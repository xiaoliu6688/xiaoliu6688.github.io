<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="电路设计（RTL）, RayBiiao">
    <meta name="description" content="优化流水线打拍带来的功耗
reference 
https://blog.csdn.net/wudpekerlily/article/details/130536789?spm=1001.2014.3001.5501

流水线中，需要对一些">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>电路设计（RTL） | RayBiiao</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 6.3.0"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">RayBiiao</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">RayBiiao</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        
    </ul>
</div>


        </div>

        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/437a6772164117edf51481393e3a706.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">电路设计（RTL）</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">
                                <span class="chip bg-color">基础知识</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E6%95%B0%E5%AD%97%E5%89%8D%E7%AB%AF/" class="post-category">
                                数字前端
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2024-01-24
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    7.6k
                </div>
                

                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.min.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h3 id="优化流水线打拍带来的功耗"><a href="#优化流水线打拍带来的功耗" class="headerlink" title="优化流水线打拍带来的功耗"></a>优化流水线打拍带来的功耗</h3><blockquote>
<p>reference </p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/wudpekerlily/article/details/130536789?spm=1001.2014.3001.5501">https://blog.csdn.net/wudpekerlily/article/details/130536789?spm=1001.2014.3001.5501</a></p>
</blockquote>
<p>流水线中，需要对一些数据进行打拍子以完成数据对齐。如果打拍子的周期太多，会产生较多无用的功耗。可以采用比较巧妙的方法，将输入数据写入类似FIFO的存储器中，不让数据流水，可以大大降低功耗。如下图所示，通过采用流水方式进行打拍，以打4拍为例进行说明。</p>
<img src="/2024/012448005/image-20240324213925897.png" alt="image-20240324213925897" style="zoom:50%;">

<p>针对功耗进行优化</p>
<img src="/2024/012448005/image-20240324214034095.png" alt="image-20240324214034095" style="zoom:50%;">

<img src="/2024/012448005/image-20240324214052705.png" alt="image-20240324214052705" style="zoom:50%;">

<p>其中，valid_out信号是valid_in信号打4拍得到的。通过这种方式，输入的数据不需要一级一级的流水到输出，只需要在合适的时机输出结果即可。在课题组的项目中，chirp状态机发出很多状态，很多信号需要对齐，可以使用这种方式完成。</p>
<img src="/2024/012448005/640.png" alt="图片" style="zoom:67%;">

<ul>
<li><p>课题组项目 后端指导前端 log</p>
<p>在做pt eco的时候，有个模块lms_delay的路径修复好几次都不成功。report_timing发现组合逻辑的路径太长造成的。检查RTL代码确实是先进行了减法 又进行了乘法，中间没有打拍。</p>
<p>采取的方式：在减法和乘法之间，打一拍，而且没有影响功能。</p>
</li>
<li><p>布线太密的原因</p>
<ul>
<li>第一个原因：寄存器位宽太大，如果对该数据进行了很多逻辑操作，就会出现布线密集的情况。</li>
<li>第二个原因：负载太大，1对多，一个信号在很多地方使用，也会导致布线密集。解决办法：使用寄存器复制的方式。</li>
</ul>
</li>
</ul>
<img src="/2024/012448005/640-1706455914012-3.png" alt style="zoom:50%;">

<ul>
<li><p>面积优化策略</p>
<p>面积：加法器 &gt; 比较器 &gt; 选择器.<br>乘法器本质也是加法器。<br>策略：<strong>先选后加，先选后比，先选后乘</strong></p>
</li>
<li><p>表达式位宽</p>
<p>利用中间值，使得结果没有歧义，比如乘法的结果是a+b的位宽之和，$unsigned(a*b)的位宽是a&#x2F;b中最大的一个，与z的定义不同。</p>
<p><img src="/2024/012448005/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIxODQyMDk3,size_16,color_FFFFFF,t_70.png"></p>
</li>
<li><p>有符号数的部分选择</p>
</li>
</ul>
<p>​	部分选择有符号数，得到的切片仍然是无符号数。<strong>哪怕选择了整个向量也是无符号的，如 input signed[7:0] a 中 a[7:0] 也会被认为是无符号的。</strong></p>
<p>​	<strong>若表达式中有一个数为无符号数，Verilog会把整个表述为无符号的，导致功能失常。</strong></p>
<ul>
<li><p>有符号数运算</p>
<p>如果是有符号数的运算，在定义时使用signed声明比较好，而不是用无符号数模拟有符号数，<strong>这样综合得到的电路更好</strong>。但是如果运算中既有无符号数，又有有符号数，结果就是无符号数的计算。</p>
<p><img src="/2024/012448005/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIxODQyMDk3,size_16,color_FFFFFF,t_70-1706971897728-3.png"></p>
</li>
<li><p>条件完备的case是没有优先级的，条件不完备是有优先级的。</p>
</li>
</ul>
<h3 id="大小端对齐"><a href="#大小端对齐" class="headerlink" title="大小端对齐"></a>大小端对齐</h3><p>大端对齐：MSB最高有效字节在内存中对应低地址；（高地址对应低位数据）<br>小端对齐：MSB最高有效字节在内存中对应高地址；地址偏移量和字节数是一一对应的关系；（低地址对应低位数据）</p>
<p>eg. 对于16进制数据0x12345678在内存中的保存方式</p>
<p><img src="/2024/012448005/image-20240221225921219.png"></p>
<p>优点：大端模式，很容易通过访问最低位地址，判断数值的正负。</p>
<h3 id="亚稳态问题"><a href="#亚稳态问题" class="headerlink" title="亚稳态问题"></a>亚稳态问题</h3><p>为了降低亚稳态，<strong>使用同步器的目的是 让下级寄存器在采样时，保证采样的数据是一个稳定的0或者1</strong>。否则，亚稳态会继续传播，有可能导致电路功能失效。同步器的每一级相当于对异步输入数据的判决，进而降低亚稳态，并不能消除亚稳态。本质是降低亚稳态的传播，否则传给其他的逻辑门，造成连锁反应，使得数字系统不稳定。</p>
<p>亚稳态失误概率</p>
<img src="/2024/012448005/image-20240507104333543.png" alt="image-20240507104333543" style="zoom: 67%;">

<p>亚稳态危害：在稳定之前输出可能是毛刺。亚稳态会继续传播，有可能导致电路功能失效。</p>
<p>建立时间setup和保持时间hold time决定了亚稳态窗口的大小。</p>
<p><strong>在工艺库的标准单元描述中，tsu和thold可能存在小于0的值，这是因为考虑了走线的延迟，相当于在外面包了一层延迟。但是tsu+thold的值一定大于0，它表示在上升沿附近数据稳定采样的一个窗口。</strong></p>
<p>当数据不满足建立setup和保持hold时间时，会出现亚稳态问题。<br>解决办法（单bit）：1. 多级同步器 2. 时钟倍频电路的多级同步器<br>方法1需要较长时间去响应异步输入，解决办法：使用倍频时钟作为两个同步器的时钟输入。（Altera的FPGA中具有这项称为时钟倍频的技术，减小异步信号输入的延迟）</p>
<img src="/2024/012448005/image-20240219205135401.png" alt="时钟倍频电路的多级同步器" style="zoom:50%;">

<ul>
<li><p>寄存器的输出 驱动 另一个寄存器的异步复位端</p>
<p>第二级寄存器的时钟和复位之间存在潜在的竞争关系。</p>
</li>
</ul>
<img src="/2024/012448005/image-20240219223205525.png" alt="异步复位" style="zoom: 33%;">

<ul>
<li><p>锁存器生成对应的电路</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token important">always @</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span> 
  <span class="token function">if</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>
  	b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  	a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token keyword">begin</span>
  	b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<img src="/2024/012448005/image-20240219225204769.png" alt style="zoom:50%;">

<p>​	某些FPGA架构不支持锁存器，在综合时会将锁存器综合成 带有反馈的组合逻辑实现。</p>
<img src="/2024/012448005/image-20240219225414951.png" alt style="zoom: 50%;">

<p>​	<strong>虽然该结构有锁存数据的能力，但是可能会违背建立时间和保持时间的要求，跟带电平触发的锁存器是不一样的。在设计中不应包含任何组合逻辑环路</strong>。<br>​	锁存器并不是不能存在的，可以用来挪用周期或借用时间来满足关键路径的要求。（time borrowing)</p>
<ul>
<li>内部时钟产生</li>
</ul>
<p>​	毛刺出现在数据上，不会有太大影响，因为是边沿采样；如果毛刺出现在时钟上，会产生明显的影响。比如，由于时钟毛刺，使得计数器的值多增加1。因此，寄存器的输入时钟最好不是经过组合逻辑处理得到的。<br>​	解决办法：将组合逻辑输出的时钟，打拍寄存器输出。</p>
<ul>
<li><p>门控时钟和时钟使能技术</p>
<p>门控时钟：当门控关闭后，时钟网络和内部的组合逻辑停止翻转，减小功耗。</p>
<img src="/2024/012448005/image-20240220103515514.png" alt style="zoom:67%;"></li>
</ul>
<p>​	同步时钟使能：以同步的方式，将输出拉死，并没有关闭时钟，而是将寄存器的输出保持不变，无法降低功耗。</p>
<img src="/2024/012448005/image-20240220103631732.png" alt style="zoom:67%;">

<ul>
<li><p>门控时钟电路</p>
<p><strong>不带锁存器的门控时钟</strong>，使用“与”门 或者 “或”门实现。</p>
<img src="/2024/012448005/image-20240220104808503.png" alt style="zoom:50%;"></li>
</ul>
<p>​	存在问题：en和clk是完全异步的，使得时钟输出畸形；</p>
<img src="/2024/012448005/image-20240220104905125.png" alt style="zoom:50%;">

<p>​	<strong>带锁存器的门控时钟</strong></p>
<p>​	为了防止高电平被意外截断，需要使用锁存器保证 在CLK为1时，即使EN拉低，GATED_CLK输出保持不变。所以需要负锁存器，在CLK拉低时，对EN进行采样，CLK拉高时锁存器的输出不变。这样可以得到完整的时钟波形</p>
<img src="/2024/012448005/image-20240220105432984.png" alt style="zoom: 50%;">

<p><strong>使用锁存器而不使用寄存器的原因：节省面积，一个DFF需要两个锁存器，而且还能降低功耗</strong></p>
<ul>
<li><p><strong>并不是所有的寄存器都要复位信号，一般情况下，控制和使能信号需要复位，数据信号不需要复位。这样可以节省面积和功耗</strong></p>
</li>
<li><p>常值的乘除法都可以进行优化；</p>
<p>除以一个数等于乘这个数的倒数；<br>一个数乘480 &#x3D;》 x*(512-32)</p>
</li>
<li><p>锁存器容易产生毛刺glitch，不能异步复位，上电后出去不确定的状态。STA非常复杂。</p>
</li>
</ul>
<p>​	锁存器latch也可以用来做timing borrow，修复setup和hold违例；正锁存器用来修复setup违例，利用高电平的透明时间。负锁存器用来修复hold违例，利用高电平的数据保持时间。</p>
<ul>
<li>摩尔状态机输出只与当前状态有关，米利状态机不仅与当前状态有关，还取决于输入；<br>因为输入的组合逻辑，所以米利状态机要比摩尔状态机输出快一个周期。</li>
</ul>
<h5 id="计算bit的位宽"><a href="#计算bit的位宽" class="headerlink" title="计算bit的位宽"></a>计算bit的位宽</h5><p>​	两个unsigned 8bit数相加&#x2F;乘，需要设置相应的位宽为：9bit&#x2F;16bit<br>​	两个signed 8bti数相加&#x2F;乘，需要设置结果位宽为：9bit&#x2F;15bit</p>
<h3 id="verilog语法"><a href="#verilog语法" class="headerlink" title="verilog语法"></a>verilog语法</h3><p>定义数字的方法：N’Bvalue。如果采用’Bvalue，大多数编译器会视为32比特，但是可能存在意想不到的错误，建议使用确定的位宽表示数据。</p>
<p>在SV中，函数function可以调用task（调用的task不能有消耗时间和延迟的语句），但是verilog中不可以。</p>
<p>function可以使用外部的变量，但是最好定义一下输入，类似形参的方式传递到function中。</p>
<p>状态机FSM最好采用摩尔型的，保证输出只与当前状态有关，而且状态是寄存器输出的，可以降低产生毛刺的概率。缺点是，输出的结果相比于米利可能会延迟一个周期。</p>
<p>在一个时钟上升沿，如果同时存在非阻塞和阻塞语句，执行顺序：先依次执行阻塞（&#x3D;），再同时执行非阻塞（&lt;&#x3D;）。</p>
<p><strong>deposit和force的区别</strong></p>
<p>force将信号赋予一个固定的值，不能为变量.<br>deposit可以将信号赋予变量值</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">initial</span> <span class="token keyword">begin</span>
	<span class="token kernel-function property">$deposit</span><span class="token punctuation">(</span>variable<span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token kernel-function property">$deposit</span><span class="token punctuation">(</span>Q<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>deposit比force好用，不用release，有其他变量向其赋值时可以直接使用。适用于没有初值的cell的输出，解决x态传播问题。</p>
<p>也可以使用force-release方式进行没有复位信号的初始化</p>
<pre class="line-numbers language-none"><code class="language-none">initial begin
	force TOP.reg_a &#x3D; 0;
	#0;
	release TOP.reg_a;
end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="任务和函数"><a href="#任务和函数" class="headerlink" title="任务和函数"></a>任务和函数</h5><p>task和function都是在模块内部任意位置定义，在模块内部使用。</p>
<p>任务和函数的局部变量都是静态的，可以用关键词automatic对变量声明，相当于每个任务和函数的局部变量都是独立唯一的，不影响多个相同任务调用时的并发执行。</p>
<p>任务：</p>
<ol>
<li>可以没有输入输出，也可以有多个。</li>
<li>可以包含延迟语句</li>
<li>task调用是过程性语句，只能出现在always块或initial块中，不能在assign中</li>
</ol>
<p>函数：</p>
<ol>
<li>至少有一个输入参数，不能声明为inout</li>
<li>可以没有输出，或者只有一个输出，函数名为输出变量</li>
<li>不能含有延迟语句</li>
</ol>
<p>区别：</p>
<ol>
<li>task可以定义自己的仿真时间单位和精度，function不可以。</li>
<li>verilog中，函数不可以调用任务，但是任务可以调用函数</li>
<li>function至少有一个输入变量</li>
</ol>
<h5 id="命名块"><a href="#命名块" class="headerlink" title="命名块"></a>命名块</h5><p>对于begin … end，如果没有命名，内部的局部变量不能被层次化引用，测试程序和vcd文件也不能引用局部变量。但是通常EDA工具会自动推断出一个名称。</p>
<h3 id="乒乓操作"><a href="#乒乓操作" class="headerlink" title="乒乓操作"></a>乒乓操作</h3><img src="/2024/012448005/image-20240303220028047.png" alt="image-20240303220028047" style="zoom: 33%;">

<p>输入数据通过输入选择单元和输出选择单元，有节拍的切换数据流，形成流水线的操作。</p>
<p>最大的特点：站在乒乓操作模块两侧，输入和输出数据的连续不断的，没有停顿。</p>
<ul>
<li><p>节省缓冲区的长度</p>
<p>前提是缓冲的数据并不是同时使用的。</p>
</li>
<li><p>用低速模块处理高速数据流</p>
<p>使用DPRAM，读写是可以同时进行的。假设读写数据周期为10ms，前5ms向DPRAM1写入数据，后5ms就可以读出前5ms写入的低地址数据，第一个10ms就多出5ms。第二个10ms，DPRAM1的数据完全可以读出数据。第三个10ms，前5ms继续向DPRAM1的低地址写入数据，但是这5ms可以读出高地址的数据，相当于又多出来5ms。因此，对于DPRAM1中的数据，最多有 <strong>20ms</strong>时间可以给下级处理，对应两个数据周期，数据吞吐量为50Mbps。</p>
<img src="/2024/012448005/image-20240303230150945.png" alt="image-20240303230150945" style="zoom:40%;"></li>
</ul>
<p><strong>静态多电压技术</strong>，可以有效降低动态功耗。但是会使得静态功耗恶化，因为低电压的缺点带来的是低阈值电压，管子更容易开启，漏电流变大。</p>
<h2 id="设计方法学"><a href="#设计方法学" class="headerlink" title="设计方法学"></a>设计方法学</h2><h3 id="解耦合"><a href="#解耦合" class="headerlink" title="解耦合"></a>解耦合</h3><p>​	降低模块间的依赖关系，提高可移植性。</p>
<h2 id="数集-数电基础"><a href="#数集-数电基础" class="headerlink" title="数集&#x2F;数电基础"></a>数集&#x2F;数电基础</h2><h5 id="最小项，最大项"><a href="#最小项，最大项" class="headerlink" title="最小项，最大项"></a>最小项，最大项</h5><p>对于n个变量a1，a2，…..，an，最小项为逻辑乘（与），并且每个变量以原变量或反变量的形式出现且仅出现一次。最大项为逻辑加，每个变量以原变量或反变量的形式出现且仅出现一次。</p>
<p><img src="/2024/012448005/v2-98f234b42df86f549e23f42bd45abfd8_720w.webp" alt="img"></p>
<h5 id="卡诺图"><a href="#卡诺图" class="headerlink" title="卡诺图"></a>卡诺图</h5><p>卡诺图中的相邻性，几何相邻性：几何位置上相邻，左右紧挨或者上下相接。对称相邻性：图形中对称位置的单元是相邻的。注意四变量卡诺图的m8位置。</p>
<img src="/2024/012448005/v2-ef968cf33cd2e7473b325e631ca90f74_720w.png" alt="img" style="zoom:50%;">

<img src="/2024/012448005/v2-02936d99e6333a22d9e4a0e5410ef6da_720w.png" alt="img" style="zoom:50%;">

<p>化简原则</p>
<img src="/2024/012448005/v2-bbd3d646e0097851d588a39e2bed8564_720w.png" alt="img" style="zoom:50%;">

<img src="/2024/012448005/v2-2772ae215d02b5d0255fc3c006232290_720w.png" alt="img" style="zoom:50%;">

<img src="/2024/012448005/v2-b0c72bd63377feb2c33966f7a7878fc1_720w.png" alt="img" style="zoom:50%;">



<h4 id="状态机的编码方式"><a href="#状态机的编码方式" class="headerlink" title="状态机的编码方式"></a>状态机的编码方式</h4><p>有三种编码方式：二进制、格雷码和独热码。</p>
<p>二进制，优点：占用资源小，实现简单。缺点：在状态跳变时，多位数据发生跳变，不利于功耗，会产生毛刺。</p>
<p>格雷码，优点：相邻状态跳转只有1bit发生变化，产生亚稳态和毛刺的概率小。缺点：编码实现复杂</p>
<p>独热码，优点：任意状态跳转，只有2bit发生变化。缺点：占用资源大。</p>
<h4 id="毛刺-glitch"><a href="#毛刺-glitch" class="headerlink" title="毛刺 glitch"></a>毛刺 glitch</h4><p>产生的原因：在组合逻辑中容易产生，多路信号同时发生变化，导致组合逻辑输出一些小的尖峰。</p>
<p>如何解决：</p>
<ol>
<li>RTL级：修改编码方式，比如使用格雷码或者独热码 替代二进制编码。</li>
<li>延迟法：产生毛刺的本质是两路信号延迟不一致导致的，可以刻意添加一定延迟，避免产生毛刺的区间。比如一个与门的输入，01 &#x3D;&gt; 10，中间出现11，会产生毛刺。如果刻意添加延迟按照这样的输入顺序 01 &#x3D;&gt; 00 &#x3D;&gt; 10，输出就不会有毛刺。</li>
<li>吸收法：添加小的滤波电容，但是恶化信号的transition time</li>
<li>利用冗余项：通过增加冗余项减小产生毛刺的可能性。在卡诺图中，卡诺圆相切的地方，在状态跳变时，容易产生毛刺，可以在相切的地方添加无关项，增加一个圆来消除组合逻辑冒险。</li>
</ol>
<p>竞争：信号经过两条以上的路径到达门的输入端，由于不同路径的延迟不一样，时间有先有后，这就叫竞争。</p>
<p>由于竞争产生的错误输出就是毛刺。</p>
<h4 id="高阻态"><a href="#高阻态" class="headerlink" title="高阻态"></a>高阻态</h4><p>数字芯片中的高阻态指的是没有任何驱动，输出既不是高电平也不是低电平，相当于开路。</p>
<h4 id="双口RAM"><a href="#双口RAM" class="headerlink" title="双口RAM"></a>双口RAM</h4><p>双口RAM是共享式的存储器，有两套独立的地址、数据和控制线。</p>
<p>结构：地址译码逻辑、数据缓冲区和控制逻辑。	<br>当同时写一个地址或者一个端口读，一个端口写同一个地址时，发生冲突。</p>
<p>解决办法：</p>
<ol>
<li>设置标志位. 两个端口的读写每次访问时，需要设置、判断标志位。</li>
<li>利用硬件解决。当发生冲突时，拉低busy信号反压控制信号ready，达到分时访问的目的。</li>
</ol>
<p>应用：由于可以并行读取和写入数据，所以适用于高速处理的数据流。比如人工智能领域，大量的矩阵存储和处理运算。</p>
<h5 id="奇校验、偶校验"><a href="#奇校验、偶校验" class="headerlink" title="奇校验、偶校验"></a>奇校验、偶校验</h5><p>偶校验：数据位  共有偶数个1，  	校验位为0；<br>奇校验：数据位  共有奇数个1，	  校验位为0；<br>0011_1011  偶校验位：1，奇校验位：0</p>
<p>面试题目总结（华为）</p>
<p><strong>在异步fifo设计中，地址比较时，有没有必要使用格雷码？</strong></p>
<p>有必要，以满信号生成为例，读地址传递过来时必须是格雷码才可以，不能是二进制数据直接采样。如果是采样二进制数据，多bit数据翻转，数据稳定的时间相比于单bit要长很多，产生毛刺的概率也很大。</p>
<p>使用格雷码的优点：计数值递增时，单比特数据发生变化，通过打两拍的方式跨时钟域传递即可。跳变时，数据稳定的时间也很短，产生毛刺的概率小。如果不使用格雷码，存在数据一致性问题，多比特数据跳变，数据稳定的时间也很长。</p>
<p><strong>2选1 MUX实现组合逻辑</strong><br>通过两个二选一的MUX实现异或逻辑，如下</p>
<p>异或的逻辑很容易用Y&#x3D;A?(~B):B;写出来，电路图可以表示为：</p>
<p><img src="/2024/012448005/wps1.png" alt="img"></p>
<p>那么，接下来，只需要用二输入MUX表示B的非门即可</p>
<p><img src="/2024/012448005/wps2.png" alt="img"></p>
<h2 id="数字前端优化"><a href="#数字前端优化" class="headerlink" title="数字前端优化"></a>数字前端优化</h2><p>比较运算的优化</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">assign</span> max_data <span class="token operator">=</span> a <span class="token operator">></span> b <span class="token operator">?</span> a <span class="token punctuation">:</span> b<span class="token punctuation">;</span>
<span class="token keyword">assign</span> min_data <span class="token operator">=</span> a <span class="token operator">></span> b <span class="token operator">?</span> b <span class="token punctuation">:</span> a<span class="token punctuation">;</span>
<span class="token operator">=></span>  通过比较符号位，得到最大和最小值
<span class="token keyword">assign</span> c <span class="token operator">=</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span>
<span class="token keyword">assign</span> max_data <span class="token operator">=</span> c<span class="token punctuation">[</span>MAX<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">?</span> b <span class="token punctuation">:</span> a<span class="token punctuation">;</span>
<span class="token keyword">assign</span> min_data <span class="token operator">=</span> c<span class="token punctuation">[</span>MAX<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">?</span> a <span class="token punctuation">:</span> b<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在逻辑综合后的门级网表中，有大量的与非门和或非门，因为采用CMOS工艺实现的，相比于与门和或门，具有更高的速度。</p>
<p><strong>数据通道不复位</strong><br>为了降低功耗和寄存器的面积，对于数据通路复位值没有意义，只有当使能信号有效时才使用，这时就可以不使用带复位的寄存器。在后仿时，需要使用$deposit初始化无复位寄存器的值。<br>deposit的作用是存储不同的值到寄存器输出q信号中，仅仅在初始化阶段提供一个初始值，防止电路后仿真时出现的x态影响其他信号。</p>
<p><strong>资源共享策略</strong><br>将重复利用的数据线，例如” &lt;&#x3D; “和” &#x3D;&#x3D; “用一个固定的线wire表示。降低面积和节省功耗。</p>
<p><img src="/2024/012448005/image-20240603142208460.png" alt="image-20240603142208460"></p>
<p><img src="/2024/012448005/image-20240603142214800.png" alt="image-20240603142214800"></p>
<p><strong>操作数隔离</strong><br>在数据通路中，将不使用的逻辑输出  的输入设置为固定值，防止其无效运算，降低功耗。</p>
<h5 id="优化毛刺的产生"><a href="#优化毛刺的产生" class="headerlink" title="优化毛刺的产生"></a>优化毛刺的产生</h5><p>bg. 在verilog仿真过程中出现一个很奇怪的现象，cnt计数值在非上升沿处发生了跳变，与预期不符，导致功能错误。代码如下：</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> hclk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span>
  <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>
    pclken  <span class="token operator">&lt;=</span> <span class="token number">1'b1</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>hclk_cnt <span class="token operator">==</span> <span class="token punctuation">(</span>hclk_pclk_ratio <span class="token operator">-</span> <span class="token number">1'b1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    pclken  <span class="token operator">&lt;=</span> <span class="token number">1'b1</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span>
    pclken  <span class="token operator">&lt;=</span> <span class="token number">1'b0</span><span class="token punctuation">;</span>
 
<span class="token keyword">assign</span> pclk_en <span class="token operator">=</span> pclken<span class="token punctuation">;</span>
<span class="token keyword">assign</span> pclk    <span class="token operator">=</span> pclken <span class="token operator">&amp;</span> hclk<span class="token punctuation">;</span>

<span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> pclk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>
  <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>
    cnt <span class="token operator">&lt;=</span> <span class="token number">'h0</span><span class="token punctuation">;</span>
  <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token keyword">begin</span>
    cnt <span class="token operator">&lt;=</span> cnt <span class="token operator">+</span> <span class="token number">'h1</span><span class="token punctuation">;</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>仿真现象：在vcs&#x2F;verdi下，cnt发现异常跳变，pclk没有异常。在modelsim上在cnt异常跳变时，pclk出现了毛刺。如下</p>
<p><img src="/2024/012448005/image-20240706004836127.png" alt="image-20240706004836127"></p>
<p>原因：这是由于pclk是组合逻辑输出，pclken是hclk下的posedge边沿同步输出的，由于Tcq的延迟，导致在hclk上升沿时，pclken会延迟很小一段时间，这个时期 hclk&amp;pclken，会有很小一段时间高电平（毛刺）。在时钟上的毛刺会导致always块误触，cnt异常累加。</p>
<p>解决办法：pclken在hclk下negedge边沿同步输出。</p>
<p><img src="/2024/012448005/image-20240706005724864.png" alt="image-20240706005724864"></p>
<p>在hclk下降沿，pclken由于Tcq延迟，并不会导致在下降沿产生毛刺，所以cnt计数值不会异常累加。</p>
<h2 id="脚本辅助设计"><a href="#脚本辅助设计" class="headerlink" title="脚本辅助设计"></a>脚本辅助设计</h2><p>使用Python生成规律的代码，比如case语句中的赋值。</p>
<p>a[15:0]和数组b[255:0], 当输入cnt为0时，a &#x3D; b[15:0];cnt为1时，a&#x3D;b[31:16];</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"case(cnt)"</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    s <span class="token operator">=</span> <span class="token string">'   4\'d'</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">': begin\n'</span>
    s <span class="token operator">=</span> s <span class="token operator">+</span> <span class="token string">'           a = b['</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">16</span><span class="token operator">+</span><span class="token number">15</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'];\n'</span>
    s <span class="token operator">=</span> s <span class="token operator">+</span> <span class="token string">'         end'</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"endcase"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="verilog高级数字系统设计技术与案例分析"><a href="#verilog高级数字系统设计技术与案例分析" class="headerlink" title="verilog高级数字系统设计技术与案例分析"></a>verilog高级数字系统设计技术与案例分析</h2><p>在ECO阶段，需要使用替补元件对电路进行修正，使用MUX很方便。很多其他逻辑都可以用MUX来实现。在ECO阶段可以使用与非门可以生成与门、或门和反相器，实现修改逻辑的目的。</p>
<h5 id="伪随机数生成器-LFSR"><a href="#伪随机数生成器-LFSR" class="headerlink" title="伪随机数生成器 LFSR"></a>伪随机数生成器 LFSR</h5><p>可以用来做扰码器和解扰器，A ^ B &#x3D; C, C ^ B &#x3D; A；A是原文信息。</p>
<img src="/2024/012448005/image-20240522232907153.png" alt="image-20240522232907153" style="zoom:33%;">

<p>两种LFSR类型：<br>    斐波那契LFSR是多对一型，多个触发器的输出经过异或给到输入。<br>    伽罗瓦LFSR是一对多型，寄存器输出可以接到多个寄存器的输入端（需要经过异或逻辑），伽罗瓦LFSR更快，因为两个触发器之间最多有一个异或门，应用在高速场景下。</p>
<img src="/2024/012448005/image-20240523000324582.png" alt="image-20240523000324582" style="zoom:50%;">

<img src="/2024/012448005/image-20240523000338539.png" alt="image-20240523000338539" style="zoom:50%;">

<p>跨时钟域传输多比特数据时，如果传输数据较少，可以采用握手机制。对于慢时钟域到快时钟域的数据传输，可以采用半握手方式。对于快时钟到慢时钟域的数据传输需要使用全握手方式。</p>
<h5 id="源同步时钟"><a href="#源同步时钟" class="headerlink" title="源同步时钟"></a>源同步时钟</h5><p>芯片间传递数据的同时还传送数据同步的时钟，时钟上升沿对准数据的中间位置。在接收端用提供的时钟将数据恢复之后，接收端可以使用一个异步fifo将恢复的数据同步到本地时钟域。</p>
<p>在一些应用中，采用两个时钟（strobe、!strobe），数据速率是时钟速率的两倍，称为DDR，用于DDR存储器中。</p>
<img src="/2024/012448005/image-20240523111612438.png" alt="image-20240523111612438" style="zoom:50%;">

<h5 id="嵌入式时钟"><a href="#嵌入式时钟" class="headerlink" title="嵌入式时钟"></a>嵌入式时钟</h5><p>源同步时钟应用于短距离和并行数据传输，对于高速和长距离传输，数据与时钟之间的相位差异会更加难以控制。在嵌入式时钟机制中，没有与数据同时传输的时钟。数据本身具有足够多的 高到低和低到高的转换，接收端利用这种转换使用PLL来提取时钟，之后使用该时钟同步接收的数据。例如PCIe，USB等，数据速率可以达到几Gbps</p>
<h5 id="提高吞吐率"><a href="#提高吞吐率" class="headerlink" title="提高吞吐率"></a>提高吞吐率</h5><ol>
<li>提高时钟频率：增加功耗。当前处理器设计趋势不仅仅提高时钟主频，而是采用其他技术提高数据处理能力，比如多核，多通道存储器等。</li>
<li>更宽的数据通道：增加数据位宽，会使得硬件成本增加，增加了设计难度，以及高频信号中常出现的电磁兼容和SI信号传输质量问题。</li>
<li>流水线</li>
<li>并行处理</li>
<li>乱序执行</li>
<li>高速缓存cache</li>
<li>预读取：在缓存区存入比当前需求更多的数据。</li>
</ol>
<h5 id="FIFO深度处理"><a href="#FIFO深度处理" class="headerlink" title="FIFO深度处理"></a>FIFO深度处理</h5><p>在异步fifo的深度选择时，考虑到格雷码翻转的规则，需要设计成2的整数次幂，比如2,4,8,16…..<br>如果需要深度为300的FIFO，按照一般的处理规则，需要设置深度为512。这种处理方案<strong>会造成很大的资源浪费</strong>。可以采用以下两种处理方式：</p>
<ol>
<li>使用两个FIFO，<strong>一个深度为300的同步FIFO，一个深度很小的（8）的异步FIFO</strong>，异步FIFO用来做跨时钟域的处理和速率匹配。</li>
<li>修改格雷码，因为格雷码是对称的。将计数值的中间值设置在512的中间(256)，上下截取150，这样可以保证相邻格雷码跳变时，只有1bit变化。（106，405），然后修改指针106的位置对应的FIFO第一个存储位置，指针405的位置对应FIFO的第300个存储位置。<br>(2^n&#x2F;2 - fifo_depth&#x2F;2) ~ (2^n&#x2F;2 + fifo_depth&#x2F;2)</li>
</ol>
<h6 id="基于触发器或者SRAM的FIFO"><a href="#基于触发器或者SRAM的FIFO" class="headerlink" title="基于触发器或者SRAM的FIFO"></a>基于触发器或者SRAM的FIFO</h6><p>根据经验，如果存储器容量小于1K位，使用触发器作为存储更合适。如果大于1K位，使用SRAM作为存储单元更合适。</p>
<p>当FIFO容量很小时，4*16，最好使用基于触发器的FIFO。如果FIFO容量为1K*32，使用触发器实现，需要的触发器个数是巨大的，FIFO的面积远大于使用SRAM的方案。另一个方面需要考虑的是FIFO的位宽和深度比值，如果存储器深度&#x2F;宽度过大或者过窄，SRAM都不是最好的选择。</p>
<h4 id="设计经验"><a href="#设计经验" class="headerlink" title="设计经验"></a>设计经验</h4><p>“<strong>除非你知道自己想去的地方，否则你不可能到达那里</strong>“</p>
<p>描述组合逻辑的方式有两种，wire和reg，两者综合后的门电路是一样的，需要根据实际情况来选择。</p>
<p>尽量使用寄存器输出，因为设计电路是层次化结构的，输出有时通过较长的路径到达另一个模块，导致互联延迟增加，采用寄存器输出，可以为后续电路留下相对宽裕的布线延迟和输入组合逻辑延迟。确定path的起点。</p>
<p>尽可能使用状态机实现控制功能，可以有效减少设计差错。</p>
<p><strong>先选后加，先选后乘。</strong>尽可能共享电路。</p>
<p><strong>采用寄存器输出的方式可以有效减少产生组合逻辑环的可能性。</strong></p>
<h5 id="初步完成代码后"><a href="#初步完成代码后" class="headerlink" title="初步完成代码后"></a>初步完成代码后</h5><ol>
<li>无论编写代码时有多么仔细，代码都会有bug，应在完成代码编写后趁热打铁，趁着熟悉即使查找问题，不要留在后面解决。</li>
<li>目测RTL代码：发现简单的问题，比如代码缩进、空格和对齐等</li>
<li>对发现bug感到惊喜</li>
</ol>
<h5 id="设计面向未来使用需求"><a href="#设计面向未来使用需求" class="headerlink" title="设计面向未来使用需求"></a>设计面向未来使用需求</h5><ol>
<li>易于实现的存储器结构：寄存器定义时，将功能相同的bit位放在一起编址</li>
<li>考虑将来需求：设计一定的冗余度；确保重要的比特位可以被软件访问到</li>
</ol>
<h5 id="设计策略"><a href="#设计策略" class="headerlink" title="设计策略"></a>设计策略</h5><ol>
<li>完成整体架构设计，使用C model或者sv建模，验证方案可行性</li>
<li>先完成，再优化。首先完成功能，再一点点精进，优化PPA</li>
</ol>
<h4 id="高速设计"><a href="#高速设计" class="headerlink" title="高速设计"></a>高速设计</h4><ol>
<li>使用独热码进行状态编码：每次状态跳变，只有2个bit翻转，数据稳定时间短，组合逻辑延迟小。</li>
<li>使用互斥的数据选择器而不是优先级编码器：具有优先级的编码器组合逻辑延迟较大，不利于提高电路的工作速度。</li>
<li>避免大量杂乱的组合逻辑电路：使用流水线进行切分</li>
<li>将后到的信号尽可能经过最小数量的逻辑门，靠近输出。</li>
<li>使用同步复位时要小心：复位信号会参与数据路径的运算，可能会带来延迟的增加。</li>
</ol>
<h4 id="SoC设计经验"><a href="#SoC设计经验" class="headerlink" title="SoC设计经验"></a>SoC设计经验</h4><h5 id="使用双触发器同步电路"><a href="#使用双触发器同步电路" class="headerlink" title="使用双触发器同步电路"></a>使用双触发器同步电路</h5><p>单比特信号跨时钟域时经常用到双触发器同步电路，建议</p>
<ol>
<li>将双触发器同步电路作为基本模块加入单元库中，在RTL时直接例化。</li>
<li>同步器模块的命名应易于识别</li>
<li>将所有的同步器放置在顶层的一个或两个模块内。</li>
</ol>
<p>时序逻辑中的case语句，默认不推荐default，当出现缺省条件时，数据保持不变，便于在DC时插入ICG，clock gating，降低功耗。</p>
<h3 id="FIFO深度计算"><a href="#FIFO深度计算" class="headerlink" title="FIFO深度计算"></a>FIFO深度计算</h3><p>fifo的几个作用</p>
<ul>
<li>解决跨时钟域传输问题</li>
<li>用来缓冲数据</li>
<li>解决位宽不匹配</li>
</ul>
<p>在实际应用中不会存在对FIFO持续写读，这样的话FIFO相当于一个存储器件，而不是缓冲器件。<strong>FIFO深度的计算建立在满足一次突发传输的基础上。</strong></p>
<h4 id="写时钟快，读时钟慢"><a href="#写时钟快，读时钟慢" class="headerlink" title="写时钟快，读时钟慢"></a>写时钟快，读时钟慢</h4><h5 id="无间断写和读"><a href="#无间断写和读" class="headerlink" title="无间断写和读"></a>无间断写和读</h5><p>如果写时钟速率为80 MHz，读时钟速率为50 MHz，写入120个数据时，FIFO深度为多少？</p>
<p>120 - 120 * （1&#x2F;80M）&#x2F; (1&#x2F;50M) &#x3D; 45, 所以FIFO深度应该为45。</p>
<h5 id="间断写和读"><a href="#间断写和读" class="headerlink" title="间断写和读"></a>间断写和读</h5><p>写时钟频率为80 MHz，读时钟频率为50 MHz，每两次写入操作间隔1个写时钟周期，每两次读取操作间隔3个读时钟周期。一次突发写入120个数据，FIFO深度为多少？</p>
<p>解法：相当于每两个写时钟周期写入一个数据，每4个读时钟周期读出一个数据。等效成无间断的读写传输。<br>120 - 120 * （1&#x2F;40M）&#x2F; (1&#x2F;12.5M) &#x3D; 83, 所以FIFO深度应该为83。</p>
<h4 id="写时钟慢，读时钟快"><a href="#写时钟慢，读时钟快" class="headerlink" title="写时钟慢，读时钟快"></a>写时钟慢，读时钟快</h4><h5 id="无间断的读写"><a href="#无间断的读写" class="headerlink" title="无间断的读写"></a>无间断的读写</h5><p>因为数据写入后，很快就被读走，所以FIFO深度设置为1即可。</p>
<h5 id="间断的读写"><a href="#间断的读写" class="headerlink" title="间断的读写"></a>间断的读写</h5><p>写时钟频率30 MHz，读时钟频率50 MHz，一次写入突发长度为120。每两次写入操作间隔1个写时钟周期，每两次读取操作间隔3个读时钟周期。求FIFO深度是多少？</p>
<p>解法：相当于写数据频率为15MHz，读数据频率为12.5MHz。<br>120 - 120 * （1&#x2F;15M）&#x2F; (1 &#x2F; 12.5M) &#x3D; 20。</p>
<h4 id="写时钟和读时钟一样快"><a href="#写时钟和读时钟一样快" class="headerlink" title="写时钟和读时钟一样快"></a>写时钟和读时钟一样快</h4><h5 id="无间断读写"><a href="#无间断读写" class="headerlink" title="无间断读写"></a>无间断读写</h5><p>如果读写时钟没有相位差，数据不需要缓冲，FIFO深度为0.<br>如果读写时钟有固定相位差，写入的数据在一个时钟周期内被读走，FIFO深度为1.</p>
<h5 id="间断读写"><a href="#间断读写" class="headerlink" title="间断读写"></a>间断读写</h5><p>写入时钟频率 fA &#x3D; 读取时钟频率 fB &#x3D; 50MHz。一次写入的突发长度120。每两次写入操作间隔1个时钟周期，每两次读取操作间隔3个时钟周期。FIFO深度应该为多少？</p>
<p>解法：相当于写数据速率为25MHz，读数据速率为12.5MHz。<br>120 - 120 * （1&#x2F;25M）&#x2F; （1 &#x2F; 12.5M）&#x3D; 60。</p>
<h4 id="特定时间内写、读速率固定"><a href="#特定时间内写、读速率固定" class="headerlink" title="特定时间内写、读速率固定"></a>特定时间内写、读速率固定</h4><p>Q：每100个时钟写入80个数据，剩余20个随机值（无效）；每10个时钟读出8个数据。求FIFO深度最小是多少才能满足要求？</p>
<p>A：在背靠背传输时，会出现写数据最多的情况，产生最大FIFO深度。</p>
<p><img src="/2024/012448005/image-20240731220200682.png" alt="image-20240731220200682"></p>
<p>160 - 160 * 0.8 &#x3D; 32；</p>
<h3 id="RDC-Reset-Domain-Cross"><a href="#RDC-Reset-Domain-Cross" class="headerlink" title="RDC(Reset Domain Cross)"></a>RDC(Reset Domain Cross)</h3><p>类似CDC问题，异步的复位信号可能会导致亚稳态问题出现。</p>
<p><img src="/2024/012448005/72827e18d53afad7a69a831aa1f1a662.png" alt="img"></p>
<p>如果rst1有效时，会导致q1的输出不确定，正好赶上dff2的时钟上升沿，产生亚稳态。</p>
<p>解决办法：</p>
<ul>
<li><p>在rst1复位之前，rst2正处于复位中。</p>
<p><img src="/2024/012448005/ad4559a61e7ca8f488e1919fa0a7aa72.png" alt="img"></p>
</li>
<li><p>数据隔离</p>
<p>在rst1复位时，将q1的输出 与 隔离信号做 与，输出0</p>
<p><img src="/2024/012448005/5f46cf212c9cd14162dabf73bdaf02b6.png" alt="img"></p>
</li>
<li><p>时钟隔离</p>
<p>在rst1复位时，让dff2的时钟信号无效。</p>
<p><img src="/2024/012448005/5b1a57234f4701b30291f2bea085e635.png" alt="img"></p>
</li>
</ul>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">刘瑞彪</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://xiaoliu6688.github.io/2024/012448005.html">https://xiaoliu6688.github.io/2024/012448005.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">刘瑞彪</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">
                                    <span class="chip bg-color">基础知识</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2024/012760393.html">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/ab6a6ac23e089b075464f8d5856ef32.jpg" class="responsive-img" alt="计算机体系结构">
                        
                        <span class="card-title">计算机体系结构</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2024-01-27
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E6%95%B0%E5%AD%97%E5%89%8D%E7%AB%AF/" class="post-category">
                                    数字前端
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">
                        <span class="chip bg-color">基础知识</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2024/012139355.html">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/ebe263d658c4f1f19afcdd23ba0d8a5.jpg" class="responsive-img" alt="icc_flow">
                        
                        <span class="card-title">icc_flow</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2024-01-21
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/ASIC%E6%95%B0%E5%AD%97%E5%90%8E%E7%AB%AF%E6%B5%81%E7%A8%8B/" class="post-category">
                                    ASIC数字后端流程
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/ICC/">
                        <span class="chip bg-color">ICC</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE' || selection.getRangeAt(0).commonAncestorContainer.nodeName === 'CODE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: RayBiiao<br />'
            + '文章作者: 刘瑞彪<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- 是否加载使用自带的 prismjs. -->
  <script type="text/javascript" src="/libs/prism/prism.min.js"></script>


<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2023-2024</span>
            
            <a href="/about" target="_blank">刘瑞彪</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">79.9k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">








    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1603386505" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1603386505" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
    
    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
     
        <script type="text/javascript">
            // 只在桌面版网页启用特效
            var windowWidth = $(window).width();
            if (windowWidth > 768) {
                document.write('<script type="text/javascript" src="/libs/others/star.js"><\/script>');
            }
        </script>
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
