<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Serdes接口</title>
      <link href="/2024/100237375.html"/>
      <url>/2024/100237375.html</url>
      
        <content type="html"><![CDATA[<p><img src="/2024/100237375/image-20241002142911050.png" alt="image-20241002142911050"></p><p><img src="/2024/100237375/image-20241002142956274.png" alt="image-20241002142956274"></p><p>TTL电路输出到0和1的驱动能力相差较大，不适合做为serdes中的有线连接部门。</p><p>CMOS电路输出驱动能力差不多，但是传播延迟较大，也不适用。</p><p>有线连接的框图</p><p><img src="/2024/100237375/image-20241002150522228.png" alt="image-20241002150522228"></p><p>Serializer的作用</p><p>将所有有关的信号转换成串行bit流数据，</p><p><img src="/2024/100237375/image-20241002151223382.png" alt="image-20241002151223382"></p><p>需要注意的几个点：</p><ol><li>DC Balance：比特流中应该保证0和1的个数差不多，否则影响均值静态电压</li><li>时钟恢复：需要从不断反转的比特流中获取时钟频率</li><li>电磁接口：考虑高次谐波对于比特流的影响</li></ol><p>Scrambler和Encoder目的是让输出的0和1更加均匀，Scrambler通过和伪随机发生器异或得到加密后的数据，Encoder通过扩展两bit使得输出的0和1数目更加均匀。</p><p><img src="/2024/100237375/image-20241002152545076.png" alt="image-20241002152545076"></p><p><img src="/2024/100237375/image-20241002152611091.png" alt="image-20241002152611091"></p><p><img src="/2024/100237375/image-20241002153735768.png" alt="image-20241002153735768"></p><p><img src="/2024/100237375/image-20241002153754132.png" alt="image-20241002153754132"></p><p><img src="/2024/100237375/image-20241002153911862.png" alt="image-20241002153911862"></p><p><img src="/2024/100237375/image-20241002154101460.png" alt="image-20241002154101460"></p><p><img src="/2024/100237375/image-20241002162041107.png" alt="image-20241002162041107"></p><p><img src="/2024/100237375/image-20241002162522079.png" alt="image-20241002162522079"></p><p><img src="/2024/100237375/image-20241002163853220.png" alt="image-20241002163853220"></p><p><img src="/2024/100237375/image-20241002164146001.png" alt="image-20241002164146001"></p><p>音频传输</p><p>嵌入在图像传输中</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>FPGA/ASIC Timing Optimization</title>
      <link href="/2024/100110667.html"/>
      <url>/2024/100110667.html</url>
      
        <content type="html"><![CDATA[<p>如何决定电路的时序约束（周期）？</p><ol><li>基于板卡所能提供的最大频率freq</li><li>根据电路的应用场景，有实时性和带宽的要求</li></ol><img src="/2024/100110667/image-20241001153050168.png" alt="image-20241001153050168" style="zoom: 33%;"><img src="/2024/100110667/image-20241001153142542.png" alt="image-20241001153142542" style="zoom:33%;"><p><img src="/2024/100110667/image-20241001153437029.png" alt="image-20241001153437029"></p><p>Cell&#x2F;Logic Delays</p><p><img src="/2024/100110667/image-20241001154927692.png" alt="image-20241001154927692"></p><p>优化LUT查找表的延迟</p><p>注意：任何n输入的LUT，可以实现n输入，1输出的组合逻辑。</p><p><img src="/2024/100110667/image-20241001160122994.png" alt="image-20241001160122994"></p><p>如果只是单纯记录计数器循环的次数，每次循环拉高一个cycle即可，可以使用下面的优化策略，如果a的所有bit相同，表示经过了一次循环。这样，组合逻辑的延迟为1级LUT的延迟。在前端代码设计中，可以使用&amp;a缩减符代替a &#x3D;&#x3D; 0实现。</p><p><img src="/2024/100110667/image-20241001160650065.png" alt="image-20241001160650065"></p><p>通过插入寄存器打断关键路径方式优化组合逻辑</p><p><img src="/2024/100110667/image-20241001161246132.png" alt="image-20241001161246132"></p><p>重定时方式</p><p><img src="/2024/100110667/image-20241001161336432.png" alt="image-20241001161336432"></p><p>重定时可能会导致电路的初试状态和综合前后不一致，只存在一个cycle的差异，但是综合工具是不知道的。</p><p><img src="/2024/100110667/image-20241001162020511.png" alt="image-20241001162020511"></p><p>减小精度</p><p><img src="/2024/100110667/image-20241001162145738.png" alt="image-20241001162145738"></p><p>降低net delay的方法</p><p><img src="/2024/100110667/image-20241001162608947.png" alt="image-20241001162608947"></p><p><img src="/2024/100110667/image-20241001162841551.png" alt="image-20241001162841551"></p><p><img src="/2024/100110667/image-20241001162924724.png" alt="image-20241001162924724"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>DFT-FLOW</title>
      <link href="/2024/081033826.html"/>
      <url>/2024/081033826.html</url>
      
        <content type="html"><![CDATA[<img src="/2024/081033826/image-20240810110410570.png" alt="image-20240810110410570" style="zoom: 33%;"><p>DFT用来检测制造过程中的缺陷，而不是设计bug。</p><h4 id="Stuck-At-Fault-Model-故障分析模型"><a href="#Stuck-At-Fault-Model-故障分析模型" class="headerlink" title="Stuck-At Fault Model 故障分析模型"></a>Stuck-At Fault Model 故障分析模型</h4><p>用逻辑结果0和1代替物理失效产生的故障</p><p><img src="/2024/081033826/image-20240810113810794.png" alt="image-20240810113810794"></p><p><img src="/2024/081033826/image-20240810115325881.png" alt="image-20240810115325881"></p><p><img src="/2024/081033826/image-20240810115410268.png" alt="image-20240810115410268"></p><p>测试向量是软件自动生成的。</p><p>优势：可以通过软件穷举所有的输入激励。<br>缺点：某些错误可能无法发现；每一步需要花费时间计算。</p><p>为了设置芯片内部寄存器的状态，检测故障，需要使用特殊的寄存器。</p><p><img src="/2024/081033826/image-20240810130033206.png" alt="image-20240810130033206"></p><p>所有寄存器通过扫描链连接在一起</p><p><img src="/2024/081033826/image-20240810130311471.png" alt="image-20240810130311471"></p><p> <img src="/2024/081033826/image-20240810131016740.png" alt="image-20240810131016740"></p><p>实际工作模式</p><p><img src="/2024/081033826/image-20240810132527009.png" alt="image-20240810132527009"></p><p>ATE：Auto Test Equipment，ATE可以自动执行一系列的测试，收集和分析测试数据。<br>ATPG：自动生成有效检测硬件故障的测试向量</p><h4 id="DFT-“views”"><a href="#DFT-“views”" class="headerlink" title="DFT “views”"></a>DFT “views”</h4><p>-view spec：only for <strong>insert_dft</strong><br>-view exist：only for <strong>dft_drc</strong> </p><h3 id="Top-Down-Scan-Insertion-Flow"><a href="#Top-Down-Scan-Insertion-Flow" class="headerlink" title="Top-Down Scan Insertion Flow"></a>Top-Down Scan Insertion Flow</h3><p><img src="/2024/081033826/image-20240810173936226.png" alt="image-20240810173936226"></p><h5 id="Specify-a-clock"><a href="#Specify-a-clock" class="headerlink" title="Specify a clock"></a>Specify a clock</h5><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl"><span class="token keyword">set</span> <span class="token variable">test_default_period</span> 100set_dft_signal <span class="token operator">-</span>view existing_dft <span class="token operator">-</span>type ScanClock <span class="token operator">-</span>port clock <span class="token operator">-</span>timing <span class="token punctuation">&#123;</span>45 55<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="/2024/081033826/image-20240810163341509.png" alt="image-20240810163341509"></p><h5 id="Specify-a-reset"><a href="#Specify-a-reset" class="headerlink" title="Specify a reset"></a>Specify a reset</h5><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">set_dft_signal <span class="token operator">-</span>view existing_dft <span class="token operator">-</span>type Reset <span class="token operator">-</span>port resetn <span class="token operator">-</span>active_state 0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/2024/081033826/image-20240810163539268.png" alt="image-20240810163539268"></p><h5 id="Specify-a-Scan-enable"><a href="#Specify-a-Scan-enable" class="headerlink" title="Specify a Scan enable"></a>Specify a Scan enable</h5><p>scan enable used for <strong>both</strong> dft_drc and insert_dft</p><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">set_dft_signal <span class="token operator">-</span>view exist <span class="token operator">-</span>active 1 <span class="token operator">-</span>type ScanEnable <span class="token operator">-</span>port test_se set_dft_signal <span class="token operator">-</span>view spec <span class="token operator">-</span>active 1 <span class="token operator">-</span>type ScanEnable <span class="token operator">-</span>port test_se <span class="token operator">-</span>hookup_pin U3<span class="token operator">/</span>Z<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="/2024/081033826/image-20240810165352709.png" alt="image-20240810165352709"></p><h5 id="Specify-a-Constant"><a href="#Specify-a-Constant" class="headerlink" title="Specify a Constant"></a>Specify a Constant</h5><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">set_dft_signal <span class="token operator">-</span>view existing_dft <span class="token operator">-</span>type Constant <span class="token operator">-</span>port atpgmode <span class="token operator">-</span>active_state 1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p> <img src="/2024/081033826/image-20240810165825982.png" alt="image-20240810165825982"></p><h5 id="Specify-a-Scan-In"><a href="#Specify-a-Scan-In" class="headerlink" title="Specify a Scan In"></a>Specify a Scan In</h5><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">set_dft_signal <span class="token operator">-</span>view spec <span class="token operator">-</span>type ScanDataIn <span class="token operator">-</span>port test_si <span class="token operator">-</span>hookup_pin U1<span class="token operator">/</span>Z<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/2024/081033826/image-20240810170026245.png" alt="image-20240810170026245"></p><h5 id="Specify-a-Scan-Out"><a href="#Specify-a-Scan-Out" class="headerlink" title="Specify a Scan Out"></a>Specify a Scan Out</h5><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">set_dft_singal <span class="token operator">-</span>view spec <span class="token operator">-</span>type ScanDataOut <span class="token operator">-</span>port test_so <span class="token operator">-</span>hookup_pin U2<span class="token operator">/</span>A<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/2024/081033826/image-20240810170134268.png" alt="image-20240810170134268"></p><h4 id="example"><a href="#example" class="headerlink" title="example"></a>example</h4><p><img src="/2024/081033826/image-20240810174039687.png" alt="image-20240810174039687"></p><h5 id="创建DFT协议"><a href="#创建DFT协议" class="headerlink" title="创建DFT协议"></a>创建DFT协议</h5><p> test protocol：在测试模式下如何控制设计（clocking，scan shifting，disabling asynchronous reset）</p><p><strong>Steps for creating a test protocol</strong></p><ol><li><p>define scan signals，clocks，resets，constant</p><p>set_dft_signal</p></li><li><p>define&#x2F;create the test protocol using</p><p>read_test_protocol  or  create_test_protocol</p></li></ol><p>让工具理解定义的scan clock，reset，scan enable，scan in，scan out等，为后面的dft_drc和insert_dft做准备。在dft_drc，preview_dft，insert_dft之前需要保证有test_protocol。</p><h5 id="dft-drc"><a href="#dft-drc" class="headerlink" title="dft_drc"></a>dft_drc</h5><p>检查是否违反设计规则，确保正确设置了DFT</p><h5 id="插入扫描路径-insert-dft"><a href="#插入扫描路径-insert-dft" class="headerlink" title="插入扫描路径 insert_dft"></a>插入扫描路径 insert_dft</h5><pre class="line-numbers language-none"><code class="language-none">preview_dftinsert_dft<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>preview_dft 命令是把将要实现的DFT结构报告出来而不是真正要去实现它。 因此 preview_dft 命令允许用户不进行逻辑综合就能对scan chain等信息进行预览，并且根据需求再调整DFT设计。</p>]]></content>
      
      
      <categories>
          
          <category> 数字中端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DFT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Advanced SOC Design</title>
      <link href="/2024/071810566.html"/>
      <url>/2024/071810566.html</url>
      
        <content type="html"><![CDATA[<h2 id="Advanced-SOC-Design-Clock"><a href="#Advanced-SOC-Design-Clock" class="headerlink" title="Advanced SOC Design Clock"></a>Advanced SOC Design Clock</h2><p>低功耗 &#x3D;&gt; many clock domain</p><ul><li>跨时钟域数据传输</li><li>STA  false path</li><li>function verification 困难</li></ul><h3 id="glitch-free-clock-Switching"><a href="#glitch-free-clock-Switching" class="headerlink" title="glitch-free clock Switching"></a>glitch-free clock Switching</h3><p><img src="/2024/071810566/image-20240718142706324.png" alt="image-20240718142706324"></p><p>由于select信号和时钟是异步的，所以会有产生毛刺的概率。</p><p>解决办法：让两个时钟都在低电平的时候才能切换，保证了没有毛刺。</p><p><img src="/2024/071810566/image-20240718143138683.png" alt="image-20240718143138683"></p><p>为了降低亚稳态，DFF1的输入是异步的，所以需要使用两级同步器打拍（上升沿触发）</p><p><img src="/2024/071810566/image-20240718143729197.png" alt="image-20240718143729197"></p><p>对于ratioed clocks，可以类比到多个时钟域切换，为了减小毛刺，所有时钟为低电平时，才切换。而不需要上述方式，判断每两个时钟为低电平的时候切换。当所有时钟为低电平的时候，都可以进行时钟切换。</p><p><img src="/2024/071810566/image-20240718144837174.png" alt="image-20240718144837174"></p><h3 id="clock-gating"><a href="#clock-gating" class="headerlink" title="clock gating"></a>clock gating</h3><p><img src="/2024/071810566/image-20240718150157476.png" alt="image-20240718150157476"></p><h4 id="XOR-based-Clock-Enable-Signal"><a href="#XOR-based-Clock-Enable-Signal" class="headerlink" title="XOR based Clock Enable Signal"></a>XOR based Clock Enable Signal</h4><p><img src="/2024/071810566/image-20240718151303834.png" alt="image-20240718151303834"></p><p>如果输入和输出一样，门控时钟就有效。</p><p>ICG会引入skew，给CTS带来压力，影响建立和保持时间检查。</p><p>如果clock latency大于period，还会恶化pll jitter，影响setup和hold检查。</p><h4 id="Asynchronous-Synchronous-Interface"><a href="#Asynchronous-Synchronous-Interface" class="headerlink" title="Asynchronous-Synchronous Interface"></a>Asynchronous-Synchronous Interface</h4><p><img src="/2024/071810566/image-20240718152422063.png" alt="image-20240718152422063"></p><p>亚稳态如果不处理，会传递给下级模块，下级逻辑的settle time不一致导致采样不一样的结果。</p><p>为什么两级同步器之间不加任何组合逻辑原因？</p><ul><li>增加组合逻辑 会增加settle时间（判决时间）</li></ul><p><img src="/2024/071810566/image-20240718154002938.png" alt="image-20240718154002938"></p><p>异步信号只能接入一个寄存器。如果接入到两个寄存器，可能造成数据一致性的问题，进入不确定的状态。</p><h5 id="多个异步输入信号接入到不同的逻辑"><a href="#多个异步输入信号接入到不同的逻辑" class="headerlink" title="多个异步输入信号接入到不同的逻辑"></a>多个异步输入信号接入到不同的逻辑</h5><p><img src="/2024/071810566/image-20240718154339622.png" alt="image-20240718154339622"></p><p>解决办法：</p><ul><li><p>每次只有一个变化。格雷码编码</p></li><li><p>握手机制</p></li><li><p>debouncing </p><p>连续采样数据很多次，如果连续两次采样的数据都是一样的，就可以接收这次数据。这种方法适合在采样时钟下，输入数据持续多个周期的场景， 适合慢时钟域数据传输到快时钟域。</p></li></ul><p><img src="/2024/071810566/image-20240718155039261.png" alt="image-20240718155039261"></p><h4 id="CDC"><a href="#CDC" class="headerlink" title="CDC"></a>CDC</h4><p><img src="/2024/071810566/image-20240718162137799.png" alt="image-20240718162137799"></p><p>快时钟域到慢时钟域：</p><ol><li>开环：3个边沿原则</li><li>闭环：握手机制，ack和req</li></ol><h5 id="多比特数据跨时钟域传输方法"><a href="#多比特数据跨时钟域传输方法" class="headerlink" title="多比特数据跨时钟域传输方法"></a>多比特数据跨时钟域传输方法</h5><p><img src="/2024/071810566/image-20240718163236677.png" alt="image-20240718163236677"></p><h5 id="CTS-issues"><a href="#CTS-issues" class="headerlink" title="CTS issues"></a>CTS issues</h5><img src="/2024/071810566/image-20240718170832951.png" alt="image-20240718170832951" style="zoom:67%;"><h3 id="Reset"><a href="#Reset" class="headerlink" title="Reset"></a>Reset</h3><p>并不是所有的寄存器都需要reset，它会占用很大的功耗、面积等。</p><p>当芯片第一次起来时，一个额外的POR（power on reset）确保进入有序的状态。</p><p>不要把有reset和没有reset的寄存器放在一个always块中。</p><img src="/2024/071810566/image-20240718201029670.png" alt="image-20240718201029670" style="zoom:80%;"><p>异步复位在释放时，考虑是否有race condit</p><p><img src="/2024/071810566/image-20240719095317255.png" alt="image-20240719095317255"></p><p>复位时，Q：1 0 0 0 ，在异步复位释放时，有可能产生 0 0 0 0的非法状态。</p><p>因此，需要保证异步复位信号是同步释放的，满足removal和recovery time。</p><p>尽可能保证复位时的值和释放时的值是同一个，否则会导致输出有一个周期的延迟，造成功能错误。</p><p>为了滤除复位信号上的毛刺，设计毛刺过滤电路。</p><p><img src="/2024/071810566/image-20240719101126658.png" alt="image-20240719101126658"></p><p>如果时钟频率很快，无法满足在一个时钟周期内将复位信号到达所有寄存器。解决办法：</p><ol><li><p>reset signal distribution</p><p><img src="/2024/071810566/image-20240719103416123.png" alt="image-20240719103416123"></p></li><li><p>停止clk，等待复位信号计数到一定数值稳定后，再打开时钟</p><p><img src="/2024/071810566/image-20240719103514844.png" alt="image-20240719103514844"></p></li></ol><h4 id="multi-clock-reset"><a href="#multi-clock-reset" class="headerlink" title="multi clock reset"></a>multi clock reset</h4><p><img src="/2024/071810566/image-20240719104629097.png" alt="image-20240719104629097"></p><p>不同时钟域的复位信号有一定的顺序。</p><h4 id="cross-reset-domain"><a href="#cross-reset-domain" class="headerlink" title="cross reset domain"></a>cross reset domain</h4><p>一个时钟域可能有不同的reset域，</p><p><img src="/2024/071810566/image-20240719104956631.png" alt="image-20240719104956631"></p><img src="/2024/071810566/image-20240719140141386.png" alt="image-20240719140141386" style="zoom:67%;"><p>RST1 release时，产生异步信号给DFF2，在DFF2的上升沿容易产生亚稳态。</p><p><img src="/2024/071810566/image-20240719141256767.png" alt="image-20240719141256767"></p><h3 id="Power-on-Reset"><a href="#Power-on-Reset" class="headerlink" title="Power on Reset"></a>Power on Reset</h3><p>保证每次复位，微处理器进入同样的状态。</p><p><img src="/2024/071810566/image-20240719112723314.png" alt="image-20240719112723314"></p><p>PLL用POR做reset，需要extend POR等待时钟稳定后，才可以release复位信号。</p><p><img src="/2024/071810566/image-20240719113444704.png" alt="image-20240719113444704"></p><h2 id="IO-serdes"><a href="#IO-serdes" class="headerlink" title="IO serdes"></a>IO serdes</h2><p>系统同步方案</p><p>接收和发送使用同一个时钟，critical path在于两个时钟交互的路径上，有input&#x2F;output delay、skew的限制</p><p><img src="/2024/071810566/image-20240719142656055.png" alt="image-20240719142656055"></p><p>源同步方案（DDR）</p><p>64bit 数据总线的DDR，每8bit使用一个data strobe采样数据。如果64bit共用一个data strobe，数据的skew太大</p><p><img src="/2024/071810566/image-20240719144803471.png" alt="image-20240719144803471"></p><p><img src="/2024/071810566/image-20240719145039502.png" alt="image-20240719145039502"></p>]]></content>
      
      
      <categories>
          
          <category> 读书笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SOC设计 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SystemVerilog硬件设计及建模</title>
      <link href="/2024/071129443.html"/>
      <url>/2024/071129443.html</url>
      
        <content type="html"><![CDATA[<h2 id="第2章-SV声明的位置"><a href="#第2章-SV声明的位置" class="headerlink" title="第2章 SV声明的位置"></a>第2章 SV声明的位置</h2><p>logic：四态变量，0 1 x z<br>enum：枚举变量<br>typedef：用户定义类型<br>struct：结构体</p><h3 id="2-1-package包"><a href="#2-1-package包" class="headerlink" title="2.1 package包"></a>2.1 package包</h3><p>为了使得多个模块共享用户定义的类型，sv增加了包的概念。在<code>package</code>和<code>endpackage</code>之间定义。包中可综合的结构有：</p><ol><li>parameter和localparam常量定义</li><li>const变量定义</li><li>typedef用户定义类型</li><li>automatic的task和function定义</li><li>从其他包中import语句</li><li>操作符重载定义</li></ol><p>包中还可以进行全局变量声明、静态任务定义和静态函数定义，但是这些都是不可综合的。包是一个独立的空间，不需要包含在verilog模块中。</p><p>const常量是sv常量，每个模块的实例可以对parameter常量重新定义，但是不能对localparameter定义。</p><p>如果赋给real类型变量，parameter定义的变量需要是显式的小数（4.0）。</p><h4 id="引用包的内容"><a href="#引用包的内容" class="headerlink" title="引用包的内容"></a>引用包的内容</h4><ol><li>用范围解析操作符直接引用</li><li>将包中特定子项&#x2F;通配符导入到模块或者接口中</li></ol><p>import definations:: *;</p><p>在综合时，包中定义的任务和函数必须声明为automatic，不能包含静态变量。</p><h3 id="2-2-unit编译单元声明"><a href="#2-2-unit编译单元声明" class="headerlink" title="2.2 $unit编译单元声明"></a>2.2 $unit编译单元声明</h3><p>相比verilog，sv增加了编译单元的概念。编译单元是同时编译所有的源文件，编译单元可以为软件提供对整个设计的子模块单独编译的方法。编辑单元域可以包含：</p><ol><li>时间单位和精度</li><li>变量声明</li><li>net声明</li><li>常量声明</li><li>用户定义的数据类型</li><li>任务和函数定义</li></ol><p>注意，外部声明不可综合。<strong>不要在$unit空间进行任何声明，所有声明在package包中</strong> 外部编译单元域声明不是全局的，sv的编译单元域之作用域同时编译的源文件，每次编译源文件，就会创建一个唯一针对此次编译的编译单元域。必要时将包导入$unit中。</p><p>为了防止重复定义，使用 <strong>条件编译</strong>。带条件编译的包</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">&#96;ifndef DFF_DONE&#96;define DFF_DONEpackage definitions     parameter Version &#x3D; &quot;1.1&quot;    typedef enum &#123;ADD, SUB, MUL&#125; opcode_t;    typedef struct &#123;        logic [2:0] a;        logic [2:0] b;        opcode_t OP;    &#125; instruction_t;    function automatic [31:0] multipler(input [31:0] a, b);        runturn a*b;    endfunctionendpackageimport definitions:: *;&#96;endif<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>每个需要包中定义的设计或者测试平台都应该将</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">&#96;include &quot;definations.pkg&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>放在文件的开始，如果包已经被编译并导入到unit域，该文件的编译就会被忽略。</p><p>使用&#96;include目的是为了保证在defination.pkg文件末尾的导入语句导入到设计或者测试文件中，编译正在使用的同一$unit域。如果直接出现在编译器的命令行中（和.v一样），包和导入语句就会被编译到另外一个$unit空间，而不是设计或测试平台正在使用的$unit域。</p><p>可在编译单元域可综合的结构有：</p><ol><li>typedef用户定义类型</li><li>自动函数&#x2F;任务</li><li>parameter&#x2F;localparam常量</li><li>包导入</li></ol><h2 id="第3章-SV文本值和数据类型"><a href="#第3章-SV文本值和数据类型" class="headerlink" title="第3章 SV文本值和数据类型"></a>第3章 SV文本值和数据类型</h2><p>sv中给变量赋值全1：<code>reg [31:0] data; data = &#39;1;</code></p><p>verilog数据类型<br>reg、integer和time是四值逻辑。wire和其他net类型的共有120种逻辑（四态逻辑+多个驱动强度）。</p><p>sv数据类型<br>定义的信号同时具有类型和数据类型。类型指示信号是 <strong>线网还是变量</strong>。数据类型指示是四值逻辑还是二值逻辑。</p><h2 id="SV-for-Design"><a href="#SV-for-Design" class="headerlink" title="SV for Design"></a>SV for Design</h2><p>inside {a,b,c} 可以代替||；</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">if(v inside &#123;3&#39;b001, 3&#39;b010, 3&#39;b100&#125;)$display(&quot;v &#x3D; %b&quot;, v);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="System-Verilog基础"><a href="#System-Verilog基础" class="headerlink" title="System Verilog基础"></a>System Verilog基础</h2><h4 id="SV中的参数传递：input，output，ref"><a href="#SV中的参数传递：input，output，ref" class="headerlink" title="SV中的参数传递：input，output，ref"></a>SV中的参数传递：input，output，ref</h4><p>两种原则：值传递和地址传递</p><p>对于数组的传递，<br>如果是input，是标准的值传递。不会改变原来的值。<br>如果是output，是地址传递，数组共有两份，函数内部看到的是新创建的一份，在函数退出时，原来的数据丢弃掉<br>如果是ref，是标准的地址传递，数组只有一份，函数里面和外面共同维护同一组数据。</p><p>对于类的传递，<br>如果是input和ref，是标准的地址传递。<br>如果是output，报null point的error</p><blockquote><p><a href="https://blog.csdn.net/qq_41467882/article/details/121684326#_output__42">https://blog.csdn.net/qq_41467882/article/details/121684326#_output__42</a></p></blockquote><p>构造函数 new：在声明时，不能有返回值，void也不可以。</p><h4 id="静态属性"><a href="#静态属性" class="headerlink" title="静态属性"></a>静态属性</h4><p>静态变量在多个实例之间是共享的。</p><p>静态方法只能访问静态变量，访问非静态变量是非法的。静态方法不能是virtual的。</p><p>在不创建对象的情况下，可以访问静态变量和静态方法。</p><p><strong>声明为automatic的函数&#x2F;任务，支持迭代，否则不支持。另外一个用途是在fork join中，如果没有生命auto则只能允许一个函数，如果调用两次，可能会有冲突</strong></p><h4 id="浅拷贝和深拷贝"><a href="#浅拷贝和深拷贝" class="headerlink" title="浅拷贝和深拷贝"></a>浅拷贝和深拷贝</h4><p>浅拷贝中，所有变量的值都被复制，但是不复制对象，只复制句柄。</p><p>要想实现深拷贝，需要实现自定义的方法，完成对象的复制。每次调用copy方法时，句柄都指向新的对象。</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">class basic_test;    int def;    int fin;    virtual function void copy_data(basic_test t);        t.def &#x3D; def;        t.fin &#x3D; fin;    endfunction    virtual function basic_test copy();        basic_test t;        t &#x3D; new();        copy_data(t);        return t;  &#x2F;&#x2F; 必须要返回值    endfunctionendclassclass wr_test extends basic_test;    int def;    function void copy_data(basic_test t);        wr_test wr;        super.copy_data(t);        $cast(wr, t);        wr.def &#x3D; def;    endfunction    function basic_test copy();        wr_test t &#x3D; new();        copy_data(t);        return t; &#x2F;&#x2F; 必须要返回值    endfunctionendclass&#x2F;&#x2F;tbmodule tb;    test_wr wr;    test_wr h;    wr &#x3D; new();    $cast(h, wr.copy());    &#x2F;&#x2F; h和wr指向两个独立的test_wr对象endmodule<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="类的继承"><a href="#类的继承" class="headerlink" title="类的继承"></a>类的继承</h4><p>派生类继承父类的方法和变量；允许多级继承；子类可以修改父类的属性和方法；</p><h4 id="多态性"><a href="#多态性" class="headerlink" title="多态性"></a>多态性</h4><p>子类可以对继承的父类方法进行修改，当使用父类句柄指向子类对象时，所对应的方法是子类修改后的。</p><p>同一个方法的不同实现形式，称为多态性。具体执行哪个方法，取决于句柄的类型。</p><h4 id="转换cast"><a href="#转换cast" class="headerlink" title="转换cast"></a>转换cast</h4><h5 id="静态转换"><a href="#静态转换" class="headerlink" title="静态转换"></a>静态转换</h5><p>在编译过程中完成静态转换，运行时不会有检查和错误报告。</p><p>不适用于对象句柄转换。</p><p>使用<code>‘</code> 强制转换更改数据类型。int’(123.0)</p><h5 id="动态转换"><a href="#动态转换" class="headerlink" title="动态转换"></a>动态转换</h5><p>子类句柄的值可以直接赋给父类句柄。</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">parent_class &#x3D; child_class; &#x2F;&#x2F; 允许 <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>父类句柄的值 不可以 赋给子类句柄。（编译错误，可以通过$cast跳过编译时的检查）</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">child_class &#x3D; parent_class; &#x2F;&#x2F; 不允许<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>如果父类句柄的值是指向子类对象的，可以将父类句柄的值赋给子类句柄</strong></p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">parent_class &#x3D; child_class1;child_class2 &#x3D; parent_class; &#x2F;&#x2F;允许$cast(child_class, parent_class);、&#x2F;&#x2F;$cast(dst,src); 需要保证src父类句柄指向子类对象<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>由于父类句柄的值是变化的，在执行过程中，可以被赋值给子类句柄。因此，$cast被称为动态转换。</p><h4 id="数据隐藏和封装"><a href="#数据隐藏和封装" class="headerlink" title="数据隐藏和封装"></a>数据隐藏和封装</h4><p>将数据隐藏在类中，并仅通过方法对其访问。</p><h5 id="local"><a href="#local" class="headerlink" title="local"></a>local</h5><p>通过将成员声明为本地成员，避免通过句柄在外部对变量进行修改。不允许在子类声明中访问local的变量。</p><h5 id="protected"><a href="#protected" class="headerlink" title="protected"></a>protected</h5><p>不允许通过句柄访问该变量，但是在子类声明中可以访问保护的变量。</p><h4 id="virtual-抽象类"><a href="#virtual-抽象类" class="headerlink" title="virtual 抽象类"></a>virtual 抽象类</h4><p>用virtual声明为抽象类，抽象类为子类设置了原型。抽象类不能实例化，只能派生。</p><p>抽象类可以包含只有方法的声明，而没有实现。</p><h4 id="virtual-虚方法"><a href="#virtual-虚方法" class="headerlink" title="virtual 虚方法"></a>virtual 虚方法</h4><p>当父类使用virtual定义的函数和方法，父类句柄在指向子类对象时，可以动态索引到子类重写的方法。</p><p>通过虚方法，无需担心句柄类型是父类还是子类，实现动态绑定。</p><ul><li>在为父类定义方法时，如果该方法后面会被覆盖或者继承，需要加virtual。需要保证子类和父类方法的参数和返回值类型都是一样的。</li><li>virtual在父类中声明一次即可</li><li>不能给变量添加virtual</li></ul><p>范围解析运算法::，允许从类的外部访问静态变量和方法。</p><h4 id="virtual-虚接口-interface"><a href="#virtual-虚接口-interface" class="headerlink" title="virtual 虚接口 interface"></a>virtual 虚接口 interface</h4><p>引入interface可以简化硬件模块间的信号连接，即interface是连接硬件的。对于验证来说，环境是软件的，面向对象的。interface无法再软件环境中实例化，无法通过interface将激励给到DUT。为了解决这个问题，引入了virtual interface，使得基于OOP的验证环境可以通过interface将激励给到DUT。</p><h4 id="回调函数"><a href="#回调函数" class="headerlink" title="回调函数"></a>回调函数</h4><p><img src="/2024/071129443/image-20241004221230128.png" alt="image-20241004221230128"></p><ol><li><p>预留回调函数的入口</p></li><li><p>定义回调类以及回调函数</p><p><img src="/2024/071129443/image-20241004222800234.png" alt="image-20241004222800234"></p><p><img src="/2024/071129443/image-20241004222834670.png" alt="image-20241004222834670"></p></li><li><p>例化以及添加回调实例</p><p><img src="/2024/071129443/image-20241004222910139.png" alt="image-20241004222910139"></p></li></ol><p><img src="/2024/071129443/image-20241004223100735.png" alt="image-20241004223100735"></p><h4 id="外部方法-extern"><a href="#外部方法-extern" class="headerlink" title="外部方法 extern"></a>外部方法 extern</h4><p>在类中需要使用extern声明方法；</p><p>在外部实现时，需要使用类解析运算符指定类名，表明方法对应于哪个类。</p><p>外部的方法&#x2F;任务必须和类中声明的方法&#x2F;任务 <strong>参数名称 一样</strong></p><h4 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h4><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">bit [7:0] unpacked_word [3:0]; &#x2F;&#x2F; 非组合型&#x2F;&#x2F; [7:0]是深度，[3:0]是深度，表示深度为4；   不可以设置为[1:0]unpacked_word &#x3D; &#39;&#123;8&#39;h12,8&#39;h34,8&#39;h56,8&#39;h78&#125;;bit [3:0] [7:0] packed_word; &#x2F;&#x2F; 组合型packed_word &#x3D; &#123;&#39;h12345678&#125;;&#x2F;&#x2F;动态数组int dyn1[], dyn2[];initial begin   dyn1 &#x3D; new[10];   foreach(dyn1[i]) dyn1[i] &#x3D; i;   dyn2 &#x3D; new[15](dyn1);end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="typedef类"><a href="#typedef类" class="headerlink" title="typedef类"></a>typedef类</h4><p>提供类的前向声明。在某些情况下，需要再类声明之前例化类。</p><h4 id="随机化"><a href="#随机化" class="headerlink" title="随机化"></a>随机化</h4><p>verilog使用$random生成随机整数，sv提供 rand和randomize方法，便于类对象的随机化。</p><p>rand和randc的区别：randc在随机化时，变量值不会重复。</p><p>为了随机化对象变量，需要使用randomize</p><p>通过rand_mode来选择是否启用随机化。</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">p.var.rand_mode(0&#x2F;1);p.rand_mode(0&#x2F;1);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>在调用randomize时，系统会调用pre_randomize()和post_randomize()函数，用户可以覆盖该函数，进行自定义的处理。</p><p>类中所有被指定或者没有被rand修饰的变量，在constrain如果使用到了，都可以作为randomize被随机化。</p><h4 id="约束随机化"><a href="#约束随机化" class="headerlink" title="约束随机化"></a>约束随机化</h4><p>约束块是类成员，跟变量、函数、任务一样的地位；由条件或表达式组成，用来限制随机变量的值；</p><p>约束块用大括号{}括起来；</p><p>可以在类中定义，也可以像extern在外部定义，在类外定义的约束块称为extern约束块。</p><p>与类成员一样，约束块也可以继承，如果遇到同名的约束，子类的对象遵从子类的约束；</p><p><strong>约束方法</strong>：</p><ol><li>可以是可变的、常量或者范围的</li><li>使用inside{ … }；  使用逗号指定特定的值，使用中括号[]指定范围；</li><li>constrain addr_range { addr &gt; 3;}；</li><li>可以使用其他随机变量作为限制条件； constraint addr_range { addr inside {[start_addr:end_addr]}; }</li><li>范围取反，constraint addr_range { addr !(inside {[5:10]}); }</li><li>限定特殊值 constraint con {addr <strong>&#x3D;&#x3D;</strong> 16’h1234};</li></ol><h5 id="dist约束"><a href="#dist约束" class="headerlink" title="dist约束"></a>dist约束</h5><p>dist可以设置随机值出现的概率;dist {value :&#x3D; 3, value2 :&#x3D; 4, [value3：value4] :&#x2F; 4}；</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">addr dist &#123;2 :&#x3D; 5, [10：12] :&#x3D; 4&#125;;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="数组约束"><a href="#数组约束" class="headerlink" title="数组约束"></a>数组约束</h5><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">constraint con &#123;a.size inside &#123;[1:10]&#125;;&#125;constraint con1 &#123;foreach(a[i]) a[i] inside [1:100];                 a.sum() &lt; 1024;                &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="句柄数组"><a href="#句柄数组" class="headerlink" title="句柄数组"></a>句柄数组</h5><p>rand修饰句柄数组，需要在new中对数组创建最大数目的对象；</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">class RandStuff;rand bit [1:0] stuff;endclassclass RandArray;rand Randstuff array[];constraint con &#123;arrary.size inside &#123;[1:10]&#125;;&#125; funciton new();array &#x3D; new[10];foreach(array[i])array[i] &#x3D; new();endfunctionendclass<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="随机控制"><a href="#随机控制" class="headerlink" title="随机控制"></a>随机控制</h5><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">randsequence (stream)stream: cfg_read :&#x3D; 1 |io_read :&#x3D; 2 |mem_read : &#x3D; 5;cfg_read: &#123;cfg_read_task;&#125; | &#123;cfg_read_task;&#125; cfg_read;io_read: &#123;io_read_task;&#125; | &#123;io_read_task;&#125; io_read;mem_read: &#123;mem_read_task;&#125; | &#123;mem_read_task;&#125; mem_read;endsequence&#x2F;&#x2F; 对随机安排原子automic测试序列很有帮助&#x2F;&#x2F; randcase 创建随机决策树int len;randcase 1: len &#x3D; $unrandom_range(0,2);8: len &#x3D; $unrandom_range(3,5);1: len &#x3D; $unrandom_range(6,7);endcase<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="隐含约束"><a href="#隐含约束" class="headerlink" title="隐含约束"></a>隐含约束</h5><p>使用 -&gt; 隐含运算符，如果LHS为真，则约束有效；</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">string addr_range;rand int addr;constraint addr_range &#123;(addr_range &#x3D;&#x3D; &quot;small&quot;) -&gt; (addr &lt; 8)&#125;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h5 id="if-else"><a href="#if-else" class="headerlink" title="if else"></a>if else</h5><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">constraint address_range &#123; if(addr_range &#x3D;&#x3D; &quot;small&quot;)                              addr &lt; 8;                           else                              addr &gt; 8;                         &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="foreach-约束"><a href="#foreach-约束" class="headerlink" title="foreach 约束"></a>foreach 约束</h5><p>foreach使得约束数组更为容易</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">constraint constraint_name &#123; foreach( var[i]) var[i] &lt;condition&gt; &#125;;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">constraint size_addr &#123;  addr.size &lt; 6;&#125;;constraint size_data &#123;  data.size &#x3D;&#x3D; addr.size;&#125;;constraint addr_values&#123;  foreach(addr[i]) addr[i] inside &#123;4, 6, 8, 10&#125;;&#125;;constraint data_values&#123;  foreach(data[i]) data[i] inside &#123;1, 3, 5, 7, 9, 11&#125;;&#125;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用constraint_mode()方法可禁用任何特定的约束块，默认为1；属于约束块的函数；</p><h5 id="静态约束"><a href="#静态约束" class="headerlink" title="静态约束"></a>静态约束</h5><p>通过static来声明，所有实例所共享。对于没有静态声明的约束，每个对象对约束的控制都是独立的。</p><h5 id="内联约束"><a href="#内联约束" class="headerlink" title="内联约束"></a>内联约束</h5><p>关键词：with；在外部编写约束，与randomize一起调用；</p><p>约束求解器考虑内联约束和类内部约束。内联约束不会覆盖类内部的约束。两个约束不能冲突，否则随机化失败。</p><p>为了解决约束冲突问题，在类约束中使用 <strong>soft软约束</strong>，外部的内联约束具有更高的优先级。</p><h5 id="唯一unique约束"><a href="#唯一unique约束" class="headerlink" title="唯一unique约束"></a>唯一unique约束</h5><p>生成数组或者变量集合中的唯一元素</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">constraint unique_name &#123;unique &#123;var1, var2, var3&#125;&#125;;constraint unique_name &#123;unique &#123;array&#125;&#125;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h5 id="solve-before"><a href="#solve-before" class="headerlink" title="solve before"></a>solve before</h5><p>强制约束求解器来选择求解约束的顺序。</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">constraint sab &#123;solve a before b&#125;;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="随机系统函数"><a href="#随机系统函数" class="headerlink" title="随机系统函数"></a>随机系统函数</h5><p>$urandom()；&#x2F;&#x2F; 无符号32bit随机数</p><p>$random()；&#x2F;&#x2F; 有符号32bit随机数</p><p>$urandom_range()；&#x2F;&#x2F; 有范围的无符号32bit随机数</p><h4 id="信号量"><a href="#信号量" class="headerlink" title="信号量"></a>信号量</h4><p>实现共享资源的控制和基本同步。</p><p>使用信号量的进程必须首先获取信号量，然后才能执行。</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">semaphore sem_name;sem_name &#x3D; new(nums_of_keys); &#x2F;&#x2F; 默认信号量为0sem_name.put(nums_of_keys); &#x2F;&#x2F; 将信号量释放，默认释放1.sem_name.get(nums_of_keys); &#x2F;&#x2F; 获取信号量，默认为1sem_name.try_get(nums_of_keys); &#x2F;&#x2F; 尝试获取信号量，不会阻塞<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="邮箱"><a href="#邮箱" class="headerlink" title="邮箱"></a>邮箱</h4><p>通用邮箱</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">mailbox mailbox_name;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>参数化邮箱</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">mailbox#(type) mailbox_name;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">new(); &#x2F;&#x2F; 无界的邮箱new(m_size); &#x2F;&#x2F; 有大小的邮箱put();try_put();get();num();try_get();<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>邮箱相当于一个通道，可以指定通道的类型。Generator往通道写数据，Driver从通道读取数据。</p><h4 id="事件Event"><a href="#事件Event" class="headerlink" title="事件Event"></a>事件Event</h4><p>事件可用于进程的同步；事件操作由两个进程组成，一个进程触发事件，一个进程等待事件触发。</p><p>使用 -&gt; 或者 -&gt;&gt;符号触发事件</p><p>等待事件使用wait 或者 @</p><p>sv引入了triggered()函数，用来检测某个事件是否被触发过，包括正在触发。线程可以等待这个结果，而不需用@阻塞，解决竞争问题。</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">event</span> a<span class="token punctuation">;</span><span class="token keyword">initial</span> <span class="token keyword">begin</span><span class="token number">#50</span>ns<span class="token punctuation">;</span><span class="token operator">-></span>a<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token keyword">initial</span> <span class="token keyword">begin</span> <span class="token number">#50</span>ns<span class="token punctuation">;</span>@a<span class="token punctuation">;</span> <span class="token comment">// 有可能能等到，有可能等不到，存在竞争</span><span class="token keyword">end</span><span class="token keyword">initial</span> <span class="token keyword">begin</span><span class="token number">#50</span>ns<span class="token punctuation">;</span><span class="token function">wait</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>trigerred<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 一定可以等到，因为triggered可以检测事件被触发过。</span><span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>等待线程的语句需要在触发线程之前执行</p></li><li><p>@event与wait(event.triggered)的区别：</p><p>若触发进程和等待进行在同一时刻，使用@event检测触发会发生竞争，@可能会错过检测事件的触发，而使用wait(event.trigerred)不会冲突，正常检测触发。</p></li></ul><p>事件Event的检测控制 一般用@， wait也可以检测事件，<strong>或者和表达式结合起来用</strong></p><pre class="line-numbers language-none"><code class="language-none">event a;-&gt;a;&#x2F;&#x2F; two ways@(a)wait(a.trigerred)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="wait-order"><a href="#wait-order" class="headerlink" title="wait_order();"></a>wait_order();</h5><p>按照一定的顺序触发事件，否则会运行错误。</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">wait_order(a,b,c); 如果不按照a b c来触发事件，就会报错。wait_order(a,b,c) success &#x3D; 1; else success &#x3D; 0;  &#x2F;&#x2F; 不会报错<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>当一个事件变量被赋值给另一个事件变量时，两者将合并。因此，对任一事件变量执行 -&gt; 都会影响等待任一事件变量的进程。</p><h4 id="program"><a href="#program" class="headerlink" title="program"></a>program</h4><ul><li>可以实例化，像模块一样连接</li><li>可以包含一个或多个initial块</li><li>不能包含always、模块、接口或者其他程序</li><li>不能使用非阻塞赋值</li></ul><p>program在设计和测试平台之间提供了无竞争的交互，程序块在REACTIVE反应区执行；模块内的非阻塞在ACTIVE活动区执行。</p><h4 id="接口interface"><a href="#接口interface" class="headerlink" title="接口interface"></a>接口interface</h4><p>SV添加了接口，封装了模块之间的通信。接口interface是硬件的概念，和module是平级的。接口是一组信号的集合，虚拟接口表示接口实例的变量。</p><ul><li>接口指定了方向，即modport</li><li>时序信息：时钟模块</li><li>接口可以有参数、常量、变量、函数和任务</li><li>接口声明一次，句柄在模块&#x2F;组件之间传递</li></ul><h5 id="虚拟接口"><a href="#虚拟接口" class="headerlink" title="虚拟接口"></a>虚拟接口</h5><p>接口实例的变量。？</p><ul><li>在使用虚拟接口之前，需要先对其进行初始化。即，虚拟接口必须连接&#x2F;指向实际接口。</li><li>访问未初始化的虚拟接口会导致运行时出现致命错误</li><li>虚拟接口可以声明为类属性，这些属性可以通过new（）的参数进行初始化</li><li>虚拟接口变量可以作为参数传递给任务，函数和方法</li><li>所有接口变量&#x2F;方法都可以通过虚拟接口句柄访问，即virtual_intf.var</li></ul><p>单个虚拟接口变量可以在整个仿真过程中的不同时间表示不同的接口实例。</p><p>在类中不可以实例化接口，但是允许声明虚拟接口指向实例化的接口。因此虚拟接口是接口类型的变量，在类中通过访问虚拟接口，进而访问接口信号。</p><h4 id="modport"><a href="#modport" class="headerlink" title="modport"></a>modport</h4><p>对接口信号进行分组并规定方向。</p><ul><li>通过指定端口方向，modport提供访问限制；</li><li>和在module中声明端口类似</li><li>不允许对使用输入声明的modport线进行驱动，否则导致编译错误</li><li>可以有任意数量的modports，一个线可以被分到多个modport中</li><li>modport中可以有input，inout，output和ref</li></ul><h4 id="时钟块"><a href="#时钟块" class="headerlink" title="时钟块"></a>时钟块</h4><p>可以在接口、模块或者程序块program中声明；</p><p>采样时发生竞争，会导致采样数据错误。为了避免在RTL仿真中出现信号竞争的问题，建议通过非阻塞赋值延迟的方式解决同步问题。</p><p>由于各种可能性，如果clk和采样数据之间只存在若干个delta-cycle延迟，采样就有可能出现问题。clocking块基于时钟周期对信号进行采样和驱动的方式，可以消除信号竞争的问题。</p><p>在时钟这个延迟时，需要引用时钟块的信号才可以看到延迟。</p><p><img src="/2024/071129443/image-20240813011123859.png" alt="image-20240813011123859"></p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">clocking cb @(posedge clk);  default input #1ps output #2;  input  from_Dut;  output to_Dut;endclocking<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>周期延迟 ##</p><p>##8 表示延迟8个周期。</p><h3 id="断言"><a href="#断言" class="headerlink" title="断言"></a>断言</h3><p>验证设计的行为，断言是嵌入在设计中或者仿真过程中绑定到设计单元的检查。警告或者错误是在特定条件下或者事件序列失败时生成的。 <strong>用于特定条件或者事件序列的发生，提供功能覆盖</strong>率。</p><p>何时添加断言：状态机跳转、死锁、活锁；FIFOs，onehot等。模块间的协议验证、非期望的信号组合，稳定状态要求。</p><p>有两种类型的断言：立即断言和并发断言；</p><p><strong>立即断言</strong>是在当前仿真时间的检查，必须将立即断言放在过程块中。</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">label: assert(expression) action_block;  &#x2F;&#x2F; 可以在断言语句周围创建一个命名块<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>action_block</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">pass_statement; else fail_statement;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>默认情况下，断言失败为错误。可以在fail_statement中指定严重性级别；</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">$fatal：运行时致命$error: 运行时错误$warning：运行时警告$info: 表示断言失败，没有特定的严重性<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>并发断言</strong>检查分布在多个时钟周期中的事件序列。</p><ul><li>只有在时钟边沿才会执行。</li><li>测试表达式在时钟边沿根据所涉及的变量的采样值进行计算</li><li>可以放置在程序块、模块、接口或者程序定义中。</li></ul><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">assert property(@(posedge clk) a&amp;&amp;b); &#x2F;&#x2F; 用property 区分 立即断言<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>SVA检查器的步骤</p><img src="/2024/071129443/image-20240813112811809.png" alt="image-20240813112811809" style="zoom:50%;"><p>序列：在涉及多个&#x2F;单个时钟周期的时间段内计算布尔表达式。一个sequence可以包含若干个布尔表达式；同时允许在sequence中使用一些新的操作符，比如##,重复操作符、序列操作符。</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">sequence name_of_sequence...endsequence<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>属性property：按逻辑或顺序组合多个序列，创建更复杂的序列。可以使用隐含操作符 |-&gt;和 |-&gt;&gt; 。</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">property name_of_property(参数);test_expression or    complex sequence expressionendproperty<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>assert断言：</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">assertion_name : assert property(property_name);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="SVA序列sequence"><a href="#SVA序列sequence" class="headerlink" title="SVA序列sequence"></a>SVA序列sequence</h4><p>检查每个时钟边沿的行为</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">sequence seq1@(posedge clk) a &#x3D;&#x3D; 1;endsequence<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>序列表达式 </p><p>通过在序列定义中定义参数，作为抽象模板；</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">sequence seq_lib(a, b)a||b;endsequencesequence seq_1    seq_lib(req1, req2);endsequence<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>具有时序关系的序列</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">sequence seq    @(posedge clk) a ##2 b;endsequence&#x2F;&#x2F; 当上升沿时，如果a为1，之后两个周期后，b为1，则断言成功；否则失败。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>任何在sequence中的语句，都可以放在property</li><li>任何property的语句，也可以放在sequence中，但是不能包含隐含操作符</li><li>property中可以例化其他property和sequence，sequence只能调用sequence，不能例化property。</li><li>property需要用cover&#x2F;assert&#x2F;assume等关键字例化，而sequence直接调用即可。</li></ul><h5 id="SVA中时钟使用情况"><a href="#SVA中时钟使用情况" class="headerlink" title="SVA中时钟使用情况"></a>SVA中时钟使用情况</h5><p>时钟可以在序列中指定，也可以在property中指定，也可以在断言语句中指定；</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">sequence seq     @(posedge clk) a ##2 b;endsequencesequence seq1    a ##2 b;endsequenceproperty p    @(posedge clk) seq1;endpropertyassert property(p); <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通常在property中定义时钟并保持序列独立于时钟比较好，提高代码的复用率。</p><p><strong>断言序列不需要单独的property定义，要检查的表达式可以直接从assert中调用</strong></p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">sequence seqa ##2 b;endsequenceassert property(@(posedge clk) seq);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>assert中，如果调用了一个property，再定义时钟是非法的。</p><h4 id="隐含运算符"><a href="#隐含运算符" class="headerlink" title="隐含运算符"></a>隐含运算符</h4><p>隐含构造只能与property定义一起使用，不能在sequence中使用。</p><p>有两种类型：重叠的隐含，非重叠的隐含。</p><p>重叠： |-&gt;。如果前因存在匹配项，则在同一周期计算后面的表达式；</p><p>非重叠：|&#x3D;&gt;。如果前因存在匹配项，则在下一个周期计算后面的表达式；</p><h5 id="SVA中的计数窗口"><a href="#SVA中的计数窗口" class="headerlink" title="SVA中的计数窗口"></a>SVA中的计数窗口</h5><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">property p;  @(posedge clk) a |-&gt; ##[0:4] b;endpropertyassert property(p);&#x2F;&#x2F; 在当前周期且前四个周期内b拉高    property p;  @(posedge clk) a |-&gt; ##[1:4] b;endpropertyassert property(p);&#x2F;&#x2F; 在下个周期到第四个周期内b拉高。property p;  @(posedge clk) a |-&gt; ##[1:$] b;endpropertyassert property(p);&#x2F;&#x2F; 检查器会持续检查b的值一直拉高<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="重复运算"><a href="#重复运算" class="headerlink" title="重复运算"></a>重复运算</h5><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">property p;  @(posedge clk) a |-&gt; ##1 b ##1 b ##1 b;endpropertya: assert property(p);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>上升沿a为高后，b应该持续三个周期为高，才可以断言成功。可以通过下面的重复运算符简化代码</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">signal [*n] or sequence [*n]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">property p;  @(posedge clk) a |-&gt; ##1 b[*3];endpropertya: assert property(p);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>转到重复运算符：用于指定信号将于指定的次数匹配，而不一定在连续周期上。</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">signal [-&gt;n]property p@(posedge clk) a |-&gt; ##1 b[-&gt;3] ##1 c;endproperty<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>非连续重复：和转到重复类似，不同：不要求信号重复的最后一个匹配项发生在整个序列匹配结束之前的时钟周期中。</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">signal [&#x3D;n] a ##1 b[-&gt;1:3] ##1 c ; &#x2F;&#x2F;eg. a !b b !b !b b b ca ##1 b[&#x3D;1:3] ##1 c; &#x2F;&#x2F;eg. a !b b !b !b b b !b !b c<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="SVA-内置方法"><a href="#SVA-内置方法" class="headerlink" title="SVA 内置方法"></a>SVA 内置方法</h4><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">$rose(boolean expression or signal name);&#x2F;&#x2F; 如果表达式的最低有效位更改为1，则返回true；否则，返回falsesequence seq_rose    @(posedge clk) $rose(a);endsequence$fell(boolean expression or signal name)&#x2F;&#x2F; 如果表达式的最低有效位更改为0，则返回true；否则，返回false$stable(boolean expression or signal name)&#x2F;&#x2F; 如果表达式的值未更改，则返回 true。否则，它将返回 false。$past(signal, nums of clock cycles);&#x2F;&#x2F; 提供来自上一个时钟周期的信号值。property p;  @(posedge clk) b |-&gt; ($past(a,2) &#x3D;&#x3D; 1);endpropertya: assert property(p);&#x2F;&#x2F; b有效的前两个周期，a为1，断言才成功。a_1: assert property( @(posedge clk) $onehot(state) );a_2: assert property( @(posedge clk) $onehot0(state) );a_3: assert property( @(posedge clk) $isunknown(bus) ) ;a_4: assert property( @(posedge clk) $countones(bus)&gt; 1 );&#x2F;&#x2F; a_1 断言独热码 &#x2F;&#x2F; a_2 断言state是否为0或者独热码&#x2F;&#x2F; a_3 断言所有位中是否有x，z&#x2F;&#x2F; a_4 计算向量中的1的位数     and: 断言两个事件同时发生intersect(a, b); intersect: 断定两个事件同时发生和结束or: 断定两个事件至少一个发生    property ifelse_prop    @(posedge clk)    if(check) delay1    else   delay2;endproperty<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="local-variables"><a href="#local-variables" class="headerlink" title="local variables"></a>local variables</h5><p>允许使用中间变量</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">sequence seqlogic [7:0] lport;(in_en, lport &#x3D; data_in) ##[1:5] (out_en and lport &#x3D;&#x3D; portout);endsequence<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h5 id="match-operators-匹配操作符"><a href="#match-operators-匹配操作符" class="headerlink" title="match operators 匹配操作符"></a>match operators 匹配操作符</h5><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">a within b : b事件发生的时间段内包含a事件发生的时间段c throughout a: 断定a事件成立的过程中，c事件一直成立firstmatch(a b c): 只要a成立，就不用判断后面的b、c了<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h5 id="disable-iff"><a href="#disable-iff" class="headerlink" title="disable iff"></a>disable iff</h5><p>在某些条件下，如果某个条件为真，我们不希望继续检查，可以通过 disable iff来实现。</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">property p@(posedge clk)    disbale iff (reset) a |-&gt; ##1 b[-&gt;3] ##1 c;endproperty<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h5 id="ended"><a href="#ended" class="headerlink" title="ended"></a>ended</h5><p>连接序列时，序列的重点可以作为同步点。</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">sequence seq_1; (a &amp;&amp; b) ##1 c;endsequencesequence seq_2;  d ##[4:6] e;endsequenceproperty p;  @(posedge clk) seq_1.ended |-&gt; ##2 seq_2.ended;endpeopertya: assert property(p);&#x2F;&#x2F; 检查seq1和seq2是否匹配，他们之间有两个周期的延迟。如果不使用ended，seq_2会从d是否为1开始检查。&#x2F;&#x2F; seq_1结束的时候，延迟两个周期后，seq2事件也结束。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="实现可变延迟"><a href="#实现可变延迟" class="headerlink" title="实现可变延迟"></a>实现可变延迟</h4><p>在断言时，使用##var会导致编译错误，在断言时使用变量是非法的。</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">sequence delay_seq(v_delay);    int delay;    (1, delay &#x3D; v_delay) ##0 (delay &gt;&#x3D; 0, delay&#x3D;delay-1) [*0:$];endsequenceorsequence delay_seq(v_delay);  int delay;  (1,delay&#x3D;v_delay) ##0 first_match((1,delay&#x3D;delay-1) [*0:$] ##0 delay &lt;&#x3D;0);endsequence&#x2F;&#x2F; first_match 目的是只匹配第一次，delay&lt;&#x3D;0的条件，即delay&#x3D;0;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="覆盖率"><a href="#覆盖率" class="headerlink" title="覆盖率"></a>覆盖率</h4><h5 id="代码覆盖率"><a href="#代码覆盖率" class="headerlink" title="代码覆盖率"></a>代码覆盖率</h5><ul><li>衡量设计代码的执行程度</li><li>包括行覆盖、FSM、条件覆盖、分支覆盖、翻转覆盖率；</li><li>仿真工具自动从设计代码中提取代码覆盖率</li></ul><h5 id="功能覆盖率"><a href="#功能覆盖率" class="headerlink" title="功能覆盖率"></a>功能覆盖率</h5><ul><li><p>衡量在验证中执行了多少设计规范。</p></li><li><p>面向数据的覆盖率：检查数据值的组合。通过编写覆盖组、覆盖点以及交叉覆盖 获取面向数据的覆盖率</p></li><li><p>面向控制的覆盖率：检查是否发生了一系列的行为。通过编写sv 断言获取断言覆盖率。</p></li></ul><p>覆盖率模型用covergroup构造定义，与类类似，可以通过new创建多个实例。covergroup可以在模块、程序、接口或类中定义。</p><ul><li>可以包括同步覆盖点采样的时钟事件</li><li>一组覆盖点</li><li>覆盖点之间的交叉覆盖</li><li>可选的形式参数</li></ul><p>模块验证阶段出口条件：功能覆盖率100%，行覆盖率100%，分支覆盖率100%，条件覆盖率95%，状态机覆盖率90%左右，并对没有覆盖的地方给出说明。</p><p>系统验证及其子系统验证时，关心模块之间的接口</p><p>覆盖率点：对一个信号或者变量出现的值的定义或分类。</p><p>交叉覆盖率点：对多个相互关联的信号或者变量可能出现的值的正交叉值，可以是两个或者多个，但最好不超过三个。</p><ul><li>标签：用来表示覆盖率点</li><li>变量：被采集的信号线，变量或者标签的交叉</li><li>选项：覆盖率点的控制信息</li><li>仓（容器）：分为自创建仓和自定义仓，交叉覆盖率点只能包含自创建仓。</li><li>忽略容器：不关心的仓</li><li>非法容器：不允许被击中的仓</li></ul><h3 id="验证的方法"><a href="#验证的方法" class="headerlink" title="验证的方法"></a>验证的方法</h3><p>主要验证方法类型：</p><ol><li><p>功能仿真</p><p>按照激励生成和检查方式，分为：</p><ul><li>定向测试</li><li>随机测试</li><li>参考模型检查</li><li>断言检查</li></ul></li><li><p>静态检查</p><p>不需要添加激励</p><ul><li>语法检查syntax</li><li>语义检查lint</li><li>跨时钟域检查CDC</li><li>形式验证formality</li></ul></li><li><p>虚拟模型（ESL、SystemC）</p><p>建模，可以在其上面开发软件或者获取性能数据，并对其进行修改，给硬件设计提供指导。判断硬件和软件的协同任务是否可以满足功耗目标。</p><p><img src="/2024/071129443/image-20241004000647978.png" alt="image-20241004000647978"></p></li><li><p>硬件加速</p><p>FPGA和专用的模拟器；FPGA主要是为软件开发提供平台，而模拟器是为了硬件和软件协同验证仿真。</p></li><li><p>电源功耗（UPF）</p><p>功能验证：采用PA（Power Aware）通过与仿真器结合，模拟电源域的开关进行设计检查</p><p>功耗预测与优化:通过功耗分析工具，结合仿真数据（FSDB&#x2F;VCD&#x2F;SAIF）进行功耗预测，并且给出分析结果。</p></li><li><p>性能评估</p></li></ol><h3 id="UVM简介"><a href="#UVM简介" class="headerlink" title="UVM简介"></a>UVM简介</h3><p><img src="/2024/071129443/image-20241004091458318.png" alt="image-20241004091458318"></p><p>UVM组件 uvm_component</p><p><img src="/2024/071129443/image-20241004092041835.png" alt="image-20241004092041835"></p><p>UVM环境</p><p>phase机制，通过该机制可以将UVM仿真阶段层次化，不单单是各个phase的先后执行顺序，而且处于同一phase中的层次化组件之间的phase也有先后顺序。</p><p><img src="/2024/071129443/image-20241004093030910.png" alt="image-20241004093030910"></p><p><img src="/2024/071129443/image-20241004093305985.png" alt="image-20241004093305985"></p><h3 id="覆盖率-1"><a href="#覆盖率-1" class="headerlink" title="覆盖率"></a>覆盖率</h3><p>覆盖率类型</p><p><img src="/2024/071129443/image-20241004094703858.png" alt="image-20241004094703858"></p><p>先使用一个反馈回路分析覆盖率结果，并决定采用哪些行动来达到100%的覆盖率</p><p>首先选择是使用更多的种子运行程序，如果对于覆盖率没有明显变化，考虑建立新的约束，只有在确实需要的时候才会创建定向测试。</p><p><img src="/2024/071129443/image-20241004095048849.png" alt="image-20241004095048849"></p><p><img src="/2024/071129443/image-20241004100154360.png" alt="image-20241004100154360"></p><p>仿真结束后，eda工具可以自动生成断言覆盖率数据。断言覆盖率数据被集成在同一个覆盖率数据库中，verifier可以进行分析。</p><h4 id="覆盖组coverage"><a href="#覆盖组coverage" class="headerlink" title="覆盖组coverage"></a>覆盖组coverage</h4><p>coverage可以包含一个或者多个coverpoint，且全部在同一时间采集</p><p>coverage可以定义在类中，也可以定义在interface或者module中。定义时必须有一个coverpoint。</p><p>covergroup可以采样任何可见的变量，例如程序变量、接口信号或者设计端口</p><p>一个类中可以包含多个covergroup，每个covergroup可以单独设置使能或者禁止。</p><p>covergroup必须被例化才可以用来收集数据。</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">class Transactor;Transaction tr;covergroup CovPort;coverpoint tr.port;endgroupfunction new();CovPort &#x3D; new();&#x2F;&#x2F; CovPort cg1 &#x3D; new();endfunctiontask main;    CovPort.sample();&#x2F;&#x2F; 采样数据endtaskendclass<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">&#x2F;&#x2F; way2 event trans_ready;covergroup CovPort @(posedge clk)coverpoint tr.point;endgroup<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="数据采样"><a href="#数据采样" class="headerlink" title="数据采样"></a>数据采样</h4><p>当coverpoint指定采样一个变量或者表达式时，sv会创建很多仓bin来记录每个数据捕获到的次数。</p><p>bin是衡量功能覆盖率的基本单位</p><p>covergroup中可以定义多个coverpoint，coverpoint中可以定义多个cover bin或者sv帮助自动定义多个cover bin</p><p>每次covergroup采样数据后，sv会在一个或者多个cover bin中留下标记，用来记录采样时变量的数值和匹配的cover bin</p><p>仿真结束后，使用eda工具读取这些数据库生成功能覆盖率</p><p>coverpoint中变量可能存在的个数，称为域，所有coverpoint的覆盖率最终构成一个covergroup的覆盖率。所有的covergroup的覆盖率构成整体的功能覆盖率。</p><p>如果coverpoint的域范围太大，系统会默认分配64个bin，将值域范围平均分配给这64个bin，可以通过<code>auto_bin_max</code>来指定自动创建bin的最大数目。</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">covergroup CovPort;options.auto_bin_max &#x3D; 8;coverpoint tr.point&#123;options.auto_bin_max &#x3D; 2;&#125;    coverpoint tr.kind &#123;        bins zero &#x3D; &#123;0&#125;;        bins lo &#x3D; &#123;[1:3], 5&#125;; &#x2F;&#x2F; 1个仓代表1:3和5        bins hi[] &#x3D; &#123;8:$&#125;;&#x2F;&#x2F; 8个独立的仓。        bins defaults &#x3D; default;     &#125; &#x2F;&#x2F; 没有分号;endgroup<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>coverpoint使用{}，而不是begin  end；</p><h4 id="条件覆盖率"><a href="#条件覆盖率" class="headerlink" title="条件覆盖率"></a>条件覆盖率</h4><p>使用关键词iff给cover point添加条件；也可以使用start和stop函数控制cover group各个独立实例；</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">covergroup CoverPort;coverpoint port iff(!bus_if.reset)endgroup&#x2F;&#x2F; iff 条件也可以加在covergroup上&#x2F;&#x2F; way2 initial beginCoverPort ck &#x3D; new();ck.stop();#1ns;bus_if.reset &#x3D; 1;#20ns; bus_if.reset &#x3D; 0;ck.start();end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="翻转覆盖率"><a href="#翻转覆盖率" class="headerlink" title="翻转覆盖率"></a>翻转覆盖率</h4><p>coverpoint也可以用来记录变量从a变化到b的跳变情况。</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">covergroup CovPort;coverpoint port&#123;bins t1 &#x3D; (0 &#x3D;&gt; 1), (0 &#x3D;&gt; 2), (0 &#x3D;&gt; 4);&#125;endgroup<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="wildcard覆盖率"><a href="#wildcard覆盖率" class="headerlink" title="wildcard覆盖率"></a>wildcard覆盖率</h4><p>使用关键词wildcard创建多个状态或者翻转，在表达式中任何x，z或者？都当成0或1的通配符</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">bit [2:0] port;covergroup CovPort;coverpoint port&#123;wildcard bins even &#x3D; &#123;3&#39;b??0&#125;;wildcard bins odd &#x3D; &#123;3&#39;d??1&#125;;&#125;endgroup<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>忽略的bins，使用<code>ignore_bins</code>来排除，最终不会计入coverpoint的覆盖率</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">bin [2:0] low_ports_0_5;covergroup CoverPort;coverpiont low_ports_0_5&#123;ignore_bins hi &#x3D; &#123;[6,7]&#125;;&#125;endgroup<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>非法的bins，如果采样到会报错，程序停下来</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">bin [2:0] low_ports_0_5;covergroup CoverPort;coverpiont low_ports_0_5&#123;        illegal_bins hi &#x3D; &#123;[6,7]&#125;;&#x2F;&#x2F;如果出现6-7报错&#125;endgroup<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="交叉覆盖率"><a href="#交叉覆盖率" class="headerlink" title="交叉覆盖率"></a>交叉覆盖率</h4><p>coverpoint是记录单个变量或者表达式的观测值，如果像记录在某一时刻，多个变量之间值的组合情况，需要使用交叉（cross）覆盖率。</p><p>cross只允许带coverpoint或者简单的变量名</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">class Transaction;rand bit [3:0] kind;rand bit [2:0] port;endclassTransaction tr;covergroup CovPort;kind: coverpoint tr.kind;port: coverpoint tr.port;cross kind, port;endgroup<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">covergroup CovPort;port: coverpint tr.port&#123;bins port[] &#x3D; &#123;[0:$]&#125;;&#125;kind: coverpoint tr.kind&#123;bins zero &#x3D; &#123;0&#125;;bins lo &#x3D; &#123;[1:3]&#125;;bins hi[] &#x3D; &#123;[8:$]&#125;;bins misc &#x3D; default;&#125;corss port, kind&#123;ignore_bins hi &#x3D; binsof(port) intersect &#123;7&#125;;        ignore_bins md &#x3D; binsof(port) intersect &#123;0&#125; &amp;&amp; binsof(kind) intersect &#123;[9:11]&#125;;        ignore_bins lo &#x3D; binsof(kind.lo);&#125;endgroup<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>一般在使用cross时，指定特定的匹配状态，比忽略bins更方便</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">covergroup CovPort;    a: coverpoint tr.a &#123;        bins a0 &#x3D; &#123;0&#125;;        bins a1 &#x3D; &#123;1&#125;;    &#125;    b: coverpoint tr.b &#123;        bins b0 &#x3D; &#123;0&#125;;        bins b1 &#x3D; &#123;1&#125;;    &#125;    cross a, b &#123;        bins a0b0 &#x3D; binsof(a.a0) &amp;&amp; binsof(b.b0);        bins a1b0 &#x3D; binsof(a.a1) &amp;&amp; binsof(b.b0);        bins b1 &#x3D; binsof(b.b1);    &#125;endgroup<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="覆盖选项"><a href="#覆盖选项" class="headerlink" title="覆盖选项"></a>覆盖选项</h4><p>如果covergroup例化多次，默认情况下SV会将所有的实例的覆盖率合并在一起，如果需要单独列出每个covergroup的覆盖率，可以设置per_instance&#x3D;1。</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">coverpoint CovPort;coverpoint tr.length;option.per_instance &#x3D; 1;endgroup<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>注释，comment。通过传入参数，对每个实例指定单独的注释。</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">covergroup CovPort(int lo,hi, string comment);option.per_instance &#x3D; 1;    option.comment &#x3D; comment;    coverpoint port&#123;        bins range &#123;[lo,hi]&#125;;    &#125;endgroupCovPort cg1 &#x3D; new(0,3,&quot;Low port numbers&quot;);CovPort cg2 &#x3D; new(4,7,&quot;High port numbers&quot;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>覆盖次数限制，at_least，如果低于at_least的数值，不会计数到bin中。</p><p>覆盖率目标，默认为100%，可以通过goal设置为90；</p><h5 id="covergroup方法"><a href="#covergroup方法" class="headerlink" title="covergroup方法"></a>covergroup方法</h5><p>sample()：采样</p><p>get_coverage()&#x2F;get_inst_coverage(); 获取覆盖率，返回0-100的real类型数值</p><p>set_inst_name(string);设置covergroup的名称</p><p>start()&#x2F;stop()；使能打开或关闭覆盖率的收集</p><h4 id="数据分析"><a href="#数据分析" class="headerlink" title="数据分析"></a>数据分析</h4><p>使用$get_coverage()得到总体的覆盖率，也可以使用coverage_inst.get_inst_coverage()获取单个covergroup实例的覆盖率。</p><p>这些函数的用处是在一个测试中监视覆盖率的变化，如果覆盖率水平一段时间后没有提升，那么这个测试应该停止。</p><p>启动新的随机种子后者测试可能会提高覆盖率</p><h4 id="验证结构"><a href="#验证结构" class="headerlink" title="验证结构"></a>验证结构</h4><p>agent包括generator和initiator，generator是产生一些激励。</p>]]></content>
      
      
      <categories>
          
          <category> 读书笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SV设计与建模 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PTPX功耗分析</title>
      <link href="/2024/052956001.html"/>
      <url>/2024/052956001.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>reference<br><a href="https://blog.csdn.net/RTL2GDS/article/details/104957522">https://blog.csdn.net/RTL2GDS/article/details/104957522</a><br><a href="https://blog.csdn.net/u011729865/article/details/54138703">https://blog.csdn.net/u011729865/article/details/54138703</a><br><a href="https://www.cnblogs.com/gujiangtaoFuture/articles/10170601.html">https://www.cnblogs.com/gujiangtaoFuture/articles/10170601.html</a></p></blockquote><h5 id="对于前端设计人员来说，PTPX的优势"><a href="#对于前端设计人员来说，PTPX的优势" class="headerlink" title="对于前端设计人员来说，PTPX的优势"></a>对于前端设计人员来说，PTPX的优势</h5><ol><li>RTL不支持功耗分析，到netlist才可以采用ptpx分析功耗</li><li>通过分析功耗，可以在设计环节发现功耗的问题，比如某些模块功耗过大；由于功耗报告是按照层次报告的，很容易找到功耗关键的点。</li><li>平均功耗分析，可以找到当前设计中关键功耗点</li><li>times-based功耗分析，可以找到瞬态功耗与仿真激励的关系，确认峰值功耗知否符合预期要求。</li></ol><p>功耗分类：Leakage power和Dynamic Power（internal和switching power），internal power表示短路电流功耗和对pin的充放电电容功耗，通过db查表得到。switching power是对load电容充放电功耗。</p><p>PT如果report_power需要额外的licence，通过以下命令打开</p><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl"><span class="token keyword">set</span> <span class="token variable">power_enable_analysis</span> true<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>功耗分析有两种：一种是平均功耗分析，一种是Time-based功耗分析。（默认平均功耗分析），在time-based模式下，需要提供波形文件，工具会分析峰值功耗，并生成功耗波形。</p><p>vcd&#x2F;fsdb文件是time_based模式分析功耗，saif是average模式分析功耗。</p><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">set_app_var power_analysis_mode averaged <span class="token operator">|</span> time_based<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>平均功耗对应一个报告，time-based功耗分析对应一个波形，显示每一时刻对应的瞬时功耗，报告额外给出peak-power的信息。</p><p>用PT做平均功耗分析分为三种情况，目的是设置静态概率和信号切换速率。</p><ol><li>有波形文件：最好使用后仿产生的VCD&#x2F;SAIF&#x2F;FSDB文件，通过<code>read_vcd/read_saif</code>，将真实的翻转率反标在net上，然后通过<code>report_switching_activity</code>检查反标率，通过<code>report_power</code>报告功耗值。</li></ol><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">read_vcd <span class="token operator">-</span>strip_path xxx.vcd   <span class="token comment"># strip_path指设计的实例名，testbench/FMCW_DCORE_TOP</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>人为设置翻转率，根据经验值通过<code>set_switching_activity/set_casae_analysis</code>来设置寄存器，门控时钟以及blackbox&#x2F;memory的翻转率。这个经验值是通过以往项目仿真得到的，具体命令如下：</li></ol><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">reset_switching_activity <span class="token punctuation">(</span>重置之前设置的翻转率<span class="token punctuation">)</span>set_switching_activity <span class="token punctuation">[</span>get_pins <span class="token operator">-</span>of_object <span class="token punctuation">[</span>all_registers<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">-</span>toggle_rate 0.5 <span class="token operator">-</span>static_probability 0.5 <span class="token operator">-</span>base_clock <span class="token operator">*</span> （设置register的翻转率）set_switching_activity <span class="token operator">-</span>type black_boxes <span class="token operator">-</span>toggle_rate 0.1 <span class="token operator">-</span>static_probability 0.5 <span class="token operator">-</span>base_clock <span class="token operator">*</span> <span class="token operator">-</span>hierarchy （设置blockboxs上的翻转率）set_switching_activity <span class="token operator">-</span>toggle_rate 0.5 <span class="token operator">-</span>static_probability 0.5 <span class="token operator">-</span>base_clock <span class="token operator">*</span> <span class="token punctuation">[</span>remove_from_collection <span class="token punctuation">[</span>all_inputs<span class="token punctuation">]</span> <span class="token punctuation">[</span>get_port <span class="token operator">-</span>filter <span class="token string">"is_clock_used_as_clock == true"</span><span class="token punctuation">]</span><span class="token punctuation">]</span> （设置Input上的翻转率）set_switching_activity <span class="token punctuation">[</span>get_pins <span class="token operator">-</span>of_object <span class="token punctuation">[</span>get_cells <span class="token operator">-</span>hierarchical <span class="token operator">*</span> <span class="token operator">-</span>filter <span class="token string">"ref_name =~ *ICG*"</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">-</span>toggle_rate 0.5 <span class="token operator">-</span>static_probability 0.5 <span class="token operator">-</span>base_clock <span class="token operator">*</span> （设置clock gate上的翻转率）set_case_analysis 1 <span class="token punctuation">[</span>get_ports <span class="token operator">*</span>reset<span class="token operator">*</span><span class="token punctuation">]</span> （使reset信号不翻转，准静态信号）set_switching_activity <span class="token operator">-</span>toggle_rate 0 <span class="token operator">-</span>static_probability 1 <span class="token operator">-</span>base_clock <span class="token operator">*</span> <span class="token punctuation">[</span>get_port <span class="token operator">*</span>reset<span class="token operator">*</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>使用默认翻转率</li></ol><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">set_app_var power_default_toggle_rate 0.5 <span class="token punctuation">(</span>默认值为 0.1）set_app_var power_default_static_probability 0.5 <span class="token punctuation">(</span>默认值为0.5<span class="token punctuation">)</span>set_app_var power_default_toggle_rate_reference_clock fastest <span class="token punctuation">(</span>默认值related<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>在PT中report_switching_activity会报出所有Nets的switching activity来源的统计数据。</p><p>对于报告中没有反标的net，需要特别注意，一般要求在updata_power或者report_power之后，这部分占得比例很小甚至为0，如果有大量没有翻转的net，会影响report_power的准确率。</p><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">report_power <span class="token operator">-</span>hierarchy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>PTPX的输入文件：db文件、sdc文件、vcd&#x2F;fsdb波形文件、SPEF RC寄生文件、门级网表netlist。</p><p>功耗分析分为两种</p><ol><li>pre功耗分析：综合后的功耗分析</li><li>post功耗分析：布局布线后的功耗分析</li></ol><p>在本次流片项目中，回片测试结果 总功耗为18mW左右，和布局布线后的功耗分析差不多，其中电容充放电功耗net_switching占比大于短路电流功耗internal_power。</p><p>在功耗报告中的power group，有clock network，io_pad，memory，register，combinational，sequential。其中clock_network功耗包括时钟网络的buffer，inverters，时钟门控逻辑。register功耗包括由时钟clk驱动的锁存器，寄存器。sequential功耗包括 不受时钟clk驱动的锁存器和寄存器。combinational功耗包括组合逻辑的单元。</p>]]></content>
      
      
      <categories>
          
          <category> ASIC数字后端流程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 功耗分析 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Digital_VLSI_Design(Prof_Adam)</title>
      <link href="/2024/050742599.html"/>
      <url>/2024/050742599.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>reference</p><p><a href="https://www.eng.biu.ac.il/temanad/digital-vlsi-design/">https://www.eng.biu.ac.il/temanad/digital-vlsi-design/</a></p></blockquote><h1 id="Digital-VLSI-Design"><a href="#Digital-VLSI-Design" class="headerlink" title="Digital_VLSI_Design"></a>Digital_VLSI_Design</h1><h2 id="Lecture-3-Logic-Synthesis"><a href="#Lecture-3-Logic-Synthesis" class="headerlink" title="Lecture 3: Logic Synthesis"></a>Lecture 3: Logic Synthesis</h2><img src="/2024/050742599/image-20240507095514852.png" alt="image-20240507095514852" style="zoom: 50%;"><img src="/2024/050742599/image-20240507095835141.png" alt="image-20240507095835141" style="zoom: 67%;"><p>时钟单元 clock cells，目的是平衡时钟上升和下降时间（影响传播延迟tcq），减小skew。</p><p>AOI22，表示两输入的与门和两输入的或门，I表示取反。</p><img src="/2024/050742599/image-20240507100714515.png" alt="image-20240507100714515" style="zoom:67%;"><p>物理视图<br>GDSII用来DRC，LVS<br>LEF文件用来布局布线，RC参数提取。</p><img src="/2024/050742599/image-20240507101104094.png" alt="image-20240507101104094" style="zoom:80%;"><p><img src="/2024/050742599/image-20240507101222615.png" alt="image-20240507101222615"></p><p>technology lef文件用来布局和布线。</p><p><img src="/2024/050742599/image-20240507101454395.png" alt="image-20240507101454395"></p><p>analysis：读取verilog文件并检查语法错误<br>elaborate：将RTL转成布尔逻辑结构，减少状态和编码寄存器，绑定getch库中的叶子单元</p><img src="/2024/050742599/image-20240507221107324.png" alt="image-20240507221107324" style="zoom: 33%;"><p>pre-mapping：映射到一般的单元中</p><p>technology mapping：映射一般逻辑到工艺库中</p><p>post-mapping optimization：改变门的尺寸，布尔逻辑迭代，优化结构满足设计约束</p><img src="/2024/050742599/image-20240507102214269.png" alt="image-20240507102214269" style="zoom: 50%;"><p><img src="/2024/050742599/image-20240507223901860.png" alt="image-20240507223901860"></p><p>LEF文件：为了便于P&amp;R，包括详细的pin信息，不包括ploy，扩散区等。通常只有cell的尺寸，size和形状。pin脚位置，金属块。</p><p><img src="/2024/050742599/image-20240507225048811.png" alt="image-20240507225048811"></p><p><img src="/2024/050742599/image-20240507225122821.png" alt="image-20240507225122821"></p><p>technology file：包含不同层的属性，包括pitch，with，via，金属方向，设计规则等，用来布局和绕线。</p><p><img src="/2024/050742599/image-20240507225423852.png" alt="image-20240507225423852"></p><p>BDD二元决策图可以将真值表转换成门级单元。</p><p><img src="/2024/050742599/image-20240507105718413.png" alt="image-20240507105718413"></p><p>优化BDD的方法：</p><ol><li>合并相同的叶子结点</li></ol><p><img src="/2024/050742599/image-20240507110430249.png" alt="image-20240507110430249"></p><ol start="2"><li>合并行为相同的结点</li></ol><p><img src="/2024/050742599/image-20240507111006987.png" alt="image-20240507111006987"></p><p>最左面的x3无论是0&#x2F;1，结果都是1，可以直接将x2连到1上即可。</p><p>二元决策图，在变量选择的顺序上比如X1,X2,X3，和X3,X2,X1对应的二元决策图也是不一样的，优化策略也不同。</p><h3 id="技术映射"><a href="#技术映射" class="headerlink" title="技术映射"></a>技术映射</h3><p>使用递归树覆盖算法，将逻辑网络映射到工艺库中，分为以下三步： </p><ol><li><p>映射网表和技术库到简单的门级单元上（两输入的与非门或者非门）</p></li><li><p>将输入的网表树化，形成递归树的形式</p></li><li><p>减小树的成本</p></li></ol><h4 id="简单门映射"><a href="#简单门映射" class="headerlink" title="简单门映射"></a>简单门映射</h4><p><img src="/2024/050742599/image-20240508100120080.png" alt="image-20240508100120080"></p><p><img src="/2024/050742599/image-20240508100449609.png" alt="image-20240508100449609"></p><h4 id="树化"><a href="#树化" class="headerlink" title="树化"></a>树化</h4><p>保证二叉树的形式，一个输出只能作为一个叶子结点</p><p><img src="/2024/050742599/image-20240508100735457.png" alt="image-20240508100735457"></p><h4 id="最小树覆盖"><a href="#最小树覆盖" class="headerlink" title="最小树覆盖"></a>最小树覆盖</h4><p><img src="/2024/050742599/image-20240508101617358.png" alt="image-20240508101617358"></p><h3 id="数据门控"><a href="#数据门控" class="headerlink" title="数据门控"></a>数据门控</h3><p><img src="/2024/050742599/image-20240507195707301.png" alt="image-20240507195707301"></p><p>在进行加法时，shifter的功能是关闭的。</p><h3 id="时序优化"><a href="#时序优化" class="headerlink" title="时序优化"></a>时序优化</h3><p><img src="/2024/050742599/image-20240507200820190.png" alt="image-20240507200820190"></p><p>关键路径靠近输出。</p><p><img src="/2024/050742599/image-20240507201010412.png" alt="image-20240507201010412"></p><p><img src="/2024/050742599/image-20240507201128327.png" alt="image-20240507201128327"></p><p><img src="/2024/050742599/image-20240507201235730.png" alt="image-20240507201235730"></p><h2 id="lecture5-STA"><a href="#lecture5-STA" class="headerlink" title="lecture5: STA"></a>lecture5: STA</h2><p>false path</p><p><img src="/2024/050742599/image-20240511101154091.png" alt="image-20240511101154091"></p><p>SDC约束</p><p>tcl语法-collection集合</p><p><img src="/2024/050742599/image-20240511101750700.png" alt="image-20240511101750700"></p><p><img src="/2024/050742599/image-20240511101905652.png" alt="image-20240511101905652"></p><p><img src="/2024/050742599/image-20240511102059530.png" alt="image-20240511102059530"></p><p>clock define</p><p><img src="/2024/050742599/image-20240511102426289.png" alt="image-20240511102426289"></p><p><img src="/2024/050742599/image-20240511102456491.png" alt="image-20240511102456491"></p><p>I&#x2F;O 约束</p><p><img src="/2024/050742599/image-20240511102533967.png" alt="image-20240511102533967"></p><p>设置最大延迟时间和最小时间不需要考虑时钟。</p><p><img src="/2024/050742599/image-20240511103113175.png" alt="image-20240511103113175"></p><p><img src="/2024/050742599/image-20240511103210194.png" alt="image-20240511103210194"></p><p><img src="/2024/050742599/image-20240511103249591.png" alt="image-20240511103249591"></p><p><img src="/2024/050742599/image-20240511103441847.png" alt="image-20240511103441847"></p><p><img src="/2024/050742599/image-20240511103653925.png" alt="image-20240511103653925"></p><p>timing report</p><p><img src="/2024/050742599/image-20240511104143288.png" alt="image-20240511104143288"></p><p><img src="/2024/050742599/image-20240511104219740.png" alt="image-20240511104219740"></p><p><img src="/2024/050742599/image-20240511104509098.png" alt="image-20240511104509098"></p><h1 id="Advanced-SOC-Design"><a href="#Advanced-SOC-Design" class="headerlink" title="Advanced SOC Design"></a>Advanced SOC Design</h1><h2 id="Fond-end-design-flow"><a href="#Fond-end-design-flow" class="headerlink" title="Fond-end design flow"></a>Fond-end design flow</h2><p>逻辑综合前后可能会导致RTL和Netlist不一致，比如 <strong>initial value，timing delay，casex和casez</strong></p><p><img src="/2024/050742599/image-20240717145547556.png" alt="image-20240717145547556"></p><p>Timing includes：</p><ol><li>gate delay</li><li>interconnect delay</li><li>crosstalk &amp; noise     （Star RC  mental fill）</li></ol><p><img src="/2024/050742599/image-20240717152716901.png" alt="image-20240717152716901"></p><p>即使有STA，还需要动态仿真测试STA无法考虑到的，比如复位功能。</p><p><img src="/2024/050742599/image-20240717160805825.png" alt="image-20240717160805825"></p><img src="/2024/050742599/image-20240717161058827.png" alt="image-20240717161058827">]]></content>
      
      
      <categories>
          
          <category> 读书笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> asic flow </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>低功耗方法学（三）</title>
      <link href="/2024/042561284.html"/>
      <url>/2024/042561284.html</url>
      
        <content type="html"><![CDATA[<h2 id="6-电源门控的架构问题"><a href="#6-电源门控的架构问题" class="headerlink" title="6 电源门控的架构问题"></a>6 电源门控的架构问题</h2><p>这章讨论一些有关植入电源门控的架构问题，特别的，它解决了分区、层次结构和多个电源门控域。</p><h3 id="6-1-垂直结构和电源门控"><a href="#6-1-垂直结构和电源门控" class="headerlink" title="6.1 垂直结构和电源门控"></a>6.1 垂直结构和电源门控</h3><p>为了支持这种可移植性，必须在电源域级别强制设置模块边界。也就是说，给定的模块应该属于单个电压域，而不是跨多个域。一些工具和流程通过RTL流程分配到不同的电压域，但是会导致分析和实现困难。</p><p>电源门控会增加IR drop，导致性能下降，级联多个电压降可能呢过导致延迟增加到不可接受的程度。</p><p>扁平化的电源门控交换网络如下图所示</p><img src="/2024/042561284/image-20240426102400513.png" alt="image-20240426102400513" style="zoom:67%;"><img src="/2024/042561284/image-20240426102417327.png" alt="image-20240426102417327" style="zoom: 67%;"><h5 id="推荐"><a href="#推荐" class="headerlink" title="推荐"></a>推荐</h5><ul><li>映射电源门控区域到模块的边界。</li><li>当划分分层电源门控设计时，确保电源门控可以映射到扁平化的交换结构。</li></ul><h5 id="陷阱"><a href="#陷阱" class="headerlink" title="陷阱"></a>陷阱</h5><ul><li>避免控制信号通过电源门控或者断电区域</li><li>避免使用超过一级或者两级的电源门控系统</li></ul><h3 id="6-2-电源网络及其控制"><a href="#6-2-电源网络及其控制" class="headerlink" title="6.2 电源网络及其控制"></a>6.2 电源网络及其控制</h3><p>在基于处理器的SoC设计中，CPU系统很可能引入很多电源网络。</p><ul><li>CPU子系统具有独立的电源轨道，允许CPU完全关闭以实现长期睡眠操作模式。</li><li>CPU逻辑的门控电源支持短期泄露节省模式，其中高速缓存可以保留，但所有泄漏的标准单元逻辑都在本地关闭。</li><li>始终开启的电源为隔离单元供电。</li><li>SoC级别的常开电源，用于控制外部电源轨开关和电源的握手</li><li>一些常开保留电源供电来自于非电源门控轨道，这需要工艺库中具有带有状态保留的寄存器单元。</li></ul><p>电源网络控制如下图所示，具有独立的VDDCPU和常开的VDDOSC，他们有一个共同的VSS地。电源门控控制单元区域具有非门控状态保持电源</p><img src="/2024/042561284/image-20240426111009781.png" alt="image-20240426111009781" style="zoom:67%;"><h4 id="6-2-1-外部电源开关"><a href="#6-2-1-外部电源开关" class="headerlink" title="6.2.1 外部电源开关"></a>6.2.1 外部电源开关</h4><p>外部电源轨开关可提供最佳的长期泄漏节省，但是会引入显著的开启延迟。</p><p>通常只有少数的电压轨可以进行外部切换，每个电源都会需要稳压器和电路板成本。每个电源轨都需要片上电源分配，使得电源规划和物理布局规则变得很复杂。大多数soc至少具有三个电源轨：</p><ul><li>IO电源（至少1.8&#x2F;2.5&#x2F;3.3V）</li><li>常开的SOC电源轨道</li><li>干净的模拟电源给PLL</li><li>一个可选的保持活动的电压供电给到实时时钟</li></ul><p>添加两个或三个以上的外部开关电源轨会显著增加最终产品的复杂性和成本。通常，芯片和电路板的共享接地&#x2F;VSS连接方法最适合外部电源轨切换。</p><img src="/2024/042561284/image-20240426133612114.png" alt="image-20240426133612114" style="zoom:50%;"><p>外部电源轨切换会导致唤醒事件出现显著的延迟（几十us到几ms级别），在RTL级别量化这些延时是很困难的，通常，应该抑制时钟，直到开关电源轨稳定在允许的误差内。对于在几百MHz的时钟域中，相当于几万个时钟周期。当引入动态电压调节时，单独的电源轨成为必要。通常希望为大型存储器提供自己的电源。</p><h5 id="推荐-1"><a href="#推荐-1" class="headerlink" title="推荐"></a>推荐</h5><ul><li><p>最大限度的减小外部开关电源轨的数目（考虑到相关额外的电源空间成本和片上配电）</p></li><li><p>外部切换电源轨，最好使用同一个公共地</p></li><li><p>在实现电压缩放的系统重，必须为每个电压缩放的区域提供独立的电源轨</p></li></ul><h5 id="陷阱-1"><a href="#陷阱-1" class="headerlink" title="陷阱"></a>陷阱</h5><ul><li><p>针对重要的外部电源轨切换时间进行设计：唤醒中必须考虑数万或数十万个时钟周期延迟</p></li><li><p>尽管从系统设计的角度来看，多轨看起来很优雅，但它们在生产中带来了验证和部署挑战。</p></li></ul><h4 id="6-2-2-片上电源门控"><a href="#6-2-2-片上电源门控" class="headerlink" title="6.2.2 片上电源门控"></a>6.2.2 片上电源门控</h4><p>片上电源门控比片外电源轨门控快得多。对于非常小的区域，电源门控需要几个甚至几百个时钟周期。</p><h3 id="6-3-电源状态表和常开寄存器"><a href="#6-3-电源状态表和常开寄存器" class="headerlink" title="6.3 电源状态表和常开寄存器"></a>6.3 电源状态表和常开寄存器</h3><p>当处理多个电源门控电源域时，电源布线可能会变得复杂，下图显示了三个电源域，每个域都有电源门控。</p><img src="/2024/042561284/image-20240426141349369.png" alt="image-20240426141349369" style="zoom:50%;"><p>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p><p>||       未完待续~       ||</p><p>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p>]]></content>
      
      
      <categories>
          
          <category> 读书笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 低功耗圣经 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>杂七杂八</title>
      <link href="/2024/04057752.html"/>
      <url>/2024/04057752.html</url>
      
        <content type="html"><![CDATA[<h1 id="版本控制"><a href="#版本控制" class="headerlink" title="版本控制"></a>版本控制</h1><blockquote><p>参考语义化版本2.0.0 <a href="https://semver.org/lang/zh-CN/">https://semver.org/lang/zh-CN/</a></p></blockquote><p>版本号规则</p><ol><li>主版本号：当你做了不兼容的 API 修改，</li><li>次版本号：当你做了向下兼容的功能性新增，</li><li>修订号：当你做了向下兼容的问题修正。</li></ol><p>初始版本号为：0.1.0</p><h1 id="版本内容修改格式如下"><a href="#版本内容修改格式如下" class="headerlink" title="版本内容修改格式如下"></a>版本内容修改格式如下</h1><pre class="line-numbers language-none"><code class="language-none"># [0.1.0] -2024-04-09### Added- xxxxxx### Fixed- xxxx### Changed- xxxxx- xxxxx### Removed- xxxxxx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>串口通信协议-UART、SPI、I2C</title>
      <link href="/2024/031321104.html"/>
      <url>/2024/031321104.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>Reference </p><p><a href="https://blog.csdn.net/qq_40268672/article/details/124436244">https://blog.csdn.net/qq_40268672/article/details/124436244</a></p></blockquote><h2 id="UART"><a href="#UART" class="headerlink" title="UART"></a>UART</h2><p>全双工的异步串口协议，主要用于调试，至少三根线RX、TX和GND</p><p>协议主要包括空闲位，起始位，数据位，奇偶校验位和停止位。空闲位是高电平，起始位是1bit的低电平，数据位一般是5,6,7,8位（如果不用奇偶校验位，数据帧可以为9bit），停止位一般是1位的高电平。UART常见的波特率一般有4800，9600，19200，38400，115200。</p><img src="/2024/031321104/20200803195509148.png" alt="img" style="zoom: 67%;"><p>优点：只有两根线，不需要时钟信号；具有奇偶校验位。<br>缺点：数据帧最大9位，不支持多从。传输速率受到波特率的限制。</p><h2 id="SPI"><a href="#SPI" class="headerlink" title="SPI"></a>SPI</h2><p>全双工的同步串口协议，常用于显示驱动器外设通信。由一个主设备和多个从设备组成，SPI接口信号有sdi串行数据输入，sdo串口数据输出，sck时钟信号以及cs片选信号。cs决定了唯一的与主设备通信的从设备，片选信号低电平有效。SPI协议有多种不同的配置，由时钟相位和时钟极性决定。</p><p>时钟极性表示当SCLK为空闲时，电平是高电平还是低电平。</p><ul><li>CPOL&#x3D;0；时钟空闲是低电平</li><li>CPOL&#x3D;1；时钟空闲是高电平</li></ul><p>时钟相位CPHA决定在第几个时钟变化边沿开始采样数据；</p><ul><li>CPHA&#x3D;0；在时钟信号SCK的第一个跳变沿采样</li><li>CPHA&#x3D;1；在时钟信号SCK的第二个跳变沿采样</li></ul><p>因此，不同的时钟相位和极性共有4种SPI协议的配置。CPHA&#x3D;0，表示第一个边沿：<br>对于CPOL&#x3D;0，idle时候的是低电平，第一个边沿就是从低变到高，所以是上升沿采样<br>对于CPOL&#x3D;1，idle时候的是高电平，第一个边沿就是从高变到低，所以是下降沿采样<br>CPHA&#x3D;1，表示第二个边沿：<br>对于CPOL&#x3D;0，idle时候的是低电平，第二个边沿就是从高变到低，所以是下降沿采样<br>对于CPOL&#x3D;1，idle时候的是高电平，第一个边沿就是从低变到高，所以是上升沿采样</p><p>从机数目受到系统负载电容的限制，降低master在电平之间的切换能力。</p><img src="/2024/031321104/v2-90fa89c6af8665282dd058768841801f_1440w.webp" alt="img" style="zoom: 50%;"><p>优点：没有起始位和停止位，可以持续传输数据；数据传输速率快，比I2C快几乎两倍，全双工通信。<br>缺点：使用四根线，没有数据传输反馈信号和奇偶校验位。</p><h2 id="IIC"><a href="#IIC" class="headerlink" title="IIC"></a>IIC</h2><p>两根线：一根是时钟线SCL和一个数据线SDA，属于半双工通信。</p><p>IIC的起始条件为在SCL为高电平期间，SDA出现下降沿</p><img src="/2024/031321104/a4b57424cb284c92a2362c24d2958404.png" alt="在这里插入图片描述" style="zoom:67%;"><p>结束条件为在SCL高电平期间，SDA出现上升沿</p><img src="/2024/031321104/a74416ae63334f068ae25c988fa5fbb2.png" alt="在这里插入图片描述" style="zoom:67%;"><p>在数据传输时，只有SCL在低电平期间，才允许数据变化，在高电平期间不允许变化，因为是判断起止条件的。</p><img src="/2024/031321104/ac4872ce1ace49e998acd746db02c1c2.png" alt="在这里插入图片描述" style="zoom:50%;"><p>IIC有一个很重要的概念： <strong>应答</strong>。slave收到数据后，会给master发送一个应答信号，slave的时钟信号是master发出的。应答出现在每一次主机完成8个数据位传输后紧跟着的时钟周期，<strong>低电平0表示应答，1表示非应答</strong>。需要应答时，数据发出方将SDA总线设置为3态输入，由于IIC总线上有上拉电阻，因此此时总线默认高电平，若数据接收方正确接收到数据，则数据接收方将SDA总线拉低，以示正确应答。</p><p><strong>IIC传输时是从MSB开始传输到LSB结束的</strong></p><p>写时序</p><p><img src="/2024/031321104/image-20240323140356689.png" alt="image-20240323140356689"></p><p>读时序</p><p><img src="/2024/031321104/image-20240323140811569.png" alt="image-20240323140811569"></p><p>​1.产生start信号。<br>​2.传送器件地址（写ID_Address），ACK。<br>​3.传送字地址（写REG_Address），ACK。<br>​4.再次产生start信号<br>​5.再传送一次器件地址，ACK。<br>​6.读取一个字节的数据，<strong>读数据最后结束前无应答(NO ACK)信号</strong>。<br>​7.产生stop信号。</p><img src="/2024/031321104/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAd2VpeGluXzQxMzM4MDgx,size_14,color_FFFFFF,t_70,g_se,x_16.png" alt="img" style="zoom:67%;"><p>​I2C是单主机多从机，发出的地址和数据对所有slave都是可见的，如果发送的地址和slave的地址匹配，slave就会给master一个应答。在时钟线（SCL）为高电平的时候，一定不能动数据线（SDA）状态，除非是启动或者结束总线。</p><p>优点：I2C支持多主多从；占用的GPIO少，节省资源。有应答机制。<br>缺点：slave不能太多，增加负载电容。半双工通信。</p><h2 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h2><h3 id="设备从属关系"><a href="#设备从属关系" class="headerlink" title="设备从属关系"></a>设备从属关系</h3><p>​UART没有主从关系；SPI存在主从关系，通过CS片选信号选择从机；IIC也存在主从关系，通过发出的数据地址选择从机。</p><h3 id="通信方式"><a href="#通信方式" class="headerlink" title="通信方式"></a>通信方式</h3><p>​UART和SPI都是全双工通信，两根数据线。I2C是半双工通信。  SPI和I2C是同步通信方式，UART是异步通信</p><h3 id="传输速度"><a href="#传输速度" class="headerlink" title="传输速度"></a>传输速度</h3><p>​UART传输速度最慢，SPI比I2C要快，达到几Mbps</p><h3 id="传输距离"><a href="#传输距离" class="headerlink" title="传输距离"></a>传输距离</h3><p>​I2C弱于UART和SPI，使用上拉电阻（实现线与），抗干扰能力较弱。适合短距离通信。</p><h3 id="通信特征"><a href="#通信特征" class="headerlink" title="通信特征"></a>通信特征</h3><p>​UART：异步，一帧传输5 6 7 8位，低位先传输。UART需要固定的波特率，两位数据的间隔要相等。<br>​SPI：同步，允许一位一位传输，允许暂停。从最高位开始传输。<br>​I2C：同步，一次传输8bit，最高位开始传输。<br>​SPI和I2C都是同步的，没有波特率的要求。</p><p>未完待续~</p>]]></content>
      
      
      <categories>
          
          <category> 数字前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 总线协议 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AES加解密算法IP</title>
      <link href="/2024/031353724.html"/>
      <url>/2024/031353724.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>reference</p><p><a href="https://www.cnblogs.com/xzj8023tp/p/12970790.html">https://www.cnblogs.com/xzj8023tp/p/12970790.html</a></p></blockquote><h2 id="加密算法概念"><a href="#加密算法概念" class="headerlink" title="加密算法概念"></a>加密算法概念</h2><p>一个密码系统的加密密钥和解密密钥相同，或者虽然不相同但是由其中的任意一个可以很容易地推导出另一个，则称该密码系统采用的是对称密码体制。优点是 <strong>加解密速度快</strong>，安全系数不高。AES是对称密钥体制算法。</p><p>如果一个密码系统的加密密钥和解密密钥不同，并且由加密密钥推导出解密密钥(或者由解密密钥推导出加密密钥)是计算上不可行的，则称该密码系统采用的是非对称密码体制。采用非对称密码体制的每个用户都有一对选定的密钥，其中一个是可以公开的，一个由用户自己秘密保存。RSA是非对称加密算法的一种。优点是安全系数高，可以方便、安全的实现数字签名和验证。</p><h3 id="AES加密算法"><a href="#AES加密算法" class="headerlink" title="AES加密算法"></a>AES加密算法</h3><p>AES算法在明文加密时，需要将整个明文分组，每组16个字节。</p><h4 id="AES加密算法两种模式ECB和CBC"><a href="#AES加密算法两种模式ECB和CBC" class="headerlink" title="AES加密算法两种模式ECB和CBC"></a>AES加密算法两种模式ECB和CBC</h4><h5 id="ECB模式"><a href="#ECB模式" class="headerlink" title="ECB模式"></a>ECB模式</h5><p>相同的输入产生相同的输出。优点：简单，有利于并行计算，误差不会传送。缺点：可能对明文进行主动攻击。</p><img src="/2024/031353724/SouthEast.jpeg" alt="img" style="zoom: 50%;"><h5 id="CBC模式"><a href="#CBC模式" class="headerlink" title="CBC模式"></a>CBC模式</h5><p>将加密的结果进行级联，第一组加密需要添加额外的数据块IV。需要将上组加密结果与当前明文异或作为第二组分组加密的输入。CBC并行度较差，每次都要等待上次结果。</p><img src="/2024/031353724/SouthEast-1713508082381-3.jpeg" alt="img" style="zoom: 67%;"><h4 id="AES加密算法具体实现"><a href="#AES加密算法具体实现" class="headerlink" title="AES加密算法具体实现"></a>AES加密算法具体实现</h4><p>AES算法是作用在有限域（2^8）,该域中的元素是由8bit组成的字节。它们可以通过异或做加法运算，也可以通过某种方式做乘法运算，而且每一个字节都有逆元。</p><p>密钥长度为128比特。字节（8bits）是AES算法中数据运算的基本单位。AES加密算法由三部分组成：初始密钥加、Nr-1轮循环加密和最后一轮加密。每一轮都有一个由初始密钥生成的轮密钥。</p><ul><li><p>有限域中的加法运算<br>相当于对两个字节做按位异或。</p></li><li><p>有限域中的乘法运算<br>相乘的结果为两个多项式的模乘，AES中不可约多项式(模)为 x^8+x^4+x^3+x+1</p></li><li><p>有限域的X乘运算<br>x（十六进制{02}）乘b(x)可以先对b(x)在字节内左移一位（最后一位补0）；如果b7&#x3D;1，再与十六进制数{1b}做逐比特异或来实现。该运算记为b&#x3D;xtime(x)。</p></li><li><p>四字节运算</p></li></ul><img src="/2024/031353724/image-20240316162412992.png" alt="image-20240316162412992" style="zoom:45%;"><p>AES算法的具体操作是在状态矩阵上进行的。对于128bit的数据，状态矩阵共有4行，32列。每行有4个字节。除了初始密钥（种子密钥），还需要10个轮密钥。</p><p>加密时，将输入字节按照a00，a10，a20，a30；a0,1，a1,1，a2,1，a3,1…的顺序映射到状态矩阵上，加密的最后以同样的顺序提取状态矩阵从而得到输出字节。</p><p>AES加密算法由三部分组成，初始密钥加、Nr-1轮循环加密和最后一轮加密，采用轮迭代结构由四个不同的变换组成。加密过程的四个变换分别为：字节变换（S盒变换）、行移位变换、列混合变换和轮密钥加变换。整个加解密过程如下：</p><img src="/2024/031353724/image-20240316162831828.png" alt="image-20240316162831828" style="zoom:50%;"><ul><li>S盒变换 SubBytes</li></ul><p>​字节替代变换，针对字节的非线性、可逆变换。一个向量乘以一个可逆矩阵，得到输出。它将状态中的每一个字节进行非线性变换为另外一个字节。可以将所有的字节变换排成一个表格，查表直接得到输出。提高速度，减小了矩阵的运算。</p><img src="/2024/031353724/1710436556338.jpg" alt="1710436556338" style="zoom:50%;"><ul><li>行移位变换</li></ul><p>​循环移位。对于128bit的加密，第一行不移动，第二行移动1个字节，第三行移动2个字节，第三行移动3个字节。对于加密，循环左移。解密，后3行依次右循环移动3，2，1个字节。</p><img src="/2024/031353724/image-20240315092725268.png" alt="image-20240315092725268" style="zoom: 50%;"><ul><li>列混合变换</li></ul><img src="/2024/031353724/image-20240315093320194.png" alt="image-20240315093320194" style="zoom:50%;"><img src="/2024/031353724/image-20240315093334980.png" alt="image-20240315093334980" style="zoom:50%;"><p>​解密与加密类似，固定多项式变为逆矩阵，表示如下。</p><img src="/2024/031353724/image-20240316163552550.png" alt="image-20240316163552550" style="zoom:50%;"><ul><li><p>轮密钥加变换</p><p>将状态矩阵与轮密钥进行逐位比特异或操作。</p></li></ul><h4 id="密钥扩展"><a href="#密钥扩展" class="headerlink" title="密钥扩展"></a>密钥扩展</h4><p>初始密钥K，共产生4*（Nr+1）个双字。最终的密钥流程产生一个四字节双字的线性数组。{w0,w1,w2,w3}是初始密钥，其中，w0对应的bit[127:96]。</p><p><img src="/2024/031353724/image-20240316163738922.png" alt="image-20240316163738922"></p><ul><li>位置变换</li></ul><p>​将4字节的输入序列，循环左移一个字节输出。</p><ul><li>S盒变换</li></ul><p>​将一个4字节的输入序列的每个字节进行S盒变换输出。</p><ul><li>常量变换</li></ul><p>​Rcon[]是一个具有10个元素的常量数组，x0&#x3D;{01},x1&#x3D;{02},…….x(8)&#x3D;{1b},x(9)&#x3D;{36}</p><h4 id="QA"><a href="#QA" class="headerlink" title="QA"></a>QA</h4><p>为什么AES-128算法采用10次轮加密，而不是20次？</p><p>因为考虑了安全性和性能（速度）的折中，10轮迭代加密基本满足AES加密算法的安全性要求，加密时间也可以接受。</p><h3 id="DES加密算法"><a href="#DES加密算法" class="headerlink" title="DES加密算法"></a>DES加密算法</h3><h4 id="初始置换（IP置换）"><a href="#初始置换（IP置换）" class="headerlink" title="初始置换（IP置换）"></a>初始置换（IP置换）</h4><p>将输入的64bit明文块进行置换和重新排列，生成新的64bit数据块目的：增加加密的混乱程度，使得每一位都能够对后面的加密过程产生影响，提高加密强度。</p><img src="/2024/031353724/4f2a76eb1686402fabf130533445e38a.png" alt="在这里插入图片描述" style="zoom:67%;"><p>逆初始变换的变换规则和初始变换相反，可逆的。</p><h4 id="加密轮F函数"><a href="#加密轮F函数" class="headerlink" title="加密轮F函数"></a>加密轮F函数</h4><p><img src="/2024/031353724/image-20240702151958722.png" alt="image-20240702151958722"></p><p>将64bit的数据分为两组，低32bit为右，高32bit为左。每一轮F函数都需要进行一系列的扩展变换，然后与子密钥异或，进而S盒替换、P盒替换。</p><h4 id="扩展变换"><a href="#扩展变换" class="headerlink" title="扩展变换"></a>扩展变换</h4><p>32bit数据通过扩展置换表得到新的48bit数据。</p><img src="/2024/031353724/image-20240702153041256.png" alt="image-20240702153041256" style="zoom:67%;"><p>通过位数扩展使得每一位都可以在下一步操作中影响更多的比特，达到扩散的效果。</p><h4 id="S盒替换"><a href="#S盒替换" class="headerlink" title="S盒替换"></a>S盒替换</h4><p>扩展置换后的48bit数据，通过8个6*4 S盒得到32bit数据。具体如下：每组6bit数据的第1bit和最后1bit拼接得到{data[6]，data[1]}行索引，中间4bit作为列索引得到相应的数据。</p><h4 id="P盒替换"><a href="#P盒替换" class="headerlink" title="P盒替换"></a>P盒替换</h4><p>和初始变换类似，替换数据的位置即可。</p><img src="/2024/031353724/image-20240702155217039.png" alt="image-20240702155217039" style="zoom:67%;"><h4 id="子密钥产生模块"><a href="#子密钥产生模块" class="headerlink" title="子密钥产生模块"></a>子密钥产生模块</h4><p>DES算法使用64bit密钥，真正参与加解密运算的只有56bit，64位密钥中第1、8、16、24、32、40、48、56及64位都是奇偶校验标志位，用于检验密钥在产生子密钥的过程中是否发生错误。</p><img src="/2024/031353724/image-20240702161608655.png" alt="image-20240702161608655" style="zoom: 80%;"><p>64bit初始密钥首先根据密钥转换表得到56位密钥，原理和初始置换相同。再由56位密钥产生16组子密钥。根据子密钥移位序列表将两个28位的数据循环左移，而后拼接合成，再根据置换表的内容进行置换选择得到48bit输出数据。</p><p>每一组子密钥的生成都需要经历移位、重组、置换步骤，16组子密钥对应16轮重复运算，且每一轮旋转移位后得到的左28位与右28位数据又将作为下一个子密钥生成的输入。</p><h3 id="FPGA"><a href="#FPGA" class="headerlink" title="FPGA"></a>FPGA</h3><p>Altera开发板的逻辑单元LC是LE，LE的结构：一个4输入的LUT和寄存器</p><p><img src="/2024/031353724/webp.webp" alt="img"></p><p>xillinx开发板的逻辑单元是CLB，一个CLB包括两个slice，每个slice由4个 6输入的LUT和8个寄存器组成。</p><p><img src="/2024/031353724/webp-1719911249197-5.webp" alt="img"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>DC_FLOW（二）</title>
      <link href="/2024/03097089.html"/>
      <url>/2024/03097089.html</url>
      
        <content type="html"><![CDATA[<h3 id="异步时钟相关设置"><a href="#异步时钟相关设置" class="headerlink" title="异步时钟相关设置"></a>异步时钟相关设置</h3><h4 id="set-clk-group"><a href="#set-clk-group" class="headerlink" title="set_clk_group"></a>set_clk_group</h4><p>用来声明不同clock组之间的关系，比如两个异步时钟不需要做时序分析，需要<code>-asynchronous</code>指定。不同于<code>set_group_path</code>，它是对于所有的path做一个分组。</p><img src="/2024/03097089/image-20240309163503401.png" alt="image-20240309163503401" style="zoom: 67%;"><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">set_clock_group <span class="token operator">-</span>asynchronous <span class="token operator">-</span>group C1 <span class="token operator">-</span>group C2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>set_clock_group在master clock的作用影响下，不会应用于generated时钟上，需要显式指定generated时钟和其他时钟组的关系。</p><img src="/2024/03097089/6ad3e4714d4306da76065df5e0481aa1.png" alt="img" style="zoom:50%;"><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">set_clock_group <span class="token operator">-</span>asynchronous <span class="token operator">-</span>group <span class="token punctuation">[</span>get_clocks CLKA<span class="token punctuation">]</span> <span class="token operator">-</span>group <span class="token punctuation">[</span>get_clocks CLKB divCLKB<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>logically exclusive</p><p>如果两个时钟是logical exclusive的，两个时钟是同时存在的，意味着两个时钟没有任何的时序路径交互。不存在起点是CK1到CK2的路径，也不存在起点从CK2到CK1的路径。典型的场景是有一个选择信号控制两个clock输出，这两个输入时钟在逻辑上是互斥的（没有跨时钟域的路径交互），需要声明<code>logically_exclusive</code></p></li></ul><p><img src="/2024/03097089/image-20240309165524200.png" alt="image-20240309165524200"></p><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">create_clock <span class="token operator">-</span>period 10 <span class="token operator">-</span>name C1 <span class="token punctuation">[</span>get_ports C1<span class="token punctuation">]</span>create_clock <span class="token operator">-</span>period 20 <span class="token operator">-</span>name C2 <span class="token punctuation">[</span>get_ports C2<span class="token punctuation">]</span>set_clock_group <span class="token operator">-</span>logically_exclusive <span class="token operator">-</span>group C1 <span class="token operator">-</span>group C2<span class="token comment"># 如果不声明 -logically_exclusive  DC会认为有4中可能，CLK1 产生数据 CLK1 去采样，CLK1 产生数据 CLK2 去采样，CLK2 产生数据 CLK1 去采样，CLK2 产生数据 CLK2 去采样。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>如果两个时钟同时存在，但是他们之间没有任何的path，这两个时钟可以设置为logically_exclusive。时钟ClkOut通过MUX选出来后，clk1和clk2不会在下游有交互。</p><img src="/2024/03097089/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3podWFuZ2Rr,size_16,color_FFFFFF,t_70.png" alt="img" style="zoom:50%;"><p>如果mux之外存在clk2驱动的flops和clkout驱动的flops有相互作用，此时不能设置clk1和clk2为logical exclusive,此时必须在 MX1 的 output 处创建 generated 时钟，创建的时钟可以设置为逻辑互斥关系。</p><img src="/2024/03097089/5ed3941ff6efe7926621bb57a8aa0112.png" alt="img" style="zoom:50%;"><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">creat_generated_clock <span class="token operator">-</span>name genclk1 <span class="token operator">-</span>source <span class="token punctuation">[</span>get_pins U_MUX1<span class="token operator">/</span>IN1<span class="token punctuation">]</span> <span class="token operator">-</span>master_clock CLK1 <span class="token punctuation">[</span>get_pins U_MUX1<span class="token operator">/</span>Y<span class="token punctuation">]</span> <span class="token operator">-</span>divide_by 1creat_generated_clock <span class="token operator">-</span>name genclk2 <span class="token operator">-</span>source <span class="token punctuation">[</span>get_pins U_MUX1<span class="token operator">/</span>IN2<span class="token punctuation">]</span> <span class="token operator">-</span>master_clock CLK2 <span class="token punctuation">[</span>get_pins U_MUX1<span class="token operator">/</span>Y<span class="token punctuation">]</span> <span class="token operator">-</span>divide_by 1 <span class="token operator">-</span>add set_clock_groups <span class="token operator">-</span>logically_exclusive <span class="token operator">-</span>group genclk1 <span class="token operator">-</span>group genclk2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="2"><li>当两个时钟在同一时刻不可能同时存在时，这两个时钟可以设置为physical exclusive关系。经过MUX的时钟只有一个，generated的时钟只有一个，不可能存在两个，所以要声明为physical exclusive关系。</li></ol><img src="/2024/03097089/image-20240309171004892.png" alt="image-20240309171004892" style="zoom:67%;"><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">create_generated_clock <span class="token operator">-</span>name GC1 <span class="token operator">-</span>divide_by 1 <span class="token operator">-</span>souce <span class="token punctuation">[</span>get_pins mux1<span class="token operator">/</span>A<span class="token punctuation">]</span>  \<span class="token punctuation">[</span>get_pins mux1<span class="token operator">/</span>Z<span class="token punctuation">]</span> <span class="token operator">-</span>combinationalcreate_generated_clock <span class="token operator">-</span>name GC2 <span class="token operator">-</span>divide_by 1 <span class="token operator">-</span>souce <span class="token punctuation">[</span>get_pins mux1<span class="token operator">/</span>B<span class="token punctuation">]</span>  \<span class="token punctuation">[</span>get_pins mux1<span class="token operator">/</span>Z<span class="token punctuation">]</span> <span class="token operator">-</span>combinationalset_clock_group <span class="token operator">-</span>physically_exclusive <span class="token operator">-</span>group GC1 <span class="token operator">-</span>group GC2<span class="token comment">#-combinational 表明从source clock pin到生成时钟的位置是组合逻辑，没有经过时序逻辑。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>总结</li></ul><p>如果两个时钟可能同时存在，但是两个时钟组的信号没有交互，可以声明为<code>logically exclusive</code>。如果两个时钟在同一时刻不可能同时存在，需要声明<code>physically exclusive</code>。</p><img src="/2024/03097089/image-20240309172447158.png" alt="image-20240309172447158" style="zoom: 33%;"><p>两者对于时序路径计算的区别：logical exclusive会考虑两个时钟域数据的串扰crosstalk对时序路径延迟的响应，physical exclusive不会考虑crosstalk。</p><h4 id="create-generated-clock"><a href="#create-generated-clock" class="headerlink" title="create generated clock"></a>create generated clock</h4><p>明确generated clock和master clock的关系，</p><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">create_generated_clock <span class="token punctuation">[</span><span class="token operator">-</span>name clock_name<span class="token punctuation">]</span> \    <span class="token operator">-</span>source master_pin \    <span class="token punctuation">[</span><span class="token operator">-</span>master_clock clock<span class="token punctuation">]</span> \    <span class="token punctuation">[</span><span class="token operator">-</span>edge edge_list<span class="token punctuation">]</span> \    <span class="token punctuation">[</span><span class="token operator">-</span>edge_shift shift_list<span class="token punctuation">]</span> \    <span class="token punctuation">[</span><span class="token operator">-</span>divide_by factor<span class="token punctuation">]</span> \    <span class="token punctuation">[</span><span class="token operator">-</span>multiply_by factor<span class="token punctuation">]</span> \    <span class="token punctuation">[</span><span class="token operator">-</span>duty_cycle percent<span class="token punctuation">]</span> \    <span class="token punctuation">[</span><span class="token operator">-</span>combinational<span class="token punctuation">]</span>    <span class="token punctuation">[</span><span class="token operator">-</span>invert<span class="token punctuation">]</span> \    <span class="token punctuation">[</span><span class="token operator">-</span>add<span class="token punctuation">]</span> \source_objects<span class="token comment"># -master_clock clock</span><span class="token comment"># -source 指明master clock的pin(-source 指的是master clock上的出来的pin，可以有多个source pin)</span><span class="token comment"># cts时，默认会减小master clock和generated clock的skew，计算generated clock的clock的latency时会加上这个skew</span><span class="token comment"># -divide_by 指明几分频</span><span class="token comment"># -edges 指明generated_clock一个完整的时钟周期，上升，下降，上升沿的时间点</span><span class="token comment"># -edge_shift&#123;1 1 1&#125; 表示每个沿都往后延迟多少</span><span class="token comment"># -preinvert 基于inverted的master clk</span><span class="token comment"># -invert    基于non-inverted的master clk后的inverted</span><span class="token comment"># -add 在有时钟定义的引脚上添加时钟，不加会覆盖</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2024/03097089/image-20240309173947008.png" alt="image-20240309173947008"></p><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">create_generated_clock <span class="token operator">-</span>source <span class="token punctuation">[</span>get_pins Udiv<span class="token operator">/</span>CLK<span class="token punctuation">]</span> <span class="token operator">-</span>name CLKdiv2 <span class="token operator">-</span>divide_by 2 <span class="token punctuation">[</span>get_pins Udiv<span class="token operator">/</span>Q<span class="token punctuation">]</span>create_generated_clock <span class="token operator">-</span>name CLKdiv2 <span class="token operator">-</span>source CLK <span class="token operator">-</span>edges <span class="token punctuation">&#123;</span>2 4 6<span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>get_pins Udiv<span class="token operator">/</span>Q<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="set-false-path"><a href="#set-false-path" class="headerlink" title="set_false_path"></a>set_false_path</h4><p>有些特殊路径不需要进行时序分析，设置false时，sta不会对其分析。</p><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">set_false_path <span class="token operator">-</span>from <span class="token punctuation">[</span>get_clocks CKA<span class="token punctuation">]</span> <span class="token operator">-</span>to <span class="token punctuation">[</span>get_clocks CKB<span class="token punctuation">]</span> <span class="token operator">-</span>through <span class="token punctuation">[</span>get_ports OUT<span class="token punctuation">]</span>set_false_path <span class="token operator">-</span>from <span class="token punctuation">[</span>get_clocks CKB<span class="token punctuation">]</span> <span class="token operator">-</span>to <span class="token punctuation">[</span>get_clocks CKA<span class="token punctuation">]</span> <span class="token operator">-</span>through <span class="token punctuation">[</span>get_ports OUT<span class="token punctuation">]</span>set_false_path <span class="token punctuation">[</span><span class="token operator">-</span>from from_list<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span>through through_list<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span>to to_list<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span>from from_list<span class="token punctuation">]</span> <span class="token comment"># 包括CK, INPUT PORT, INOUT PORT</span><span class="token punctuation">[</span><span class="token operator">-</span>to to_list<span class="token punctuation">]</span>     <span class="token comment"># 包括output port，sequential cell的D，inout port</span><span class="token punctuation">[</span><span class="token operator">-</span>through through_list<span class="token punctuation">]</span> <span class="token comment"># 包括pin，ports，cells，nets</span><span class="token comment"># 包含form 或者 to 或者 through的path 都是false path</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="set-false-path和set-disable-timing区别"><a href="#set-false-path和set-disable-timing区别" class="headerlink" title="set_false_path和set_disable_timing区别"></a>set_false_path和set_disable_timing区别</h5><p>set_false_path只对data path起作用，EDA工具还是会计算路径的timing，只是不会报告是否有违例。</p><p>set_disable_timing对计算路径的timing起作用，完全不会分析timing arc。</p><p>对于异步电路要使用set_clock_group，同步电路使用false_path，主要区别在于crosstalk的计算。设置false_path后，按照同步方式来计算crosstalk，部分延迟不会计算在path内。如果timing clean后，设置clock group，report timing会发现存在较多timing违例。</p><h5 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h5><img src="/2024/03097089/1735380-20200414154416129-1897703915.png" alt="img" style="zoom: 25%;"><p>在crosstalk分析中，当信号A和信号B跳变发生于同一时刻，那么信号B会因为信号A的影响，产生一个delta delay。而如果信号A的跳变过早或者过晚，那么对于信号B的delay就没有影响。</p><p>当进行on-chip-variation mode 分析的时候。每一个aggressor和victim的跳变，都会有个最早到达时间和最晚到达时间。这个最早和最晚到达时间中间的window，就称为timing window。只有当aggressor和victim的timing window有重叠时，delta delay才会产生，也就是说，aggressor才会对victim产生影响。</p><p>如果设set false path，工具会继续按照同步关系计算timing window。</p><p>而我们知道，对于aggressor和victim属于两个具有异步关系的clock的情况，aggressor的跳变可能发生于victim整个时钟周期的任何时刻。而不只是在按照同步clock计算出来的timing windlow中。</p><p>而按照同步关系来计算的话，aggressor对victim的timing window之外的跳变的影响，工具就忽略了。这可能会导致严重的后果，轻则性能下降（setup），重则芯片fail（hold）。</p><h4 id="multi-cycle-path"><a href="#multi-cycle-path" class="headerlink" title="multi-cycle-path"></a>multi-cycle-path</h4><p>多周期设计。适应场景：设计时加入移位寄存器来做使能信号。</p><img src="/2024/03097089/image-20240309214325529.png" alt="image-20240309214325529" style="zoom: 67%;"><img src="/2024/03097089/image-20240309214654478.png" alt="image-20240309214654478" style="zoom: 67%;"><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">set_multicycle_path <span class="token operator">-</span>setup 6 <span class="token operator">-</span>from CLK1 <span class="token operator">-</span>to CLK2 <span class="token operator">-</span>end <span class="token comment"># 允许6个时钟周期后采样数据</span>set_multicycle_path <span class="token operator">-</span>hold 5 <span class="token operator">-</span>from CLK1 <span class="token operator">-</span>to CLK2  <span class="token operator">-</span>end <span class="token comment"># hold检查要提前5个时钟沿，需要和发射沿对齐。hold检查本身就要早于setup检查一个周期。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>慢时钟到快时钟</li></ul><p><img src="/2024/03097089/image-20240309215949714.png" alt="image-20240309215949714"></p><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">set_multicycle_path <span class="token operator">-</span>from CLK1 <span class="token operator">-</span>to CLK2 <span class="token operator">-</span>setup 3 <span class="token operator">-</span>endset_multicycle_path <span class="token operator">-</span>from CLK1 <span class="token operator">-</span>to CLK2 <span class="token operator">-</span>hold 2 <span class="token operator">-</span>end<span class="token comment"># -end 以捕获时钟为基准，移动的是capture clock，-setup向右移，-hold向左移</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>快时钟到慢时钟</li></ul><p><img src="/2024/03097089/20210313202848917.png" alt="在这里插入图片描述"></p><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">set_multicycle_path <span class="token operator">-</span>from CLK1 <span class="token operator">-</span>to CLK2 <span class="token operator">-</span>setup 3 <span class="token operator">-</span>start <span class="token comment"># 挪动到第3个周期</span>set_multicycle_path <span class="token operator">-</span>from CLK1 <span class="token operator">-</span>to CLK2 <span class="token operator">-</span>hold 2 <span class="token operator">-</span>start  <span class="token comment"># 向右挪动了2个周期</span><span class="token comment"># -start以发射时钟为基准，移动的是launch clock，-setup向左移，-hold向右移 </span><span class="token comment"># 注意setup和hold检查的位置，都是按照最严格的检查，在发射路径上，hold要比setup晚一个周期。且hold检查的位置为0，setup为1；</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="half-cycle-path"><a href="#half-cycle-path" class="headerlink" title="half cycle path"></a>half cycle path</h4><p>如果在设计中，同时存在上升沿触发的D触发器，以及下降沿触发的D触发器，则视为半周期路径</p><img src="/2024/03097089/image-20240309221504902.png" alt="image-20240309221504902" style="zoom:67%;"><img src="/2024/03097089/image-20240309221510712.png" alt="image-20240309221510712" style="zoom:67%;"><p>hold time 时序很容易满足。</p><h3 id="SoC时钟分频"><a href="#SoC时钟分频" class="headerlink" title="SoC时钟分频"></a>SoC时钟分频</h3><p><img src="/2024/03097089/5394e30d991b4bfeb3f61ebeee707d21.png" alt="img"></p><p>首先创建时钟</p><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">create_clock <span class="token operator">-</span>period 10 <span class="token punctuation">[</span>get_pins U_PLL<span class="token operator">/</span>OUT0<span class="token punctuation">]</span> <span class="token operator">-</span>name CLKacreate_clock <span class="token operator">-</span>period 12 <span class="token punctuation">[</span>get_pins U_PLL<span class="token operator">/</span>OUT1<span class="token punctuation">]</span> <span class="token operator">-</span>name CLKb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>产生派生时钟CLKr</p><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">create_generated_clock <span class="token operator">-</span>name CLKr <span class="token punctuation">[</span>get_pins U_DIVr<span class="token operator">/</span>OUT<span class="token punctuation">]</span> <span class="token operator">-</span>source <span class="token punctuation">[</span>get_pins U_PLL<span class="token operator">/</span>OUT0<span class="token punctuation">]</span> <span class="token operator">-</span>master_clock CLKa <span class="token operator">-</span>divide_by 4<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>产生派生时钟CLKmx</p><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">create_generated_clock <span class="token operator">-</span>name CLKm0 <span class="token operator">-</span>source <span class="token punctuation">[</span>get_pins U_PLL<span class="token operator">/</span>OUT0<span class="token punctuation">]</span> <span class="token operator">-</span>divide_by 3 <span class="token operator">-</span>combinational <span class="token operator">-</span>master_clock CLKa <span class="token punctuation">[</span>get_pins U_MUX<span class="token operator">/</span>OUT<span class="token punctuation">]</span>create_generated_clock <span class="token operator">-</span>name CLKm1 <span class="token operator">-</span>source <span class="token punctuation">[</span>get_pins U_PLL<span class="token operator">/</span>OUT1<span class="token punctuation">]</span> <span class="token operator">-</span>divide_by 4 <span class="token operator">-</span>combinational <span class="token operator">-</span>master_clock CLKb <span class="token punctuation">[</span>get_pins U_MUX<span class="token operator">/</span>OUT<span class="token punctuation">]</span> <span class="token operator">-</span>add<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>产生派生时钟CLKdx （<strong>不要忘记加-add，否则覆盖上条命令</strong>）</p><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">create_generated_clock <span class="token operator">-</span>name CLKd0 <span class="token operator">-</span>source <span class="token punctuation">[</span>get_pins U_MUX<span class="token operator">/</span>OUT<span class="token punctuation">]</span> <span class="token operator">-</span>divide_by 3 <span class="token operator">-</span>master_clock CLKm0 <span class="token punctuation">[</span>get_pins U_DIV<span class="token operator">/</span>OUT<span class="token punctuation">]</span>create_generated_clock <span class="token operator">-</span>name CLKd1 <span class="token operator">-</span>source <span class="token punctuation">[</span>get_pins U_MUX<span class="token operator">/</span>OUT<span class="token punctuation">]</span> <span class="token operator">-</span>divide_by 3 <span class="token operator">-</span>master_clock CLKm1 <span class="token punctuation">[</span>get_pins U_DIV<span class="token operator">/</span>OUT<span class="token punctuation">]</span> <span class="token operator">-</span>add<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>声明物理互斥关系</p><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">set_clock_group <span class="token operator">-</span>physically_exclusive <span class="token operator">-</span>group <span class="token punctuation">&#123;</span>CLKm0 CLKd0<span class="token punctuation">&#125;</span> <span class="token operator">-</span>group <span class="token punctuation">&#123;</span>CLKm1 CLKd1<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="巧用RTL原语实现MUX门级映射"><a href="#巧用RTL原语实现MUX门级映射" class="headerlink" title="巧用RTL原语实现MUX门级映射"></a>巧用RTL原语实现MUX门级映射</h3><p>在DC综合阶段，会将case语句的描述处理成SELECT_OP类型，将电平&#x2F;边沿触发的时序逻辑处理成SEQGEN类型。</p><p>在综合时，compile会将SELECT_OP类型实现为一个与或非逻辑或者MUX逻辑，相对于RTL中例化一个MUX而言，会带来不确定性。使用verilog的原语操作，可将case语句综合时实现为MUX逻辑。具体如下</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">case</span><span class="token punctuation">(</span>sel<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">// synopsys infer_mux</span><span class="token number">2'b00</span><span class="token punctuation">:</span> out <span class="token operator">=</span> in1<span class="token punctuation">;</span><span class="token number">2'b01</span><span class="token punctuation">:</span> out <span class="token operator">=</span> in2<span class="token punctuation">;</span><span class="token number">2'b10</span><span class="token punctuation">:</span> out <span class="token operator">=</span> in3<span class="token punctuation">;</span><span class="token number">2'b11</span><span class="token punctuation">:</span> out <span class="token operator">=</span> in4<span class="token punctuation">;</span><span class="token keyword">default</span><span class="token punctuation">:</span> out <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">endcase</span><span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>infer_mux在DC中可以指导将case语句综合成MUX结构的逻辑。</p><p>compile综合的结果如下（对比是否使用原语infer_mux）</p><p><img src="/2024/03097089/5f73583fdd794e7cbb11a34ce9ab0e60.png" alt="在这里插入图片描述"></p><ul><li>dout[0]上的MUX4面积： <strong>98.76</strong></li><li>dout[1]的与或非逻辑面积：<strong>70.092</strong></li></ul><p>在原语的控制下，DC强制使用了MUX，对于dout1的面积，实际上是做了面积的优化。相比于与非门实现的方式，面积增加了，优点在哪里？可以映射到工艺库中的标准MUX中，因为std cell的mux的精心设计过的，PPA更好一些。</p><p>对于八选一的MUX，使用了infer_mux原语，DC工具会自动扩展，灵活构建MUX Tree满足8选1的需求。如果工艺库中只有4选1的MUX，compile后的结果如下</p><p><img src="/2024/03097089/b593e35e30f240b892c59612701218a1.png" alt="在这里插入图片描述"></p><p>使用RTL原语的方法，对于设计人员的工作量大为减少，并且可以不依赖工艺库，DC工具甚至可以自动构建MUX tree，达到了事半功倍的效果。</p><h3 id="插入门控时钟"><a href="#插入门控时钟" class="headerlink" title="插入门控时钟"></a>插入门控时钟</h3><p>有两种方式插入门控时钟</p><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">insert_clock_gating compile_ultra <span class="token operator">-</span>gate_clock<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>在此之前需要设置<code>set_clock_gating_style</code>来配置门控时钟参数</p><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl"><span class="token operator">-</span>global 使得门控时钟跨越hier层次，如果不用每个子模块都会产生一个门控时钟单元。<span class="token operator">-</span>minimun_bitwidth 用于设置使用时钟门控的最小数据位宽<span class="token operator">-</span>max_fanout 设置门控单元所驱动的最大负载数目set_clock_gating_styple <span class="token operator">-</span>max_fanout 30 <span class="token operator">-</span>mininum_bitwidth 4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>针对课题组的项目</strong></p><p>在逻辑综合时设置插入icg，使用门控时钟前后，core area减小了8.9%，icg的插入率为45%</p><h3 id="GBA和PBA"><a href="#GBA和PBA" class="headerlink" title="GBA和PBA"></a>GBA和PBA</h3><p>GBA是Graph Base Analysis，PT在计算timing时，默认是基于GBA模式的。GBA计算path delay时采用的是所有pin脚中最慢的skew作为input transition。PBA是根据实际路径来使用skew作为input transition。</p><p><img src="/2024/03097089/e508c7d235ad463609b45df0d3fd9155.jpeg" alt="img"></p><p>利和弊：</p><p>GBA计算方式得到的结果比较悲观，而PBA更加真实。PBA计算方式比较复杂，runtime时间久。GBA较为悲观，但是运行时间短。</p>]]></content>
      
      
      <categories>
          
          <category> ASIC数字后端流程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>低功耗方法学（二）</title>
      <link href="/2024/030658141.html"/>
      <url>/2024/030658141.html</url>
      
        <content type="html"><![CDATA[<h2 id="4-电源门控概述（power-gating）"><a href="#4-电源门控概述（power-gating）" class="headerlink" title="4 电源门控概述（power gating）"></a>4 电源门控概述（power gating）</h2><p>为了减少芯片的总泄漏功耗，非常希望添加关闭未使用的模块的机制，这种技术称为电源门控 <strong>power gating</strong></p><h3 id="4-1-动态功耗和泄漏功耗分布"><a href="#4-1-动态功耗和泄漏功耗分布" class="headerlink" title="4.1 动态功耗和泄漏功耗分布"></a>4.1 动态功耗和泄漏功耗分布</h3><p>电源门控的基本策略是提供两种电源模式：低功率模式和活动模式。目标是在恰当的时间以适当的方式在这些模式中切换，以最大限度的节省功耗，同时最大限度的减少对性能的影响。</p><p>电源门控比时钟门控更有复杂，因为需要模块之间复杂的通信和时间延迟以安全进入和退出电源门控模式。电源门控的控制权可以由软件调度，作为设备驱动程序或操作系统空闲任务的一部分，也可以由电源管理控制器在硬件中启动。需要从以下角度考虑选择哪种控制模式</p><ol><li>可能节省的漏电功耗</li><li>产生进入和退出电源门控模式的时间</li><li>进入和离开这个模式消耗的能量</li><li>模块的活动分布（活动或者睡眠的比例）</li></ol><p><strong>术语</strong></p><p>​SLEEP：进入低功耗模式<br>​WAKE：返回活动模式</p><ul><li><p>通过时钟门控降低功耗</p><img src="/2024/030658141/image-20240306225913409.png" alt="image-20240306225913409" style="zoom: 33%;"></li><li><p>通过电源门控降低功耗</p><p>WAKE时间和时钟运行直接的响应时间很重要，在系统设计层次不能</p><img src="/2024/030658141/1709739346255.jpg" alt="1709739346255" style="zoom:33%;"></li><li><p>电源门控切换速度不彻底（真实情况）</p><img src="/2024/030658141/image-20240306234721173.png" alt="image-20240306234721173" style="zoom:33%;"></li></ul><h3 id="4-2-电源门控在不同子系统上的影响"><a href="#4-2-电源门控在不同子系统上的影响" class="headerlink" title="4.2 电源门控在不同子系统上的影响"></a>4.2 电源门控在不同子系统上的影响</h3><p>带有缓存的CPU系统通常可能长期处于休眠或者不活动状态，使得电源门控的设计更加具有必要性。需要考虑一下因素：</p><ul><li>电压门控技术可以很好的降低CPU的泄漏功耗</li><li>如果每次CPU断电时缓存内容都丢失，上电时需要重新填充，可能需要花费大量时间和成本</li><li>节省的净能量取决于睡眠和唤醒的活动性。即电源门控节省的能量和重新加载消耗的能量。</li></ul><p>外围子系统受到设备驱动程序和操作系统的电源管理方案控制。需要在唤醒时快速恢复状态以最大限度的节省功耗</p><ul><li>设备驱动程序可能需要显示加载&#x2F;恢复密钥状态或启动硬件定时器控制作为唤醒&#x2F;睡眠的一部分</li><li>更好的方式是外设在睡眠模式时，保存一些状态，但是需要额外的电路和控制。</li></ul><h3 id="4-3-电源门控的设计原理"><a href="#4-3-电源门控的设计原理" class="headerlink" title="4.3 电源门控的设计原理"></a>4.3 电源门控的设计原理</h3><p>使用电源门控的SoC简化视图如下，与时钟通电的模块不同，电源门控功能模块通过电源开关网络接收电源。电源开关网络分布在电源门控功能模块周围。Isol模块放置在电源门控模块和始终开启模块之间，当输入处于阈值电压时，输出电压的过渡状态很短，不会对后面always on模块产生较大影响，起到了隔离的作用。</p><img src="/2024/030658141/image-20240307135341610.png" alt="image-20240307135341610" style="zoom:40%;"><p>对于某些电源门控模块，非常希望在断电时保留模块内部状态，并在通电期间恢复该状态。这种策略在上电期间可以节省大量时间和功耗。实现方式：将保留寄存器替代普通寄存器。</p><p>保持寄存器通常具有比主寄存器慢但是泄漏电流小得多的辅助寄存器或者影子寄存器。影子寄存器始终处于通电状态，并在电源门控期间存储主存储器的内容。该控制信号由电源门控控制器提供。</p><h4 id="4-3-1-电源切换-细粒度和粗粒度"><a href="#4-3-1-电源切换-细粒度和粗粒度" class="headerlink" title="4.3.1 电源切换-细粒度和粗粒度"></a>4.3.1 电源切换-细粒度和粗粒度</h4><p>电源切换一般有两种方法：细粒度电源门控和粗粒度电源门控</p><p>在细粒度电源切换门控中，开关放置在库中每个标准单元中，由于开关必须提供电源所需要的最坏情况电流，因此必须相当大，以免影响性能。每个单元的面积开销很大（通常是原始单元大小的2到4倍）。下面是带上拉的细粒度与门。</p><img src="/2024/030658141/image-20240307144844883.png" alt="image-20240307144844883" style="zoom:50%;"><p>细粒度电源门控的主要优点是，开关上的IR压降的时序影响和钳位器的行为很容易表征，因为他们包含在单元内，可以采用传统的设计方法部署细粒度电源门控。</p><p>在粗粒度电源门控中，一组门级单元通过一组开关单元来切换电源。时序分析困难，但是面积相比细粒度小很多。</p><p>目前，设计中都是使用粗粒度电源门控。任何电源门控的关键挑战是减小涌浪电流，以避免电源网络中出现过多的IR压降。否则，电源门控模块的功能和状态 当进行睡眠&#x2F;复位顺序不同时会被破坏。</p><h4 id="4-3-2-电源门控的挑战"><a href="#4-3-2-电源门控的挑战" class="headerlink" title="4.3.2 电源门控的挑战"></a>4.3.2 电源门控的挑战</h4><ol><li>电源开关结构设计</li><li>电源门控控制器设计</li><li>保持寄存器和隔离寄存器的选择和使用</li><li>最大限度减少电源门控对时序和面积的影响</li><li>接口隔离</li><li>时钟和复位的功能控制</li><li>对每个受支持的电源状态与状态相关的验证</li><li>制造和生产测试策略</li></ol><h2 id="5-电源门控设计"><a href="#5-电源门控设计" class="headerlink" title="5 电源门控设计"></a>5 电源门控设计</h2><p>带有电源门控的SoC结构，需要解决的问题：开关网络和电源门控控制器的设计、何时何地插入保留寄存器和隔离寄存器。</p><img src="/2024/030658141/image-20240309092347605.png" alt="image-20240309092347605" style="zoom: 67%;"><h3 id="5-1-开关结构设计"><a href="#5-1-开关结构设计" class="headerlink" title="5.1 开关结构设计"></a>5.1 开关结构设计</h3><p>第一种架构是切换VDD还是VSS，或者同时切换。一般采用NMOS传递低电压，PMOS传递高电压，因为没有阈值电压损失。但是这种切换的开关电源会导致较大的IR Drop在电源上，进而影响设计中门的延迟。</p><img src="/2024/030658141/image-20240309094251614.png" alt="image-20240309094251614" style="zoom:50%;"><p>对于Header-Switch结构，当开关关闭时，GATED VDD输出趋近于低电平。对于Footer-Switch 结构，当开关关闭时，GATED VSS输出趋近于高电平。</p><p>注意，在NMOS导通传递低电平，在PMOS导通传输高电平时，无法保证没有电压损失，因为开关有漏电流。<strong>这也是为什么输出需要隔离单元的原因之一</strong></p><p>推荐的方式:</p><ul><li>切换电源或者低，而不是两者都切换，以减小IR drop。</li><li>在设计前期决定是Header-Switch还是GATED VDD更适合系统设计。</li><li>Header-Switch更适合外部电源门控</li><li>Header-Switch适合用在多电压或者电压调节技术中</li></ul><p>缺点：</p><p>Footer-Switch电源门控与外部开关电源或者多个电源混用时，会导致整个设计的功耗、时序和功能变得复杂，对标准单元库提出了更复杂的要求。</p><h4 id="5-1-1-控制开关网络"><a href="#5-1-1-控制开关网络" class="headerlink" title="5.1.1 控制开关网络"></a>5.1.1 控制开关网络</h4><p>关键问题在于限制模块电源切换时所产生的涌浪电流，过多的这种电流会导致电源出现电压尖峰，可能损坏常开模块中寄存器以及电源门控模块中的保留寄存器。</p><p>一种代表性降低涌浪电流的方法是将控制信号以链表方式连接到开关，来自电源控制器的控制信号连接到第一个开关，它缓冲（具有适当的延迟）信号并将其发送到下一个开关。</p><p>这种链的结果是，从发出“加电”信号到模块加电需要一些时间。因此，交换结构通常会提供确认信号来指示该结构已完全加电。该信号可以简单地是“加电”控制信号的最终缓冲版本。</p><p>更激进的一种方式是依次使用多个上电控制信号，第一控制信号可以打开一组弱开关或“涓流”开关，这些开关启动加电但限制浪涌电流。然后第二控制信号可以打开主电源开关组。</p><p>无论具体的控制方法如何，在上电序列期间，重要的是要等到交换结构完全上电，然后才能使电源门控块恢复正常操作。该上电序列的时序由电源控制器负责。</p><p>电源开关结构的控制信号（电源开&#x2F;关和确认的整个链）必须由始终开启的缓冲区进行缓冲，而不是由电源门控缓冲区进行缓冲。</p><h4 id="5-1-1-电源门控的建议和陷阱"><a href="#5-1-1-电源门控的建议和陷阱" class="headerlink" title="5.1.1 电源门控的建议和陷阱"></a>5.1.1 电源门控的建议和陷阱</h4><p>建议</p><ul><li>电源控制器需要针对特定的电源门控技术来设计</li><li>应该为电源门控控制端口提供断言，以匹配所选的开关技术，确保RTL设计环境中的功能验证和覆盖率</li><li>电源门控控制信号必须在测试期间可控。</li></ul><p>陷阱</p><ul><li>将外部电源门控和内部电源门控相结合可能会很麻烦，因为在内部的电源在外部电源门控期间可能不会“始终开启”。在这种情况下需要仔细设计和验证。</li></ul><h3 id="5-2-信号隔离"><a href="#5-2-信号隔离" class="headerlink" title="5.2 信号隔离"></a>5.2 信号隔离</h3><p>电源门控模块的每个接口都需要进行管理，确保关闭该电压域不会导致其他模块的任何输入出现涌浪电流。并且需要保证掉电模块的输出浮动不会导致上电模块出现虚假翻转行为。</p><p>电源门控模块的输出是主要的问题，因为它们可能导致其他模块出现电气或者功能问题。输入一般不是问题，因为它们可以通过上电模块驱动为有效逻辑值，不会在断电模块中产生电气或者功能问题。</p><h4 id="5-2-1-信号隔离技术"><a href="#5-2-1-信号隔离技术" class="headerlink" title="5.2.1 信号隔离技术"></a>5.2.1 信号隔离技术</h4><p>控制掉电模块输出的基本方法是使用隔离单元将输出钳位到特定的有效值。</p><p>隔离单元分为三种类型：将信号钳位到0的单元、将信号钳位到1的单元以及将信号锁定存为最近值的隔离单元。</p><p>钳位库单元旨在避免信号输入浮动时出现的涌浪电流和泄漏路径，只要控制输入信号处于合适的状态即可。此外，这些钳位库单元具有特殊的属性，保证在综合时不会因逻辑优化而被优化掉或者优化错误。</p><p>两种隔离单元，与门类型和或门类型</p><img src="/2024/030658141/image-20240310183835490.png" alt="image-20240310183835490" style="zoom: 43%;"><p>注意的是，这些钳位单元对于输入到输出带来了一些延迟，对于关键路径，可能会带来setup违例的影响，比如高速缓存接口。另一种不增加延迟的隔离技术是使用上拉或者下拉晶体管。但是可能会带来多个驱动晶体管，需要仔细设计和排序，避免竞争使用。即使上拉或者下拉晶体管是相对较弱的器件，总数也可能足够大，以至于总线产生的电流过量导致问题。</p><img src="/2024/030658141/image-20240310191620029.png" alt="image-20240310191620029" style="zoom: 43%;"><p>为了避免输出毛刺，在上电期间，需要保证输出隔离。这种隔离效果应该是直接的，对于上拉&#x2F;下拉晶体管来说，可能相当具有挑战性，因为只要这些晶体管在活动状态下重新上电，会出现多点驱动问题，输出不定，产生毛刺。</p><p>尽管上拉&#x2F;下拉钳位隔离单元在面积和时序上有优势，但是由于出现的诸多问题，不建议参与RTL设计。相反，建议使用”门级”单元格式。</p><h4 id="5-2-2-输出和输入隔离"><a href="#5-2-2-输出和输入隔离" class="headerlink" title="5.2.2 输出和输入隔离"></a>5.2.2 输出和输入隔离</h4><p>如上所述，有必要隔离电源门控单元的输出，以避免浮动输出驱动上电模块输入的电气问题。从逻辑上讲，将信号钳位在电源门控模块的输出还是目的模块的输入没有什么区别。</p><p>但是有一些实际考虑因素会影响这一选择。</p><p>电源门控模块的输出至少会流向多个上电模块。如果在上电模块的输入隔离，需要多个隔离单元。因此，在电源门控模块的输出隔离更节省面积。在电源门控模块的输出做隔离，使得分析更加容易。</p><p>但是源头隔离输出的方式，对于布局和布线提出了一些限制。与电源门控模块中的其他门不同，隔离单元必须保证在断电期间保持通电状态，所以需要提供常开的电源线，使得电源布线变得复杂，但是现在EDA工具能够解决这个问题。</p><p>因此，强烈建议输出信号采用源头隔离的方式。</p><h4 id="5-2-3-接口协议和隔离"><a href="#5-2-3-接口协议和隔离" class="headerlink" title="5.2.3 接口协议和隔离"></a>5.2.3 接口协议和隔离</h4><p>设计电源门控模块的接口时，有两个目标：最大程度地减少泄漏电流和避免不必要或不正确的行为。</p><p>无论如何，需要考虑在断电期间，将接口信号钳位到0&#x2F;1带来的影响。钳位到错误的电平，可能会增加漏电流。</p><p>对于Header switched设计方式，建议使用高电平有效，低电平有效复位，将所有信号钳位到0。对于Footer-switched方式，建议高电平有效信号和低电平有效复位，并将所有信号钳位为“0”，此规则有一个可能的例外：如果在接收块的输入处使用传输门。如果使用传输门，我们可能需要钳位为“1”以避免潜路径泄漏。</p><img src="/2024/030658141/image-20240310205621878.png" alt="image-20240310205621878" style="zoom: 33%;"><p>普遍倾向于使用高电平有效和低电平有效复位的原因有两个：这是最常用的设计；对于RTL设计也容易、易于调试</p><p>最后一点：对于复杂的协议，可能需要更复杂的隔离策略：将信号在断电时保持不变。这种方法允许重新启动进程，而不是从复位状态开始。但是这种需要带锁存的隔离单元，并不是所有库中都有该单元。只有在绝对必要时才使用该策略。</p><h3 id="隔离的建议和陷阱"><a href="#隔离的建议和陷阱" class="headerlink" title="隔离的建议和陷阱"></a>隔离的建议和陷阱</h3><p>建议</p><ul><li>隔离电源门控模块的输出</li><li>使用隔离单元而不是上拉或下拉式钳位，除非使用非常专门的接口协议</li><li>确保在隔离控制信号测试期间可以检测到卡在 0 和卡在 1 故障</li></ul><p>缺陷</p><ul><li>确保隔离单元始终处于通电状态</li><li>时钟上的隔离钳位会使时钟树合成和时序收敛变得相当复杂，如果可能，请避免在电源门控模块中生成并在该模块外部使用的时钟。</li></ul><h3 id="5-3-状态保留和恢复的方法"><a href="#5-3-状态保留和恢复的方法" class="headerlink" title="5.3 状态保留和恢复的方法"></a>5.3 状态保留和恢复的方法</h3><p>给定电源开关结构和隔离策略，就可以对逻辑模块进行电源门控。如果不使用保留策略，断电后重新上电，所有状态信息都会丢失。要在上电时恢复其状态，该模块必须从外部源恢复其状态或从复位条件建立其状态。无论哪种情况，所需的时间和功率都可能很大。</p><p>保留状态的寄存器数目，需要根据子系统的特征进行评估。</p><p>多种方法可以保存和恢复电源门控模块的内部状态</p><ul><li>基于软件的读写寄存器</li><li>使用扫描链在片外存储芯片掉电时的状态</li><li>使用保留寄存器保存寄存器的状态</li></ul><p>采用软件方法保留和恢复状态的缺点</p><ul><li>总线阻塞会降低断电和上电的速度</li><li>总线冲突会使得模块保存和恢复状态时间不确定。</li><li>实现起来较为复杂。</li></ul><h4 id="5-3-2-基于扫描链保留状态"><a href="#5-3-2-基于扫描链保留状态" class="headerlink" title="5.3.2 基于扫描链保留状态"></a>5.3.2 基于扫描链保留状态</h4><p>为了DFT而设计的扫描链可以重新用关于执行状态保留，几乎不会增加多余的硬件开销。在断电期间，扫描寄存器像扫描测试一样，输出到片外或片内存储器中，如果位于片内，存储器需要时钟通电。在上电期间，扫描链从存储器加载数据。</p><p>一旦状态被扫描到内存中，整个子系统的电源可以完全断电，无需为保留寄存器 保留时钟开启的电源区域。</p><p>从RTL设计角度来说，存在挑战。在DC之前不会插入和连接扫描触发器，但有必要在综合之前对控制器进行仿真和调试。</p><p>为了实现最快的保存和恢复时间，我们希望使用内存数据总线的所有位宽来保存数据写入内存。意味着扫描链的数量等于内存数据总线的宽度。实际上，扫描链可能太多，无法用于制造测试。但通常我们会使用至少 8 个扫描链，并且可能是 8 的倍数。对于多条的扫描链，需要平衡扫描链的长度，因为这写扫描链都是使用同一个移位使能信号。</p><p>寄存器状态保存和恢复会带来较大功耗，如果使用外部存储器，则 IO 功率可能会很大，即使使用内部存储器，仅仅通过扫描链移动数据就可能需要大量的动态功率。并且可能带来不可接受的IR电压降。</p><p>对于长期睡眠，通过关闭整个子系统可以节省漏电。如果可以使用扫描链恢复状态，对于功耗的节省更加显著。</p><p>下面是4bit的保存数据扫描链示意图，其中一个扫描链比其他扫描链短，一旦扫描链平衡，状态就可以保存在内存中，然后从内存中恢复。</p><p><img src="/2024/030658141/image-20240323200253055.png" alt="image-20240323200253055"></p><p>网表实现之前（插入扫描链），对RTL级进行仿真和验证是一个挑战，但是并非不可克服。</p><p>一种方法是将添加条件代码，这些代码仅在模拟基于扫描保留时才进行编译。该代码进行行为级建模，以验证控制器是否正常运行以及数据是否正确写入存储器和从存储器中读取。</p><h4 id="5-3-2-保留寄存器"><a href="#5-3-2-保留寄存器" class="headerlink" title="5.3.2 保留寄存器"></a>5.3.2 保留寄存器</h4><p>保留寄存器包含一个“影子”寄存器，可以在断电期间保留寄存器状态，并在上电时恢复。与主寄存器不同，影子寄存器需要始终在通电状态。</p><p>下图显示了两个保留寄存器，在每种情况下，主寄存器均有开关电源轨“VDD_SW”供电，CLK，D和RESETN引脚均在主寄存器上运行。影子寄存器始终由电源VDD供电。</p><p>左图中，当SAVE有效时，主寄存器的状态将加载到影子寄存器中。当RESTORE有效时，影子寄存器的状态被加载回主寄存器。右图中，当RETAIN变高时，主寄存器状态加载到影子寄存器中，当RETAIN变低时，影子寄存器状态加载回主寄存器。RETAIN是边沿敏感信号。</p><img src="/2024/030658141/image-20240323203605089.png" alt="image-20240323203605089" style="zoom:50%;"><p>物理实现中，保留寄存器会带来一定的面积开销，通常为20%或更多。一些保留寄存器包含保护带，以尽可能稳健地将保留状态与电源门控瞬态隔离。在这种情况下，面积开销可能高达 50% 或更多。在具有大量寄存器的设计中，该区域的影响可能很大。</p><p>考虑替代方案。我们可以限制实现仅使用低泄漏、高 VT 寄存器，</p><h4 id="5-3-3-用于保留的电源控制器设计"><a href="#5-3-3-用于保留的电源控制器设计" class="headerlink" title="5.3.3 用于保留的电源控制器设计"></a>5.3.3 用于保留的电源控制器设计</h4><p>控制器必须给出保存和恢复寄存器明确的顺序。影子寄存器可能很慢，需要保证在保存操作时，主寄存器的数据是稳定的。大多数设计人员在执行保存之前停止时钟。当然，保存操作必须在电源关闭之前完成。</p><p>必须先完成恢复操作，然后才能将新值加载到主寄存器。大多数设计人员在还原操作完成之前不会重新启动时钟。</p><p>虽然功率门控控制器在设计中需要一定的注意，但保留寄存器对标准触发器的实际替代可以在实现期间可以通过EDA工具自动完成。</p><p>为了最小化泄漏，时钟和复位树可能在掉电期间关闭。为了防止这些浮动（模拟中的X）信号损坏保留寄存器，保留必须优先于时钟和复位在设计功率门控控制器时，重要的是要理解功率门控库中可用单元的行为，以确保影子寄存器不会因浮动时钟和复位而损坏。</p><h4 id="5-3-4-部分和完全状态保留"><a href="#5-3-4-部分和完全状态保留" class="headerlink" title="5.3.4 部分和完全状态保留"></a>5.3.4 部分和完全状态保留</h4><p>在部分状态保留中，只保存和恢复“架构上可见”的状态。挑战在于非保留寄存器需要在安全、合法和可验证的状态下上电启动。非保留寄存器的典型例子：FIFO、存储器和计数器。这些器件转换成保留寄存器可能非常昂贵。</p><p>深状态和浅状态的概念在确定非保留寄存器时可能有用。浅状态指的是直接控制设计逻辑的寄存器，也就是说，可以绘制为状态机图的设计部分。深状态是指状态机使用的寄存器，但其中包含大量的辅助数据，如内存，计数器和FIFO，通常不会将这些器件作为状态机的一部分。</p><p>对于部分保留，合理的策略可以是保存和恢复浅状态，并且具有用于处理深状态的单独策略。重置深状态寄存器的控制器是一种可能的策略。在恢复时，需要仔细和有选择的使用复位，保证只复位非保留寄存器，不干扰保留寄存器。</p><h4 id="5-3-5-系统级问题和保留"><a href="#5-3-5-系统级问题和保留" class="headerlink" title="5.3.5 系统级问题和保留"></a>5.3.5 系统级问题和保留</h4><p>构成时钟门控使能的所有状态位都需要保留或重新初始化为安全和可重启的条件，以此方式，可以干净地重新生成时钟门控单元锁存器的内容，而不需要向时钟门控单元添加保持。</p><h4 id="5-3-6-状态保留的建议和陷阱"><a href="#5-3-6-状态保留的建议和陷阱" class="headerlink" title="5.3.6 状态保留的建议和陷阱"></a>5.3.6 状态保留的建议和陷阱</h4><h5 id="建议"><a href="#建议" class="headerlink" title="建议"></a>建议</h5><ul><li>如果实现部分保留，则为设计的保留和非保留存储部分提供单独的重置。这允许对上电复位和恢复&#x2F;重新初始化操作进行清晰的验证。</li><li>在实现部分保留时，确保状态机和定序器不依赖于非保留状态，以避免状态相关的死锁或无效状态条件。(The如果必须用非保留状态测试许多保留状态值，则要验证的状态空间可能是巨大的）。</li><li>在专用保留寄存器的面积影响太高的情况下，则重用制造扫描链是一种选择。</li><li>在扫描测试期间，必须使保留控制可控且可观察。</li></ul><h5 id="陷阱"><a href="#陷阱" class="headerlink" title="陷阱"></a>陷阱</h5><ul><li>不良的浪涌电流管理或保留电源噪声可能会损坏保留寄存器，导致重启时出现不安全&#x2F;无效状态。</li><li>部分保留需要更严格的重置和恢复验证，以确保保留&#x2F;恢复状态和重新初始化的非保留状态之间永远不会出现死锁情况。</li><li>影响时钟门控的使能需要保存其状态，以确保接下来的行为正确。</li><li>基于扫描的保存和恢复方法可能使用系统总线来向&#x2F;从存储器传输数据。该总线通常可以具有等待状态;因此，需要注意确保扫描保存&#x2F;恢复控制器可以支持等待状态而没有任何数据丢失。</li></ul><h3 id="5-4-电源门控控制"><a href="#5-4-电源门控控制" class="headerlink" title="5.4 电源门控控制"></a>5.4 电源门控控制</h3><p>有了电源交换结构、隔离策略和保留策略，我们现在可以设计控制掉电和上电顺序的电源控制器</p><h4 id="5-4-1-电源控制时序"><a href="#5-4-1-电源控制时序" class="headerlink" title="5.4.1 电源控制时序"></a>5.4.1 电源控制时序</h4><p>不需要保存状态情况下，关闭电源进行下面操作。</p><ul><li>刷新正在进行的任何总线或外部操作</li><li>在适当的阶段停止时钟，以最大限度地减少漏入电源门控区的电流</li><li>置位隔离控制信号，将所有输出置于安全状态。</li><li>对模块进行复位，使其在复位条件下上电</li><li>置位电源门控控制信号，使模块掉电</li></ul><p>在恢复电源时，进行下面操作</p><ul><li>使电源门控控制信号无效，让模块上电。</li><li>根据控制涌浪电流的方法和技术，选择对多个控制信号排序，分阶段上电。</li><li>取消复位有效，确保门控上电后的初始化。</li><li>取消隔离控制信号有效，恢复输出</li><li>重新启动时钟，无毛刺且不违反最小脉宽设计约束</li></ul><img src="/2024/030658141/image-20240324104727581.png" alt="image-20240324104727581" style="zoom:67%;"><img src="/2024/030658141/image-20240324110003813.png" alt="image-20240324110003813" style="zoom:67%;"><h4 id="5-4-2-握手协议"><a href="#5-4-2-握手协议" class="headerlink" title="5.4.2 握手协议"></a>5.4.2 握手协议</h4><p>电源门控上电和掉电需要时间，电源门控切换结构必须限制电压尖峰（可能会破坏保留寄存器或其他上电模块），大多数设计通过在上电期间限制电流来实现这一点，从而限制电压上升到其最终值的速率。</p><p>电源控制器必须适应此过程，它必须等到加电完成后才能发出restore。也就是说，它必须在通电和恢复时插入延迟。最简单的方法是在控制时序中加入一个固定延迟。计数器计数到足够周期以满足上电和掉电时间。但是，在RTL中嵌入这样的时间常数将RTL绑定到特定交换结构实现的定时。结果是IP的便携性或可重复使用性明显降低。</p><p>因此，建议使用req-ack握手来控制电源切换结构。</p><img src="/2024/030658141/image-20240324112423023.png" alt="image-20240324112423023" style="zoom:67%;"><p>电源控制器发出N_PWR_REQ以关闭电源交换结构。交换结构负责在电源完全关闭时返回N_PWR_ACK。上电时，控制器解除N_PWR_ACK以打开交换结构。当交换结构完全打开并且可以安全进行时，交换结构解除N_PWR_ACK。之后按照，RESET和ISO的时序发出信号。</p><p>在电源控制器中，电源的ACK信号通常是异步的，需要将该信号同步到该时钟域才可以使用。</p><h4 id="5-4-3-电源门控控制器的建议和缺陷"><a href="#5-4-3-电源门控控制器的建议和缺陷" class="headerlink" title="5.4.3 电源门控控制器的建议和缺陷"></a>5.4.3 电源门控控制器的建议和缺陷</h4><h5 id="建议-1"><a href="#建议-1" class="headerlink" title="建议"></a>建议</h5><ul><li>设计具有用于电源门控控制的请求和确认握手的控制器</li><li>需要设计同步器确保安全的唤醒时序</li></ul><h5 id="缺陷"><a href="#缺陷" class="headerlink" title="缺陷"></a>缺陷</h5><ul><li>一种关键情况是，控制器在掉电后立即尝试对模块上电，而实际上掉电尚未完成。也就是说，上电序列在电源门控结构仅部分断电时开始。设计人员在设计功率控制器时需要仔细考虑这种情况。请记住，关断时间取决于半导体工艺和温度。</li></ul><h3 id="5-5-电源门控设计与验证-RTL仿真"><a href="#5-5-电源门控设计与验证-RTL仿真" class="headerlink" title="5.5 电源门控设计与验证-RTL仿真"></a>5.5 电源门控设计与验证-RTL仿真</h3><p>接下来我们考虑在RTL级验证电源门控电路的问题。这是一个挑战，因为硬件描述语言（HDL）不提供用于在RTL级描述电源连接的机制。为了模拟电源门控，我们需要扩展Verilog，通过修改代码或使用一组单独的命令来描述电源连接和电源开关。</p><p>同一电源格式（Unified Power Format，UPF）定义了用于电源门控和仿真的语言格式和语义。UPF标准的大部分内容都涉及电源策略的实现。</p><h4 id="5-5-1-推断RTL中电源门控的行为"><a href="#5-5-1-推断RTL中电源门控的行为" class="headerlink" title="5.5.1 推断RTL中电源门控的行为"></a>5.5.1 推断RTL中电源门控的行为</h4><p>第一步是模拟掉电块的影响。</p><p>UPF提供了一种机制（一组tcl命令），用于定义电源域（一组Verilog模块）和电源域的一组电源（电源和接地电源网）。</p><p>下图显示了要模拟设计的电源连接。Verilog模块my_module（实例U1）有一个header开关，用于控制模块中所有逻辑的电源。功率门控控制器解除断言pwr_req以使模块掉电，并且断言pwr_req以使模块上电。信号pwr_ack是表示交换机已完成上电&#x2F;掉电的确认信号。在RTL级别，它只是一个缓冲版本的req。在门级网表中，它将具有真实的延迟。具体的UPF命令如下</p><img src="/2024/030658141/image-20240324172644978.png" alt="image-20240324172644978" style="zoom:67%;"><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">create_power_domain top <span class="token operator">-</span>include_scopecreate_power_domain top_power_domain <span class="token operator">-</span>include_scopecreate_supply_net VDD_SOC <span class="token operator">-</span>domain top_power_domainconnect_supply_net VDD_SOC <span class="token operator">-</span>domain top_power_domaincreate_supply_net VSS_SOC <span class="token operator">-</span>domain top_power_domainconnect_supply_net VSS_SOC <span class="token operator">-</span>domain top_power_domainset_scope U1create_power_domain my_power_domain <span class="token operator">-</span>include_scopecreate_supply_net sw_vdd <span class="token operator">-</span>domain my_power_domainset_domain_supply_net my_power_domain <span class="token operator">-</span>primary_power_net sw_vdd <span class="token operator">-</span>primary_ground_net <span class="token operator">/</span>top<span class="token operator">/</span>VSS_SOC<span class="token comment">#create_power_switch block1_sw   -domain block1  </span><span class="token comment">#-input_supply_port &#123;&lt;PIN_NAME> VDD&#125; </span><span class="token comment">#-output_supply_port &#123;&lt;PIN_NAME> VDD_1&#125; </span><span class="token comment">#-control_port &#123;&lt;PIN_NAME> inst_always_on/pwr_ctrl&#125; </span><span class="token comment">#-on_state     &#123;&lt;state_name> &lt;input_pin_name> &lt;boolean_expression>&#125;</span><span class="token comment">#-off_state    &#123;&lt;state_name> &lt;boolean_expression>&#125;</span>                        create_power_switch my_power_switch <span class="token operator">-</span>domain my_power_domain<span class="token operator">-</span>input_supply_port <span class="token punctuation">&#123;</span>my_sw_input_port <span class="token operator">/</span>top<span class="token operator">/</span>VDD_SOC<span class="token punctuation">&#125;</span><span class="token operator">-</span>output_supply_port <span class="token punctuation">&#123;</span>my_sw_output sw_vdd<span class="token punctuation">&#125;</span><span class="token operator">-</span>control_port <span class="token punctuation">&#123;</span>my_sw_control <span class="token operator">/</span>top<span class="token operator">/</span>pwr_req<span class="token punctuation">&#125;</span><span class="token operator">-</span>ack_port <span class="token punctuation">&#123;</span>my_ack_port <span class="token operator">/</span>top<span class="token operator">/</span>pwr_ack<span class="token punctuation">&#125;</span><span class="token operator">-</span>on_state <span class="token punctuation">&#123;</span>pwr_on_state my_input_port<span class="token punctuation">&#123;</span>my_sw_control_port <span class="token operator">==</span> 1<span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token operator">-</span>off_state <span class="token punctuation">&#123;</span>pwr_off_state <span class="token punctuation">&#123;</span>my_sw_control <span class="token operator">==</span> 0<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当pwr_req拉低时（请求关断），开关会关闭所有元件的电源，也就是所有寄存器的输出为x，U1的输出为x。与此同时，pwr_ack信号拉低，通知电源控制器电源已经完全关闭。UPF支持为应答信号分配延迟，但对于RTL仿真，我们使用默认的零延迟。</p><p>当pwr_req拉高时，开关将电源接通U1的所有元件，所有寄存器恢复其正常操作，与此同时，将pwr_ack设置为高，通知电源控制器电源已完全打开。</p><p>对于不支持UPF的仿真器，可以使用行为级代码模拟电源门控的行为。</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token important">always @</span> <span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>current_state <span class="token operator">&lt;=</span> <span class="token number">4'b0101</span><span class="token punctuation">;</span><span class="token keyword">else</span>current_state <span class="token operator">&lt;=</span> next_state<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token constant">`ifdef</span> RTL_PG_EMULATE<span class="token keyword">wire</span> sw_vdd<span class="token punctuation">;</span><span class="token keyword">assign</span> sw_vdd <span class="token operator">=</span> pwr_req <span class="token operator">&amp;</span> pwr_ack<span class="token punctuation">;</span><span class="token constant">`endif</span><span class="token important">always @</span> <span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token constant">`ifdef</span> RTL_PG_EMULATE<span class="token keyword">or</span> <span class="token keyword">negedge</span> sw_vdd<span class="token constant">`endif</span> <span class="token punctuation">)</span> <span class="token keyword">begin</span><span class="token constant">`ifdef</span> RTL_PG_EMULATE<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>sw_vdd<span class="token punctuation">)</span>current_state <span class="token operator">&lt;=</span> <span class="token number">4'bXXXX</span><span class="token punctuation">;</span><span class="token keyword">else</span><span class="token constant">`endif</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>current_state <span class="token operator">&lt;=</span> <span class="token number">4'b0101</span><span class="token punctuation">;</span><span class="token keyword">else</span>current_state <span class="token operator">&lt;=</span> next_state<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token keyword">end</span><span class="token comment">// 在掉电的瞬间，current_state输出x态。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5-5-2-推断RTL中的电源门控和保留的行为"><a href="#5-5-2-推断RTL中的电源门控和保留的行为" class="headerlink" title="5.5.2 推断RTL中的电源门控和保留的行为"></a>5.5.2 推断RTL中的电源门控和保留的行为</h4><p>对于使用保留的设计， 下一步是修改RTL建模保留状态的行为。</p><ul><li>在保存操作之前，保留状态变量初始化为x</li><li>在SAVE操作时，采样寄存器的状态保存到 保留寄存器。</li><li>电源门控时，强制所有的寄存器输出x</li><li>在RESTORE操作时，从保留寄存器的值恢复到主寄存器</li><li>建模时，确保电源门控、保持、复位和时钟的优先级顺序。</li></ul><p>UPF提供命令来指定保留寄存器的“always on”电源网络以及保存和恢复控制信号。默认情况下，set_retention命令会将电源域中的所有寄存器转换为保留寄存器。</p><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">set_retention my_retention_strategy <span class="token operator">-</span>domain my_power_domain<span class="token operator">-</span>retention_power_net VDD_SOCset_retention_control my_retention_strategy<span class="token operator">-</span>domain my_power_domain<span class="token operator">-</span>save_signal <span class="token punctuation">&#123;</span>SAVE posedge<span class="token punctuation">&#125;</span><span class="token operator">-</span>restore_signal <span class="token punctuation">&#123;</span>NRESTORE negedge<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过RTL来建模描述保存和恢复寄存器的行为</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> save_current_state<span class="token punctuation">;</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> SAVE<span class="token punctuation">)</span> <span class="token keyword">begin</span>save_current_state <span class="token operator">&lt;=</span> current_state<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> NRESTORE<span class="token punctuation">)</span> <span class="token keyword">begin</span>current_state <span class="token operator">&lt;=</span> save_current_state<span class="token punctuation">;</span><span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 读书笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 低功耗圣经 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>总线仲裁算法</title>
      <link href="/2024/030241575.html"/>
      <url>/2024/030241575.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>主要参考博客如下<br><a href="https://blog.csdn.net/Ocean_Yv/article/details/126496121">https://blog.csdn.net/Ocean_Yv/article/details/126496121</a><br><a href="https://blog.csdn.net/weixin_43698385/article/details/126112076">https://blog.csdn.net/weixin_43698385/article/details/126112076</a></p></blockquote><h2 id="总线仲裁算法"><a href="#总线仲裁算法" class="headerlink" title="总线仲裁算法"></a>总线仲裁算法</h2><p>固定优先级算法的弊端：如果两个请求同时且一直有效，会导致无法响应优先级低的请求，一直处于饥饿状态。<br>改进措施：使用轮询优先级仲裁算法，完成此次请求后，改变当前仲裁优先级。</p><p>在AHB总线中，在多对多的拓扑结构中，仲裁器采用的是固定优先级算法，如果一个master一直占领总线但是迟迟得不到响应，会导致总线挂死，其他master也无法进行数据传输。<br>解决措施：将固定优先级算法改为轮询优先级算法，并且如果一个master长时间没有得到响应，就需要舍弃此次仲裁的结果，并改变优先级，让其他的master先传输。<br>AXI协议不会出现上述这种问题，因为AXI采用的交叉矩阵结构，不同master使用的不是同一个总线，master1到slave1占领的总线，不影响其他master向其他slave传输数据。</p><h3 id="固定优先级算法"><a href="#固定优先级算法" class="headerlink" title="固定优先级算法"></a>固定优先级算法</h3><p>采用固定的优先级，不同请求信号req完成仲裁后，下次请求信号到来时，仲裁机制按照一样的优先级顺序仲裁，纯组合逻辑就可以完成。可以用优先级或者补码特性来判断。</p><h4 id="if-elseif-case"><a href="#if-elseif-case" class="headerlink" title="if elseif &#x2F; case"></a>if elseif &#x2F; case</h4><p>通常使用有优先级的if elseif else或者带优先级的case完成固定优先级算法的仲裁。</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token comment">// first way : if elseif else</span><span class="token keyword">module</span> <span class="token function">arbiter_fixed</span><span class="token punctuation">(</span>    <span class="token keyword">input</span>      <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>   request<span class="token punctuation">,</span>    <span class="token keyword">output</span> <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>   grant<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// request[0] has high priority</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span>request<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        grant <span class="token operator">=</span> <span class="token number">4'b0001</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>request<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        grant <span class="token operator">=</span> <span class="token number">4'b0010</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>request<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        grant <span class="token operator">=</span> <span class="token number">4'b0100</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>request<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        grant <span class="token operator">=</span> <span class="token number">4'b1000</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>        grant <span class="token operator">=</span> <span class="token number">4'b0000</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token keyword">endmodule</span><span class="token comment">// second way : case</span><span class="token keyword">module</span> <span class="token function">arbiter_fixed</span><span class="token punctuation">(</span>    <span class="token keyword">input</span>      <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>   request<span class="token punctuation">,</span>    <span class="token keyword">output</span> <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>   grant<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// request[0] has high priority</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">case</span><span class="token punctuation">(</span><span class="token number">1'b1</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>        request<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> grant <span class="token operator">=</span> <span class="token number">4'b1000</span><span class="token punctuation">;</span>        request<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> grant <span class="token operator">=</span> <span class="token number">4'b0100</span><span class="token punctuation">;</span>        request<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> grant <span class="token operator">=</span> <span class="token number">4'b0010</span><span class="token punctuation">;</span>        request<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> grant <span class="token operator">=</span> <span class="token number">4'b0001</span><span class="token punctuation">;</span>         <span class="token keyword">default</span> <span class="token punctuation">:</span> grant <span class="token operator">=</span> <span class="token number">4'b0000</span><span class="token punctuation">;</span>    <span class="token keyword">end</span><span class="token keyword">end</span><span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>按照上面的case方式综合出来的语句和if else-if else得到的电路是一样的，都是由固定的优先级</p><h4 id="补码特性"><a href="#补码特性" class="headerlink" title="补码特性"></a>补码特性</h4><p>利用补码的特性，原码和补码相 “<strong>与</strong>”，得到一个独热码，该独热码为1的位置 是 原码从右到左第一个为1的位置；</p><p><strong>补码 &#x3D; 原码 取反 + 1；原码 &#x3D;（补码 - 1）+ 1；</strong></p><p>比如，req &#x3D; 4’b0110，（0110 - 0001）&#x3D; 0101； ~0101 &#x3D; 1010 ；   1010 &amp; 0110 &#x3D; <strong>0010</strong></p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token comment">// third way : con</span><span class="token keyword">module</span> <span class="token function">arbiter_fixed</span><span class="token punctuation">(</span>    <span class="token keyword">input</span>   <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>   request<span class="token punctuation">,</span>    <span class="token keyword">output</span>  <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>   grant<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">assign</span> grant <span class="token operator">=</span> request<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token operator">~</span><span class="token punctuation">(</span>request<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token operator">&#123;</span><span class="token number">3'b0</span><span class="token punctuation">,</span> <span class="token number">1'b1</span><span class="token operator">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="轮询优先级算法"><a href="#轮询优先级算法" class="headerlink" title="轮询优先级算法"></a>轮询优先级算法</h3><p>每次仲裁后，需要改变优先级，也就是说输出不仅与输入有关，还和当前的状态有关。所以只能是时序逻辑。轮询的方式有两种，比如优先级A&gt;B&gt;C&gt;D，如果仲裁授予masterC，优先级可以变为D&gt;A&gt;B&gt;C，也可以变为A&gt;B&gt;D&gt;C，第二种方式优先级变化没有规律，实现起来很复杂，通过采用第一种轮询的方式。</p><p>同样有两种方式可以实现该轮询方式，第一种基于状态机跳转实现，第二种基于优化后补码特性实现</p><h4 id="基于状态机跳转"><a href="#基于状态机跳转" class="headerlink" title="基于状态机跳转"></a>基于状态机跳转</h4><p>仲裁后的优先级排序方式共有4种，每次仲裁结果作为当前状态，根据输入信号req决定下次仲裁结果grant；</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token comment">// 伪代码</span>mastera<span class="token punctuation">:</span><span class="token function">case</span><span class="token punctuation">(</span>request_abc<span class="token punctuation">)</span> <span class="token keyword">begin</span><span class="token number">3'b000</span><span class="token punctuation">:</span>nxt_state <span class="token operator">&lt;=</span> mastera<span class="token punctuation">;</span><span class="token number">3'b001</span><span class="token punctuation">:</span>nxt_state <span class="token operator">&lt;=</span> masterc<span class="token punctuation">;</span><span class="token number">3'b010</span><span class="token punctuation">:</span>nxt_state <span class="token operator">&lt;=</span> masterb<span class="token punctuation">;</span><span class="token number">3'b011</span><span class="token punctuation">:</span>nxt_state <span class="token operator">&lt;=</span> masterb<span class="token punctuation">;</span><span class="token number">3'b100</span><span class="token punctuation">:</span>nxt_state <span class="token operator">&lt;=</span> mastera<span class="token punctuation">;</span><span class="token number">3'b101</span><span class="token punctuation">:</span>nxt_state <span class="token operator">&lt;=</span> masterc<span class="token punctuation">;</span><span class="token number">3'b110</span><span class="token punctuation">:</span>nxt_state <span class="token operator">&lt;=</span> masterb<span class="token punctuation">;</span><span class="token number">3'b111</span><span class="token punctuation">:</span>nxt_state <span class="token operator">&lt;=</span> masterb<span class="token punctuation">;</span><span class="token keyword">endcase</span><span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="基于优化后补码特性实现"><a href="#基于优化后补码特性实现" class="headerlink" title="基于优化后补码特性实现"></a>基于优化后补码特性实现</h4><p>参考上面的思路，补码与原码相 “与”，得到从右到左第一个不为0的位置的独热码；计算原码时，**-1 具有特殊的意义，表示从右第一个数开始，向左寻找，第一个不为0的数，将其转换成独热码。**如果减去的值为上次的grant值，相当于从该位置开始，向左寻找第一个不为0的数，将其转换成独热码。但是会存在一个问题，开始位置的后面是无法遍历到的。因此，采用将两个仲裁优先级拼接，从开始位置向左遍历，一定可以遍历完一个循环。如果请求master在开始位置的后面，仲裁结果位于高4bit中，所以再将结果的高4bit和低4bit进行合并，得到最终结果。</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">round_robin_arb</span><span class="token punctuation">(</span>    <span class="token keyword">input</span>   clk         <span class="token punctuation">,</span>    <span class="token keyword">input</span>   rst_n       <span class="token punctuation">,</span>        <span class="token keyword">input</span>  <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> request<span class="token punctuation">,</span>    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> grant<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 存储移位后上一次仲裁结果</span>    <span class="token keyword">reg</span>  <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> last_state<span class="token punctuation">;</span>    <span class="token important">always@</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> rst_n<span class="token punctuation">)</span> <span class="token keyword">begin</span>        <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rst_n<span class="token punctuation">)</span>            last_state <span class="token operator">&lt;=</span> <span class="token number">4'b0001</span><span class="token punctuation">;</span>     <span class="token comment">// 默认值，表示最低位的优先级最高</span>        <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">|</span>request<span class="token punctuation">)</span>            last_state <span class="token operator">&lt;=</span> <span class="token operator">&#123;</span>grant<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>grant<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>grant<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>grant<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">&#125;</span><span class="token punctuation">;</span> <span class="token comment">// 有仲裁请求，根据上一次的仲裁结果，左移1bit后用于控制新的优先级</span>        <span class="token keyword">else</span>            last_state <span class="token operator">&lt;=</span> last_state<span class="token punctuation">;</span>  <span class="token comment">// 无仲裁请求时，pre_state不更新</span>    <span class="token keyword">end</span>    <span class="token comment">// 如果最左侧几个高优先级主机都为发起仲裁请求，需要从最低位开始轮询。</span>    <span class="token comment">// 此处通过两个request拼接，将右侧低位拼接到左侧，即可实现对低位的判断。</span>    <span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> grant_ext<span class="token punctuation">;</span>    <span class="token keyword">assign</span> grant_ext <span class="token operator">=</span> <span class="token operator">&#123;</span>request<span class="token punctuation">,</span>request<span class="token operator">&#125;</span> <span class="token operator">&amp;</span> <span class="token operator">~</span><span class="token punctuation">(</span><span class="token operator">&#123;</span>request<span class="token punctuation">,</span>request<span class="token operator">&#125;</span> <span class="token operator">-</span> last_state<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 得到的grant_ext必定为一个独热码，但是置高位可能在代表低位的高4bit中，因此进行求或运算</span>    <span class="token keyword">assign</span> grant <span class="token operator">=</span> grant_ext<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">|</span> grant_ext<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 数字前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>低功耗方法学（一）</title>
      <link href="/2024/030235044.html"/>
      <url>/2024/030235044.html</url>
      
        <content type="html"><![CDATA[<h1 id="低功耗方法学-一"><a href="#低功耗方法学-一" class="headerlink" title="低功耗方法学(一)"></a>低功耗方法学(一)</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote><p>参考《Low_Power_Methodology_Manual_for_Soc_Design》，将认为重点的知识点进行记录和总结。</p></blockquote><h2 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1 介绍"></a>1 介绍</h2><h3 id="1-1-功耗和能量"><a href="#1-1-功耗和能量" class="headerlink" title="1.1 功耗和能量"></a>1.1 功耗和能量</h3><p>​功耗是瞬时能量，能量是一个总和；类似于速度和距离的关系；</p><img src="/2024/030235044/image-20240302005439890.png" style="zoom: 40%;"><h3 id="1-2-动态功耗"><a href="#1-2-动态功耗" class="headerlink" title="1.2 动态功耗"></a>1.2 动态功耗</h3><p>动态功耗有两种，电容充放电功耗和短路电流功耗；</p><img src="/2024/030235044/image-20240303101531073.png" alt="image-20240303101531073" style="zoom: 33%;"><p>第一项是电容充放电功耗，第二项是短路电流功耗，tsc为短路电流持续时间。随着工艺尺寸的降低，静态功耗的占比越来越大，甚至超过动态功耗。</p><p>降低电压会大大降低功耗，但是会导致载流子的速度降低，影响性能。一般SoC设计者，使用以下方式降低功耗。</p><ol><li>多电压技术。不同设备采用不同电压，外围低速设备使用低电压。</li><li>电压缩放技术，动态电压管理技术。一个模块支持多电压工作，在执行繁忙任务时，使用高电压，在执行低性能任务时，使用低电压。</li><li>时钟门控技术，降低信号翻转带来的功耗。</li></ol><h3 id="静态功耗"><a href="#静态功耗" class="headerlink" title="静态功耗"></a>静态功耗</h3><p>​静态功耗是在信号不翻转时的功耗，又称为漏电功耗。来源：栅极漏电、衬底电流和漏极反偏结漏电。</p><img src="/2024/030235044/image-20240303151547141.png" alt style="zoom:33%;"><h2 id="2-标准低功耗方法学"><a href="#2-标准低功耗方法学" class="headerlink" title="2 标准低功耗方法学"></a>2 标准低功耗方法学</h2><h3 id="2-1-时钟门控"><a href="#2-1-时钟门控" class="headerlink" title="2.1 时钟门控"></a>2.1 时钟门控</h3><p>动态功耗中，时钟缓冲器带来的功耗占比超过50%，甚至更多。降低这种功耗最常见的办法是在不需要时钟时，关闭时钟。</p><p>在现在的EDA工具中，带有同步使能的寄存器，通过会自动识别并转换成门控时钟电路，而不影响逻辑功能，如下图所示。</p><img src="/2024/030235044/image-20240303154850877.png" alt style="zoom: 40%;"><p>如果使用时钟门控的寄存器为多bit，比如32bit，使用时钟门控技术对于功耗的降低是非常明显的。因为使用一个门控时钟，输出连接32个寄存器，节省了32个重复的选择器逻辑。</p><h3 id="2-2-门级功耗优化"><a href="#2-2-门级功耗优化" class="headerlink" title="2.2 门级功耗优化"></a>2.2 门级功耗优化</h3><p>除了门控时钟优化，也可以通过优化门级逻辑，降低功耗。</p><img src="/2024/030235044/image-20240303162241287.png" alt style="zoom:50%;"><p>上图与门的输出就有较高的活动性，通过降低与门输出线上的负载电容，可以降低功耗。因此，将后级或非门拆分为或门和非门，减小与门输出的负载。</p><p>下图4输入的与门，不同的输入引脚有不同的输入功率。对于活动性高的信号可以接入输入功率低的引脚，活动性低的信号可以接入输入功率高的引脚，避免输入功率大和开关活动性高同时出现，进而降低功耗。</p><p>通过修改管子的尺寸，改变驱动能力，可以降低动态功耗。</p><p><strong>门级逻辑优化技术，由工具自动实现，对RTL设计人员是透明的。</strong></p><h3 id="2-3-多电压"><a href="#2-3-多电压" class="headerlink" title="2.3 多电压"></a>2.3 多电压</h3><p>功耗与电压成二次方关系，不同模块采用不同电压。但是需要复杂的电源网络供电，以及信号电平转换器等。</p><img src="/2024/030235044/image-20240303165214237.png" alt style="zoom:50%;"><h3 id="2-4-多阈值电压逻辑"><a href="#2-4-多阈值电压逻辑" class="headerlink" title="2.4 多阈值电压逻辑"></a>2.4 多阈值电压逻辑</h3><p>工艺库中通常提供不同阈值电压相同逻辑的单元，通常是在满足时序的基础上，使用高阈值电压的管子降低功耗。</p><img src="/2024/030235044/image-20240303165856495.png" alt style="zoom:50%;"><h2 id="3-多电压设计"><a href="#3-多电压设计" class="headerlink" title="3 多电压设计"></a>3 多电压设计</h2><p>使用多个独立电压对芯片进行供电，考虑复杂的供电策略：根据不同的负载提供不同的电压，根据模块不同的行为提供不同的电压，RAM在保持状态时提供低电压，在读写时提供高电压，甚至可以考虑 电源门控技术。多电压策略分类如下：</p><ol><li>静态电压调节SVS：不同模块采用不同的电压，一个模块分配一个电压；</li><li>多电压调节MVS：一个模块可以采用不同电压进行切换。</li><li>动态电压和频率调节DVFS：检测负载变化，对电压和频率进行调节。</li><li>自适应电压调节AVS：DVFS的扩展，构造环路，通过反馈自适应调节电压。</li></ol><h3 id="3-1-多电压设计中挑战"><a href="#3-1-多电压设计中挑战" class="headerlink" title="3.1 多电压设计中挑战"></a>3.1 多电压设计中挑战</h3><ol><li>电平转换器：不同电压域的数据信号传输需要level shifter缓冲器，实现从一个电压摆幅到另外一个摆幅。</li><li>静态时序分析：工艺库中的时序分析都是针对单一电压的单元，多个模块在不同电压下运行，工艺库无法提供准确的时序参数表征和分析。</li><li>布局布线：多电压的版图设计需要更复杂和更仔细的布局规划，电源网络会更复杂。</li><li>PCB板级：需要更多的稳压模块提供不同的电压。</li><li>上电和断电顺序：给电顺序可能会影响电路的功能。</li></ol><h3 id="3-2-电压调节的接口-电平移位器"><a href="#3-2-电压调节的接口-电平移位器" class="headerlink" title="3.2 电压调节的接口-电平移位器"></a>3.2 电压调节的接口-电平移位器</h3><p>现在芯片的电压一般都在1v左右，为什么还需要处理从0.9v到1.2v电压域的信号？</p><p>一个根本的原因在于：0.9v的电压驱动1.2v栅极，会导致NMOS和PMOS同时导通，产生动态短路功耗。</p><p>此外，标准单元库的特点是 最好输入是干净、快速、轨到轨的输入范围。否则，会导致信号在一个电压域的驱动单元和另一个电压域的接收单元之间呈现出明显的上升时间和下降时间降低问题，对时序分析带来不好的影响，甚至带来短路电流。</p><h4 id="3-2-1-高电平-低电平-电平转换器"><a href="#3-2-1-高电平-低电平-电平转换器" class="headerlink" title="3.2.1 高电平-低电平 电平转换器"></a>3.2.1 高电平-低电平 电平转换器</h4><p>实现起来比较容易，两个串联的反相器即可，只需要一个电源轨，来自较低或目标电源域的电源轨。并且，仅引入了缓冲器的延迟，对时序分析影响不大。</p><img src="/2024/030235044/image-20240304210034774.png" alt="image-20240304210034774" style="zoom: 33%;"><h4 id="3-2-2-低电平-高电平-电平移位器"><a href="#3-2-2-低电平-高电平-电平移位器" class="headerlink" title="3.2.2 低电平-高电平 电平移位器"></a>3.2.2 低电平-高电平 电平移位器</h4><p>欠驱动信号会降低接收输入端的上升和下降时间，导致更高的短路电流和降低噪声容限。</p><p>对于跨电压域的时钟信号尤为重要，上升和下降时间的任何退化都会导致时钟偏移skew变大。</p><p>一种简单直接的设计方式：采用缓冲和反向形式的低电压用来驱动交叉耦合的PMOS管，最后输出接一级缓冲。如下图所示，共用一个地。这种电平移位器带来的延迟较大。</p><img src="/2024/030235044/image-20240304215419001.png" alt="image-20240304215419001" style="zoom: 40%;"><h4 id="3-2-3-电平转换器的布局"><a href="#3-2-3-电平转换器的布局" class="headerlink" title="3.2.3 电平转换器的布局"></a>3.2.3 电平转换器的布局</h4><p>高电压域到低电压域的数据传输，通常将电平移位器放在低电压域，因为电平移位器只需要低电压轨道，将缓冲器放在高电压域。</p><img src="/2024/030235044/image-20240304222217976.png" alt="image-20240304222217976" style="zoom:40%;"><p>低电压域到高电压域的数据传输，由于输出驱动器需要比输入级更多的电流，所以将电平转换器放在高电压域中。</p><img src="/2024/030235044/image-20240304225632558.png" alt="image-20240304225632558" style="zoom:40%;"><h4 id="3-2-4-自动化插入"><a href="#3-2-4-自动化插入" class="headerlink" title="3.2.4 自动化插入"></a>3.2.4 自动化插入</h4><p>高电平-低电平 电平移位器的插入应该考虑时序问题；不使用电平移位器会导致延迟计算的误差，如果两个域的电压差很大，则该误差不可接受。</p><p>低电平-高电平 电平移位器的插入应该考虑功耗和时序问题。不使用电平移位器会导致高电压域的输入级不会一直关断，产生短路电流。并且影响了输入转换时间，导致延时计算误差。</p><h4 id="3-2-5-电平移位器的建议和缺陷"><a href="#3-2-5-电平移位器的建议和缺陷" class="headerlink" title="3.2.5 电平移位器的建议和缺陷"></a>3.2.5 电平移位器的建议和缺陷</h4><ul><li>建议</li></ul><ol><li>将高-低 电平移位器放在低电压域；低-高 电平移位器放在高电压域；</li><li>低-高 电平移位器 会带来显著的延迟效应，考虑这些延迟是否影响关键模块的时序。</li><li>确保不同电压域直接存在明确的关系。</li></ol><ul><li><p>缺陷</p><p>电平移位器的加入，导致时序分析困难</p></li></ul><h3 id="3-3-在多电压中的时序问题"><a href="#3-3-在多电压中的时序问题" class="headerlink" title="3.3 在多电压中的时序问题"></a>3.3 在多电压中的时序问题</h3><h4 id="3-3-1-静态时序分析"><a href="#3-3-1-静态时序分析" class="headerlink" title="3.3.1 静态时序分析"></a>3.3.1 静态时序分析</h4><p>在静态电压调节中，只需要一个工艺库，对不同电压的时序参数进行了表征，就可以针对不同电压域进行时序分析。目前，这个问题很容易得到解决。</p><img src="/2024/030235044/image-20240304235232681.png" alt="image-20240304235232681" style="zoom:40%;"><p>对于左面的模块，既有0.9v的电压，也有1v的电压，在时序约束时，应该按照哪个电压约束？</p><p>解决办法：为每个电压指定对应的时钟约束，一组用于0.9v，一组用于1.0v；因为这两个电压对应于不同的性能和时钟速度。当同时满足时序要求时，才算是真正的完成时序检查。</p><h3 id="3-4-多电压带来的系统问题"><a href="#3-4-多电压带来的系统问题" class="headerlink" title="3.4 多电压带来的系统问题"></a>3.4 多电压带来的系统问题</h3><p>不同电压的上电问题，在同一时间启动所有的不同电源是不切实际的，某些IP需要特定的上电顺序。</p><p>电源控制器通常由CPU控制，意味着电源控制软件必须与CPU上运行的系统软件集成。</p>]]></content>
      
      
      <categories>
          
          <category> 读书笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 低功耗圣经 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FMCW频率源系统建模</title>
      <link href="/2024/022817065.html"/>
      <url>/2024/022817065.html</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="e2e7e219c240c57c3b489125bd6a11b5bcc5a46e63fdb657f299b84bd5deef51">4630436162ade97ba2718b7d0c4b3b6351ade09e539dfebeb5402828e29e64b0474ba98726a3f48ffd712f7d028c0f8590bc7f86c7306404b3affc0f0001546dd88f03f4ef2e0711b996ee8d42bbcf79da327a1d501a906dc08f19870f01c80be620a7d2b84f91009ed0ba0f601b70a6829b934c0d2cbe664828ac9267a0907d782961a6129afb3496f582ed17d6735d99981128f3cb5b443074e00cc483026afddf1bba17e4596b20db3b825ff12322d8f1694b391dbcf90fa66dd5bd0be7f746870ff27e14d1aade0107678a3ae431154d1fbdfa28a3bdbf965461f3eb1b0b2f92060cb810c8ae6c604646bcc339af0d4b4d8015710cbe47634b2bede05e7bfdc9544129fe2aa5c50000fd4f876317cd33074477c2fa8711aec9dad80e7d1a5116bbb79bfbe32e3f4a7983f8d7f7e9bdc441583e22cd8b85a7e268bb423c29e207bfe92c2c851480f3ee8c250b730ac0450ab6d6258998584da12d69451ab1acb9b52d20868d634287117c9e9ae82eab37b7efbb06d8af5585c7cdd360170496354aac0edf9eccbd4cb08e48a7d76252052ec09ed5b66c4098a11efe2efb78f770b7d6a03c344e8606196ad60b423c85416b354f1b63a7a8bcd420b863fe2f4df3409233f672ea0c13310c963ee9714964e7b2d21afd437d612411fff304e24bd67e26ace6e9625a5f8fda3afb89163dca08f7d1b94973eceefa79711177d505ed4233e598fad8d5fc5d94a2f506b62dc20bcf34b4a35fddee8b029b26d29ce7eaef4a65ab31ae0b0018d9c38e79fd1b2e2d9306efae05fb53cca250b1766db0a690d2a96dd0b5fc5442da8b4111c022282bea19c33cbee4e73488bc230b04e5262ebd93bd504a9c9bc4a6b22da4cc60f029232cd00c3bc70785ec9b866340e94e39abbac166272ab4d68619de42404bd38559d9d3763dadf0d8fc4e864b413a62dc30f4ce2d284a7ee48738f39e93cd9b6ec500cea02c262f75a2ccc6f6447ef8a52bcf08da3fad7e326c037a222a044da8a57e19d7dc2b0ef79cb02fcf24a3876e4ac916af6bd808d07633fea45e70ca0ce9fff9537753e2dd8a4f01bada9d0bc1a32eaabf11d75d17403e80ba2a36b1200bbafb5fa04795484d3b0a2f73dfcc9d37721d5d1e35213375d74a627519e1be693c17096a8d0db9d036a5938762dd0e56c31b20b8c8eba3fac905d0e4d7c5bc2200e408c953b6fe716ae33086397844cf0e6367f1c997bf1e332bed52ca7d8769299ff6fd2127531c644453cc0335022c45d020719be232114a4b8b72de0dce169e0fb94d7dbf4748cbacc1f9c53d8a3a6763eb15d167291d5210916c8495e28e11a323e7f81b56f8d7cc4421495228956e96259ff6e6675ed8ec5a4c08d3a0c9d59f08b7a30491c1fe30f552c9c3406e5903a5601e6dd240f7838f5a117a178f9e144603e9aebde8b8527b3eafd5e886cefa1ce89ada4ffe47c9326321c5a2101890d826498d46b6679499bd24a2263f71470ab4c11df0a48c93b43dcbb6026934540ac0d0479480adc295d9450b07b66855975a005ff528e366afd98da062688dc6fbd2e724bef1822df0cbbe37be6f21cae3bcb0cbd8733aa27d58f8c6a14053db8e103a9021d766f1e57eed1a3b82fed8bc6133672b52a26e52061af29457fe6ddb036b68e89d09a94840a745875bf1533d4f518623090116d349a82069c591d98337e3b22cdd7beef3016fb1d9a1e1fe18d46df8ccf2445f52022691802d7d51146f0fb8141ff7cda54bc651e2ca3c3f22487969c453b0bccbc03b68d15d44ce5881d3343ecae7fa3aa3b4534bdc7978d2b42547648f0dcf7479e1e257d96de572fadaffd370835225a695aabd112834e8e6c7bab037575552d18a313467eac6701319a1f1b2bf529689eae5c3c2c9243025021fd6b2121ea5ce3b32ba9abe0bcb1e5bc4721b360f7a351b1c5148bdfd4245b662564e46965bcad9a7df0cd4245bf83bc24a659d030623a5e3d0bfa855c0bcb7c7c3475396d71cca59290b11d9be78ea046cdec4f79362af6b095911fee420aec3bcfa7a08cd4ca890a8d48908603fba3f3418717ef99460b8e8e9bc850c93da038ae19b92127e2f91ae3c5cbf22d31677894894b5bfcc2c9cdafaaa14711105eb64b70fd00db408d889a6e5b585930eced4d73f20541edd7620a7039d444928e1139628f741e0f33f655ea287209939865c48bac1bc1c52c213e454bd710df3cd75ca93a90d55f0a51f3bb6c85f6019600c5da64e3c6bdfea20f64384391ebda6a8f2b7d6dfe3286a3951f2ef2022b078fa38ec872e7754acfd4550185270a378bd6a16b1d0179d092de90e953277fa46e5311bb6c18e8c5dad0b2bc4063ac38c56aca006de62504f671c10977ba2ccc95eeca37dbe33e2aa5bcbbc047ec42c0662e90b4667fde7fd61947782d182577cf0edb7e8c0971d3f753ba0192cd5ddb2b812752ad26b2131ba4e2ff1e06a1068942ece55c194a7bf0b2364fd06200774d25fa98ae64d73922a4b8e549d2029b7eaf6f6e7857004b134f8fd00cfb420d3d19b09de437843084fa56d349f90c2b5b1d98bc483bad46fe311c790fb1e201900d5c5745084ba3b591bca3ff7cdda2e88d31c612d61ed28ebf14c64ecbc9d91434a7429f1c657933ffd37a9bb0f8ce562e05ebef69aa5dcdf369c745f28f2508fd080590dd0162046b8b27c3845ad36da27607115239fab27fc20731af4055e85020505baa396e42fae48cf347ea9c0fc254c197e501c18c7dec24c5ec7c1472ee7500fa741f48e9566d7dc8be00b8d138d7c1334861a5060d6632e44c8c4b854fbec6c5c2d369eccfdcf2b891b94dfe7048aac591e204df1edd299116678123ba018d5b658b4f29a54cae35a5cf7b8ae4a783f0300d1ad3845604dc3d5dae17a46821c7472ea7a9e15dcab26a4d2126e7003d4b33ae97a9166eabae25a768a8e7f80b31dcde6030233239dec724d03d5862f9f7a9b26b0bdab621bbd187fccc11571ec983352a30ff8d77e2671549eeca11a478bd48a44f8f245c331dd21229253bd35699a16cb9c582ed479376997292887583355c414527d3ff6d0555b3304d433d72469bb6e40b303627254773dd2437210e75fe434bee328c0d51d532f5ff79db54c4702bd9706ec30435be655301ceb71104b38a3f047b29f1ceb2f30efa2558b1c50fd1771fcf3979980baa8f752500a257a83d68bf911f80beb5d3489356327ef317f7ae9641a6de0cf8375a56d19520855c1b08bfcaf870e290871a93456888286b58fd9c818336feb2a7c3c3e178e5c6d5b286a452d7f3fc2d17ebf3ec03386cf71322f47b0ed3021b1d4454576beff7c2dc156e93bbb98aa8e0aa7589a7451c1460f4f2e85c68dcb7c0e468958899cb1580297c0e0a2cc9f8843e1151fea7b191a48b5dc509b8450d35c982855dd6bf41f91fef8e62518680611f7416317139c93a7b46905c86d9f6c8db6ce45d644392bbb4570a7c5b0b78eaac3c6e2902d4525491ff37495411922637bf1c402224db5169c49a1fbe0a9441d12f4df53b2ceb4a6b21e1881f845880a27a65e911a0ccd9b16883f6f923aaa74e152e50cb8e0ae639cdebd678526c5374e521fc005f0c48b10f4a115bb0e1ec86b893598cf172fd4529e3e3acab57563e0bafe5de1a3c4726ccf3f3c5a92ed3493d386ea197eb9e9f0f4586720f189e49b126894e92bf18f4af1be293da4c9b13602890d87d7d9d90f4e66e5ffdda002269a128dcda51487a940d45a946367863164b08e040e6c0be6a1fb5b3445b7f1da743976956984e8bdf58afbdad0d52fd6164c06afe09b1aa2556b57745b66edb2dd65bc61c21684ab6213d34d47a40ba204875cc22cd535229351dbbe4e9ddce33b159d94dd2b79fde50405692a00665877e35e15c123755c4acfcd9e4b5e9e6ba3345d87f3a95eca86f1fa0055256d1b509f1705a80a6ca65a36eec2002ad2668740bf409fd3e3f9b12488d5f04072d3bcbdb1d0e4f19f6b5ec29ba7332d1f96518d87b1e783e73f238bc03640054870e30fc82d7636d47722b57f154cd83e8a6d4393ff44b82ef2e8360f5342c07efbfe93914a4e6ec0fd0bfadb265273f0d7a8ec82baf97d2fbce3012b5156c76c6e6d3ee9c86f9088f36ee6cd9b463c115cb4b747afe187692575e7cdd4a3864c27fe6b7daeeb250d15aa3e79838968a12b302e2e6e678a7359d8d22828b4f73a95027ca787e9a6e6baba69e9b50cdd00a2584bd5c958d5cd7f24e6d411855f169d9f023e69c0b063b5e3c467caa99fe27e8366e70557ed996355a2549f15a00a54fd5ed064ed8ea5606eec86134dc267e5be96a6a276d1c1d0f80db1ea928dbcc6e23658c30d498b835f4d44cf047d9de6dd10a3570f9623a6f6a9d8d092c9111c030f755c383dea6378041982892f03a0ab9591b240328772e77dc3facb4ab91446e19d158ece05f5a73d4fcd86e711fd938ac1fd57a346d0860a38d933b02765de87fab88d5ab20697bd483278cfd83eaa18d9f20f4e262198ae6a5774c1781de08ff62916114d61ca6da75cc43e5fda58c339758816f56c0b3f9723717cec261ab3e8abf801f231a5001e0b13e112b7cfb46a6f0757975de4dd4536ad5efafc9d8968b5728d0c9144b7c73d291f9a0054ac60487aaa0cb24bc1a7e0cc7321081787fb4f210f6ba02763fc5b0568856714c114d90b50db6f051d3bf1a9b121f0cbd85a1184b0ba887fccaa2843e9f9d62d267e11107804dcfdc99ee170c1b4a4105f1f07c0e80e1c70806ac36b132f4d50869a2f32543d6f8c9d2f945bb5f6e7042f33d7f6db99a75b47bde5ad25b50bd54473165a0fbe782b286e9c872efb39dff81ab31fe7067c22124e2cef6a5a77601a3894c68881fb111de8a7c92917d7ceea042ad2f444bf9ae620cc61d5f912b1bbc4b12f2748732cb1af1a947bc7032ae05c8ae25773faa08838e8c7013c18d2cd421c12f21cdc5d8644ee453fc4dd1b53fe1ecf289d95f75878ffba50752432e8cff69321b5603806636a72e5353a98a620cfc649074d3ad21e1d9a8684abdca0040a6f582bb87a4a978b6e736ac0be5d103820d25ed88602bb32d2785e3aa2f619ace99dac4e0a658045d13f5a1bc9b7ca17c19ff434a6d04ee9f51eff686019052171a66fbb6f25f04146f0fcfa78a0c32c88d01a90aa16325b723c8a727ea23aacb5c9c12e4b81b67aabcf0cc40a127922dc2a6fe06dd5996206d77c70433baa2651d12ab929cadeed5aa35c85da21069f5f2d506f7a1eefe663dabfa916e83e4e3992eca6f87a1dd15fbc6e0085856b4b8186b02f27dfa166c632bdd6d0232d950a7a7d7b1e974eea35c2c9ca29505fe29eebf5d61507d4892013eea45b1914374cedaa9b95fc8d783393827cd074c0053398bb6ffefd749e1b13bba23f570197154e8277566495e751649366360baa604ded9291c7d15fd001a9fb9b4b3b98a90e1f41734d7a3463b318e58343c4e5d129d0c54cc70c5bdb82905c24282903fa34881e226939f9ed3f2c713e028d2d3977271d6ffb5a726c42526a2ed745101d5d746249fc28d23e201c7b402f91b92511fc03f9643345f4823c5a33f0542583e4c911e73357d790c22dd0aa97be9868975379163a739a23bc62e3bfdda6ae5fadc73ecb47e7747f55569742bdd9869f73f9ffb4893a21f26f11667c99f7140db732d249d700f86aa5cde5cefd7d6aeda49420c1d44d912574d5e7bce51e7bfadcc49b550d1af27057c38fde79373bf4595b110d1c17d7aff90f8b66b4ef30fb5dbccb6ce22e0f72c56e0d84af7c5d8adfb4cec956df19a63cdcbd661bdbc397f48589e1a8512f277a71d8cca0c5978cad7c19a666a9b7f26ad236156c10962c26dd77d45b4185993760a4454ee994edf1169765121f377a00ce24b0e71379742c861e6eb1fb72f4e752fbf6cc942e558ff707aaaf4275dec0d69828667dfb6c2ed39244be97b80cef49a7263c0c1b749b5439643c8d366e6e326855d5fe610b78c5d1a9eeaf4d6b78e2f4e87da332e2a60d0dabeb2232f49a3009c163b6466842eca30802a5be5d28cdb8b7cf6cd1cd64c9175d0e1e37c64d65727b1b57b3d9aed80b38a89546bf3cc78dcf74736448a2b90456e443eee2a2847284feca42ede150d21f829ed6761bf632b2cdf46c2a0e9ea850cf200eed94ea5280ab30f2d697c5cc83cd5d52dbca458a6d726db3c82af4808f8d1465d9123ccb971f60c2d04dd97954a502392285d93899a34203edc4f2c2dc7b81d10479ba1d3b0243c80abcf3a8ce352a94b655795b52071db855b48d9a41688b1d4b9f74dc1bedffa9abfb24fdb79397e99fc551c2e916d5361e2d6e04dbb2264fb3a09b107e97f0679bfc2ed48cfdfcbdedf7167037df793c7cb4ab98790052967b23b93965a7ca2f6d688c2e8d49a7862d794ecef87ffc2208afca1a48008e3b8fae01e6f79b5ba0458e706fd889ae75f1916299e5f109514c0f74307f46d9ddf1ba81f0bb62f0e57f81728698d3de2f8974547b43d2bf98b1718afa02cf993949df5038b05eb618f88520ffeb8c46aff8e891f5c644e9021c87c5de440da2f162a6505d5fbac4ef2d26b7cfccb83ff75907a335dae5278ff5e6f5e92874934535b7457ff0f22ca7e31cd7c042a6ff04c08b73c9f036848bae03398f5f69793c2452b9871648961770e27c7211752a9dd908dfa70ee997f4f65225628a0a5fc2219e647ce3727ce322204be9a29eb427c5f0b2df73337ad6c3c497a0c4e5550041eb468c12842c41033e397e4f93773e31e8c71c6a8c7b0af61b1c36c2dbfeba23ae480c1c551b97e9bfc03562648087600214df9dc8e0446a2e79643977320bd775ad73c85cb763195757ba89987ee2a5a802596326569bb0338679e4f305a9c63c4ca066f6c2a2e000b89eaa86f121cb81c34eecaff917275461aee8d2c8fddcc327e73b260b829e75a9cdf555045c5b82f1ad3477a625fde6a75fa07baeb4daf9225a94ae724e906693ce50b5701d503b44e88ae36c0472e091210bec60a670b5d27887f921d29a78ef93906111ea8e2a6dbbad610fef61f491c1fa753eb303a7efda106b4c8d63f5408feec5e6886c2aa593dfc3576ce42f4282b668745474fa3d5a43cb7b58f0cf83fc4aac11f6cd2c28f3d454603d889478a1bbff762aa1476727bbb0bf994f017f78108ff659d00f0ed9464406416477b5feff932741fe319e9091c9225e7d666f0367a02966b2fa0696d4ecf8ba45e30120e33f5b0d024035ceb6e7f5d8041488d4ac21f6751e29d82a0445c5f29691fbc5426d6f342726e315f9cf0c8de2ded0a1f52ff6010d6ead36f85d9e7caee6497998c56acb3029047ee9e7c77cb1fd380a7b2891a9b9304638784dbafbdfaac681799f630676adb0f2c2f5c592981eaecee305d3e638e08f487e98f574caa76f72d1568bdb727e2f34815360e638a6427917b26ee7e42da3d34afab1f30afcbdc59c1f055d6297009f21ff63b70bdafc394c3bf902993c88b79d870b53390e5573ad89239b81072aa1abf5cac8ffcd404446bf1b0e35d8c705fba7db1394ce23adea92c6f5122da6018ac26b6e6d8f2e67552e546ae2a31de8c91ae2a1563651c8abb7fbef21f6012a010c6b3d3e0884de1d48316a8b63b3d01a2d184003741740a9d5f475e1126f5b90227bcc546d2b9dcf4883ac83fe9d7f553b668308ccd51a46443034e3e7977d90735c5a466c9b6547502b22d6a177888cc074a7af39d071f65fa9aef3f9d07010dbbadb8c0dd635cc721c4974ba0be2e0f549bb090dfd839146975824e011bda912e699cac577a4d11b503da3ada107202b2b9afcdfa95c43270b977654985235474c3aa61f762747a6cf9a628251dd69a4a6351fe64dbe623068be4f2d715e14d8b621030686e29462f78c47916104e24b38a65a7bda1787843061d7e919c68028ddb1b96e6c70b6a691c923eba92cad7614691412bde2053baf20fec6fe2bb7df0c435a1874154a8678c86ced790b65783d8a4423f6dbd2cb9b41fe10a38b7497dc1b9664d2687cd2f5e699283e6e5b01cc52ec35a4d8e39be1d018167407c42bbf1a77718f9f41c446fd79a8891d584afb932ede318455ea30c43904f7b4e391e2bcb13fa572a8649524f29ff486ca0dfb855cf74d05789bedf4d6c10a36f93beb5bbeacfdf69fcef857c97b3ae96892baa665ddb945081325790c669f001cd3b0f83500573c2bc56f598fc7de7cd02a455ca607789a4c7cda3a957a7f7546de2bf8f83cf5cee334f23b80446ab5b226154be7981cf10e0fd0bb7749de42f6eb90940d4844773686a9bd1b5f149dbc4e0759d87de0487b4735914f616dba62d3deb1d0031bd7cb662b62286de16bbe5d26de3bdbc91816cefdd2bb0dbb3d04deb235f1be339ce5c3769c21013dc0a561032b929060997149222ab4f0ca7a089a495d4d7368893a46ddd9f5b615d7de01611c80d9c0a67d329066e553e9353116abb2b70190e0c3bfbd5bfc3e981990ae1d28e61e934966e13839925264e5801b8e8f6d61d7666906562f672386aeac1d4ba772f0efcee62d96afc359f78b59787c653e86044923afa050de6bf26711f24d37bfe3ea619f53a7cd09d9166a1131cada83be4d756be02f083c029e58f0abbaa8661e0aab580c22d044ee4ece2b40f02dddab2a95d400b07e736c78b7ec1b14ba16fefcdbe70c23676d09dcde1a48381bd80ae1c71f5181d04c5fc1c31bda65e7f424ae6b187cf3d0f26127c112f40322f9161a287fea642baa4d8364b02e594b6870df42325f8e08e8c59ffd19cc56a0421172b33594e92e430544f2ec8eb1ab836dac8cbc5ed2443cee942eb3e081820ae13a4dc609ec31ab77093b0b6c33a3fb4d54015d27e65e8d556d986ca0b6bbee6b9cea24fbfe952692b05e0515c28479f6ba62534e90685c98bd8f60ce6c494fc1264bb6aee3cd831328a70ebe1ea8182f10e64752021e3cf2b7d302c88d3a9dce11edfb156cbaff7f35cc218aefad4df27dc36c70682df1679ffcb4f3412061299440f9eeeba58b2822752764d1ace97c404db97fbfd8abea4de5ebe9d2312b338d3a0ce35c0f9ccd13e54d9caba25d62a4c63eb3f51d622975fdaa3c116f7662f4a903cd3047ecbb888bf61eabef3d0206ded56f0cd9cb9518ad5303d3a6ae2800b35af2a9ff7aca3cc2d12917156f376dbda12d142ce6cfcfce0355199ecdf293a5e005a02898517b55df0eefed854ed0887bac92c9f9586446291e9ce43061044217b5f9dd3c92c3acfd876f39b42f41945a8a4bdb567c5f30b3c2ed6ce70e633a9aea462e056ba312db4f4ed6886fb83fa47a996fa4871ff59ba3f9b99ad53f2e079d7693b504c94b2bbcba9231f702c6c5751e98b6d2f8f1faa86aa5a20b471f2c923b402129b12b8186da83cdb1d0cc076ec0d902c1e4a7401f402bfe83a210a871d62b807853e5737e5d9a3b78b5a115dee16f25c3131e2fcbcbafd2336c30e303bfebc9abaf6db1dd0cdd2c18</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> 课题组项目 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> FMCW </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FMCW</title>
      <link href="/2024/022837365.html"/>
      <url>/2024/022837365.html</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="bcc886015d867e685b6559a1a44adb96ac29f5a8c6a876082b4e78820267315c">10d79030e8222445804370796b90fca106f15dd47c03b7cc3ac7fb0590359f37ccd6ce25dabd9e485ae27a888d7ca1365faa8a02c4def6f2b680714dbfda3152f3e1c340acfd9ff0ccfb8758f48d76fc9b1d64545e4a4abbbe4e54f9a5bc525eb3873879f528981e5cf4dc75af378932210948467a541081f9fe77ad477811a3f1bd4da116b2ebc0184d867743e2d6547a787c27042c570fc5383eb78929b1d4a7d00c7253cf993abc4ea298ad840ae58ecdc6e9b11ff1038c0442badd946644538ca9882ae6ae86523929deb5acc2fbfe4b27919a28501eaa7ac9a9eb86e7a093e710c4a4aa0a2d29d2ecdf38ece2e29b1f62f1f0be16b6777521431f0a86398e38112c884626a2d54841b54856c0cdf0a0b17a33e0368c8c01c5c655e778bb6750ba0d1021a519867fcee72dd3ab0cd37a5f4f7698655764508f14e4753e290e4b98b6435e84a4e221b9c2bc55e078586965c73d478583e60e1005f0f932d0520ab4fc97597faf900e45dd35eb9dad57b36b93b200baadf06e32e06fff981451c60bab187a114a9b69e0d3d9bdae2260fb22b76a4f7e449ec5d66e3de863a73e35b9373995ea3ab27f9ad1106c83409fdaca90bf984aff8d1dbce64c1abfa669ce682a5c5eb865101716ebc98a5f54dabacb2898b8e85cb05a37227a186cd46d6dc08ec9577edcc8b94a3f4f2ce411ac9fb1e74fcc6d3ead1a50b8d0fef91147ef92ec7a658fe7ce2cab39a1eb9847cc43dd76bbe5984c51de5e445b53398573196217409add999afb0f10602845ffcd9854f4ef57108f05a140d4906dfb3e1d41b9a678421951dc93f4f7e0de5f24aff55f31e65f967b71c26f432bb60058b61cf88f3cb315e877c036031a2511ed04e6c4a39b075918abf76742d820024f35ee5a7a6e27f8c9adb853da1faa2e27da2a703a23ae76b617625341c8a3898c5d7249036804bc8cc94994e9cee71d7496153c43e4bb4f57dd461e3fae30bea5c2d3fc7f15240a358f313ff1aca8ef151df3dc3487b28987157972c89b8b8023449028b26881321891d94cb0e5a506ac2a0e37fd986f099ded74b920c78a4f98691b6ea1c5913f4f5b8def831b699a6188601e4b138cf02cbe1f2016e5746c47fa6c73c4ea8530122aa5865eea1886098d5c880f04eb234bfc6518e810dd90ea92e303b1f7d98d1793405089bce16f9e761ba09c5d07dc6504cef4ddb14aed99365faaa61ce1b3c716759740c8e61551cd9597b5aaed29baeba25bed32f1e8be6406aa9f3df69f1118a55f44b51aa9ad9eb0279f58fa4e6fd7962133b37ff133f220ab4210d640b4473ae678c4c376cd3c28a7be4c2ce1f4a6b4943fb75a539f951dd9d23aa3b054b2315bf0cb5a8696ca4c7670bee4e17d315732b57e67863ec6b3a017bc82465d1f2c7972c06a0c2d27c8f808262f01cf9d6f318aab3ec13ce48b7be2fc44643f6c43b2d452c23880d427224d4bfc61722b1e13a2c6cdeca20678dcc3e01e3fb8eeacca2e37c70fa5db0f6c309ccbddfc727b42e5bf51bcdecf6086ffbd86775f9c583ab53d127274d8f05ab56df31b6d1976a98d394280c4b4740e460a295e491c851379e08f984c66f7c76ea38cfa72e3d563707383c4427d1daea64268be9f880440b1e782b135b291cd4fb0ac3b89bd0feb61924fb92d550da3341269e8193072ce1f4f75e8fb0270e3ea698df492edcecf9290700fbb691dfe00af9ee1b04a2634990cfe1d3c1f5e8cf48e2f92ed379efbe8b91fd36227ddbbdac767530a4bbea9aebcce2f753eb6438331523d5a3ddb4b0ea650edecc65ffe6c1c7024c3ad729e98364b6d802b65a8555fa4a967b4d42a3dfe778e1317b353f4778e8d15bf93c0cd00c196030fe0a9af468592c8b34db2d3eb9594cc0f41961e70d61ac96488adef66d18fa51bbaf4b0a2140677d88a6b704fb9add9e6a53983741da4b940087adf3c6b12c89e5fc922ad4469c38c5b8759176f56467b9b65dbe0a4e5abb51f9a76146830e29eb13c80930db10b9653c5c1a64163b7f804e4c4206cd9e1b2b6d32618bd65fcf56eab37957ffe3c9de383541040af43c001adf9160ccc18b053b5d7fae8a5e2bc3f4ef7fa8ab6ac75a839d8c1b88c1599689168a0cf05462af9d81467395ac0635195508abc36889bd1306a69ba95898710ad9b0593d23ff643ebe4efdfc646cf8b42b33aabf42d59a1cb88a1150065571967ac858488c7461cfc41d77a328d71d7e32e342d52db78e9d65812d41447ac2c032fdf55c8339c4d8dc7d8e530ceb93fe1712cbaef00a8239c53ed91a2adbbbd7e97a00a26c7ff415a4e1c508f68f877296ac1ed7068112e134a2231c185</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> 课题组项目 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> FMCW </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>握手协议与反压</title>
      <link href="/2024/02265961.html"/>
      <url>/2024/02265961.html</url>
      
        <content type="html"><![CDATA[<h2 id="握手与反压"><a href="#握手与反压" class="headerlink" title="握手与反压"></a>握手与反压</h2><blockquote><p>部分内容参考以下博客<br><a href="https://blog.csdn.net/qq_57502075/article/details/127137378">https://blog.csdn.net/qq_57502075/article/details/127137378</a><br><a href="https://zhuanlan.zhihu.com/p/359330607">https://zhuanlan.zhihu.com/p/359330607</a><br><a href="https://www.bilibili.com/read/cv11100841/">https://www.bilibili.com/read/cv11100841/</a></p><p><a href="https://zhuanlan.zhihu.com/p/532012806">芯片设计-skid buffer(ready打断) - 知乎 (zhihu.com)</a></p><p><a href="https://zhuanlan.zhihu.com/p/503806430">芯片设计-握手与反压(valid&amp;ready) - 知乎 (zhihu.com)</a></p></blockquote><h3 id="握手协议"><a href="#握手协议" class="headerlink" title="握手协议"></a>握手协议</h3><p>主要有三种握手场景</p><ul><li>valid先拉高</li></ul><img src="/2024/02265961/v2-b6e5825d295cd1327c4406681de334e4_720w.webp" alt style="zoom: 50%;"><ul><li>ready先拉高</li></ul><img src="/2024/02265961/v2-df7b58f89b52d56d6b5eabce820acbd9_720w.webp" alt style="zoom:50%;"><ul><li>valid、ready同时拉高</li></ul><img src="/2024/02265961/v2-2ad04643ab5f2f7387675d5891a4a4b3_720w.webp" style="zoom:50%;"><p>需要注意：</p><ol><li>valid和ready信号是独立的，没有明确的依赖关系。（<strong>但是在AXI协议中，ready可以依赖valid拉高再拉高，反之，可能会产生死锁</strong>）</li><li>valid信号需要和有效数据对齐</li><li><strong>握手成功后，数据需要更新；如果没有新的数据更新，需要将valid拉低</strong></li><li>valid信号一旦拉高，只有在ready信号拉高时，才允许valid拉低。</li></ol><h3 id="握手接口信号"><a href="#握手接口信号" class="headerlink" title="握手接口信号"></a>握手接口信号</h3><img src="/2024/02265961/image-20240227094825901.png" alt style="zoom: 50%;"><p>说明：一般来说握手的具体描述在master和slave内部，但是可以独立出来作为单独的模块，握手在该模块中完成；</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token comment">// 中间一级寄存器</span><span class="token keyword">module</span> <span class="token function">handshake</span><span class="token punctuation">(</span>    <span class="token keyword">input</span>       clk<span class="token punctuation">,</span>    <span class="token keyword">input</span>       nrst<span class="token punctuation">,</span>    <span class="token keyword">input</span>       valid_i<span class="token punctuation">,</span>    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> data_i<span class="token punctuation">,</span>    <span class="token keyword">output</span>      ready_o<span class="token punctuation">,</span>    <span class="token keyword">output</span>      valid_o<span class="token punctuation">,</span>    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>data_o<span class="token punctuation">,</span>    <span class="token keyword">input</span>       ready_i <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> data_o_r<span class="token punctuation">;</span><span class="token keyword">reg</span> valid_o_r<span class="token punctuation">;</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>    valid_o_r <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>ready_o<span class="token punctuation">)</span>     valid_o_r <span class="token operator">&lt;=</span> valid_i<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token function">if</span><span class="token punctuation">(</span>valid_i <span class="token operator">&amp;</span> ready_o<span class="token punctuation">)</span>    data_o_r <span class="token operator">&lt;=</span> data_i<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token keyword">assign</span> ready_o <span class="token operator">=</span> <span class="token operator">!</span>valid_o_r <span class="token operator">||</span> ready_i<span class="token punctuation">;</span><span class="token keyword">assign</span> valid_o <span class="token operator">=</span> valid_o_r<span class="token punctuation">;</span><span class="token keyword">assign</span> data_o  <span class="token operator">=</span> data_o_r<span class="token punctuation">;</span><span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>具有两级缓冲的带握手功能的寄存器，可以用深度为2的FIFO代替。</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token comment">// two stage register</span><span class="token keyword">module</span> <span class="token function">handshake</span><span class="token punctuation">(</span>    <span class="token keyword">input</span>           clk<span class="token punctuation">,</span>    <span class="token keyword">input</span>           nrst<span class="token punctuation">,</span>    <span class="token keyword">input</span>           valid_i<span class="token punctuation">,</span>    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>    data_i<span class="token punctuation">,</span>    <span class="token keyword">output</span>          ready_o<span class="token punctuation">,</span>    <span class="token keyword">output</span>          valid_o<span class="token punctuation">,</span>    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>   data_o<span class="token punctuation">,</span>    <span class="token keyword">input</span>           ready_i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> slice_reg<span class="token punctuation">,</span> spill_reg<span class="token punctuation">;</span><span class="token keyword">reg</span> slice_full<span class="token punctuation">,</span> spill_full<span class="token punctuation">;</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>        slice_reg <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>spill_full <span class="token operator">&amp;</span> valid_i<span class="token punctuation">)</span>        slice_reg <span class="token operator">&lt;=</span> data_i<span class="token punctuation">;</span><span class="token keyword">end</span> <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>        slice_full <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>spill_full<span class="token punctuation">)</span>        slice_full <span class="token operator">&lt;=</span> valid_i<span class="token punctuation">;</span><span class="token keyword">end</span> <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>        spill_reg <span class="token operator">&lt;=</span> <span class="token number">'h0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>ready_i <span class="token operator">&amp;</span> slice_full<span class="token punctuation">)</span>        spill_reg <span class="token operator">&lt;=</span> slice_reg<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>        spill_full <span class="token operator">&lt;=</span> <span class="token number">'h0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>ready_i <span class="token operator">||</span> spill_full<span class="token punctuation">)</span>        spill_full <span class="token operator">&lt;=</span> <span class="token operator">!</span>ready_i <span class="token operator">&amp;</span> slice_full<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token keyword">assign</span> valid_o <span class="token operator">=</span> slice_full <span class="token operator">||</span> spill_full<span class="token punctuation">;</span><span class="token keyword">assign</span> data_o <span class="token operator">=</span> spill_full <span class="token operator">?</span> spill_reg <span class="token punctuation">:</span> slice_reg<span class="token punctuation">;</span><span class="token keyword">assign</span> ready_o <span class="token operator">=</span> <span class="token operator">!</span>spill_full<span class="token punctuation">;</span><span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="反压"><a href="#反压" class="headerlink" title="反压"></a>反压</h3><p>出现反压有两个场景，</p><ol><li>入口流量大于出口流量，即多对一。</li><li>在流水线中，后级还没有准备好，前级对后级进行数据冲刷，所以需要反压让前级数据保持不变；</li></ol><p><strong>在实际设计中遇到的情况：</strong>第一个对应的仲裁器，在icache和dcache同时读取SRAM数据时，需要以dcache优先，保证取数据优先，这时就要反压icache的访问内存行为，即拉低arready和rvalid；第二个对应在CPU五级流水线设计过程中，如果访存阶段通过axi协议读写内存数据时，需要将流水线停顿下来，发出反压信号stall，让前级流水线的寄存器保持不变（跨级反压）。</p><hr><p>不同场景的反压方法</p><ul><li><p>不带存储体的反压</p><p>反压信号需要对流水线的所有寄存器进行控制；</p></li></ul><p>eg. 下面加法问题，要求不使用存储器FIFO，完成握手设计；</p><p>思路：没有FIFO缓冲，相当于每级流水线的FIFO深度为1；逐级反压；</p><img src="/2024/02265961/image-20240227135234852.png" style="zoom: 67%;"><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> handshake_pb <span class="token punctuation">(</span>    <span class="token keyword">input</span>  <span class="token keyword">wire</span>         clk<span class="token punctuation">,</span>    <span class="token keyword">input</span>  <span class="token keyword">wire</span>         rst<span class="token punctuation">,</span>    <span class="token keyword">input</span>  <span class="token keyword">wire</span>         valid_i<span class="token punctuation">,</span>    <span class="token keyword">output</span> <span class="token keyword">wire</span>         ready_o<span class="token punctuation">,</span>    <span class="token keyword">input</span>  <span class="token keyword">wire</span>  <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span>    <span class="token keyword">input</span>  <span class="token keyword">wire</span>  <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> b<span class="token punctuation">,</span>    <span class="token keyword">input</span>  <span class="token keyword">wire</span>  <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> c<span class="token punctuation">,</span>    <span class="token keyword">input</span>  <span class="token keyword">wire</span>  <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> d<span class="token punctuation">,</span>    <span class="token keyword">input</span>  <span class="token keyword">wire</span>  <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> e<span class="token punctuation">,</span>    <span class="token keyword">input</span>  <span class="token keyword">wire</span>  <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> f<span class="token punctuation">,</span>    <span class="token keyword">output</span> <span class="token keyword">wire</span>  <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> dout<span class="token punctuation">,</span>    <span class="token keyword">input</span>  <span class="token keyword">wire</span>         ready_i<span class="token punctuation">,</span>    <span class="token keyword">output</span> <span class="token keyword">reg</span>          valid_o    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">assign</span> ready_o <span class="token operator">=</span> <span class="token operator">~</span>valid_r1 <span class="token operator">||</span> ready_r1<span class="token punctuation">;</span>    <span class="token comment">//pre_fetch结构</span>    <span class="token comment">//valid_r1为0 代表下一级无数据</span>    <span class="token comment">//ready_r1   代表下一级准备好了读</span>    <span class="token important">always_ff @</span> <span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>         <span class="token function">if</span><span class="token punctuation">(</span>rst<span class="token punctuation">)</span><span class="token keyword">begin</span>            valid_r1    <span class="token operator">&lt;=</span> <span class="token number">1'b0</span><span class="token punctuation">;</span>        <span class="token keyword">end</span>        <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>ready_o<span class="token punctuation">)</span><span class="token keyword">begin</span>            valid_r1    <span class="token operator">&lt;=</span> valid_i<span class="token punctuation">;</span>        <span class="token keyword">end</span>    <span class="token keyword">end</span>        <span class="token important">always_ff @</span> <span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>        <span class="token function">if</span><span class="token punctuation">(</span>ready_o <span class="token operator">&amp;</span> valid_i<span class="token punctuation">)</span><span class="token keyword">begin</span>            r1_ab       <span class="token operator">&lt;=</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>   <span class="token comment">//数据信号不复位</span>        <span class="token keyword">end</span>    <span class="token keyword">end</span>    <span class="token keyword">assign</span> ready_r1 <span class="token operator">=</span> <span class="token operator">~</span>valid_r2 <span class="token operator">||</span> ready_r2<span class="token punctuation">;</span>    <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">31</span> <span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">]</span> r2_abcd<span class="token punctuation">;</span>    <span class="token important">always_ff @</span> <span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>         <span class="token function">if</span><span class="token punctuation">(</span>rst<span class="token punctuation">)</span><span class="token keyword">begin</span>            valid_r2    <span class="token operator">&lt;=</span> <span class="token number">1'b0</span><span class="token punctuation">;</span>        <span class="token keyword">end</span>        <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>ready_r1<span class="token punctuation">)</span><span class="token keyword">begin</span>            valid_r2    <span class="token operator">&lt;=</span> valid_r1<span class="token punctuation">;</span>        <span class="token keyword">end</span>    <span class="token keyword">end</span>        <span class="token important">always_ff @</span> <span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>        <span class="token function">if</span><span class="token punctuation">(</span>ready_r1 <span class="token operator">&amp;</span> valid_r1<span class="token punctuation">)</span><span class="token keyword">begin</span>            r2_abcd     <span class="token operator">&lt;=</span> r1_ab <span class="token operator">+</span> r1_cd<span class="token punctuation">;</span>        <span class="token keyword">end</span>    <span class="token keyword">end</span>    <span class="token keyword">assign</span> ready_r2 <span class="token operator">=</span> <span class="token operator">~</span>valid_r3 <span class="token operator">||</span> ready_i<span class="token punctuation">;</span>        <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">31</span> <span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">]</span> r3<span class="token punctuation">;</span>    <span class="token important">always_ff @</span> <span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>         <span class="token function">if</span><span class="token punctuation">(</span>rst<span class="token punctuation">)</span><span class="token keyword">begin</span>            valid_r3    <span class="token operator">&lt;=</span> <span class="token number">1'b0</span><span class="token punctuation">;</span>        <span class="token keyword">end</span>        <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>ready_r2<span class="token punctuation">)</span><span class="token keyword">begin</span>            valid_r3    <span class="token operator">&lt;=</span> valid_r2<span class="token punctuation">;</span>        <span class="token keyword">end</span>    <span class="token keyword">end</span>        <span class="token important">always_ff @</span> <span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>        <span class="token function">if</span><span class="token punctuation">(</span>ready_r2 <span class="token operator">&amp;</span> valid_r2<span class="token punctuation">)</span><span class="token keyword">begin</span>            r3          <span class="token operator">&lt;=</span> r2_ef <span class="token operator">+</span> r2_abcd<span class="token punctuation">;</span>        <span class="token keyword">end</span>    <span class="token keyword">end</span>    <span class="token keyword">assign</span> dout     <span class="token operator">=</span> r3<span class="token punctuation">;</span>    <span class="token keyword">assign</span> valid_o  <span class="token operator">=</span> valid_r3<span class="token punctuation">;</span><span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>带存储体的反压</p><p>在握手模块中添加存储体，比如RAM和FIFO；将无法及时响应的数据缓冲到FIFO里，需要设置水线water line，也就是当waterline为多少时开始反压前一级模块。</p></li></ul><img src="/2024/02265961/image-20240227102838935.png" alt style="zoom:80%;"><p>​当FIFO数据个数达到阈值后，需要将ready_o拉低，告知上游模块，无法处理新的数据，完成反压。<strong>waterline计算：FIFO的深度 - 流水线的级数。</strong>上图水线为24</p><p>eg. 设计一个并行6输入32比特加法器，输出1个带截断的32比特加法结果，要求用三级流水设计，求带存储器FIFO，可以缓冲数据，带前后反压。</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">输入：<span class="token list punctuation">1.</span> 6个32bit数据 a，b，c，d，e，f<span class="token list punctuation">2.</span> 上一级的valid_i<span class="token list punctuation">3.</span> 下一级的ready_i输出：<span class="token list punctuation">1.</span> 1个32bit结果 dout<span class="token list punctuation">2.</span> 给上一级的ready_o<span class="token list punctuation">3.</span> 给下一级的valid_o<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> handshake_fifo #<span class="token punctuation">(</span>    <span class="token keyword">parameter</span>           FIFO_DATA_WIDTH <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">,</span>    <span class="token keyword">parameter</span>           FIFO_DEPTH <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">(</span>    <span class="token keyword">input</span>  <span class="token keyword">wire</span>         clk<span class="token punctuation">,</span>    <span class="token keyword">input</span>  <span class="token keyword">wire</span>         rst<span class="token punctuation">,</span>    <span class="token keyword">input</span>  <span class="token keyword">wire</span>         valid_i<span class="token punctuation">,</span>    <span class="token keyword">input</span>  <span class="token keyword">wire</span>         ready_i<span class="token punctuation">,</span>    <span class="token keyword">input</span>  <span class="token keyword">wire</span>  <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span>    <span class="token keyword">input</span>  <span class="token keyword">wire</span>  <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> b<span class="token punctuation">,</span>    <span class="token keyword">input</span>  <span class="token keyword">wire</span>  <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> c<span class="token punctuation">,</span>    <span class="token keyword">input</span>  <span class="token keyword">wire</span>  <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> d<span class="token punctuation">,</span>    <span class="token keyword">input</span>  <span class="token keyword">wire</span>  <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> e<span class="token punctuation">,</span>    <span class="token keyword">input</span>  <span class="token keyword">wire</span>  <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> f<span class="token punctuation">,</span>    <span class="token keyword">output</span> <span class="token keyword">logic</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> dout<span class="token punctuation">,</span>    <span class="token keyword">output</span> <span class="token keyword">logic</span>        ready_o<span class="token punctuation">,</span>    <span class="token keyword">output</span> <span class="token keyword">logic</span>        valid_o    <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">localparam</span>          WATERLINE <span class="token operator">=</span> FIFO_DEPTH <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">//three levels' pipeline</span>    <span class="token keyword">logic</span>               handshake<span class="token punctuation">;</span>    <span class="token keyword">logic</span>               handshake_ff1<span class="token punctuation">;</span>    <span class="token keyword">logic</span>               handshake_ff2<span class="token punctuation">;</span>    <span class="token keyword">logic</span>               wr_en<span class="token punctuation">;</span>            <span class="token keyword">assign</span> handshake <span class="token operator">=</span> ready_o <span class="token operator">&amp;</span> valid_i<span class="token punctuation">;</span>    <span class="token important">always @</span> <span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">posedge</span> rst<span class="token punctuation">)</span> <span class="token keyword">begin</span>        <span class="token function">if</span><span class="token punctuation">(</span>rst<span class="token punctuation">)</span> <span class="token keyword">begin</span>            handshake_ff1 <span class="token operator">&lt;=</span> '<span class="token number">0</span><span class="token punctuation">;</span>            handshake_ff2 <span class="token operator">&lt;=</span> '<span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">end</span>        <span class="token keyword">else</span> <span class="token keyword">begin</span>            handshake_ff1 <span class="token operator">&lt;=</span> handshake<span class="token punctuation">;</span>            handshake_ff2 <span class="token operator">&lt;=</span> handshake_ff1<span class="token punctuation">;</span>        <span class="token keyword">end</span>    <span class="token keyword">end</span>        <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">31</span> <span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">]</span> r1_ab<span class="token punctuation">;</span>    <span class="token important">always @</span> <span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">posedge</span> rst<span class="token punctuation">)</span> <span class="token keyword">begin</span>        <span class="token function">if</span><span class="token punctuation">(</span>rst<span class="token punctuation">)</span> <span class="token keyword">begin</span>            r1_ab <span class="token operator">&lt;=</span> '<span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">end</span>        <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>handshake<span class="token punctuation">)</span><span class="token keyword">begin</span>            r1_ab <span class="token operator">&lt;=</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>        <span class="token keyword">end</span>    <span class="token keyword">end</span>        <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">31</span> <span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">]</span> r1_cd<span class="token punctuation">;</span>    <span class="token important">always @</span> <span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">posedge</span> rst<span class="token punctuation">)</span> <span class="token keyword">begin</span>        <span class="token function">if</span><span class="token punctuation">(</span>rst<span class="token punctuation">)</span> <span class="token keyword">begin</span>            r1_cd <span class="token operator">&lt;=</span> '<span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">end</span>        <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>handshake<span class="token punctuation">)</span><span class="token keyword">begin</span>            r1_cd <span class="token operator">&lt;=</span> c <span class="token operator">+</span> d<span class="token punctuation">;</span>        <span class="token keyword">end</span>    <span class="token keyword">end</span>        <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">31</span> <span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">]</span> r1_ef<span class="token punctuation">;</span>    <span class="token important">always @</span> <span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">posedge</span> rst<span class="token punctuation">)</span> <span class="token keyword">begin</span>        <span class="token function">if</span><span class="token punctuation">(</span>rst<span class="token punctuation">)</span> <span class="token keyword">begin</span>            r1_ef <span class="token operator">&lt;=</span> '<span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">end</span>        <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>handshake<span class="token punctuation">)</span><span class="token keyword">begin</span>            r1_ef <span class="token operator">&lt;=</span> e <span class="token operator">+</span> f<span class="token punctuation">;</span>        <span class="token keyword">end</span>    <span class="token keyword">end</span>        <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">31</span> <span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">]</span> r2_abcd<span class="token punctuation">;</span>    <span class="token important">always @</span> <span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">posedge</span> rst<span class="token punctuation">)</span> <span class="token keyword">begin</span>        <span class="token function">if</span><span class="token punctuation">(</span>rst<span class="token punctuation">)</span> <span class="token keyword">begin</span>            r2_abcd <span class="token operator">&lt;=</span> '<span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">end</span>        <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>handshake_ff1<span class="token punctuation">)</span> <span class="token keyword">begin</span>            r2_abcd <span class="token operator">&lt;=</span> r1_ab <span class="token operator">+</span> r1_cd<span class="token punctuation">;</span>        <span class="token keyword">end</span>    <span class="token keyword">end</span>        <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">31</span> <span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">]</span> r2_ef<span class="token punctuation">;</span>    <span class="token important">always @</span> <span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">posedge</span> rst<span class="token punctuation">)</span> <span class="token keyword">begin</span>        <span class="token function">if</span><span class="token punctuation">(</span>rst<span class="token punctuation">)</span> <span class="token keyword">begin</span>            r2_ef <span class="token operator">&lt;=</span> '<span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">end</span>        <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>handshake_ff1<span class="token punctuation">)</span> <span class="token keyword">begin</span>            r2_ef <span class="token operator">&lt;=</span> r1_ef<span class="token punctuation">;</span>        <span class="token keyword">end</span>    <span class="token keyword">end</span>        <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">31</span> <span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">]</span> r3<span class="token punctuation">;</span>    <span class="token important">always @</span> <span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">posedge</span> rst<span class="token punctuation">)</span> <span class="token keyword">begin</span>        <span class="token function">if</span><span class="token punctuation">(</span>rst<span class="token punctuation">)</span> <span class="token keyword">begin</span>            r3 <span class="token operator">&lt;=</span> '<span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">end</span>        <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>handshake_ff2<span class="token punctuation">)</span> <span class="token keyword">begin</span>            r3 <span class="token operator">&lt;=</span> r2_ef <span class="token operator">+</span> r2_abcd<span class="token punctuation">;</span>        <span class="token keyword">end</span>    <span class="token keyword">end</span>        <span class="token important">always @</span> <span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">posedge</span> rst<span class="token punctuation">)</span> <span class="token keyword">begin</span>        <span class="token function">if</span><span class="token punctuation">(</span>rst<span class="token punctuation">)</span> <span class="token keyword">begin</span>            wr_en <span class="token operator">&lt;=</span> <span class="token number">1'b0</span><span class="token punctuation">;</span>        <span class="token keyword">end</span>        <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>handshake_ff2<span class="token punctuation">)</span> <span class="token keyword">begin</span>            wr_en <span class="token operator">&lt;=</span> <span class="token number">1'b1</span><span class="token punctuation">;</span>        <span class="token keyword">end</span>        <span class="token keyword">else</span> <span class="token keyword">begin</span>            wr_en <span class="token operator">&lt;=</span> <span class="token number">1'b0</span><span class="token punctuation">;</span>        <span class="token keyword">end</span>    <span class="token keyword">end</span>    <span class="token important">always_ff @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span><span class="token keyword">begin</span>        <span class="token function">if</span><span class="token punctuation">(</span>rst<span class="token punctuation">)</span><span class="token keyword">begin</span>            ready_o <span class="token operator">&lt;=</span> <span class="token number">1'b0</span><span class="token punctuation">;</span>        <span class="token keyword">end</span>        <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>usedw <span class="token operator">></span> WATERLINE<span class="token punctuation">)</span><span class="token keyword">begin</span>            ready_o <span class="token operator">&lt;=</span> <span class="token number">1'b0</span><span class="token punctuation">;</span>        <span class="token keyword">end</span>        <span class="token keyword">else</span> <span class="token keyword">begin</span>            ready_o <span class="token operator">&lt;=</span> <span class="token number">1'b1</span><span class="token punctuation">;</span>        <span class="token keyword">end</span>    <span class="token keyword">end</span>    <span class="token keyword">assign</span> valid_o <span class="token operator">=</span> <span class="token operator">~</span>empty<span class="token punctuation">;</span>     sync_fifo # <span class="token punctuation">(</span>        <span class="token punctuation">.</span>MEM_TYPE   <span class="token punctuation">(</span><span class="token string">"auto"</span>         <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">.</span>READ_MODE  <span class="token punctuation">(</span><span class="token string">"fwft"</span>         <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">.</span>WIDTH      <span class="token punctuation">(</span>FIFO_DATA_WIDTH<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">.</span>DEPTH      <span class="token punctuation">(</span>FIFO_DEPTH     <span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token function">fifo_inst</span><span class="token punctuation">(</span>        <span class="token punctuation">.</span>clk    <span class="token punctuation">(</span>clk                <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// input  wire</span>        <span class="token punctuation">.</span>rst_n  <span class="token punctuation">(</span>rst_n              <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// input  wire</span>        <span class="token punctuation">.</span>wren   <span class="token punctuation">(</span>wr_en              <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// input  wire</span>        <span class="token punctuation">.</span>din    <span class="token punctuation">(</span>r3                 <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// input  wire [WIDTH-1:0]</span>        <span class="token punctuation">.</span>rden   <span class="token punctuation">(</span>ready_i<span class="token operator">&amp;!</span>empty     <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// input  wire</span>        <span class="token punctuation">.</span>dout   <span class="token punctuation">(</span>dout               <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// output reg  [WIDTH-1:0]</span>        <span class="token punctuation">.</span>empty  <span class="token punctuation">(</span>empty              <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// output wire</span>        <span class="token punctuation">.</span>usedw  <span class="token punctuation">(</span>usedw              <span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>逐级反压与跨级反压</li></ul><p>​带多个存储体的反压分为两种：逐级反压和跨级反压；区别如下</p><img src="/2024/02265961/v2-b0b7c25408364e8805d98054f238b1e1_1440w.webp" alt style="zoom:50%;"><p>​逐级反压：module3达到水线反压module2；module2达到水线反压module1；module1达到水线反压上游接口；<strong>每级都有握手信号需要处理</strong></p><p>​跨级反压：module3的存储体深度 &#x3D; waterlie3 + 在途1 + waterline1 + 在途2 + waterline2 + 在途3；<strong>只需要处理上游模块和module3的握手信号</strong></p><h4 id="流水线反压总结"><a href="#流水线反压总结" class="headerlink" title="流水线反压总结"></a>流水线反压总结</h4><p><img src="/2024/02265961/v2-1c0c8c051a559d8d5b31ec8200dccfbd_1440w.webp" alt="img"></p><p>当data_o_ready拉低时，流水线如何处理。</p><ol><li>方案一<br>立即通知sender，拉低data_i_ready。由于流水线中还有数据在流动，需要保存流水线的输出。添加深度为3的FIFO。如下图所示</li></ol><p><img src="/2024/02265961/v2-546249278af92d7c8f71f0157bc2ca8a_1440w.webp" alt="img"></p><ol start="2"><li>方案二<br>跨级反压，将所有部件停顿下来。流水线中不会有数据流动，不需要添加fifo，但是这种对硬件的利用率较低，如下图所示。</li></ol><img src="/2024/02265961/v2-9a383d9371f7ed3be8a67cb408447996_1440w.webp" alt="img" style="zoom:67%;"><ol start="3"><li>方案三<br>为了挤出气泡，不能data_o_ready拉低，流水线就停顿。需要判断流水线中是否可以继续流动，添加计数器，如果大于3，即使data_o_ready拉低，也是可以流动的。通过入口data_i_ready&amp;data_i_valid握手，将计数值累加，出口dat_o_ready&amp;data_o_valid握手，将计数值累减。计数值大于3时，需要判断data_o_ready是否为1，决定流水线是否流动。如下图所示。</li></ol><img src="/2024/02265961/v2-976c9d96166e7f0c402af59ddf6dbe8c_1440w.webp" alt="img" style="zoom:67%;"><ol start="4"><li>方案四<br>逐级反压。流水线的每一级都需要握手，只要后级准备好或者当前级空闲，即可流动数据给当前级。如下图</li></ol><img src="/2024/02265961/v2-ee5103b023a19f0eb8738bc4fc6215da_1440w.webp" alt="img" style="zoom:67%;"><h4 id="skid-buffer（打断ready信号）"><a href="#skid-buffer（打断ready信号）" class="headerlink" title="skid buffer（打断ready信号）"></a>skid buffer（打断ready信号）</h4><p>在上面的第四个方案中，每一级的ready信号都依赖于receiver的data_o_ready信号。当流水线的级数较多时，ready信号需要较长的延迟。因此，需要对下级返回的ready信号打一拍。</p><p>但是一旦打一拍，反压能力就会延迟一拍。出现的问题如下图所示。</p><img src="/2024/02265961/v2-c80b0fb9691569a3bf28ecd9edc864cd_720w.webp" alt="img" style="zoom:67%;"><ol><li>data_i_ready是延迟一拍后的信号，在data_i为3时，不应该采样数据了，data_o的数据2应保持不变，导致数据2丢失。</li><li>在data_o_ready拉高时，输出数据3，data_o的数据并没有变化，在data_i_ready拉高时，data_o的数据还是3，导致重复输出数据3。</li></ol><h5 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h5><ol><li><p>添加buffer<br>这个buffer叫做skid buffer，在data_o_ready拉低时，如果下拍的data_i_valid仍然拉高，需要将data_o的数据保存在buffer中，并将data_i_ready拉低（表示buffer中有数据）</p><p>在data_o_ready拉高时，如果data_i_ready为0，则输出buffer的数据，data_o_valid为~data_i_ready；实现方式如下：</p></li></ol><img src="/2024/02265961/v2-63df5862e126a354239d88825c820fa4_720w.webp" alt="img" style="zoom:67%;"><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token comment">// ports</span><span class="token keyword">output</span> <span class="token keyword">reg</span>     data_i_ready<span class="token punctuation">;</span><span class="token keyword">input</span>          data_i_valid<span class="token punctuation">;</span><span class="token keyword">input</span> <span class="token punctuation">[</span>DW<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> data_i<span class="token punctuation">;</span><span class="token keyword">input</span>           data_o_ready<span class="token punctuation">;</span><span class="token keyword">output</span>          data_o_valid<span class="token punctuation">;</span><span class="token keyword">output</span> <span class="token punctuation">[</span>DW<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> data_o<span class="token punctuation">;</span><span class="token comment">// signals</span><span class="token keyword">reg</span>  <span class="token punctuation">[</span>DW<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> buf_data<span class="token punctuation">;</span><span class="token comment">// data_i_ready由组合逻辑改为时序逻辑</span><span class="token important">always @</span> <span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> rst_n<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rst_n<span class="token punctuation">)</span>        data_i_ready <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//有个buf放在那，因此复位后至少可以收一个数据。</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>data_o_valid<span class="token punctuation">)</span>        data_i_ready <span class="token operator">&lt;=</span> data_o_ready<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span> <span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> rst_n<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rst_n<span class="token punctuation">)</span> <span class="token comment">//可能有些控制信号通过本模块的data端口进行传输，因此有必要进行复位。</span>        buf_data <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>data_i_ready<span class="token operator">&amp;</span>data_i_valid<span class="token punctuation">)</span>        buf_data <span class="token operator">&lt;=</span> data_i<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token comment">// out，如果buf中有数据，优先读走buf中的数据</span><span class="token keyword">assign</span> data_o_valid <span class="token operator">=</span> data_i_valid <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token operator">!</span>data_i_ready<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">assign</span> data_o       <span class="token operator">=</span> data_i_ready <span class="token operator">?</span> data_i <span class="token punctuation">:</span> buf_data <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li><p>添加fifo</p><p>暴力解决，实现简单。要求fifo深度至少为2.</p></li></ol><p><img src="/2024/02265961/v2-395baf053020b99d04c92ec07c9873e6_720w.webp" alt="img"></p><h3 id="CDC中握手案例"><a href="#CDC中握手案例" class="headerlink" title="CDC中握手案例"></a>CDC中握手案例</h3><p>通过req和ack握手，来传输数据，保证采样的数据是稳定的。本质是传输1bit的使能信号。</p><p>tx：数据有效时发出req信号和数据信号，这俩信号需要保证是一致的，即req为1时，数据稳定。输入信号为ack信号，来自接收方，需要打两拍才能使用，ack_r2&amp;req时，拉低req信号。</p><p>rx：输入信号req为异步，需要在当前时钟域打两拍，如果req_r2 &amp;&amp; !ack为1，将数据保存下来。然后拉高ack信号给发送方，用于拉低req信号。</p><p>具体参考代码如下</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token comment">// tx</span><span class="token keyword">module</span> cdc_tx <span class="token punctuation">(</span>    <span class="token keyword">input</span>           clk1<span class="token punctuation">,</span>    <span class="token keyword">input</span>           rstn1<span class="token punctuation">,</span>    <span class="token keyword">input</span>           valid<span class="token punctuation">,</span>    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>     data_in<span class="token punctuation">,</span>    <span class="token keyword">input</span>           ack<span class="token punctuation">,</span>    <span class="token keyword">output</span>          ready<span class="token punctuation">,</span>    <span class="token keyword">output</span> <span class="token keyword">reg</span>      req<span class="token punctuation">,</span>    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>    data_o<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">reg</span>    ack_r<span class="token punctuation">,</span> ack_rr<span class="token punctuation">;</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk1 <span class="token keyword">or</span> <span class="token keyword">negedge</span> rstn1<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rstn1<span class="token punctuation">)</span> <span class="token keyword">begin</span>        ack_r  <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>        ack_rr <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">end</span>    <span class="token keyword">else</span> <span class="token keyword">begin</span>        ack_r  <span class="token operator">&lt;=</span> ack<span class="token punctuation">;</span>        ack_rr <span class="token operator">&lt;=</span> ack_r<span class="token punctuation">;</span>    <span class="token keyword">end</span><span class="token keyword">end</span><span class="token keyword">assign</span> ready <span class="token operator">=</span> req <span class="token operator">==</span> ack_rr<span class="token punctuation">;</span><span class="token keyword">assign</span> data_o <span class="token operator">=</span> valid <span class="token operator">?</span> data_in <span class="token punctuation">:</span> <span class="token number">'h0</span><span class="token punctuation">;</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk1 <span class="token keyword">or</span> <span class="token keyword">negedge</span> rstn1<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rstn1<span class="token punctuation">)</span>        req <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>ack_rr<span class="token punctuation">)</span>        req <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>valid <span class="token operator">&amp;</span> ready<span class="token punctuation">)</span>        req <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token keyword">endmodule</span> <span class="token comment">//</span><span class="token comment">// rx</span><span class="token keyword">module</span> cdc_rx <span class="token punctuation">(</span>    <span class="token keyword">input</span>               clk2<span class="token punctuation">,</span>    <span class="token keyword">input</span>               rstn2<span class="token punctuation">,</span>    <span class="token keyword">input</span>               req<span class="token punctuation">,</span>     <span class="token keyword">input</span>   <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>       data_i<span class="token punctuation">,</span>    <span class="token keyword">output</span>  <span class="token keyword">reg</span>         ack<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> data_reg<span class="token punctuation">;</span><span class="token keyword">reg</span> req_r<span class="token punctuation">,</span> req_rr<span class="token punctuation">;</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk2 <span class="token keyword">or</span> <span class="token keyword">negedge</span> rstn2<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rstn2<span class="token punctuation">)</span> <span class="token keyword">begin</span>        req_r  <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>        req_rr <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token keyword">begin</span>        req_r  <span class="token operator">&lt;=</span> req<span class="token punctuation">;</span>        req_rr <span class="token operator">&lt;=</span> req_r<span class="token punctuation">;</span>    <span class="token keyword">end</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk2 <span class="token keyword">or</span> <span class="token keyword">negedge</span> rstn2<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rstn2<span class="token punctuation">)</span>         ack <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>req_rr<span class="token punctuation">)</span>        ack <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>        ack <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk2 <span class="token keyword">or</span> <span class="token keyword">negedge</span> rstn2<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rstn2<span class="token punctuation">)</span>         data_reg <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>req_rr <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>ack<span class="token punctuation">)</span>        data_reg <span class="token operator">&lt;=</span> data_i<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token keyword">endmodule</span> <span class="token comment">//</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="向后延迟打拍"><a href="#向后延迟打拍" class="headerlink" title="向后延迟打拍"></a>向后延迟打拍</h3><p>相当于切断valid信号的组合逻辑路径，在valid路径上插入寄存器，导致数据和valid信号都延迟一拍。</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">module forward_delay(  input           clk,  input           nrst,  input           data_i_valid,  input [8-1:0]   data_i,  output          data_i_ready,    input           data_o_ready,  output          data_o_valid,  output [8-1:0]  data_o);reg [7:0] data_reg;reg       valid_reg;always @(posedge clk or negedge nrst) begin  if(!nrst)    valid_reg &lt;&#x3D; 0;  else if(data_i_ready) &#x2F;&#x2F;如果寄存器准备好更新数据了，那么寄存器数据的有效性就可以被更新。    valid_reg &lt;&#x3D; data_i_valid;endalways @(posedge clk) begin  if(data_i_valid &amp; data_i_ready)    data_reg &lt;&#x3D; data_i;endassign data_i_ready &#x3D; !valid_reg | data_o_ready; &#x2F;&#x2F; 当寄存器为空时（！valid_reg）或者下游的ready信号拉高，表明这个寄存器保存的数据可以被更新。assign data_o &#x3D; data_reg;assign data_i_valid &#x3D; valid_reg;endmodule<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="向前延迟打拍"><a href="#向前延迟打拍" class="headerlink" title="向前延迟打拍"></a>向前延迟打拍</h3><p>切断ready信号的组合逻辑，在ready路径上插入寄存器，并不会造成一个周期数据延迟。</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">module back_delay(  input           clk,  input           nrst,  input           data_i_valid,  input [8-1:0]   data_i,  output          data_i_ready,    input           data_o_ready,  output          data_o_valid,  output [8-1:0]  data_o);reg [7:0] data_reg;reg       ready_reg;always @(posedge clk or negedge nrst) begin  if(!nrst)    ready_reg &lt;&#x3D; 1;  else if(data_o_valid) &#x2F;&#x2F; 如果输出数据有效，将下游的ready信号读入，决定将数据写入寄存器中    ready_reg &lt;&#x3D; data_o_ready;endalways @(posedge clk) begin  if(data_i_valid &amp; data_i_ready)    data_reg &lt;&#x3D; data_i;endassign data_o_valid &#x3D; data_i_valid | (!ready_reg); &#x2F;&#x2F; 如果寄存器是满的 或者 输入数据有效，表示输出数据就有效。assign data_o &#x3D; ready_reg ? data_i : data_reg; &#x2F;&#x2F; 如果寄存器是空的，输出直接接输入，否则取寄存器的数据。（隐含的条件是data_o_ready信号拉低了一拍）assign data_i_ready &#x3D; ready_reg;endmodule<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 数字前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 握手协议 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一生一芯-异常处理设计</title>
      <link href="/2024/022651980.html"/>
      <url>/2024/022651980.html</url>
      
        <content type="html"><![CDATA[<h2 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h2><h3 id="ecall自陷指令"><a href="#ecall自陷指令" class="headerlink" title="ecall自陷指令"></a>ecall自陷指令</h3><p>发生异常ecall时，处理器需要完成的操作：</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog">PC <span class="token operator">=></span> csr<span class="token punctuation">[</span>mepc<span class="token punctuation">]</span>causeid <span class="token operator">=></span> mcausecsr<span class="token punctuation">[</span>mtvec<span class="token punctuation">]</span> <span class="token operator">=></span> PC<span class="token comment">// 在WB阶段，硬件自动完成</span><span class="token comment">// 将当前PC写入mepc</span><span class="token comment">// 跳转到mtvec继续执行指令</span><span class="token comment">// 将id号保存在mcause</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="mret指令"><a href="#mret指令" class="headerlink" title="mret指令"></a>mret指令</h3><p>将mepc给PC，跳转到发生异常处，改变程序执行顺序。在WB阶段执行；</p><p><strong>在WB阶段执行mret和ecall指令时，都更改了pc的值，需要对流水线前四级的寄存器进行冲刷reflush</strong></p><p><img src="/2024/022651980/image-20240227164253113.png"></p><h3 id="csr相关指令"><a href="#csr相关指令" class="headerlink" title="csr相关指令"></a>csr相关指令</h3><p><strong>csrrw，csrrwi，csrrs，csrrsi，csrrc，csrrci；</strong></p><img src="/2024/022651980/image-20240227152225346.png" alt style="zoom:50%;"><img src="/2024/022651980/image-20240227152627604.png" alt style="zoom:50%;"><img src="/2024/022651980/image-20240227152651142.png" alt style="zoom:50%;"><img src="/2024/022651980/image-20240227152745330.png" alt style="zoom:50%;"><ul><li><p><strong>csrrw rd csr, rs1</strong>，<strong>csrrwi rd, csr, uimm[4:0]</strong><br>ID译码阶段，读取寄存器堆CSR[csr]，regfiles[rs1];<br>WB写回阶段，将读取的结果保存在寄存器堆中，CSR[csr] &#x3D;&gt; X[rd]，X[rs1] &#x3D;&gt; CSR[csr];<br><strong>如果rd&#x3D;0，不会向regfiles写入数据</strong></p></li><li><p><strong>csrrs rd, csr, rs1   csrrsi rd, csr, zimm[4:0]</strong><br>ID译码阶段，读取寄存器堆CSR[csr]，regfiles[rs1];<br>​EXE执行阶段， X[rs1] &#x2F; zimm | CSR[csr] &#x3D;&gt; exe_o;<br>​WB写回阶段，CSR[csr] &#x3D;&gt; X[rd]，exe_o  &#x3D;&gt; CSR[csr];</p></li><li><p><strong>csrrc rd, csr, rs1   csrrci rd, csr, zimm[4:0]</strong><br>  ID译码阶段，读取寄存器堆CSR[csr]，regfiles[rs1];<br>  EXE执行阶段， ~(X[rs1] &#x2F; zimm) &amp; CSR[csr] &#x3D;&gt; exe_o;<br>  WB写回阶段，CSR[csr] &#x3D;&gt; X[rd]，exe_o  &#x3D;&gt; CSR[csr];</p></li></ul><h3 id="数据通路和控制信号设计"><a href="#数据通路和控制信号设计" class="headerlink" title="数据通路和控制信号设计"></a>数据通路和控制信号设计</h3><p>​根据上文描述，设计数据通路。ID阶段csr1_o和csr2_o的选择如下所示</p><img src="/2024/022651980/image-20240227163318097.png" alt style="zoom: 50%;"><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>csr1_sel <span class="token operator">=</span> <span class="token number">2'b00</span><span class="token punctuation">;</span><span class="token function">if</span><span class="token punctuation">(</span>i_type <span class="token operator">&amp;</span> <span class="token punctuation">(</span>opcode <span class="token operator">==</span> <span class="token number">7'b1110011</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">begin</span><span class="token function">case</span><span class="token punctuation">(</span>fun3<span class="token punctuation">)</span><span class="token number">3'b010</span><span class="token punctuation">:</span>csr1_sel <span class="token operator">=</span> <span class="token number">2'b00</span><span class="token punctuation">;</span> <span class="token comment">// csrrs</span><span class="token number">3'b110</span><span class="token punctuation">:</span> csr1_sel <span class="token operator">=</span> <span class="token number">2'b01</span><span class="token punctuation">;</span> <span class="token comment">// csrrsi</span><span class="token number">3'b011</span><span class="token punctuation">:</span> csr1_sel <span class="token operator">=</span> <span class="token number">2'b11</span><span class="token punctuation">;</span> <span class="token comment">// csrrc</span><span class="token number">3'b111</span><span class="token punctuation">:</span> csr1_sel <span class="token operator">=</span> <span class="token number">2'b10</span><span class="token punctuation">;</span> <span class="token comment">// csrrci</span><span class="token number">3'b001</span><span class="token punctuation">:</span> csr1_sel <span class="token operator">=</span> <span class="token number">2'b00</span><span class="token punctuation">;</span> <span class="token comment">// csrrw</span><span class="token number">3'b101</span><span class="token punctuation">:</span> csr1_sel <span class="token operator">=</span> <span class="token number">2'b00</span><span class="token punctuation">;</span> <span class="token comment">// csrrwi</span><span class="token keyword">default</span> <span class="token punctuation">:</span> csr1_sel <span class="token operator">=</span> <span class="token number">2'b00</span><span class="token punctuation">;</span><span class="token keyword">endcase</span><span class="token keyword">end</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>csr2_sel <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token function">if</span><span class="token punctuation">(</span>i_type <span class="token operator">&amp;</span> <span class="token punctuation">(</span>opcode <span class="token operator">==</span> <span class="token number">7'b1110011</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">begin</span><span class="token function">case</span><span class="token punctuation">(</span>fun3<span class="token punctuation">)</span><span class="token number">3'b010</span><span class="token punctuation">:</span>csr2_sel <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// csrrs</span><span class="token number">3'b110</span><span class="token punctuation">:</span> csr2_sel <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// csrrsi</span><span class="token number">3'b011</span><span class="token punctuation">:</span> csr2_sel <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// csrrc</span><span class="token number">3'b111</span><span class="token punctuation">:</span> csr2_sel <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// csrrci</span><span class="token number">3'b001</span><span class="token punctuation">:</span> csr2_sel <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// csrrw</span><span class="token number">3'b101</span><span class="token punctuation">:</span> csr2_sel <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// csrrwi</span><span class="token keyword">default</span> <span class="token punctuation">:</span> csr2_sel <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">endcase</span><span class="token keyword">end</span><span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 数字前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 一生一芯 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>手撕代码</title>
      <link href="/2024/022637133.html"/>
      <url>/2024/022637133.html</url>
      
        <content type="html"><![CDATA[<h2 id="毛刺过滤电路"><a href="#毛刺过滤电路" class="headerlink" title="毛刺过滤电路"></a>毛刺过滤电路</h2><h3 id="同时过滤正毛刺和负毛刺"><a href="#同时过滤正毛刺和负毛刺" class="headerlink" title="同时过滤正毛刺和负毛刺"></a>同时过滤正毛刺和负毛刺</h3><p>用verilog设计一个功能模块，将不足两个时钟周期长度的毛刺过滤掉，时序图如下所示：</p><p>输入信号：clk，rst_n，Din</p><p>输出信号：Dout</p><p><img src="/2024/022637133/v2-92bfd62c33dd99594745ac2becfc5206_720w.webp" alt="img"></p><p>思路：如果两个周期输入信号保持不变，则输出。否则，保持不变；</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">filter</span><span class="token punctuation">(</span>    <span class="token keyword">input</span>       clk<span class="token punctuation">,</span>    <span class="token keyword">input</span>       nrst<span class="token punctuation">,</span>    <span class="token keyword">input</span>       din<span class="token punctuation">,</span>    <span class="token keyword">output</span> <span class="token keyword">reg</span>  dout <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">reg</span> din_r<span class="token punctuation">;</span> <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>        din_r  <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token keyword">begin</span>        din_r  <span class="token operator">&lt;=</span> din<span class="token punctuation">;</span>    <span class="token keyword">end</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>         dout <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>din <span class="token operator">==</span> din_r<span class="token punctuation">)</span>        dout <span class="token operator">&lt;=</span> din<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="仅过滤单向毛刺"><a href="#仅过滤单向毛刺" class="headerlink" title="仅过滤单向毛刺"></a>仅过滤单向毛刺</h3><ul><li><p>过滤负毛刺</p><p>过滤一个周期的负毛刺，当负电平持续两个周期，才可以输出低电平；</p><p>采用两拍的寄存器，两级输出做 “<strong>或</strong>”操作；</p></li><li><p>过滤正毛刺</p><p>过滤一个周期的正毛刺，当正电平持续两个周期，才可以输出正电平；</p><p>采用两拍的寄存器，两级输出做 “<strong>与</strong>”操作；</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">filter_pos</span><span class="token punctuation">(</span>    <span class="token keyword">input</span>       clk<span class="token punctuation">,</span>    <span class="token keyword">input</span>       nrst<span class="token punctuation">,</span>    <span class="token keyword">input</span>       din<span class="token punctuation">,</span>    <span class="token keyword">output</span>      dout<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>        din_r <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>        din_r <span class="token operator">&lt;=</span> din<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token keyword">assign</span> dout <span class="token operator">=</span> din <span class="token operator">&amp;</span> din_r<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><hr><h2 id="消抖动电路"><a href="#消抖动电路" class="headerlink" title="消抖动电路"></a>消抖动电路</h2><p>题目：用verilog实现按键抖动消除电路，抖动小于15ms，输入时钟12MHz。</p><p>思路：添加计数器，如果15ms数据没有变化，将输入放在输出。</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> de_jitter <span class="token punctuation">(</span>    <span class="token keyword">input</span>       clk<span class="token punctuation">,</span>    <span class="token keyword">input</span>       nrst<span class="token punctuation">,</span>    <span class="token keyword">input</span>       din<span class="token punctuation">,</span>        <span class="token keyword">output</span>      dout<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">localparam</span> jitter_factor <span class="token operator">=</span> <span class="token number">180000</span><span class="token punctuation">;</span><span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> cnt<span class="token punctuation">;</span><span class="token keyword">reg</span> din_r<span class="token punctuation">;</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>        din_r <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>         din_r <span class="token operator">&lt;=</span> din<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>         cnt <span class="token operator">&lt;=</span> <span class="token number">'h0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>flag<span class="token punctuation">)</span>        cnt <span class="token operator">&lt;=</span> <span class="token number">'h0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>         cnt <span class="token operator">&lt;=</span> cnt <span class="token operator">+</span> <span class="token number">'h1</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>         flag <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>din_r <span class="token operator">==</span> din<span class="token punctuation">)</span>        flag <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>         flag <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>         dout <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>cnt <span class="token operator">==</span> jitter_factor <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>        dout <span class="token operator">&lt;=</span> din<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="串并、并串转换"><a href="#串并、并串转换" class="headerlink" title="串并、并串转换"></a>串并、并串转换</h2><h3 id="串转并"><a href="#串转并" class="headerlink" title="串转并"></a>串转并</h3><p>​    用一个计数器count，每输入8个数，就输出一次，每周期dout_temp左移一位，然后再将输入的1bit串行据存入dout_temp的最低位。</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">Serial_Parallel</span><span class="token punctuation">(</span>    <span class="token keyword">input</span>            clk<span class="token punctuation">,</span>    <span class="token keyword">input</span>            nrst<span class="token punctuation">,</span>    <span class="token keyword">input</span>            data_in<span class="token punctuation">,</span>    <span class="token keyword">input</span>            data_valid<span class="token punctuation">,</span>    <span class="token keyword">output</span> <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> data_out<span class="token punctuation">,</span>    <span class="token keyword">output</span>           data_out_valid<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> cnt<span class="token punctuation">;</span> <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> data_reg<span class="token punctuation">;</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>        cnt <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>data_valid<span class="token punctuation">)</span> <span class="token keyword">begin</span>        <span class="token function">if</span><span class="token punctuation">(</span>cnt <span class="token operator">==</span> <span class="token number">7</span><span class="token punctuation">)</span>            cnt <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">else</span>            cnt <span class="token operator">&lt;=</span> cnt <span class="token operator">+</span> <span class="token number">'h1</span><span class="token punctuation">;</span>    <span class="token keyword">end</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>        data_reg <span class="token operator">&lt;=</span> <span class="token number">'h0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>data_valid<span class="token punctuation">)</span>        data_reg <span class="token operator">&lt;=</span> <span class="token operator">&#123;</span>data_reg<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> data_in<span class="token operator">&#125;</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span>cnt <span class="token operator">==</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>        data_valid <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>        data_out <span class="token operator">&lt;=</span> data_reg<span class="token punctuation">;</span>    <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token keyword">begin</span>        data_valid <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>        data_out <span class="token operator">&lt;=</span> data_reg<span class="token punctuation">;</span>    <span class="token keyword">end</span><span class="token keyword">end</span><span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="并转串"><a href="#并转串" class="headerlink" title="并转串"></a>并转串</h3><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">Parallel_Serial</span><span class="token punctuation">(</span>    <span class="token keyword">input</span>           clk<span class="token punctuation">,</span>    <span class="token keyword">input</span>           nrst<span class="token punctuation">,</span>    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>     data_in<span class="token punctuation">,</span>    <span class="token keyword">input</span>           data_in_valid<span class="token punctuation">,</span>    <span class="token keyword">output</span>          data_out_valid<span class="token punctuation">,</span>     <span class="token keyword">output</span>          data_out<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> cnt<span class="token punctuation">;</span><span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> data_in_reg<span class="token punctuation">;</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>         data_in_reg <span class="token operator">&lt;=</span> <span class="token number">'h0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>data_in_valid<span class="token punctuation">)</span>         data_in_reg <span class="token operator">&lt;=</span> data_in<span class="token punctuation">;</span>    <span class="token keyword">else</span>         data_in_reg <span class="token operator">&lt;=</span> data_in_reg <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>        cnt <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>data_in_valid<span class="token punctuation">)</span>        cnt <span class="token operator">&lt;=</span> <span class="token number">8</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>cnt <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">)</span>        cnt <span class="token operator">&lt;=</span> cnt <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token keyword">assign</span> data_out_valid <span class="token operator">=</span> <span class="token punctuation">(</span>cnt <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">assign</span> data_out <span class="token operator">=</span> data_in_reg<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="数据位宽转换"><a href="#数据位宽转换" class="headerlink" title="数据位宽转换"></a>数据位宽转换</h2><h3 id="宽到窄传输"><a href="#宽到窄传输" class="headerlink" title="宽到窄传输"></a>宽到窄传输</h3><p>假设数据从模块A传入到模块B，模块A的<strong>输出数据为32位</strong>，模块B的<strong>输入数据位宽为16位</strong>，那么如何能把数据从A传入B<strong>而不损失数据</strong>呢。</p><p>思路：<strong>通过时钟分频和倍频</strong></p><p>宽数据是慢时钟，窄数据是快时钟；</p><p>Input：快时钟+宽数据</p><p>Output：窄数据（快时钟输出）</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">Wide_Narror</span><span class="token punctuation">(</span>    <span class="token keyword">input</span>           clk_2x<span class="token punctuation">,</span>    <span class="token keyword">input</span>           nrst<span class="token punctuation">,</span>    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>    data_in<span class="token punctuation">,</span>        <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>   data_out<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">reg</span> clk_1x<span class="token punctuation">;</span><span class="token keyword">reg</span> flag<span class="token punctuation">;</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk_2x <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>        clk_1x <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>         clk_1x <span class="token operator">&lt;=</span> <span class="token operator">~</span>clk_1x<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk_1x <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>        data_in_reg <span class="token operator">&lt;=</span> <span class="token number">'h0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>         data_in_reg <span class="token operator">&lt;=</span> data_in<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token keyword">assign</span> data_out <span class="token operator">=</span> clk_1x <span class="token operator">?</span> data_in_reg<span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">:</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> data_in_reg<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="窄到宽传输"><a href="#窄到宽传输" class="headerlink" title="窄到宽传输"></a>窄到宽传输</h3><p>宽数据是慢时钟，窄数据是快时钟；</p><p>Input：快时钟 + 窄数据</p><p>Output：宽数据（慢时钟输出）</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">Narror_Wide</span><span class="token punctuation">(</span>    <span class="token keyword">input</span>           clk_2x<span class="token punctuation">,</span>    <span class="token keyword">input</span>           nrst<span class="token punctuation">,</span>    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>    data_in<span class="token punctuation">,</span>        <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>   data_out<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">reg</span> clk_1x<span class="token punctuation">;</span><span class="token keyword">reg</span> flag<span class="token punctuation">;</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk_2x <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>        clk_1x <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>         clk_1x <span class="token operator">&lt;=</span> <span class="token operator">~</span>clk_1x<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk_1x <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>        data_in_reg <span class="token operator">&lt;=</span> <span class="token number">'h0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>         data_in_reg <span class="token operator">&lt;=</span> <span class="token operator">&#123;</span>data_in_reg<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> data_in<span class="token operator">&#125;</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token keyword">assign</span> data_out <span class="token operator">=</span> clk_1x <span class="token operator">?</span> data_in_reg <span class="token punctuation">:</span> <span class="token number">'h0</span><span class="token punctuation">;</span><span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="握手解决流水线断流、反压问题"><a href="#握手解决流水线断流、反压问题" class="headerlink" title="握手解决流水线断流、反压问题"></a>握手解决流水线断流、反压问题</h2><p>通过三级流水线实现以下组合逻辑的计算；包含握手和反压的处理。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">y <span class="token operator">=</span> <span class="token punctuation">(</span>c1<span class="token operator">+</span>c2<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>c3<span class="token operator">+</span>c4<span class="token punctuation">)</span> <span class="token operator">+</span> a2<span class="token operator">*</span>b2 <span class="token operator">+</span> a3<span class="token operator">*</span>b3 <span class="token operator">+</span> a4<span class="token operator">*</span>b4<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>思路：第一级流水完成 (c1+c2)，(c3+c4)的计算<br>        第二级流水完成乘法运算<br>        第三级流水加法运算</p><p>每一级的上下游都要有握手和反压信号的处理；</p><p><img src="/2024/022637133/image-20240228153148536.png" alt="image-20240228153148536"></p><ul><li><p><strong>ready信号的处理</strong></p><p><strong>以ready_r1为例，当r1寄存器为空（valid_r1&#x3D;&#x3D;0）或者ready_2为1时，r1都有能力接收数据；</strong><br>如果ready_r2为1，valid_r1也为1，则将该结果保存在r2寄存器中；下一个周期r1可以接收新数据；<br>如果ready_r2为0，valid_r1为1，下级无法握手成功传输，所以r1无法接收新数据；</p></li><li><p><strong>valid信号的处理</strong></p><p><strong>对于r1来说，valid_r1可以作为握手的结果信号；当valid_i和ready_r1握手成功后，r1输出valid_r1为1和有效的data_a。</strong></p></li></ul><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">handshake_pipline</span><span class="token punctuation">(</span>    <span class="token keyword">input</span>       clk<span class="token punctuation">,</span>    <span class="token keyword">input</span>       nrst<span class="token punctuation">,</span>    <span class="token keyword">input</span>       valid_i<span class="token punctuation">,</span>           <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> c1<span class="token punctuation">,</span>    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> c2<span class="token punctuation">,</span>    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> c3<span class="token punctuation">,</span>    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> c4<span class="token punctuation">,</span>    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> a2<span class="token punctuation">,</span>    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> b2<span class="token punctuation">,</span>    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> a3<span class="token punctuation">,</span>    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> b3<span class="token punctuation">,</span>    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> a4<span class="token punctuation">,</span>    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> b4    <span class="token keyword">output</span> <span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> result<span class="token punctuation">,</span>    <span class="token keyword">output</span>      valid_o<span class="token punctuation">,</span>    <span class="token keyword">input</span>       ready_i<span class="token punctuation">,</span>    <span class="token keyword">output</span>      ready_o<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> a1_r<span class="token punctuation">,</span> b1_r<span class="token punctuation">;</span><span class="token keyword">wire</span> ready_r1<span class="token punctuation">,</span> ready_r2<span class="token punctuation">,</span> ready_r3<span class="token punctuation">;</span><span class="token comment">// first stage</span><span class="token keyword">assign</span> ready_r1 <span class="token operator">=</span> ready_r2 <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token operator">!</span>valid_r1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>        valid_r1 <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>ready_r1<span class="token punctuation">)</span>        valid_r1 <span class="token operator">&lt;=</span> valid_i<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span>valid_i <span class="token operator">&amp;</span> ready_r1<span class="token punctuation">)</span> <span class="token keyword">begin</span>        a1_r <span class="token operator">&lt;=</span> c1 <span class="token operator">+</span> c2<span class="token punctuation">;</span>        b1_r <span class="token operator">&lt;=</span> c3 <span class="token operator">+</span> c4<span class="token punctuation">;</span>    <span class="token keyword">end</span><span class="token keyword">end</span><span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> a2_r<span class="token punctuation">,</span> b2_r<span class="token punctuation">,</span> a3_r<span class="token punctuation">,</span> b3_r<span class="token punctuation">,</span> a4_r<span class="token punctuation">,</span> b4_r<span class="token punctuation">;</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span>valid_i <span class="token operator">&amp;</span> ready_r1<span class="token punctuation">)</span> <span class="token keyword">begin</span>        a2_r <span class="token operator">&lt;=</span> a2<span class="token punctuation">;</span>        b2_r <span class="token operator">&lt;=</span> b2<span class="token punctuation">;</span>        a3_r <span class="token operator">&lt;=</span> a3<span class="token punctuation">;</span>        b3_r <span class="token operator">&lt;=</span> b3<span class="token punctuation">;</span>        a4_r <span class="token operator">&lt;=</span> a4<span class="token punctuation">;</span>        b4_r <span class="token operator">&lt;=</span> b4<span class="token punctuation">;</span>    <span class="token keyword">end</span><span class="token keyword">end</span><span class="token comment">// second stage</span><span class="token keyword">assign</span> ready_r2 <span class="token operator">=</span> ready_r3 <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token operator">!</span>valid_r2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>        valid_r2 <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>ready_r2<span class="token punctuation">)</span>        valid_r2 <span class="token operator">&lt;=</span> valid_r1<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> mul_1<span class="token punctuation">,</span> mul_2<span class="token punctuation">,</span> mul_3<span class="token punctuation">,</span> mul_4<span class="token punctuation">;</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span>valid_r1 <span class="token operator">&amp;</span> ready_r2<span class="token punctuation">)</span> <span class="token keyword">begin</span>         mul_1 <span class="token operator">&lt;=</span> a1_r <span class="token operator">*</span> b1_r<span class="token punctuation">;</span>        mul_2 <span class="token operator">&lt;=</span> a2_r <span class="token operator">*</span> b2_r<span class="token punctuation">;</span>        mul_3 <span class="token operator">&lt;=</span> a3_r <span class="token operator">*</span> b3_r<span class="token punctuation">;</span>         mul_4 <span class="token operator">&lt;=</span> a4_r <span class="token operator">*</span> b4_r<span class="token punctuation">;</span>    <span class="token keyword">end</span><span class="token keyword">end</span><span class="token comment">// third stage</span><span class="token keyword">assign</span> ready_r3 <span class="token operator">=</span> ready_i <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token operator">!</span>valid_r3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>        valid_r3 <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>ready_r3<span class="token punctuation">)</span>        valid_r3 <span class="token operator">&lt;=</span> valid_r2<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span>valid_r2 <span class="token operator">&amp;</span> ready_r3<span class="token punctuation">)</span> <span class="token keyword">begin</span>        result <span class="token operator">&lt;=</span> mul_1 <span class="token operator">+</span> mul_2 <span class="token operator">+</span> mul_3 <span class="token operator">+</span>mul_4<span class="token punctuation">;</span>    <span class="token keyword">end</span><span class="token keyword">end</span><span class="token keyword">assign</span> valid_o <span class="token operator">=</span> valid_r3<span class="token punctuation">;</span><span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="快速计算one-hot码中“1”所对应的下标"><a href="#快速计算one-hot码中“1”所对应的下标" class="headerlink" title="快速计算one-hot码中“1”所对应的下标"></a>快速计算one-hot码中“1”所对应的下标</h2><p>题目：找一个多bit信号最高位的1或最低位的1所对应的下标</p><p>思路：根据独热码和对应坐标的真值表，写出逻辑表达式；</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">One_Hot_position</span><span class="token punctuation">(</span>    <span class="token keyword">input</span>       clk<span class="token punctuation">,</span>    <span class="token keyword">input</span>       nrst<span class="token punctuation">,</span>    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> data_in<span class="token punctuation">,</span>    <span class="token keyword">output</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> position<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">assign</span> position<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> data_in<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">|</span> data_in<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">|</span> data_in<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">|</span> data_in<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">assign</span> position<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> data_in<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">|</span> data_in<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">|</span> data_in<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">|</span> data_in<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">assign</span> position<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> data_in<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">|</span> data_in<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">|</span> data_in<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">|</span> data_in<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//    one_hotindex</span><span class="token comment">// 8'b0000_00013'b000</span><span class="token comment">// 8'b0000_00103'b001</span><span class="token comment">// 8'b0000_01003'b010</span><span class="token comment">// 8'b0000_10003'b011</span><span class="token comment">// 8'b0001_00003'b100</span><span class="token comment">// 8'b0010_00003'b101</span><span class="token comment">// 8'b0100_00003'b110</span><span class="token comment">// 8'b1000_00003'b111</span><span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="找到序列第一个1和最后一个1"><a href="#找到序列第一个1和最后一个1" class="headerlink" title="找到序列第一个1和最后一个1"></a>找到序列第一个1和最后一个1</h2><p>思路：找出多bit数据中第一个1和最后一个1的位置，将其转换成独热码，根据独热码得到位置；</p><p>通过”按位”操作</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token comment">// MAX</span>pre<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>pre<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> pre<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">|</span> data_in<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>pre<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> pre<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">|</span> data_in<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">~</span>pre <span class="token operator">&amp;</span> data_in <span class="token operator">=></span> One_Hot<span class="token comment">// MIN</span><span class="token comment">// 利用补码的特性，原码和补码”与“操作后，得到独热码，1的位置为原码最低位为1的位置</span>data_in <span class="token operator">&amp;</span> <span class="token operator">~</span><span class="token punctuation">(</span>data_in <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=></span> One_Hot<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">Find_Max_1</span><span class="token punctuation">(</span>    <span class="token keyword">input</span>       clk<span class="token punctuation">,</span>    <span class="token keyword">input</span>       nrst<span class="token punctuation">,</span>    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> data_in<span class="token punctuation">,</span>    <span class="token keyword">output</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> data_out<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> pre<span class="token punctuation">;</span><span class="token keyword">assign</span> pre<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">assign</span> pre<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> pre<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">|</span> data_in<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">assign</span> data_out <span class="token operator">=</span> <span class="token operator">~</span>pre <span class="token operator">&amp;</span> data_in<span class="token punctuation">;</span><span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">Find_Min_1</span><span class="token punctuation">(</span>    <span class="token keyword">input</span>       clk<span class="token punctuation">,</span>    <span class="token keyword">input</span>       nrst<span class="token punctuation">,</span>    <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> data_in<span class="token punctuation">,</span>    <span class="token keyword">output</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> data_out<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">assign</span> data_out <span class="token operator">=</span> data_in <span class="token operator">&amp;</span> <span class="token operator">~</span><span class="token punctuation">(</span>data_in <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="跨时钟域传输"><a href="#跨时钟域传输" class="headerlink" title="跨时钟域传输"></a>跨时钟域传输</h2><p>已知data a为a时钟域0-15范围内的顺序数，现需要将它的值传递至b时钟域(设b的时钟频率高于a)，请便用verilog设计合适的跨时钟域处理逻辑、模块端口定义如下:</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">data_sync</span><span class="token punctuation">(</span>  <span class="token keyword">input</span>         nrst<span class="token punctuation">,</span>  <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>   data_a<span class="token punctuation">,</span>  <span class="token keyword">input</span>         aclk<span class="token punctuation">,</span>  <span class="token keyword">output</span>        bclk<span class="token punctuation">,</span>  <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>  data_b<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>由于计数值是连续变化的，采用格雷码实现。</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">data_sync</span><span class="token punctuation">(</span>  <span class="token keyword">input</span>         nrst<span class="token punctuation">,</span>  <span class="token keyword">input</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>   data_a<span class="token punctuation">,</span>  <span class="token keyword">input</span>         aclk<span class="token punctuation">,</span>  <span class="token keyword">output</span>        bclk<span class="token punctuation">,</span>  <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>  data_b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> data_a_gray<span class="token punctuation">;</span> <span class="token keyword">reg</span>  <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> data_a_gray_r<span class="token punctuation">;</span> <span class="token keyword">assign</span> data_a_gray <span class="token operator">=</span> data_a <span class="token operator">^</span> <span class="token punctuation">(</span>data_a <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> aclk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>    data_a_gray_r <span class="token operator">&lt;=</span> <span class="token number">'h0</span><span class="token punctuation">;</span>  <span class="token keyword">else</span>    data_a_gray_r <span class="token operator">&lt;=</span> data_a_gray<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> bclk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    data_b_gray <span class="token operator">&lt;=</span> <span class="token number">'h0</span><span class="token punctuation">;</span>    data_b_gray_r <span class="token operator">&lt;=</span> <span class="token number">'h0</span><span class="token punctuation">;</span>  <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token keyword">begin</span>    data_b_gray <span class="token operator">&lt;=</span> data_a_gray<span class="token punctuation">;</span>    data_b_gray_r <span class="token operator">&lt;=</span> data_b_gray<span class="token punctuation">;</span>  <span class="token keyword">end</span><span class="token keyword">end</span><span class="token keyword">assign</span> data_b<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> data_b_gray_r<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">assign</span> data_b<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> data_b_gray_r<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">^</span> data_b<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">assign</span> data_b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> data_b_gray_r<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">^</span> data_b<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">assign</span> data_b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> data_b_gray_r<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">^</span> data_b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="模3-模7检测器"><a href="#模3-模7检测器" class="headerlink" title="模3 模7检测器"></a>模3 模7检测器</h1><p>使用verilog代码，设计电路，判断输入序列能否被三整除，能的时候输出1，不能的时候输出0</p><p>思路：本质是一个序列检测器，通过现态和输入决定输出和下一个状态。余数只有三种可能，00,01,10。输入从右面进，之前的状态需要向左移1比特。状态机如下。</p><table><thead><tr><th align="center">当前态余数</th><th align="center">输入</th><th align="center">次态余数</th><th align="center">输出</th></tr></thead><tbody><tr><td align="center">0</td><td align="center">1</td><td align="center">1</td><td align="center">0</td></tr><tr><td align="center">0</td><td align="center">0</td><td align="center">0</td><td align="center">1</td></tr><tr><td align="center">1</td><td align="center">0</td><td align="center">2</td><td align="center">0</td></tr><tr><td align="center">1</td><td align="center">1</td><td align="center">0</td><td align="center">1</td></tr><tr><td align="center">2</td><td align="center">0</td><td align="center">1</td><td align="center">0</td></tr><tr><td align="center">2</td><td align="center">1</td><td align="center">2</td><td align="center">0</td></tr></tbody></table><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">mod3</span><span class="token punctuation">(</span>  <span class="token keyword">input</span>       clk<span class="token punctuation">,</span>  <span class="token keyword">input</span>       nrst<span class="token punctuation">,</span>  <span class="token keyword">input</span>       data_in<span class="token punctuation">,</span>  <span class="token keyword">output</span> <span class="token keyword">reg</span>  data_out<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">parameter</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> S0 <span class="token operator">=</span> <span class="token number">2'b00</span><span class="token punctuation">,</span>                S1 <span class="token operator">=</span> <span class="token number">2'b01</span><span class="token punctuation">,</span>                S2 <span class="token operator">=</span> <span class="token number">2'b10</span><span class="token punctuation">;</span><span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> state<span class="token punctuation">,</span> next_state<span class="token punctuation">;</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>      state <span class="token operator">&lt;=</span> S0<span class="token punctuation">;</span>  <span class="token keyword">end</span>      state <span class="token operator">&lt;=</span> next_state<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token function">case</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token keyword">begin</span>    S0<span class="token punctuation">:</span> <span class="token function">if</span><span class="token punctuation">(</span>data_in<span class="token punctuation">)</span> next_state <span class="token operator">=</span> S1<span class="token punctuation">;</span> <span class="token keyword">else</span> next_state <span class="token operator">=</span> S0<span class="token punctuation">;</span>    S1<span class="token punctuation">:</span> <span class="token function">if</span><span class="token punctuation">(</span>data_in<span class="token punctuation">)</span> next_state <span class="token operator">=</span> S0<span class="token punctuation">;</span> <span class="token keyword">else</span> next_state <span class="token operator">=</span> S2<span class="token punctuation">;</span>    S2<span class="token punctuation">:</span> <span class="token function">if</span><span class="token punctuation">(</span>data_in<span class="token punctuation">)</span> next_state <span class="token operator">=</span> S2<span class="token punctuation">;</span> <span class="token keyword">else</span> next_state <span class="token operator">=</span> S1<span class="token punctuation">;</span>    <span class="token keyword">default</span><span class="token punctuation">:</span> next_state <span class="token operator">=</span> S0<span class="token punctuation">;</span>  <span class="token keyword">end</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token function">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>state <span class="token operator">==</span> S0<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>data_in<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>state <span class="token operator">==</span> S1<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>data_in<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    data_out <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token keyword">else</span>     data_out <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>模7检测器是同样的道理。状态跳转如下表所示</p><table><thead><tr><th align="center">当前态余数</th><th align="center">输入</th><th align="center">次态余数</th><th align="center">输出</th></tr></thead><tbody><tr><td align="center">0</td><td align="center">0</td><td align="center">0</td><td align="center">1</td></tr><tr><td align="center"></td><td align="center">1</td><td align="center">1</td><td align="center">0</td></tr><tr><td align="center">1</td><td align="center">0</td><td align="center">2</td><td align="center">0</td></tr><tr><td align="center"></td><td align="center">1</td><td align="center">3</td><td align="center">0</td></tr><tr><td align="center">2</td><td align="center">0</td><td align="center">4</td><td align="center">0</td></tr><tr><td align="center"></td><td align="center">1</td><td align="center">5</td><td align="center">0</td></tr><tr><td align="center">3</td><td align="center">0</td><td align="center">6</td><td align="center">0</td></tr><tr><td align="center"></td><td align="center">1</td><td align="center">0</td><td align="center">1</td></tr><tr><td align="center">4</td><td align="center">0</td><td align="center">1</td><td align="center">0</td></tr><tr><td align="center"></td><td align="center">1</td><td align="center">2</td><td align="center">0</td></tr><tr><td align="center">5</td><td align="center">0</td><td align="center">3</td><td align="center">0</td></tr><tr><td align="center"></td><td align="center">1</td><td align="center">4</td><td align="center">0</td></tr><tr><td align="center">6</td><td align="center">0</td><td align="center">5</td><td align="center">0</td></tr><tr><td align="center"></td><td align="center">1</td><td align="center">6</td><td align="center">0</td></tr></tbody></table><h2 id="任意整数除3求商和余数"><a href="#任意整数除3求商和余数" class="headerlink" title="任意整数除3求商和余数"></a>任意整数除3求商和余数</h2><p>参考上面的求余数方法，输入数据要一次性全部给进来，然后从高位开始遍历，每个周期都更新1bit的商和余数。余数共有3个状态，00,01,10. 根据输入是0还是1，状态跳转如下</p><table><thead><tr><th align="center">当前态余数</th><th align="center">输入</th><th align="center">次态余数</th><th align="center">商的操作</th></tr></thead><tbody><tr><td align="center">00</td><td align="center">0</td><td align="center">00</td><td align="center">商0</td></tr><tr><td align="center"></td><td align="center">1</td><td align="center">01</td><td align="center">商0</td></tr><tr><td align="center">01</td><td align="center">0</td><td align="center">10</td><td align="center">商0</td></tr><tr><td align="center"></td><td align="center">1</td><td align="center">00</td><td align="center">商1</td></tr><tr><td align="center">10</td><td align="center">0</td><td align="center">01</td><td align="center">商1</td></tr><tr><td align="center"></td><td align="center">1</td><td align="center">10</td><td align="center">商1</td></tr></tbody></table><p>code如下</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">module mod_div_3(  input           clk,  input           nrst,  input [7:0]     data_in,  input           valid_i,  output reg          valid_o,  output reg [7:0]    quotient,  output reg [1:0]    reminder);parameter DATA_WIDTH &#x3D; 8;reg [1:0] state, next_state;parameter [1:0] IDLE &#x3D; 2&#39;b11,                S0 &#x3D; 2&#39;b00,                S1 &#x3D; 2&#39;b01,                S2 &#x3D; 2&#39;b10;reg [2:0] cnt;reg [7:0] data_reg;always @(posedge clk or negedge nrst) begin  if(!nrst)    state &lt;&#x3D; IDLE;  else     state &lt;&#x3D; next_state;endalways @(*) begin  if(cnt &#x3D;&#x3D; DATA_WIDTH) begin    case(state)      IDLE: if(valid_i) next_state &#x3D; S0;             else        next_state &#x3D; IDLE;      S0: if(data_reg[7]) next_state &#x3D; S1;          else            next_state &#x3D; S0;      S1: if(data_reg[7]) next_state &#x3D; S0;          else            next_state &#x3D; S2;      S2: if(data_reg[7]) next_state &#x3D; S2;          else            next_state &#x3D; S1;      default: next_state &#x3D; IDLE;    endcase  end else begin    next_state &#x3D; IDLE;  endendalways @(posedge clk or negedge nrst) begin  if(!nrst)       cnt &lt;&#x3D; &#39;h0;  else if(state &#x3D;&#x3D; IDLE)     cnt &lt;&#x3D; &#39;h0;      else     cnt &lt;&#x3D; cnt + &#39;h1;endalways @(posedge clk or negedge nrst) begin  if(!nrst)    quotient &lt;&#x3D; &#39;h0;  else if(state !&#x3D; IDLE) begin    if(data_reg[7])      quotient &lt;&#x3D; &#123;quotient[6:0], state[0]|state[1]&#125;;    else       quotient &lt;&#x3D; &#123;quotient[6:0], state[1]&#125;;endalways @(posedge clk or negedge nrst) begin  if(!nrst) begin    reminder &lt;&#x3D; &#39;h0;    valid_o &lt;&#x3D; 0;  end else if(cnt &#x3D;&#x3D; DATA_WIDTH) begin    reminder &lt;&#x3D; state;    valid_o &lt;&#x3D; 1;  end else begin    valid_o &lt;&#x3D; 1;  endendendmodule<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 数字前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一生一芯-AXI总线及仲裁设计</title>
      <link href="/2024/022546524.html"/>
      <url>/2024/022546524.html</url>
      
        <content type="html"><![CDATA[<h2 id="AXI-Lite总线设计"><a href="#AXI-Lite总线设计" class="headerlink" title="AXI-Lite总线设计"></a>AXI-Lite总线设计</h2><p>采用AXI-Lite协议，只支持单次传输，不支持突发传输，接口信号简单。由于dcache既需要读操作，也需要写操作，以dcache为例进行说明；</p><h3 id="读操作"><a href="#读操作" class="headerlink" title="读操作"></a>读操作</h3><p>读操作的依赖关系：先完成读地址通道的握手，再进行读数据的握手，得到读数据。</p><img src="/2024/022546524/image-20240226100402535.png" alt="image-20240226100402535" style="zoom:50%;"><ul><li><strong>master</strong></li></ul><pre class=" language-verilog"><code class="language-verilog"><span class="token comment" spellcheck="true">// AR</span><span class="token keyword">assign</span> axi_araddr <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> RADDR<span class="token punctuation">)</span><span class="token operator">?</span> <span class="token operator">&amp;</span><span class="token number">#123</span><span class="token punctuation">;</span>addr<span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">3'b000</span><span class="token operator">&amp;</span><span class="token number">#125</span><span class="token punctuation">;</span> <span class="token punctuation">:</span> <span class="token number">64'h0</span><span class="token punctuation">;</span><span class="token keyword">assign</span> axi_arvalid <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> RADDR<span class="token punctuation">)</span><span class="token operator">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// R</span><span class="token keyword">assign</span> axi_rready <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> RDATA<span class="token punctuation">)</span><span class="token operator">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span></code></pre><ul><li>slave</li></ul><pre class=" language-verilog"><code class="language-verilog"><span class="token comment" spellcheck="true">// read operation</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> rstn<span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rstn<span class="token punctuation">)</span>     rvalid <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>rvalid <span class="token operator">&amp;</span> rready<span class="token punctuation">)</span>    rvalid <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>arvalid <span class="token operator">&amp;</span> arready<span class="token punctuation">)</span>    rvalid <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token keyword">reg</span> flag<span class="token punctuation">;</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> rstn<span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rstn<span class="token punctuation">)</span>    flag <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>arvalid<span class="token punctuation">)</span>    flag <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token keyword">else</span>    flag <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> counter<span class="token punctuation">;</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> rstn<span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rstn<span class="token punctuation">)</span>    counter <span class="token operator">&lt;=</span> <span class="token number">'h0</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>    counter <span class="token operator">&lt;=</span> counter <span class="token operator">+</span> <span class="token number">'h1</span><span class="token punctuation">;</span>  <span class="token keyword">else</span>    counter <span class="token operator">&lt;=</span> <span class="token number">'h0</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> rstn<span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rstn<span class="token punctuation">)</span>     arready <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>   <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>arvalid <span class="token operator">&amp;</span> arready<span class="token punctuation">)</span>    arready <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>counter <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span>    arready <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> rstn<span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rstn<span class="token punctuation">)</span>    data <span class="token operator">=</span> <span class="token number">64'h0</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>arvalid<span class="token punctuation">)</span>    data <span class="token operator">=</span> <span class="token function">paddr_read</span><span class="token punctuation">(</span>araddr<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">else</span>     data <span class="token operator">=</span> <span class="token number">'h0</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token keyword">assign</span> rdata <span class="token operator">=</span> rvalid <span class="token operator">?</span> data <span class="token punctuation">:</span> <span class="token number">'h0</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// counter 用来模拟salve提供数据所需要的周期数，延迟握手。</span></code></pre><h3 id="写操作"><a href="#写操作" class="headerlink" title="写操作"></a><strong>写操作</strong></h3><p>写操作中，写地址和写数据通道没有明确的握手依赖关系，但是写响应通道需要写地址和写数据握手后才可以握手，由于AXI-Lite只支持单次数据传输，所以没有wlast参与。本设计中，先进行写地址握手，再进行写数据握手，最后写响应通道握手，完成写操作。</p><ul><li>master</li></ul><pre class=" language-verilog"><code class="language-verilog"><span class="token comment" spellcheck="true">// AW</span><span class="token keyword">assign</span> axi_awaddr  <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> WADDR<span class="token punctuation">)</span> <span class="token operator">?</span> addr <span class="token punctuation">:</span> <span class="token number">64'h0</span><span class="token punctuation">;</span><span class="token keyword">assign</span> axi_awvalid <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> WADDR<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// W</span><span class="token keyword">assign</span> axi_wdata  <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> WDATA<span class="token punctuation">)</span> <span class="token operator">?</span> wdata <span class="token punctuation">:</span> <span class="token number">64'h0</span><span class="token punctuation">;</span><span class="token keyword">assign</span> axi_wstrb  <span class="token operator">=</span> <span class="token punctuation">(</span>flash_flag<span class="token operator">&amp;</span>dirty<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">8'b11111111</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>flash_flag<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">8'b0000_0000</span> <span class="token punctuation">:</span> byte_enable<span class="token punctuation">;</span><span class="token keyword">assign</span> axi_wvalid <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> WDATA<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// B</span><span class="token keyword">assign</span> axi_bready <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> WRESP<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span></code></pre><ul><li>slave</li></ul><pre class=" language-verilog"><code class="language-verilog"><span class="token comment" spellcheck="true">// write operation</span><span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> waddr<span class="token punctuation">;</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> rstn<span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rstn<span class="token punctuation">)</span>     waddr <span class="token operator">&lt;=</span> <span class="token number">'h0</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>awvalid<span class="token punctuation">)</span>    waddr <span class="token operator">&lt;=</span> awaddr<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> wdata_r<span class="token punctuation">;</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> rstn<span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rstn<span class="token punctuation">)</span>     wdata_r <span class="token operator">&lt;=</span> <span class="token number">'h0</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>wvalid<span class="token punctuation">)</span>    wdata_r <span class="token operator">&lt;=</span> wdata<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> rstn<span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rstn<span class="token punctuation">)</span>    awready <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>awvalid <span class="token operator">&amp;&amp;</span> awready<span class="token punctuation">)</span>    awready <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>awvalid<span class="token punctuation">)</span>    awready <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> rstn<span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rstn<span class="token punctuation">)</span>    wready <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>wvalid <span class="token operator">&amp;&amp;</span> wready<span class="token punctuation">)</span>    wready <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>wvalid<span class="token punctuation">)</span>    wready <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> rstn<span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token function">if</span><span class="token punctuation">(</span>wvalid <span class="token operator">&amp;&amp;</span> wready<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token property">$display</span><span class="token punctuation">(</span><span class="token string">"write addr:%x, data:%x"</span><span class="token punctuation">,</span> waddr<span class="token punctuation">,</span> wdata_r<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">case</span><span class="token punctuation">(</span>wstrb<span class="token punctuation">)</span>       <span class="token number">8'b00000001</span><span class="token punctuation">:</span> <span class="token function">paddr_write</span><span class="token punctuation">(</span>waddr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> wdata_r<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token number">8'b00000011</span><span class="token punctuation">:</span> <span class="token function">paddr_write</span><span class="token punctuation">(</span>waddr<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> wdata_r<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token number">8'b00001111</span><span class="token punctuation">:</span> <span class="token function">paddr_write</span><span class="token punctuation">(</span>waddr<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> wdata_r<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token number">8'b11111111</span><span class="token punctuation">:</span> <span class="token function">paddr_write</span><span class="token punctuation">(</span>waddr<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> wdata_r<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">endcase</span>  <span class="token keyword">end</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> rstn<span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rstn<span class="token punctuation">)</span>    bvalid <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>bvalid <span class="token operator">&amp;&amp;</span> bready<span class="token punctuation">)</span>    bvalid <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>wready <span class="token operator">&amp;</span> wvalid<span class="token punctuation">)</span>    bvalid <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token keyword">assign</span> bresp <span class="token operator">=</span> bvalid <span class="token operator">?</span> <span class="token number">2'b00</span> <span class="token punctuation">:</span> <span class="token number">2'b00</span><span class="token punctuation">;</span></code></pre><h3 id="AXI仲裁器"><a href="#AXI仲裁器" class="headerlink" title="AXI仲裁器"></a>AXI仲裁器</h3><p>SRAM一般只有一个，Icache和Dcache可能出现同时访问SRAM的情况，产生了冲突，需要设计Arbiter来决定哪个master的优先级更高。当发生仲裁时，本设计中设计Dcache优先级更高。</p><img src="/2024/022546524/image-20240226102945089.png" alt="image-20240226102945089" style="zoom: 50%;"><p>Icache没有写操作的需要，不需要仲裁。只有Icache和Dcache同时发生读操作时才进行仲裁。</p><pre class=" language-verilog"><code class="language-verilog"><span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token function">if</span><span class="token punctuation">(</span>lsu_arvalid<span class="token punctuation">)</span> <span class="token keyword">begin</span>    arvalid <span class="token operator">=</span> lsu_arvalid<span class="token punctuation">;</span>    araddr  <span class="token operator">=</span> lsu_araddr<span class="token punctuation">;</span>  <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token keyword">begin</span>    arvalid <span class="token operator">=</span> if_arvalid<span class="token punctuation">;</span>    araddr  <span class="token operator">=</span> if_araddr<span class="token punctuation">;</span>  <span class="token keyword">end</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token function">if</span><span class="token punctuation">(</span>lsu_arvalid<span class="token punctuation">)</span>    if_arready <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">else</span>     if_arready <span class="token operator">=</span> arready<span class="token punctuation">;</span><span class="token keyword">end</span>  <span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token function">if</span><span class="token punctuation">(</span>lsu_arvalid<span class="token punctuation">)</span>    if_rvalid <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">else</span>     if_rvalid <span class="token operator">=</span> rvalid<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token comment" spellcheck="true">// 当lsu_arvalid为1时，反压if_arready和if_rvalid，延迟Icache读地址通道和读数据通道的握手</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 数字前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 一生一芯 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>时钟切换设计</title>
      <link href="/2024/022513924.html"/>
      <url>/2024/022513924.html</url>
      
        <content type="html"><![CDATA[<h2 id="时钟切换"><a href="#时钟切换" class="headerlink" title="时钟切换"></a>时钟切换</h2><blockquote><p>某些时钟切换的场景下，需要选择信号来选择某一个时钟信号</p></blockquote><h3 id="组合逻辑选通"><a href="#组合逻辑选通" class="headerlink" title="组合逻辑选通"></a>组合逻辑选通</h3><p>电路对时钟信号非常敏感，如果采用组合逻辑选通时钟，很有可能在时钟上产生毛刺，导致功能错误，或者不满足时序要求，造成亚稳态。</p><img src="/2024/022513924/image-20240225231635368.png" alt="image-20240225231635368" style="zoom: 25%;"><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">assign</span> clk1_t <span class="token operator">=</span> clk1 <span class="token operator">&amp;</span> sel_clk1<span class="token punctuation">;</span><span class="token keyword">assign</span> clk2_t <span class="token operator">=</span> clk2 <span class="token operator">&amp;</span> <span class="token operator">!</span>sle_clk1<span class="token punctuation">;</span><span class="token keyword">assign</span> clk_out <span class="token operator">=</span> clk1_t <span class="token operator">|</span> clk2_t<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><img src="/2024/022513924/8f134e7b11982eb43608e728782d78da.png" alt style="zoom: 33%;"><h3 id="时序逻辑选通"><a href="#时序逻辑选通" class="headerlink" title="时序逻辑选通"></a>时序逻辑选通</h3><p><strong>产生毛刺的本质原因是sel信号是异步的，无法保证输出的时钟在低电平时切换。</strong></p><p><strong>通过添加一级寄存器</strong>，使得sel选通信号在时钟切换在下降沿才发生变化，这样不会产生毛刺，因为是“相与”的关系。<br><strong>增加了反馈的好处</strong>：即使select信号改变了，时钟的切换需要等待切换前时钟为低电平时才可以 发生切换，保证了之前时钟信号的完整性（不会斩波）。<br>通过以上两种优化，就可以输出没有毛刺的时钟信号。这是一种非常安全的时钟切换方案。</p><img src="/2024/022513924/1bee2a8c32b64dd050b86e103ad3462d.jpeg" style="zoom:50%;"><p>此外，由于sel信号是异步输入，为了降低亚稳态，可以打两拍，再进行时钟切换。</p><img src="/2024/022513924/12ba42985f38e4091d39bc8bae8d191e.jpeg" style="zoom:50%;"><pre class="line-numbers language-Verilog" data-language="Verilog"><code class="language-Verilog">&#x2F;********************************************************************* * Author           : liu * Last modified    : 2023-05-30 15:25 * Filename         : switch_clock.v * Description      :  * ******************************************************************&#x2F;module switch_clock(  input clk1,  input rstn1,  input clk2,  input rstn2,  input select,  output clkout);  wire clk1_select;  wire clk2_select;  reg clk1_reg_r, clk1_reg_rr;  reg clk2_reg_r, clk2_reg_rr;  reg clk1_reg_rrr;  reg clk2_reg_rrr;    always @(posedge clk1 or negedge rstn1)beginif(!rstn1) begin  clk1_reg_r &lt;&#x3D; 0;  clk1_reg_rr &lt;&#x3D; 0;endelse begin  clk1_reg_r &lt;&#x3D; clk1_select;  clk1_reg_rr &lt;&#x3D; clk1_reg_r;end  end  always @(posedge clk2 or negedge rstn2)beginif(!rstn2) begin  clk2_reg_r &lt;&#x3D; 0;  clk2_reg_rr &lt;&#x3D; 0;endelse begin  clk2_reg_r &lt;&#x3D; clk2_select;  clk2_reg_rr &lt;&#x3D; clk2_reg_r;end  end  assign clk1_select &#x3D; select &amp; (~clk2_reg_rrr);  assign clk2_select &#x3D; ~select &amp; (~clk1_reg_rrr);  always @(negedge clk1 or negedge rstn1) beginif(!rstn1)  clk1_reg_rrr &lt;&#x3D; 0;else  clk1_reg_rrr &lt;&#x3D; clk1_reg_rr;  end  always @(negedge clk2 or negedge rstn2) beginif(!rstn2)  clk2_reg_rrr &lt;&#x3D; 0;else  clk2_reg_rrr &lt;&#x3D; clk2_reg_rr;  end  assign clkout &#x3D; (clk1 &amp; clk1_reg_rrr ) || (clk2 &amp; clk2_reg_rrr);endmodule<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2024/022513924/48bccb9764f34ae5948dd826d5dcb0f5.png" alt="测试结果"></p>]]></content>
      
      
      <categories>
          
          <category> 数字前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux常用命令</title>
      <link href="/2024/022548230.html"/>
      <url>/2024/022548230.html</url>
      
        <content type="html"><![CDATA[<h3 id="文件操作"><a href="#文件操作" class="headerlink" title="文件操作"></a>文件操作</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">压缩成.tar文件： <span class="token function">tar</span> <span class="token parameter variable">-cvf</span> file.tar files解压.tar文件： <span class="token function">tar</span> <span class="token parameter variable">-xvf</span> file.tar压缩成.tar.gz文件： <span class="token function">tar</span> <span class="token parameter variable">-czvf</span> file.tar.gz files解压.tar.gz文件： <span class="token function">tar</span> <span class="token parameter variable">-xzvf</span> file.tar.gz压缩.tar.bz2文件： <span class="token function">tar</span> <span class="token parameter variable">-cjvf</span> file.tar.bz2 files解压.tar.bz2文件： <span class="token function">tar</span> <span class="token parameter variable">-xjvf</span> file.tar.bz2压缩成.gz 文件 <span class="token function">gzip</span> <span class="token function">file</span>解压 <span class="token function">gzip</span> <span class="token parameter variable">-d</span> file.gz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="系统配置"><a href="#系统配置" class="headerlink" title="系统配置"></a>系统配置</h3><p>​&#x2F; ——根目录<br>​&#x2F;bin ——存放必要的命令<br>​&#x2F;boot ——存放内核以及启动所需的文件<br>​&#x2F;dev ——存放设备文件<br>​&#x2F;etc ——存放系统配置文件<br>​&#x2F;home ——普通用户的宿主目录，用户数据存放在其主目录中<br>​&#x2F;lib ——存放必要的运行库<br>​&#x2F;mnt ——存放临时的映射文件系统，通常用来挂载使用。<br>​&#x2F;proc ——存放存储进程和系统信息<br>​&#x2F;root ——超级用户的主目录<br>​&#x2F;sbin ——存放系统管理程序<br>​&#x2F;tmp ——存放临时文件<br>​&#x2F;usr ——存放应用程序，命令程序文件、程序库、手册和其它文档。<br>​&#x2F;var ——-系统默认日志存放目录</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">hostname</span> <span class="token builtin class-name">:</span> 显示系统的hostname<span class="token function">ifconfig</span> <span class="token parameter variable">-a</span> <span class="token builtin class-name">:</span> 显示网络的配置信息<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="查看文件内容情况："><a href="#查看文件内容情况：" class="headerlink" title="查看文件内容情况："></a>查看文件内容情况：</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">wc</span> <span class="token function">file</span> <span class="token builtin class-name">:</span> 计算文件的行数和字节数<span class="token function">wc</span> <span class="token parameter variable">-w</span> <span class="token function">file</span> <span class="token builtin class-name">:</span> 计算文件的字数<span class="token function">wc</span> <span class="token parameter variable">-l</span> <span class="token function">file</span> <span class="token builtin class-name">:</span> 计算文件的行数<span class="token function">find</span> 查找文件或目录命令格式为: <span class="token function">find</span> 后接查找的目录，-name指定需要查找的文件名称，名称可以使用“* ”表示所有。<span class="token function">find</span> /home <span class="token parameter variable">-name</span> “test.txt”,<span class="token function">find</span> /home <span class="token parameter variable">-name</span> “*.txt” :查找/home目录下，所有以.txt结尾的文件或者目录。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="grep命令"><a href="#grep命令" class="headerlink" title="grep命令"></a>grep命令</h3><p>在&#x2F;home&#x2F;usr目录中查找文件名中包括”<strong>Montage</strong>“或者<strong>montage</strong>的文件名，并打印出来；</p><p>A：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">grep</span> <span class="token parameter variable">-rli</span> <span class="token string">"Montage\|montage"</span> /home/usr<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>grep</code> 命令用于在文件中搜索指定的模式。 </p><ul><li><p><code>-r</code> 选项用于在指定的目录和其子目录中递归搜索。 </p></li><li><p><code>-l</code> <strong>选项用于只输出包含模式的文件名，而不是匹配的行。(字母L的小写，如果没有这个，则会输出所有含有字段的文件名及对应行)</strong></p></li><li><p><code>-i</code> 选项用于忽略大小写。 </p></li><li><p><code>&#39;montage&#39;</code> 是要搜索的模式。 </p></li><li><p><code>/home/user/</code> 是要搜索的目录。</p></li><li><p>-E 使用正则表达式</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux基础知识 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux常用命令 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一生一芯-Cache设计(二)</title>
      <link href="/2024/022536323.html"/>
      <url>/2024/022536323.html</url>
      
        <content type="html"><![CDATA[<h2 id="Cache实现"><a href="#Cache实现" class="headerlink" title="Cache实现"></a>Cache实现</h2><p>根据上述的理论知识，确定cache的设计要求如下</p><ol><li><p><strong>采用直接映射缓存的方式，cache size为2KB，cache line为8Bytes</strong></p></li><li><p><strong>当访问cache缺省时，采用读分配Read allocate和写分配Write allocate策略，</strong></p></li><li><p><strong>cache的更新策略为写回Write Back</strong></p></li></ol><h3 id="Icache实现"><a href="#Icache实现" class="headerlink" title="Icache实现"></a>Icache实现</h3><p>icache在流水线中的位置以及接口信号如下</p><img src="/2024/022536323/image-20240225165626395.png" style="zoom: 33%;"><p>​包含两组握手信号，第一个是ifu和PC寄存器的握手，只有ifpc_valid &amp; ifpc_ready&#x3D;1握手后，才可以更新ifu阶段的取值地址pc_i。第二个是ifu和icache的握手，只有cache_rdy &amp;  cache_vld 握手成功后，ifu阶段才可以拿到pc对应的指令，并通过inst_valid信号指示，给到IF_ID寄存器。Icache和SRAM通过AXI协议完成读取指令。</p><p>​由于icache只有对内存读取数据的需求，所以AXI协议中的写地址、写数据和写响应通道可以忽略，icache的整个状态跳转如下</p><img src="/2024/022536323/image-20240225171812056.png" alt="image-20240225171812056" style="zoom:33%;"><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">assign</span> allocate <span class="token operator">=</span> state <span class="token operator">==</span> ALLOCATE<span class="token punctuation">;</span><span class="token keyword">assign</span> wstrb <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> ALLOCATE<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">8'b11111111</span> <span class="token punctuation">:</span> <span class="token number">8'b00000000</span><span class="token punctuation">;</span><span class="token keyword">assign</span> wdata <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> ALLOCATE<span class="token punctuation">)</span> <span class="token operator">?</span> ram_data <span class="token punctuation">:</span> <span class="token number">64'h0</span><span class="token punctuation">;</span><span class="token keyword">assign</span> ready <span class="token operator">=</span> hit <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> IDLE<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">case</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>        IDLE <span class="token punctuation">:</span> <span class="token function">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span>hit<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> valid<span class="token punctuation">)</span>            next_state <span class="token operator">=</span> RADDR<span class="token punctuation">;</span>                <span class="token keyword">else</span>                          next_state <span class="token operator">=</span> IDLE<span class="token punctuation">;</span>        RADDR<span class="token punctuation">:</span> <span class="token function">if</span><span class="token punctuation">(</span>axi_arvalid <span class="token operator">&amp;&amp;</span> axi_arready<span class="token punctuation">)</span> next_state <span class="token operator">=</span> RDATA<span class="token punctuation">;</span>                <span class="token keyword">else</span>                          next_state <span class="token operator">=</span> RADDR<span class="token punctuation">;</span>        RDATA<span class="token punctuation">:</span> <span class="token function">if</span><span class="token punctuation">(</span>axi_rvalid <span class="token operator">&amp;&amp;</span> axi_rready<span class="token punctuation">)</span>   next_state <span class="token operator">=</span> ALLOCATE<span class="token punctuation">;</span>                <span class="token keyword">else</span>                          next_state <span class="token operator">=</span> RDATA<span class="token punctuation">;</span>        ALLOCATE<span class="token punctuation">:</span> next_state <span class="token operator">=</span> IDLE<span class="token punctuation">;</span>         <span class="token keyword">default</span> <span class="token punctuation">:</span> next_state <span class="token operator">=</span> IDLE<span class="token punctuation">;</span>    <span class="token keyword">endcase</span><span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>只有在IDLE状态才会读取cache的数据，如果hit，直接输出有效的指令；如果miss，则通过AXI读取内存，首先跳转到RADDR状态，进行读地址通道的握手，然后跳转到读数据状态。读地址通道握手后，得到指令数据，然后跳转到读分配状态，将读出的指令加载到cachemem中。最终在IDLE状态，hit该cacheline，读出数据。</p><p>cachemem中对于hit的判断和cacheline的更新如下</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> rstn<span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rstn<span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>flash<span class="token punctuation">)</span> <span class="token keyword">begin</span><span class="token function">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>DATA_SIZE<span class="token punctuation">;</span>i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>   v<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">'h0</span><span class="token punctuation">;</span>  d<span class="token punctuation">[</span>i<span class="token punctuation">]</span>   <span class="token operator">&lt;=</span> <span class="token number">'h0</span><span class="token punctuation">;</span>  tag<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">'h0</span><span class="token punctuation">;</span>      mem<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">'h0</span><span class="token punctuation">;</span>  <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>en <span class="token operator">&amp;</span> allocate<span class="token punctuation">)</span> <span class="token keyword">begin</span>      <span class="token function">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>      <span class="token function">if</span><span class="token punctuation">(</span>wen<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>        mem<span class="token punctuation">[</span>addr_index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token operator">*</span>i<span class="token operator">+</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> wdata<span class="token punctuation">[</span><span class="token number">8</span><span class="token operator">*</span>i<span class="token operator">+</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">end</span>    d<span class="token punctuation">[</span>addr_index<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>    v<span class="token punctuation">[</span>addr_index<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>    tag<span class="token punctuation">[</span>addr_index<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> addr_tag<span class="token punctuation">;</span>   <span class="token keyword">end</span><span class="token keyword">end</span><span class="token keyword">assign</span> addr_index <span class="token operator">=</span> addr<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">+</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">assign</span> addr_tag <span class="token operator">=</span> addr<span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">assign</span> offset<span class="token operator">=</span> addr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">assign</span> hit <span class="token operator">=</span> en <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>addr_tag <span class="token operator">==</span> tag<span class="token punctuation">[</span>addr_index<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> v<span class="token punctuation">[</span>addr_index<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">assign</span> rdata <span class="token operator">=</span> offset<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">?</span><span class="token operator">&#123;</span><span class="token number">32'b0</span><span class="token punctuation">,</span> mem<span class="token punctuation">[</span>addr_index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">:</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token operator">&#125;</span> <span class="token punctuation">:</span> <span class="token operator">&#123;</span><span class="token number">32'b0</span><span class="token punctuation">,</span> mem<span class="token punctuation">[</span>addr_index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>由于inst指令是32bit的，cacheline是64bit，通过判断offset[2]确定读取命中cacheline的高32bit还是低32bit。</p><p><strong>在cache miss时，通过AXI访问内存时，通常需要多个周期。这个过程中，需要将流水线停顿下来，发出stall信号给PC寄存器，输出给IF_ID寄存器为nop指令。</strong></p><hr><h3 id="Dcache实现"><a href="#Dcache实现" class="headerlink" title="Dcache实现"></a>Dcache实现</h3><p>dcache在流水线中的位置以及接口信号如下</p><img src="/2024/022536323/image-20240225202346217.png" alt style="zoom:33%;"><p>​只包含一组握手信号，lus和dcache之间；对dcache进行读操作的过程跟icache差不多。<br>​<strong>最大区别</strong>在于写操作，写缺省时，执行写分配，将写入地址的数据读取到cachemem中(这个过程和读分配差不多)，在IDLE状态将待更新的数据写入到cacheline中，并将对应的dirty位置1。在替换该cacheline时，判断dirty位为1，需要先将数据写入到内存中；因此，相比icache，多了很多状态。</p><img src="/2024/022536323/image-20240225205639538.png" alt="image-20240225205639538" style="zoom:33%;"><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span><span class="token keyword">case</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span>IDLE <span class="token punctuation">:</span> next_state <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">!</span>hit <span class="token operator">&amp;&amp;</span> dirty <span class="token operator">&amp;&amp;</span> valid<span class="token punctuation">)</span> <span class="token operator">?</span> WRITEBACK <span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token operator">!</span>hit <span class="token operator">&amp;&amp;</span> valid<span class="token punctuation">)</span> <span class="token operator">?</span> RADDR <span class="token punctuation">:</span> IDLE<span class="token punctuation">;</span>WRITEBACK <span class="token punctuation">:</span> next_state <span class="token operator">=</span> WADDR<span class="token punctuation">;</span>ALLOCATE <span class="token punctuation">:</span> next_state <span class="token operator">=</span> IDLE<span class="token punctuation">;</span>RADDR <span class="token punctuation">:</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>axi_arvalid <span class="token operator">&amp;&amp;</span> axi_arready<span class="token punctuation">)</span> next_state <span class="token operator">=</span> RDATA<span class="token punctuation">;</span>RDATA <span class="token punctuation">:</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>axi_rvalid  <span class="token operator">&amp;&amp;</span> axi_rready <span class="token punctuation">)</span> next_state <span class="token operator">=</span> ALLOCATE<span class="token punctuation">;</span>WADDR <span class="token punctuation">:</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>axi_awvalid <span class="token operator">&amp;&amp;</span> axi_awready<span class="token punctuation">)</span> next_state <span class="token operator">=</span> WDATA<span class="token punctuation">;</span>WDATA <span class="token punctuation">:</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>axi_wvalid  <span class="token operator">&amp;&amp;</span> axi_wready <span class="token punctuation">)</span> next_state <span class="token operator">=</span> WRESP<span class="token punctuation">;</span>        WRESP <span class="token punctuation">:</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>axi_bvalid  <span class="token operator">&amp;&amp;</span> axi_bready <span class="token punctuation">)</span> next_state <span class="token operator">=</span> RADDR<span class="token punctuation">;</span><span class="token keyword">default</span> <span class="token punctuation">:</span> next_state <span class="token operator">=</span> IDLE<span class="token punctuation">;</span><span class="token keyword">endcase</span><span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>针对读写指令是字节&#x2F;半字&#x2F;字&#x2F;双字</p><p>在读写cacheline时需要根据地址的后三位使用offset来限制，保证读出的数据都是对齐的，写入数据对cacheline的数据更新也是对齐的。</p></li></ul><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">assign</span> offset <span class="token operator">=</span> addr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// Read</span><span class="token important">always @</span><span class="token operator">*</span> <span class="token keyword">begin</span>  <span class="token function">case</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span> <span class="token number">3'b000</span><span class="token punctuation">:</span> rdata <span class="token operator">=</span> mem<span class="token punctuation">[</span>addr_index<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token number">3'b001</span><span class="token punctuation">:</span> rdata <span class="token operator">=</span> <span class="token operator">&#123;</span><span class="token number">8'b0</span><span class="token punctuation">,</span> mem<span class="token punctuation">[</span>addr_index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token operator">&#125;</span><span class="token punctuation">;</span><span class="token number">3'b010</span><span class="token punctuation">:</span> rdata <span class="token operator">=</span> <span class="token operator">&#123;</span><span class="token number">16'b0</span><span class="token punctuation">,</span> mem<span class="token punctuation">[</span>addr_index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token operator">&#125;</span><span class="token punctuation">;</span><span class="token number">3'b011</span><span class="token punctuation">:</span> rdata <span class="token operator">=</span> <span class="token operator">&#123;</span><span class="token number">24'b0</span><span class="token punctuation">,</span> mem<span class="token punctuation">[</span>addr_index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">]</span><span class="token operator">&#125;</span><span class="token punctuation">;</span><span class="token number">3'b100</span><span class="token punctuation">:</span> rdata <span class="token operator">=</span> <span class="token operator">&#123;</span><span class="token number">32'b0</span><span class="token punctuation">,</span> mem<span class="token punctuation">[</span>addr_index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">:</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token operator">&#125;</span><span class="token punctuation">;</span><span class="token number">3'b101</span><span class="token punctuation">:</span> rdata <span class="token operator">=</span> <span class="token operator">&#123;</span><span class="token number">40'b0</span><span class="token punctuation">,</span> mem<span class="token punctuation">[</span>addr_index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">:</span><span class="token number">40</span><span class="token punctuation">]</span><span class="token operator">&#125;</span><span class="token punctuation">;</span><span class="token number">3'b110</span><span class="token punctuation">:</span> rdata <span class="token operator">=</span> <span class="token operator">&#123;</span><span class="token number">48'b0</span><span class="token punctuation">,</span> mem<span class="token punctuation">[</span>addr_index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">]</span><span class="token operator">&#125;</span><span class="token punctuation">;</span><span class="token number">3'b111</span><span class="token punctuation">:</span> rdata <span class="token operator">=</span> <span class="token operator">&#123;</span><span class="token number">56'b0</span><span class="token punctuation">,</span> mem<span class="token punctuation">[</span>addr_index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">:</span><span class="token number">56</span><span class="token punctuation">]</span><span class="token operator">&#125;</span><span class="token punctuation">;</span><span class="token keyword">default</span><span class="token punctuation">:</span> rdata <span class="token operator">=</span> mem<span class="token punctuation">[</span>addr_index<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">endcase</span><span class="token keyword">end</span><span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> we_offset<span class="token punctuation">;</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token function">case</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token number">3'b000</span><span class="token punctuation">:</span> we_offset <span class="token operator">=</span> we <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token number">3'b001</span><span class="token punctuation">:</span> we_offset <span class="token operator">=</span> we <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token number">3'b010</span><span class="token punctuation">:</span> we_offset <span class="token operator">=</span> we <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token number">3'b011</span><span class="token punctuation">:</span> we_offset <span class="token operator">=</span> we <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token number">3'b100</span><span class="token punctuation">:</span> we_offset <span class="token operator">=</span> we <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span><span class="token number">3'b101</span><span class="token punctuation">:</span> we_offset <span class="token operator">=</span> we <span class="token operator">&lt;&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span><span class="token number">3'b110</span><span class="token punctuation">:</span> we_offset <span class="token operator">=</span> we <span class="token operator">&lt;&lt;</span> <span class="token number">6</span><span class="token punctuation">;</span><span class="token number">3'b111</span><span class="token punctuation">:</span> we_offset <span class="token operator">=</span> we <span class="token operator">&lt;&lt;</span> <span class="token number">7</span><span class="token punctuation">;</span><span class="token keyword">default</span> <span class="token punctuation">:</span> we_offset <span class="token operator">=</span> we<span class="token punctuation">;</span>  <span class="token keyword">endcase</span><span class="token keyword">end</span><span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> wdata_offset<span class="token punctuation">;</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token function">case</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token number">3'b000</span><span class="token punctuation">:</span> wdata_offset <span class="token operator">=</span> wdata <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token operator">*</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token number">3'b001</span><span class="token punctuation">:</span> wdata_offset <span class="token operator">=</span> wdata <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token operator">*</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token number">3'b010</span><span class="token punctuation">:</span> wdata_offset <span class="token operator">=</span> wdata <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">;</span><span class="token number">3'b011</span><span class="token punctuation">:</span> wdata_offset <span class="token operator">=</span> wdata <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">;</span><span class="token number">3'b100</span><span class="token punctuation">:</span> wdata_offset <span class="token operator">=</span> wdata <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">;</span><span class="token number">3'b101</span><span class="token punctuation">:</span> wdata_offset <span class="token operator">=</span> wdata <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token operator">*</span><span class="token number">5</span><span class="token punctuation">;</span><span class="token number">3'b110</span><span class="token punctuation">:</span> wdata_offset <span class="token operator">=</span> wdata <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token operator">*</span><span class="token number">6</span><span class="token punctuation">;</span><span class="token number">3'b111</span><span class="token punctuation">:</span> wdata_offset <span class="token operator">=</span> wdata <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token operator">*</span><span class="token number">7</span><span class="token punctuation">;</span><span class="token keyword">default</span> <span class="token punctuation">:</span> wdata_offset <span class="token operator">=</span> wdata<span class="token punctuation">;</span>  <span class="token keyword">endcase</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> rstn<span class="token punctuation">)</span> <span class="token keyword">begin</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rstn<span class="token punctuation">)</span> <span class="token keyword">begin</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>v<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> d<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> tag<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>mem<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>en <span class="token operator">&amp;&amp;</span> hit<span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">begin</span><span class="token keyword">if</span> <span class="token punctuation">(</span>we_offset<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>  mem<span class="token punctuation">[</span>addr_index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">8</span> <span class="token operator">*</span> i <span class="token operator">+</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> wdata_offset<span class="token punctuation">[</span><span class="token number">8</span> <span class="token operator">*</span> i <span class="token operator">+</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">end</span>  <span class="token keyword">end</span>  d<span class="token punctuation">[</span>addr_index<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>en <span class="token operator">&amp;&amp;</span> allocate<span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">begin</span><span class="token keyword">if</span> <span class="token punctuation">(</span>we<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>  mem<span class="token punctuation">[</span>addr_index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">8</span> <span class="token operator">*</span> i <span class="token operator">+</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> wdata<span class="token punctuation">[</span><span class="token number">8</span> <span class="token operator">*</span> i <span class="token operator">+</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">end</span>  <span class="token keyword">end</span>  d<span class="token punctuation">[</span>addr_index<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>  v<span class="token punctuation">[</span>addr_index<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>  tag<span class="token punctuation">[</span>addr_index<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> addr_tag<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token keyword">end</span><span class="token comment">// lsu.v</span><span class="token comment">// 针对不同的指令，将输出的结果进行符号位扩展。</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token function">if</span><span class="token punctuation">(</span>lden_i<span class="token punctuation">)</span> <span class="token keyword">begin</span><span class="token function">case</span><span class="token punctuation">(</span>lsfunc3_i<span class="token punctuation">)</span>  <span class="token number">3'b000</span><span class="token punctuation">:</span> lsres <span class="token operator">=</span> <span class="token operator">&#123;&#123;</span><span class="token number">56</span><span class="token operator">&#123;</span>temp<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token operator">&#125;&#125;</span><span class="token punctuation">,</span> temp<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">&#125;</span><span class="token punctuation">;</span>  <span class="token number">3'b001</span><span class="token punctuation">:</span> lsres <span class="token operator">=</span> <span class="token operator">&#123;&#123;</span><span class="token number">48</span><span class="token operator">&#123;</span>temp<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token operator">&#125;&#125;</span><span class="token punctuation">,</span> temp<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">&#125;</span><span class="token punctuation">;</span>  <span class="token number">3'b010</span><span class="token punctuation">:</span> lsres <span class="token operator">=</span> <span class="token operator">&#123;&#123;</span><span class="token number">32</span><span class="token operator">&#123;</span>temp<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">]</span><span class="token operator">&#125;&#125;</span><span class="token punctuation">,</span> temp<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">&#125;</span><span class="token punctuation">;</span>  <span class="token number">3'b100</span><span class="token punctuation">:</span> lsres <span class="token operator">=</span> <span class="token operator">&#123;</span><span class="token number">56'b0</span><span class="token punctuation">,</span> temp<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">&#125;</span><span class="token punctuation">;</span>  <span class="token number">3'b101</span><span class="token punctuation">:</span> lsres <span class="token operator">=</span> <span class="token operator">&#123;</span><span class="token number">48'b0</span><span class="token punctuation">,</span> temp<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">&#125;</span><span class="token punctuation">;</span>  <span class="token number">3'b110</span><span class="token punctuation">:</span> lsres <span class="token operator">=</span> <span class="token operator">&#123;</span><span class="token number">32'b0</span><span class="token punctuation">,</span> temp<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">&#125;</span><span class="token punctuation">;</span>  <span class="token number">3'b011</span><span class="token punctuation">:</span> lsres <span class="token operator">=</span> temp<span class="token punctuation">;</span>  <span class="token keyword">default</span><span class="token punctuation">:</span> lsres <span class="token operator">=</span> <span class="token number">'h0</span><span class="token punctuation">;</span>  <span class="token keyword">endcase</span>  <span class="token keyword">end</span> <span class="token keyword">else</span> lsres <span class="token operator">=</span> <span class="token number">'h0</span><span class="token punctuation">;</span><span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>在dcache读写内存时，需要多个周期，这时流水线需要停顿下来，发出stall信号，将前面各个阶段寄存器的数据保持不变。</strong></p>]]></content>
      
      
      <categories>
          
          <category> 体系结构 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 一生一芯 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一生一芯-Cache设计（一）</title>
      <link href="/2024/022542394.html"/>
      <url>/2024/022542394.html</url>
      
        <content type="html"><![CDATA[<h2 id="Cache基础知识"><a href="#Cache基础知识" class="headerlink" title="Cache基础知识"></a>Cache基础知识</h2><blockquote><p>部分参考网上的学习资料，侵删。</p></blockquote><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>时间局部性：在程序中，某个数据在短时间内会被频繁用到。<br>空间局部性：访问某个数据时，通过附近数据的概率也很大，比如循环访问数组数据。</p><p>Cache：用一块小而块的存储设备（采用SRAM实现），作为大而慢的存储设备的缓冲区，提高访存的速度，并降低功耗。考虑到时间、空间局部性原理，cache的作用就显而易见了。</p><p>cache的大小: cache size，cache平分成很多块称为cacheline，大小是 cache line size。比如，一个64Bytes的cache，平分成8个cache line，每个cache line大小是8Bytes</p><h4 id="分配策略-针对cacheline，读写缺省"><a href="#分配策略-针对cacheline，读写缺省" class="headerlink" title="分配策略(针对cacheline，读写缺省)"></a>分配策略(针对cacheline，读写缺省)</h4><ul><li><p>读分配：读取cache时，发生cache缺省，分配一个cache line缓存，用于读取数据。(天然满足)</p></li><li><p>写分配：写cache时，发生缺省时，从主存中加载数据到cacheline，更新该cacheline数据，将dirty位置1，等到替换时，再写入主存。</p></li></ul><h4 id="Cache更新策略（写cache命中）"><a href="#Cache更新策略（写cache命中）" class="headerlink" title="Cache更新策略（写cache命中）"></a>Cache更新策略（写cache命中）</h4><ul><li>写直通</li></ul><p>​当CPU执行store指令，在cache中命中时，既更新cache中数据也更新主存中的数据，保证数据一致性。</p><ul><li>写回</li></ul><p>​当CPU执行store指令并在cache命中时，我们只更新cache中的数据。并且每个cache line中会有一个bit位记录数据是否被修改过，称之为dirty bit。我们会将dirty bit置1。主存中的数据只会在cache line被替换或者显示的clean操作时更新。因此，主存中的数据可能是未修改的数据，而修改的数据躺在cache中。cache和主存的数据可能不一致。更新cacheline时，要根据dirty位，决定是否将数据写回内存。然后再进行其他操作。</p><ul><li><h5 id="dirty-bit"><a href="#dirty-bit" class="headerlink" title="dirty bit"></a>dirty bit</h5></li></ul><p>​在写回的更新策略中，cache命中，首先会更新cacheline的数据，导致内存和cache中数据不一致，当该cache line被替代时，将替换的数据写到内存中。dirty bit是标记要写回到内存的cache line。</p><p><strong>通常写分配和写回策略一起使用</strong></p><hr><h4 id="直接映射"><a href="#直接映射" class="headerlink" title="直接映射  "></a>直接映射  <img src="/2024/022542394/image-20240722104817022.png" alt="image-20240722104817022"></h4><p>优点：实现简单，运算组合逻辑延迟小。<br>缺点：hit rate较低，容易颠簸。</p><h4 id="两路组相连"><a href="#两路组相连" class="headerlink" title="两路组相连"></a>两路组相连</h4><p>将cache平均分成多份，每一份就是一路，两路组相连缓存就是将cache分为2份，每份32Bytes。一个index可以对应多个cacheline。</p><img src="/2024/022542394/image-20240225153918193.png" alt style="zoom: 33%;"><p>直接映射缓存每个地址只有一个cacheline的tag进行比较。</p><p>index也称为 组索引，相比于直接映射缓存，两路组相连映射缓存的index要少1bit，因为cache的个数少了一半，相当于一个addr地址对应于两个cacheline，然后通过tag比对两次，命中一个即cache命中。</p><p>优点：降低cache的颠簸可能性；<br>缺点：硬件成本高；</p><img src="/2024/022542394/image-20240722105457813.png" alt="image-20240722105457813" style="zoom:67%;"><h4 id="全相连"><a href="#全相连" class="headerlink" title="全相连"></a>全相连</h4><p>没有index，将addr的tag与所有的cacheline作比较。</p><p><img src="/2024/022542394/1665648129223.png" alt="img"></p><ul><li>一般TLB采用这种结构，size很小</li><li>缺点：面积、功耗代价很大。优点：很高的命中率，灵活性高。</li></ul><h4 id="替换策略"><a href="#替换策略" class="headerlink" title="替换策略"></a>替换策略</h4><p>替换发生在某个cache set中所有的cacheline都满了的情况。</p><ol><li><p><strong>LRU（Least Recently Used）</strong>最近最少使用替换算法</p><p>为每个cacheline设置一个使用次数计数部分，每当way被访问就累加1，计数值最小的就是要替换的cacheline。</p><p><img src="/2024/022542394/image-20240722134726409.png" alt="image-20240722134726409"></p><p>LRU指示最近最少使用的cacheline，MRU指示最近最多使用的cacheline。</p><p>当cacheline hit时，需要更改计数器的值，hit 的cacheline设置为0，低于hit cacheline的计数值加1。相当于设置了MRU的优先级。</p><p>当cacheline 没有hit时，需要替换cacheline，将最近最少使用的cacheline设置为替换后的cacheline，并将计数值设置为0，其他没有替换的cacheline都要加1。</p></li><li><p>随机替换</p></li><li><p>Round robin，first in first out</p></li></ol><h3 id="更新策略总结"><a href="#更新策略总结" class="headerlink" title="更新策略总结"></a>更新策略总结</h3><ul><li><strong>CPU读cache时</strong></li></ul><p>​若hit，CPU直接从cache读取数据即可<br>​若miss，<br>​Read allocate读分配：先从内存中读取数据到cache，再从cache中读数据。</p><ul><li><strong>CPU写cache时</strong></li></ul><p>​若hit，有两种处理方式<br>​Write thorough：把数据同时更新cache和内存中<br>​Write back ：先更新cacheline数据，设置dirty位，被替换时再通过flush方式写入内存</p><p>​若miss，有两种方式<br>​Write allocate：先把数据读取到cache中，更新该cacheline，被替换时再通过flush方式写入内存<br>​No Write allocate：只更新主存数据</p><h3 id="Multi-level-Caches"><a href="#Multi-level-Caches" class="headerlink" title="Multi-level Caches"></a>Multi-level Caches</h3><p><img src="/2024/022542394/image-20240722141434334.png" alt="image-20240722141434334"></p><p>Inclusive和Exclusive Cache</p><p><img src="/2024/022542394/image-20240722142442377.png" alt="image-20240722142442377"></p><p>inclusive cache中，L1的数据一定包含在L2中，当L1的cacheline被替换时，L2的数据也要替换掉。</p><p>exclusive cache中，L1数据被替换时，放在L2 Cache中。 </p><h3 id="Cache-Performance"><a href="#Cache-Performance" class="headerlink" title="Cache Performance"></a>Cache Performance</h3><p><strong>AMAT（Average memory access time）&#x3D; cache hit time + cache_miss_rate * cache_miss_latency；</strong></p><p><img src="/2024/022542394/image-20240722143323292.png" alt="image-20240722143323292"></p><p>降低cache miss rate方法：</p><p><img src="/2024/022542394/image-20240722143524701.png" alt="image-20240722143524701"></p><p>软件编译去减小miss rate</p><p><img src="/2024/022542394/image-20240722143848234.png" alt="image-20240722143848234"></p><p>降低hit time（tag look up+cache access）</p><p><strong>PIPT(Physically indexed and physically tagged cache)</strong></p><ul><li>hit time &#x3D; TLB latency + cache latency</li></ul><p><img src="/2024/022542394/image-20240722145855659.png" alt="image-20240722145855659"></p><p><strong>VIVT(Virtually indexed Virtually Tagged cache)</strong></p><p><img src="/2024/022542394/image-20240722150128840.png" alt="image-20240722150128840"></p><p><strong>VIPT(Virtuall indexed Physically tagged cache)</strong></p><p><img src="/2024/022542394/image-20240722150443695.png" alt="image-20240722150443695"></p><p>降低cache miss的延迟</p><p><img src="/2024/022542394/image-20240722151009627.png" alt="image-20240722151009627"></p><p><img src="/2024/022542394/image-20240722151228022.png" alt="image-20240722151228022"></p><h4 id="Prefetch"><a href="#Prefetch" class="headerlink" title="Prefetch"></a>Prefetch</h4><p><img src="/2024/022542394/image-20240722151309597.png" alt="image-20240722151309597"></p><h3 id="Cache-MESI"><a href="#Cache-MESI" class="headerlink" title="Cache MESI"></a>Cache MESI</h3><p><img src="/2024/022542394/image-20240722164009399.png" alt="image-20240722164009399"></p><p>将transition 序列串行化，通过interconnect network来实现，否则会有内存一致性问题。</p><p>MESI cache一致性协议是write-invalidate的。</p><p>保证cache一致性的提前是 <strong>写传播和事务串行化</strong>，写传播表示 在对某一个cacheline进行修改时，需要让其他核心的cache知道该修改。</p><p><img src="/2024/022542394/image-20240722164508794.png" alt="image-20240722164508794"></p><p><img src="/2024/022542394/image-20240722164553808.png" alt="image-20240722164553808"></p><p>系统里面只能有一个cacheline是modified</p><p> <img src="/2024/022542394/image-20240722164932903.png" alt="image-20240722164932903"></p><p>cacheline只存在当前cache里面，memory中其他cache里面没有。</p><p><img src="/2024/022542394/image-20240722165020653.png" alt="image-20240722165020653"></p><p>cacheline在多个cache里面都有。</p><p><img src="/2024/022542394/image-20240722165055916.png" alt="image-20240722165055916"></p><p><img src="/2024/022542394/image-20240722165352888.png" alt="image-20240722165352888"></p><p><img src="/2024/022542394/image-20240722170305260.png" alt="image-20240722170305260"></p><p><img src="/2024/022542394/image-20240722170448079.png" alt="image-20240722170448079"></p><p>软件可以配置将内存数据写入到Scratchpad Mmeory中。没有tag的比较，速度非常快，一个周期就可以得到数据。</p><h4 id="内存一致性和缓存一致性的区别"><a href="#内存一致性和缓存一致性的区别" class="headerlink" title="内存一致性和缓存一致性的区别"></a>内存一致性和缓存一致性的区别</h4><p>缓存一致性有两个角度，纵向：cache和内存中的数据不一致。横向：不同cache的同一个cacheline数据不一致。</p><p>内存一致性：从多个核心角度看待内存数据不一致，如果不同核心发出读写任务，且乱序，如果不做内存一致性处理，容易导致读写数据不一致的问题。</p>]]></content>
      
      
      <categories>
          
          <category> 体系结构 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 一生一芯 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AMBA2.0</title>
      <link href="/2024/022437262.html"/>
      <url>/2024/022437262.html</url>
      
        <content type="html"><![CDATA[<h2 id="AMBA协议"><a href="#AMBA协议" class="headerlink" title="AMBA协议"></a>AMBA协议</h2><p>AHB协议：高性能总线，支持多主机，数据位宽可到32,64,128bit<br>APB协议：接口简单，适合低功耗。</p><ul><li><p>AHB信号说明</p><p>HADDR：地址总线<br>HTRANS[1:0]：传输类型，00：IDLE，01：BUSY，10：NONSEQ，11：SEQ<br>HWRITE：读写使能，高写低读<br>HSIZE[2:0]：描述数据的位宽，协议允许最大1024bit<br>HBURST[2:0]：突发类型，支持单拍传输，4,8,16拍增量、回环传输，以及不定义长度增量传输。（比axi多了不定长传输，少了fixed传输）</p><p>HWDATA：写数据总线</p><p>HSELx：slave选择信号</p><p>HRDATA：读数据总线</p><p>HREADY：传输完成信号，表示总线上的传输已经完成。</p><p>HRESEP：传输响应信号</p></li><li><p>仲裁信号</p><p>HBUSREQx：总线请求信号，master发出，最多16个master<br>HGRANTx：仲裁器发出，目前优先级最高的主机拉高。需要等待当前占用总线的slave传输完成，hready拉高且优先级最高的hgrantx拉高时，才会真正的切换总线 <strong>地址和控制信号</strong> 的所有权。<br>HMASTER[3:0]：仲裁器发出，表示当前哪个master正在占用总线；</p></li><li><p>APB信号</p><p>PADDR：APB地址总线<br>PSELx：从机选择信号<br>PENABLE：APB选通信号<br>PWRITE：读写使能信号，高写低读<br>PRDATA：读数据总线<br>PWDATA：写数据总线</p></li></ul><p><strong>等待状态的传输</strong></p><p>第一个地址周期，必须是从机的HREADY拉高，从机才可以采样到相应的地址和控制信息。后面的数据周期，同样需要从机HREADY拉高时才可以进行下面的操作。</p><img src="/2024/022437262/image-20240224173637302.png" alt="image-20240224173637302" style="zoom: 33%;"><p><strong>多重操作</strong></p><p>整个传输类似两级流水线，第一拍地址，第二拍数据。</p><img src="/2024/022437262/image-20240224174126020.png" alt="image-20240224174126020" style="zoom: 33%;"><ul><li><p><strong>AHB协议中最重要的两个信号：hreadyout和htrans</strong></p><p>隐含握手信号，htrans表示master输出数据的有效性，hreadyout表示slave准备好接收数据。类似axi4的valid和ready。</p><p>htrans：Busy是由于master没准备好，又想要占用总线而插在一个burst中的状态，如果采用了Idle，总线会重新仲裁，master对总线的占用权发生了变化（CPU中可能会出现）；Idle是插在两个burst之间，用来区分两次不同传输。</p></li><li><p>窄传输和宽传输</p><p>窄传输：从机的数据总线位宽 小于 主机的数据总线位宽，需要一定的外部逻辑就可以实现。比如64-&gt;32，通过地址的倒数第3bit选择高32bit还是低32bit给从机数据端口。</p><img src="/2024/022437262/image-20240224185833222.png" alt="image-20240224185833222" style="zoom: 33%;"><p>宽传输：从机的数据总线位宽 大于 主机的数据总线位宽。</p></li></ul><img src="/2024/022437262/image-20240224185855431.png" alt="image-20240224185855431" style="zoom:33%;"><ul><li><p>APB传输协议</p><img src="/2024/022437262/image-20240224191638563.png" alt style="zoom: 33%;"><img src="/2024/022437262/image-20240224192445131.png" style="zoom: 33%;"><img src="/2024/022437262/image-20240224192637732.png" alt="image-20240224192637732" style="zoom:33%;"><p>向apb的slave写数据，过程：首先向bridge写入地址和数据，需要两拍，然后继续向apb的从机写入数据，经过SetUp和Enable状态写入。</p><p>2.0协议中规定apb的slave没有响应信号。</p><p>为什么bridge的第一个写操作后需要等待一个周期，是因为ahb是pipline的，wdata的数据不能和setup同时到达，需要等待一个周期才可，如果是连续的写操作，则不需要这个等待状态。连续写操作不需要等待状态，是因为中间的缓存reg状态已经充满地址了，不需要等待一个周期了。</p></li><li><p>Retry和Split的区别</p><p>Retry和split都是ahb的slave在不能及时响应时发起的，retry后，不会影响此次master的优先级，并且会从头传输上次未传输完成的数据，split后，会影响master的优先级，并且会降低master的优先级，等待split的slave向arbiter发起准备好继续传输后，恢复master的优先级，重要的是恢复后的传输会从的split发生的位置继续传输，而不是从头传输。（在常见的soc系统中，slave的这两种传输一般不会发生）</p></li><li><p>数据和地址对齐</p><p>在APB中，地址和数据位宽是对齐的，如果PRDATA位宽是32bit，则PADDR[1:0]&#x3D;0，AHB中也有此要求，例如HSIZE&#x3D;1时，HADDR[0]&#x3D;0，HSIZE&#x3D;2时，HADDR[1:0] &#x3D; 0；HSIZE&#x3D;3时，HADDR[2:0] &#x3D; 0，以此类推。</p><p>AHB数据位宽最大多少 1024位，APB是32位最大位宽</p></li><li><p>地址越界</p><p>AXI系统中，slave地址空间一般为4KB的整数倍，如果burst传输地址范围超过了4kB就会传输错误。0x01000&#x3D;4KB<br>AHB系统中，salve地址空间一般为1KB的整数倍，如果burst传输地址范围超过了1kB就会传输错误。0x0400 &#x3D; 1KB<br>如果burst超过了4&#x2F;1KB边界，就要重新发起burst传输或者采用其他方式，取决于master行为。</p></li><li><p>AHB总线传输过程中的ERROR分析：</p><img src="/2024/022437262/image-20240224234749434.png" style="zoom: 67%;"><p>在error的倒数第二个周期hready需要拉低，表示不能再接收新的传输了（因为数据A传输过程中出现错误了），最后一个error周期，hready拉高了，（为什么拉高，因为IDLE状态下，不进行数据传输，hready就应该拉高，这是为了和复位时的状态保持一致吧），但是这个时候恢复到了IDLE状态，B的地址还是不能进行传输的，因为只有NONSEQ和SEQ才能进行地址的传输。进而保证了地址B不能进行有效传输。</p></li><li><p>还有一个原因是因为流水线的缘故，T3时刻的地址B已经传到总线上了，这也是为了防止在T3-T4周期，进行无效的数据B传输，所以需要设置为IDLE，而且一定要延迟这一拍，允许主机****有足够的的时间来取消地址B的传输****。（也就是说把地址B从总线上撤下来，或者说起到一个流水线冲刷的作用）</p></li></ul><p><img src="/2024/022437262/wps8.jpg" alt="img"> </p><p>​ERROR传输的两个周期中，第一个周期的hready是拉低的。</p><p>​ERROR的第二个周期，htrans是IDLE的，这种打断在AHB协议上是可以的，但是axi不支持</p><p>​ERROR传输的应用场景：译码错误，当master访问slave不存在的地址时。</p><ul><li>突发传输终止</li></ul><p>​AHB允许打断突发传输，场景：在传输过程中，仲裁器改变了HGRANT信号，或者slave在传输过程中发出ERROR的响应。</p><p>​AXI中不允许打断突发传输，需要等待传输完成。</p><ul><li>等待传输</li></ul><p>​salve可以通过hreadyout拉低打断传输，master可以通过设置htrans为busy打断传输。如果hready拉低时，htrans有效，此时不可以更改总线的地址和传输类型，需要等到hreadyout拉高时才可以修改。</p><img src="/2024/022437262/640.png" alt="图片" style="zoom: 67%;"><p>针对定长的传输，如果hreadyout拉低，此时master的htrans为busy，允许trans更改为seq，且地址和传输类型不能更改。针对不定长的传输INCR，允许master在hreadyout为0时更改为其他类型的传输，如果为SEQ，表示继续传输当前的任务，如果为NOSEQ，表示开始新的任务。</p><img src="/2024/022437262/640-1717253953042-3.png" alt="图片" style="zoom:67%;"><p>AHB Lite和AHB协议的区别</p><ol><li>AHB Lite没有仲裁器，只有一个master</li><li>数据位宽 最大32bits</li><li>没有retry和split机制</li></ol><p>AHB resp信号</p><ol><li>OKAY</li><li>ERROR</li><li>RETRY：不需要改变仲裁优先级，重新传输。</li><li>SPLIT：改变优先级，其他的master先进行传输。</li></ol><h4 id="背靠背传输"><a href="#背靠背传输" class="headerlink" title="背靠背传输"></a>背靠背传输</h4><p>ahb2apb bridge中，背靠背传输的读操作的enable状态，hreadyout拉低原因</p><p>写操作需要缓存一拍写地址，将地址和数据对齐，一起放在APB总线上。</p><p>读操作直接将AHB的地址放在 APB总线上，不需要缓冲。</p><p><strong>为了满足协议的要求，在背靠背传输中，在第一次写操作的数据阶段，将读地址缓冲了一拍存到了寄存器中，因此在第一次写操作完成的时候需要优先消化完缓冲的读地址，在enable状态将hreadyout信号拉低</strong></p><p><img src="/2024/022437262/image-20240817190345425.png" alt="image-20240817190345425"></p>]]></content>
      
      
      <categories>
          
          <category> 数字前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 总线协议 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C基础</title>
      <link href="/2024/02248418.html"/>
      <url>/2024/02248418.html</url>
      
        <content type="html"><![CDATA[<h2 id="指针"><a href="#指针" class="headerlink" title="指针"></a>指针</h2><ul><li>堆栈</li></ul><p>stack堆是操作系统在编译时分配的，有一定的限制，是个定值；<br>heap栈是动态内存，由编程者自行决定；</p><img src="/2024/02248418/wps3.jpg" style="zoom:50%;"><p>eg. 存在函数返回值为指针时，由于返回的是地址，当stack内存被覆盖时，会引起读取数据错误，所以在返回值的地方要申请一块heap内存.</p><img src="/2024/02248418/wps4.jpg" style="zoom:50%;"><p>函数返回值为局部变量时，需要将变量设置为static静态变量，因为执行玩该函数,就会释放内存。如果返回值的是一个地址，那么后面再使用到该地址可能就不对了，因为他已经释放掉了。（static int *Add(int*a, int*b) ）</p><ul><li><p>内存泄露</p><p>内存泄漏指的是申请的动态内存heap，使用结束后没有释放，导致内存不足。</p></li></ul><h3 id="变量指针"><a href="#变量指针" class="headerlink" title="变量指针"></a>变量指针</h3><img src="/2024/02248418/wps1.jpg" style="zoom:50%;"><img src="/2024/02248418/wps2.jpg" alt="img" style="zoom:50%;"><pre class=" language-c"><code class="language-c"><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>c<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//只允许读，不允许写</span></code></pre><h3 id="函数指针"><a href="#函数指针" class="headerlink" title="函数指针"></a>函数指针</h3><pre class=" language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">*</span> b<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token operator">*</span>a <span class="token operator">+</span> <span class="token operator">*</span>b<span class="token punctuation">;</span>    <span class="token keyword">return</span> c<span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>p<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> sum<span class="token punctuation">;</span>    p <span class="token operator">=</span> <span class="token operator">&amp;</span>add<span class="token punctuation">;</span>    sum <span class="token operator">=</span> <span class="token function">p</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>a<span class="token punctuation">,</span><span class="token operator">&amp;</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"sum = %d\n"</span><span class="token punctuation">,</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span></code></pre><h2 id="static-extern关键字"><a href="#static-extern关键字" class="headerlink" title="static&#x2F;extern关键字"></a>static&#x2F;extern关键字</h2><p>Static可以用来修饰局部变量，保证在规定范围内，变量一直有效；</p><pre class=" language-C"><code class="language-C">#include<stdio.h>void test()&#123;    Static int a = 1;    a++;    printf("%d ", a);&#125;int main(void)&#123;    int i = 0;    while (i <= 10)    &#123;        test();        i++;    &#125;    return 0;&#125;// a的值只在函数内有效// Static修饰局部变量，修改了变量的生命周期，本质上改变了变量的存储范围，变成了静态存储区</code></pre><img src="/2024/02248418/wps6.png" alt="img" style="zoom:50%;"><h3 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h3><p>Static修饰全局变量时，其他文件不可以访问该变量。<br>Extern声明的函数和变量，可以被其他文件访问。</p><img src="/2024/02248418/wps7.jpg" alt style="zoom: 67%;"><h2 id="全局结构体变量定义"><a href="#全局结构体变量定义" class="headerlink" title="全局结构体变量定义"></a>全局结构体变量定义</h2><p>​结构体是一种变量类型，最好方式是在.h文件定义，其他地方想用这个结构体，只需包含此.h文件即可，但是定义结构体变量的话，最好在.c文件定义，然后.h里面extern声明，其他.c文件想用只需包含.h文件即可。（为了防止重复定义，所以不建议在.h文件中直接定义变量）</p><pre class=" language-C"><code class="language-C">// a.ctemptype temp1,temp2,temp3;// 必须在函数里面使用才可以// a.htypedef struct &#123;    u8 disp_int;        //整数部分    u8 disp_flo;        //小数部分    u8 disp_flag;       //符号部分&#125;temptype; extern temptype temp1,temp2,temp3;// extern是一种“外部声明”的关键字，字面意思就是在此处声明某种变量或函数，在外部定义。// b.c#include “a.h”u8 data;data = temp1.disp_int;</code></pre><p>函数 extern &#x2F;&#x2F;不使用include</p><pre class=" language-C"><code class="language-C">a.c //定义extern int fun(int a, int b)&#123;    return a + b;&#125;b.c //声明#include<stdio.h>extern int fun(int a, int b);int main()&#123;    int result = fun(1, 3);    return 0;&#125;</code></pre><h2 id="ELF文件解析"><a href="#ELF文件解析" class="headerlink" title="ELF文件解析"></a>ELF文件解析</h2><p>程序中的段和节是真正的程序体，段包括代码段和数据段，多个节经过链接合并成一个段</p><p>段和节的信息都是通过header描述的，程序头是program header， 节头是section header；<br>段和节的大小都是不固定的，需要专门的数据结构来描述，即程序头表（program header table）和节头表（section header table）<br>这是两个数组，程序头表的元素全是程序头，节头表的元素全是节头。<br>程序头表是描述段的。</p><pre class=" language-c"><code class="language-c"><span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">get_syscall_name</span><span class="token punctuation">(</span>uintptr_t type<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>  <span class="token keyword">static</span> <span class="token keyword">char</span> name<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">switch</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> SYS_exit  <span class="token punctuation">:</span> <span class="token function">strcpy</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">"SYS_exit"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> SYS_gettimeofday<span class="token punctuation">:</span><span class="token function">strcpy</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">"SYS_gettimeofday"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">"Unhandled syscall"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> name<span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span></code></pre><p>program break 是用户程序的数据段data segment结束的位置，链接的时候ld会默认添加一个名为_end的符号，指示程序的数据段结束位置。用户程序开始运行的时候, program break会位于_end所指示的位置, 意味着此时堆区的大小为0<br>通过访问end的地址即可得到program break，用户程序申请内存时，需要将递增后的program break作为地址传给系统调用，然后返回原来的program地址，供程序使用。</p><h3 id="C语言语法"><a href="#C语言语法" class="headerlink" title="C语言语法"></a>C语言语法</h3><h4 id="define"><a href="#define" class="headerlink" title="#define"></a>#define</h4><p><code>##(预处理器粘合剂)</code>：表示连接作用，比如，#define CON(x,y) x##y，表示 x和y接在一起<br><code>变参宏</code> ：比如 #define PR(…)  printf(_<em>VA_ARGS</em>_)</p><h4 id="位结构体"><a href="#位结构体" class="headerlink" title="位结构体"></a>位结构体</h4><p>​实现C中变量长度截断+符号位扩展，code如下</p><pre class=" language-C"><code class="language-C">#define SEXT(x, len) (&#123; struct &#123; int64_t n : len; &#125; __x = &#123; .n = x &#125;; (uint64_t)__x.n; &#125;)#define SEXT(x, len) (&#123;   struct &#123;     int64_t n : len;   &#125; __x = &#123;     .n = x   &#125;;   (uint64_t)__x.n; &#125;)</code></pre><p>可以整理成下面的形式进行分析，首先采用宏定义的形式，#define 关键一句在于‘int64_t n : len 表示只取n的后len位，对应于verilog变量的[len-1:0]位.<br>通过‘(uint64_t)__x.n; ，将len位的数据进行符号位扩展，符号位为n[len-1]的数据。</p><blockquote><p> 如果不采用这种方式进行符号位扩展的话，就会按照最高位为1的进行扩展，得到所有高位都是1，这种并不是我们想要的，比如一个10为的二进制数据：0010010101，扩展成16位，就会得到1111111110010101。这种不是我们要的结果。<br>如果按照上文提供的位结构体实现，就会得到0000000010010101，这才是我们想要的结果。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 软件编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C/C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一生一芯-乘除法器设计</title>
      <link href="/2024/022240394.html"/>
      <url>/2024/022240394.html</url>
      
        <content type="html"><![CDATA[<h2 id="乘法器设计"><a href="#乘法器设计" class="headerlink" title="乘法器设计"></a>乘法器设计</h2><p>本设计采用基于4 Booth和华莱士树乘法器相结合的方式实现乘法；<br>一般乘法运算采用移位累加的方式实现，当乘法位数较大时，组合逻辑很大，且中间结果不易插入寄存器。在本设计的乘法中，<strong>Booth算法减小了部分积的个数，华莱士树算法提高了计算累加和的速度，且可以在中间插入寄存器，进一步提高主频和数据吞吐量</strong></p><h4 id="Booth算法"><a href="#Booth算法" class="headerlink" title="Booth算法"></a>Booth算法</h4><h5 id="booth乘法算法的条件"><a href="#booth乘法算法的条件" class="headerlink" title="booth乘法算法的条件"></a>booth乘法算法的条件</h5><ol><li>乘数和被乘数都是偶数，如果不是需要扩展符号位</li><li>补码运算，如果想要实现无符号数运算，需要在乘数和被乘数前面扩展两个0，然后按照补码运算</li></ol><p>编码的计算需要将乘数后面补0，一次完整的乘法共有N&#x2F;2个码元</p><img src="/2024/022240394/Booth_multiplication with shifter.png" alt="使用移位加实现Booth乘法" style="zoom: 33%;"><h5 id="key-point"><a href="#key-point" class="headerlink" title="key point"></a>key point</h5><ul><li><p>扩展符号位成偶数时，需要根据有无符号位进行扩展，如果是无符号，扩展0，如果有符号位，扩展符号位</p></li><li><p>在进行部分积累加中，每个cycle需要将累加寄存器右移两位，为的是对齐，得到真实的部分和，在下次加法时，保证是对齐的</p></li><li><p>在累加器右移过程中，需要扩展两位符号位，因为右移了2位，在下次操作时就要用到这两位符号位</p></li><li><p>booth两位运算规则</p></li></ul><table><thead><tr><th>yi+1</th><th>yi</th><th>yi-1</th><th>操作</th></tr></thead><tbody><tr><td>0</td><td>0</td><td>0</td><td>+0</td></tr><tr><td>0</td><td>0</td><td>1</td><td>+X补</td></tr><tr><td>0</td><td>1</td><td>0</td><td>+X补</td></tr><tr><td>0</td><td>1</td><td>1</td><td>+2X补</td></tr><tr><td>1</td><td>0</td><td>0</td><td>-2X补</td></tr><tr><td>1</td><td>0</td><td>1</td><td>-X补</td></tr><tr><td>1</td><td>1</td><td>0</td><td>-X补</td></tr><tr><td>1</td><td>1</td><td>1</td><td>+0</td></tr></tbody></table><p>本设计中乘法运算为 64bit * 64bit，booth算法本身是带符号的补码运算，如果要兼容无符号运算，需要在符号位前面扩展1bit，但是算法又规定乘数和被乘数都是偶数，所以还需要扩展1bit 符号位0，总共扩展2bit，exp_B为(66+1)bit，代码如下</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">assign</span> exp_B <span class="token operator">=</span> <span class="token operator">&#123;</span><span class="token number">1'b0</span><span class="token punctuation">,</span> unsigned_flag<span class="token punctuation">,</span> B<span class="token punctuation">,</span> <span class="token number">1'b0</span><span class="token operator">&#125;</span><span class="token punctuation">;</span><span class="token comment">// 最后补0是必须的，unsigned_flag = 1 => 表示无符号运算</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>按照有符号补码运算，64bit的乘数，产生32个部分积；考虑无符号运算，还需要产生一个部分积，该部分积的产生规则如下：</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token keyword">case</span> <span class="token punctuation">(</span>y<span class="token punctuation">)</span>    <span class="token number">3'b000</span><span class="token punctuation">,</span> <span class="token number">3'b111</span><span class="token punctuation">,</span> <span class="token number">3'b001</span> <span class="token punctuation">:</span>   P <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>         <span class="token number">3'b010</span> <span class="token punctuation">:</span> <span class="token function">if</span><span class="token punctuation">(</span>unsigned_flag<span class="token punctuation">)</span> P <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                <span class="token keyword">else</span>   P <span class="token operator">=</span> X<span class="token punctuation">;</span>    <span class="token number">3'b110</span><span class="token punctuation">,</span> <span class="token number">3'b101</span> <span class="token punctuation">:</span> P <span class="token operator">=</span> <span class="token operator">~</span>X <span class="token operator">+</span> <span class="token number">1'b1</span><span class="token punctuation">;</span>                                 <span class="token number">3'b011</span> <span class="token punctuation">:</span> <span class="token function">if</span><span class="token punctuation">(</span>unsigned_flag<span class="token punctuation">)</span> P <span class="token operator">=</span> X<span class="token punctuation">;</span>            <span class="token keyword">else</span> P <span class="token operator">=</span> X <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token number">3'b100</span> <span class="token punctuation">:</span> P <span class="token operator">=</span> <span class="token operator">~</span><span class="token punctuation">(</span>X <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1'b1</span><span class="token punctuation">;</span>                                               <span class="token keyword">endcase</span><span class="token keyword">end</span><span class="token comment">// 无符号数运算，如果乘数的最高位为0，部分积为0；如果乘数的最高位为1，部分积为被乘数</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>最后，将部分积进行移位累加即可（每次累加和 移位2bit）</strong></p><h4 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h4><pre class="line-numbers language-none"><code class="language-none">原码+补码&#x3D;模;负数+模&#x3D;补码;   -2的原码4’b1010, 补码为-2+16&#x3D;14(4&#39;b1110)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>在verilog中的算术右移操作<code>&gt;&gt;&gt;</code>需要声明要移位的变量为<code>signed</code>类型。</p><h3 id="华莱士树算法"><a href="#华莱士树算法" class="headerlink" title="华莱士树算法"></a>华莱士树算法</h3><p><strong>本质是</strong> <strong>对累加的各个部分积进行压缩，最终压缩到单个C和S，通过加法器计算得到结果</strong></p><h4 id="进位保存加法器"><a href="#进位保存加法器" class="headerlink" title="进位保存加法器"></a><strong>进位保存加法器</strong></h4><ul><li>CAS （carry save adder）</li></ul><p>基本思想：将3个加数和减少为2个加数的和，将进位C和结果S分别计算保存，每个比特可以独立计算C和S，速度极快，一位的全加器相当于进位保留加法器 &#x3D;&gt; 3:2 压缩器。</p><p>比如一个算式如：Sum &#x3D; A + B + C + D，可以设计N bit的CAS结构，将多个数合并，经过两级CSA，最后将进位C[N-1:0]和Sum[N-1:0]通过一个加法器相加（<strong>注意将进位传给下面的CAS计算时，需要将C左移一位</strong>），得到最终结果。</p><img src="/2024/022240394/2.8_walloc_tree.4b50192e.png" alt style="zoom: 67%;"><p>上图是17bit的华莱士树，因为进位和输出结果都是同一个方向的，所以可以在每层之间插入寄存器打拍，提高主频。</p><p>相同bit的华莱士树有多种实现方式，如下图所示</p><img src="/2024/022240394/WORONG_exaxple of walllace tree.png" alt="两种错误的8个数相加的一位华莱士树" style="zoom: 33%;"><p>完成的功能相同，但是两者之间存在区别。<strong>关键点在于延迟</strong>，假设每个CSA部件的延迟为1，左面结构的结果延迟为5，右面为4。左面结构插入寄存器时，就会导致结果错误。</p><img src="/2024/022240394/image-20230811215003860.png" alt style="zoom: 33%;"><p>在设计华莱士树时，<strong>保证华莱士树的数据流是单向的，不会在该层之前进行操作，比如左图的进位C3，导致整个数据流发生了交叠</strong>。</p><h3 id="Booth算法×华莱士树算法"><a href="#Booth算法×华莱士树算法" class="headerlink" title="Booth算法×华莱士树算法"></a>Booth算法×华莱士树算法</h3><p>32位的乘法器结构如下，其中Switch模块完成将booth模块输出的结果打一拍，避免组合逻辑的延迟较长。</p><img src="/2024/022240394/image-20240222231842246.png" alt style="zoom: 33%;"><p>其中，booth输出的部分积，需要进行移位加才能进入到CSA模块中。代码如下</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token comment">// phase 1</span><span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">67</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> S0_1<span class="token punctuation">,</span> S1_1<span class="token punctuation">,</span> S2_1<span class="token punctuation">,</span> S3_1<span class="token punctuation">,</span> S4_1<span class="token punctuation">;</span><span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">67</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> C0_1<span class="token punctuation">,</span> C1_1<span class="token punctuation">,</span> C2_1<span class="token punctuation">,</span> C3_1<span class="token punctuation">,</span> C4_1<span class="token punctuation">;</span>CSA #<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">WIDTH</span><span class="token punctuation">(</span><span class="token number">68</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">csa1</span><span class="token punctuation">(</span>in0<span class="token punctuation">,</span> in1<span class="token operator">&lt;&lt;</span><span class="token number">2</span><span class="token punctuation">,</span> in2<span class="token operator">&lt;&lt;</span><span class="token number">4</span><span class="token punctuation">,</span> S0_1<span class="token punctuation">,</span> C0_1<span class="token punctuation">)</span><span class="token punctuation">;</span>CSA #<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">WIDTH</span><span class="token punctuation">(</span><span class="token number">68</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">csa2</span><span class="token punctuation">(</span>in3<span class="token operator">&lt;&lt;</span><span class="token number">6</span><span class="token punctuation">,</span> in4<span class="token operator">&lt;&lt;</span><span class="token number">8</span><span class="token punctuation">,</span> in5<span class="token operator">&lt;&lt;</span><span class="token number">10</span><span class="token punctuation">,</span> S1_1<span class="token punctuation">,</span> C1_1<span class="token punctuation">)</span><span class="token punctuation">;</span>CSA #<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">WIDTH</span><span class="token punctuation">(</span><span class="token number">68</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">csa3</span><span class="token punctuation">(</span>in6<span class="token operator">&lt;&lt;</span><span class="token number">12</span><span class="token punctuation">,</span> in7<span class="token operator">&lt;&lt;</span><span class="token number">14</span><span class="token punctuation">,</span> in8<span class="token operator">&lt;&lt;</span><span class="token number">16</span><span class="token punctuation">,</span> S2_1<span class="token punctuation">,</span> C2_1<span class="token punctuation">)</span><span class="token punctuation">;</span>CSA #<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">WIDTH</span><span class="token punctuation">(</span><span class="token number">68</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">csa4</span><span class="token punctuation">(</span>in9<span class="token operator">&lt;&lt;</span><span class="token number">18</span><span class="token punctuation">,</span> in10<span class="token operator">&lt;&lt;</span><span class="token number">20</span><span class="token punctuation">,</span> in11<span class="token operator">&lt;&lt;</span><span class="token number">22</span><span class="token punctuation">,</span> S3_1<span class="token punctuation">,</span> C3_1<span class="token punctuation">)</span><span class="token punctuation">;</span>CSA #<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">WIDTH</span><span class="token punctuation">(</span><span class="token number">68</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">csa5</span><span class="token punctuation">(</span>in12<span class="token operator">&lt;&lt;</span><span class="token number">24</span><span class="token punctuation">,</span> in13<span class="token operator">&lt;&lt;</span><span class="token number">26</span><span class="token punctuation">,</span> in14<span class="token operator">&lt;&lt;</span><span class="token number">28</span><span class="token punctuation">,</span> S4_1<span class="token punctuation">,</span> C4_1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// phase 2</span><span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">67</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> C0_2<span class="token punctuation">,</span> C1_2<span class="token punctuation">,</span> C2_2<span class="token punctuation">,</span> C3_2<span class="token punctuation">;</span><span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">67</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> S0_2<span class="token punctuation">,</span> S1_2<span class="token punctuation">,</span> S2_2<span class="token punctuation">,</span> S3_2<span class="token punctuation">;</span>CSA #<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">WIDTH</span><span class="token punctuation">(</span><span class="token number">68</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">csa6</span><span class="token punctuation">(</span>S0_1<span class="token punctuation">,</span> S1_1<span class="token punctuation">,</span> S2_1<span class="token punctuation">,</span> S0_2<span class="token punctuation">,</span> C0_2<span class="token punctuation">)</span><span class="token punctuation">;</span>CSA #<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">WIDTH</span><span class="token punctuation">(</span><span class="token number">68</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">csa7</span><span class="token punctuation">(</span>S3_1<span class="token punctuation">,</span> S4_1<span class="token punctuation">,</span> in15<span class="token operator">&lt;&lt;</span><span class="token number">30</span><span class="token punctuation">,</span> S1_2<span class="token punctuation">,</span> C1_2<span class="token punctuation">)</span><span class="token punctuation">;</span>CSA #<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">WIDTH</span><span class="token punctuation">(</span><span class="token number">68</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">csa8</span><span class="token punctuation">(</span><span class="token punctuation">(</span>C0_1 <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>C1_1 <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>C2_1 <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> S2_2<span class="token punctuation">,</span> C2_2<span class="token punctuation">)</span><span class="token punctuation">;</span>CSA #<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">WIDTH</span><span class="token punctuation">(</span><span class="token number">68</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">csa9</span><span class="token punctuation">(</span><span class="token punctuation">(</span>C3_1 <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>C4_1 <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> in16<span class="token operator">&lt;&lt;</span><span class="token number">32</span><span class="token punctuation">,</span> S3_2<span class="token punctuation">,</span> C3_2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// phase 3</span><span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">67</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> S0_3<span class="token punctuation">,</span> C0_3<span class="token punctuation">;</span><span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">67</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> S1_3<span class="token punctuation">,</span> C1_3<span class="token punctuation">;</span>CSA #<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">WIDTH</span><span class="token punctuation">(</span><span class="token number">68</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">csa10</span><span class="token punctuation">(</span>S0_2<span class="token punctuation">,</span> S1_2<span class="token punctuation">,</span> S2_2<span class="token punctuation">,</span> S0_3<span class="token punctuation">,</span> C0_3<span class="token punctuation">)</span><span class="token punctuation">;</span>CSA #<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">WIDTH</span><span class="token punctuation">(</span><span class="token number">68</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">csa11</span><span class="token punctuation">(</span>S3_2<span class="token punctuation">,</span> <span class="token punctuation">(</span>C0_2 <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>C1_2 <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> S1_3<span class="token punctuation">,</span> C1_3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// phase 4</span><span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">67</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> S0_4<span class="token punctuation">,</span> C0_4<span class="token punctuation">;</span><span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">67</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> S1_4<span class="token punctuation">,</span> C1_4<span class="token punctuation">;</span>CSA #<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">WIDTH</span><span class="token punctuation">(</span><span class="token number">68</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">csa12</span><span class="token punctuation">(</span>S0_3<span class="token punctuation">,</span> S1_3<span class="token punctuation">,</span> <span class="token punctuation">(</span>C0_3 <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> S0_4<span class="token punctuation">,</span> C0_4<span class="token punctuation">)</span><span class="token punctuation">;</span>CSA #<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">WIDTH</span><span class="token punctuation">(</span><span class="token number">68</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">csa13</span><span class="token punctuation">(</span><span class="token punctuation">(</span>C2_2 <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>C3_2 <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>C1_3 <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> S1_4<span class="token punctuation">,</span> C1_4<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// phase 5</span><span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">67</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> S0_5<span class="token punctuation">,</span> C0_5<span class="token punctuation">;</span>CSA #<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">WIDTH</span><span class="token punctuation">(</span><span class="token number">68</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">csa14</span><span class="token punctuation">(</span>S0_4<span class="token punctuation">,</span> S1_4<span class="token punctuation">,</span> <span class="token punctuation">(</span>C0_4 <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> S0_5<span class="token punctuation">,</span> C0_5<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// phase 6</span>CSA #<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">WIDTH</span><span class="token punctuation">(</span><span class="token number">68</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">csa15</span><span class="token punctuation">(</span>S0_5<span class="token punctuation">,</span> <span class="token punctuation">(</span>C0_5 <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>C1_4 <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> S<span class="token punctuation">,</span> C<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">assign</span> OUT <span class="token operator">=</span> S <span class="token operator">+</span> <span class="token punctuation">(</span>C <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="除法器设计"><a href="#除法器设计" class="headerlink" title="除法器设计"></a>除法器设计</h2><p>被除数Dividend &#x2F; 除数Divisor &#x3D; 商Quotient ······ 余数Remainder</p><p>简单的迭代除法是 <strong>试商法</strong>，迭代过程中，如果不够减，商0，根据是否恢复余数，分为恢复余数法（循环减法）、不恢复余数法（加减交替）。</p><p><strong>区别</strong>：逐位计算商的时候，不够减商0；如果是恢复余数算法，需要将余数加上除数；如果是不恢复余数算法，不需要加上余数，在下个周期时加上除数。</p><h3 id="恢复余数法"><a href="#恢复余数法" class="headerlink" title="恢复余数法"></a>恢复余数法</h3><p>64bit 绝对值 恢复余数除法运算结构如下</p><img src="/2024/022240394/image-20240223154401784.png" alt style="zoom:50%;"><p>优点：面积小，节省资源。缺点：速度慢</p><p>计算过程：被除数前面补64个0，记为A，除数为B，每个周期执行减法运算，判断ALU输出的符号，如果为负，寄存器A左移1bit且右面补0，不需要将ALU结果写入寄存器A；如果为正，寄存器A左移1bit，右面补1，将ALU计算结果写入寄存器A的高64位；以此类推，经过64个周期，从寄存器A中得到商和余数。最终，根据是否是 有符号计算，对输出结果进行处理。</p><p>其中，ALU采用补码进行减法运算。**[X - Y]补 &#x3D; [X]补 + [-Y]补**，  <strong>[-Y]补 &#x3D; [Y]补码 取反 + 1</strong></p><p>如果要同时支持无符号和有符号除法运算，需要对输入的数据进行预处理。根据被除数和除数的符号，决定 <strong>商和余数的符号</strong>；将有符号除法转换成无符号除法。</p><table><thead><tr><th align="center">被除数</th><th>除数</th><th>商</th><th>余数</th></tr></thead><tbody><tr><td align="center">正</td><td>正</td><td>正</td><td>正</td></tr><tr><td align="center">正</td><td>负</td><td>负</td><td>正</td></tr><tr><td align="center">负</td><td>正</td><td>负</td><td>负</td></tr><tr><td align="center">负</td><td>负</td><td>正</td><td>负</td></tr></tbody></table><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">assign</span> dividend_unsigned <span class="token operator">=</span> signed_flag <span class="token operator">?</span>                            dividend<span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">]</span> <span class="token operator">?</span>                           <span class="token operator">&#123;</span><span class="token number">1'b0</span><span class="token punctuation">,</span><span class="token operator">&#123;</span><span class="token punctuation">(</span><span class="token operator">~</span>dividend<span class="token punctuation">[</span><span class="token number">62</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">&#125;&#125;</span> <span class="token punctuation">:</span> dividend                            <span class="token punctuation">:</span> dividend<span class="token punctuation">;</span><span class="token keyword">assign</span> divisor_unsigned <span class="token operator">=</span> signed_flag <span class="token operator">?</span>                           divisor<span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">]</span> <span class="token operator">?</span>                          <span class="token operator">&#123;</span><span class="token number">1'b0</span><span class="token punctuation">,</span><span class="token operator">&#123;</span><span class="token punctuation">(</span><span class="token operator">~</span>divisor<span class="token punctuation">[</span><span class="token number">62</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">&#125;&#125;</span> <span class="token punctuation">:</span> divisor                          <span class="token punctuation">:</span> divisor<span class="token punctuation">;</span><span class="token keyword">assign</span> merchant   <span class="token operator">=</span> signed_flag <span class="token operator">?</span>                     <span class="token punctuation">(</span>dividend<span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">]</span> <span class="token operator">^</span> divisor<span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span>                    <span class="token operator">-</span>merchant_t <span class="token punctuation">:</span> merchant_t                    <span class="token punctuation">:</span> merchant_t<span class="token punctuation">;</span><span class="token comment">//最后一次商结果作为最终的商</span><span class="token keyword">assign</span> remainder  <span class="token operator">=</span> signed_flag <span class="token operator">?</span>                     dividend<span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">]</span> <span class="token operator">?</span>                     <span class="token operator">-</span>remainder_t <span class="token punctuation">:</span> remainder_t                    <span class="token punctuation">:</span> remainder_t<span class="token punctuation">;</span> <span class="token comment">//最后一次余数作为最终的余数</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="乘除法器-接入流水线CPU"><a href="#乘除法器-接入流水线CPU" class="headerlink" title="乘除法器 接入流水线CPU"></a>乘除法器 接入流水线CPU</h2><p>乘除法器都是多个周期才出结果，因此，需要握手信号。当乘除法指令到执行阶段时，Div&#x2F;Mul模块发出stall信号，等待valid和ready信号握手，输出计算结果，撤销stall信号，继续执行后续指令。</p><img src="/2024/022240394/image-20240222232209980.png" alt style="zoom:50%;">]]></content>
      
      
      <categories>
          
          <category> 数字前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 一生一芯 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一生一芯-Cache设计（三）</title>
      <link href="/2024/022113792.html"/>
      <url>/2024/022113792.html</url>
      
        <content type="html"><![CDATA[<h2 id="缓存一致性"><a href="#缓存一致性" class="headerlink" title="缓存一致性"></a>缓存一致性</h2><h4 id="Fence指令"><a href="#Fence指令" class="headerlink" title="Fence指令"></a>Fence指令</h4><p>在前续集合predecessor执行到FENCE指令前的任何操作前，处于FENCE指令后的后续集合（successor）中的任何操作，都不能被其他任何RISC-V线程或者外部设备看到。即FENCE就像一个栅栏，FENCE之前所有的存储器操作、IO操作必须完成后，在FENCE指令之后的指令才能看到结果。 </p><h4 id="fence-i"><a href="#fence-i" class="headerlink" title="fence.i"></a>fence.i</h4><p>原因：store指令可能会对内存中的程序区进行修改，而icache可能看不到程序的修改，而读取错误的指令，导致程序运行错误。<br>目的：为了解决数据与指令的一致性问题，即icache和dcache的一致性。当执行fence.i指令时，fence之前的所有存储操作，io操作必须完成后，fence指令后面的指令才能访问内存。</p><h4 id="实现方式："><a href="#实现方式：" class="headerlink" title="实现方式："></a>实现方式：</h4><p>译码阶段遇到fence.i指令，icache和dcache的具体操作：</p><ol><li>对icache中的cachemem进行刷新，完成初始化，保证后面的所有取指令操作都是从内存中获取。</li><li>对dcache中cachemem的所有dirty置1的cacheline写到内存中，保证内存中代码区和数据区的一致性。</li></ol><h3 id="icache"><a href="#icache" class="headerlink" title="icache"></a>icache</h3><p>fence模块发出flash，stall和nop使能信号，将取指令的pc地址保持不变，将进入if阶段的fence指令通过nop冲刷掉，也就是说icache的cachemem一个周期就要完成冲刷。</p><img src="/2024/022113792/image-20240222105149731.png" alt style="zoom:50%;"><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> rstn<span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rstn<span class="token punctuation">)</span>flash <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>fence_i<span class="token punctuation">)</span>flash <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>flash_done<span class="token punctuation">)</span>flash <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token keyword">assign</span> stall <span class="token operator">=</span> flash <span class="token operator">|</span> fence_i<span class="token punctuation">;</span><span class="token keyword">assign</span> nop <span class="token operator">=</span> stall<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="dcache"><a href="#dcache" class="headerlink" title="dcache"></a>dcache</h3><p>设置FLASH和FLASH_DONE状态，等待到fence.i指令流水到访存阶段，进入FLASH状态，遍历所有cacheline，将所有脏（dirty）块写到内存中；cachesize为4k，cacheline为8byte，共需要进行512次写数据传输，判断dirty位是否为1，并通过wstrb确定有效字节，将wdata写入内存。</p><p>遍历结束后，flash_finish拉高，进入FLASH_DONE状态，拉高flash_done，pc重新从内存中取指令，流水线继续执行，完成了指令和数据的一致性。</p><img src="/2024/022113792/image-20240222112053777.png" alt style="zoom: 50%;"><img src="/2024/022113792/image-20240226100157943.png" alt style="zoom:50%;"><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span><span class="token keyword">case</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span>IDLE <span class="token punctuation">:</span> next_state <span class="token operator">=</span> flash <span class="token operator">?</span> FLASH <span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token operator">!</span>hit <span class="token operator">&amp;&amp;</span> dirty <span class="token operator">&amp;&amp;</span> valid<span class="token punctuation">)</span> <span class="token operator">?</span> WRITEBACK <span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token operator">!</span>hit <span class="token operator">&amp;&amp;</span> valid<span class="token punctuation">)</span> <span class="token operator">?</span> RADDR <span class="token punctuation">:</span> IDLE<span class="token punctuation">;</span>WRITEBACK <span class="token punctuation">:</span> next_state <span class="token operator">=</span> WADDR<span class="token punctuation">;</span>ALLOCATE <span class="token punctuation">:</span> next_state <span class="token operator">=</span> IDLE<span class="token punctuation">;</span>RADDR <span class="token punctuation">:</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>axi_arvalid <span class="token operator">&amp;&amp;</span> axi_arready<span class="token punctuation">)</span> next_state <span class="token operator">=</span> RDATA<span class="token punctuation">;</span>RDATA <span class="token punctuation">:</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>axi_rvalid  <span class="token operator">&amp;&amp;</span> axi_rready <span class="token punctuation">)</span> next_state <span class="token operator">=</span> ALLOCATE<span class="token punctuation">;</span>WADDR <span class="token punctuation">:</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>axi_awvalid <span class="token operator">&amp;&amp;</span> axi_awready<span class="token punctuation">)</span> next_state <span class="token operator">=</span> WDATA<span class="token punctuation">;</span>WDATA <span class="token punctuation">:</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>axi_wvalid  <span class="token operator">&amp;&amp;</span> axi_wready <span class="token punctuation">)</span> next_state <span class="token operator">=</span> WRESP<span class="token punctuation">;</span>WRESP <span class="token punctuation">:</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>axi_bvalid  <span class="token operator">&amp;&amp;</span> axi_bready <span class="token punctuation">)</span> next_state <span class="token operator">=</span> <span class="token punctuation">(</span>flash_flag <span class="token operator">&amp;&amp;</span> flash_finish<span class="token punctuation">)</span> <span class="token operator">?</span> FLASH_DONE <span class="token punctuation">:</span> flash_flag <span class="token operator">?</span> WADDR <span class="token punctuation">:</span> RADDR<span class="token punctuation">;</span>FLASH <span class="token punctuation">:</span> next_state <span class="token operator">=</span> WADDR<span class="token punctuation">;</span>FLASH_DONE <span class="token punctuation">:</span> next_state <span class="token operator">=</span> IDLE<span class="token punctuation">;</span><span class="token keyword">default</span> <span class="token punctuation">:</span> next_state <span class="token operator">=</span> IDLE<span class="token punctuation">;</span><span class="token keyword">endcase</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> rstn<span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rstn<span class="token punctuation">)</span>flash_cnt <span class="token operator">&lt;=</span> <span class="token number">'h0</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>state <span class="token operator">==</span> WDATA<span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span>axi_wready<span class="token operator">&amp;&amp;</span>axi_wready<span class="token operator">&amp;&amp;</span>flash_flag<span class="token punctuation">)</span>flash_cnt <span class="token operator">&lt;=</span> flash_cnt <span class="token operator">+</span> <span class="token number">'h1</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> flash_cnt <span class="token operator">&lt;=</span> <span class="token number">'h0</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> rstn<span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rstn<span class="token punctuation">)</span>flash_finish <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>flash_flag <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>flash_cnt <span class="token operator">==</span> CACHE_SIZE<span class="token punctuation">)</span><span class="token punctuation">)</span>flash_finish <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> flash_finish <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> rstn<span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rstn<span class="token punctuation">)</span>flash_flag <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>state <span class="token operator">==</span> FLASH_DONE<span class="token punctuation">)</span>flash_flag <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>state <span class="token operator">==</span> FLASH<span class="token punctuation">)</span>flash_flag <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token keyword">assign</span> axi_wstrb  <span class="token operator">=</span> <span class="token punctuation">(</span>flash_flag<span class="token operator">&amp;</span>dirty<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">8'b11111111</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>flash_flag<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">8'b0000_0000</span> <span class="token punctuation">:</span> byte_enable<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="虚拟存储器"><a href="#虚拟存储器" class="headerlink" title="虚拟存储器"></a>虚拟存储器</h4><p>分页机制，虚拟地址划分以 <strong>页</strong>为单位（page），典型大小为4KB；<br>物理地址也有页，与虚拟页大小相同，称为 <strong>帧frame</strong></p><p>VA和PA都有两部分组成，一个是用来索引虚拟页或者物理帧，一个是页&#x2F;帧偏移</p><p>MMU内存管理单元负责虚拟内存到物理内存的映射。</p><p><img src="/2024/022113792/1666059846816.png" alt="img"></p><h5 id="单级页表"><a href="#单级页表" class="headerlink" title="单级页表"></a>单级页表</h5><p><strong>页表</strong> 用来存储VA到PA的映射关系，VA的一个页就可以放在物理地址的任何一个帧上了。</p><p>页表放在物理内存中，每个进程都有自己的页表。页表寄存器（PTR）用来索引页表。</p><p>单级页表访问内存（两次访问物理内存）</p><ol><li>根据PTR定位物理内存中的页表</li><li>根据VPN访问页表中的PFN</li><li>根据PFN访问物理内存</li></ol><h5 id="多级页表"><a href="#多级页表" class="headerlink" title="多级页表"></a>多级页表</h5><p>单级页表一张就需要4MB的巨大空间。多级页表将单级页表进行划分，实现更小的子页，也不需要巨大的连续地址空间。</p><img src="/2024/022113792/1666060401537.png" alt="img" style="zoom: 80%;"><ul><li>一个一级和二级页表都有2^10个表项, 因为物理内存是32位, 所以大小均为4KB, 正好可以放进物理内存的一个页内</li><li>一级页表4KB大小一般是不可避免的, 而二级页表则是根据需求逐步创建的, 操作系统会尽量让虚拟地址集中, 减少二级页表的开辟</li><li>多级页表的优势：易于扩展，当地址位宽增加到64位时，通过增加级数减少页表的占用。</li></ul><p><img src="/2024/022113792/1666077064529.png" alt="img"></p><p>虚拟内存的优点：</p><ol><li>每个进程都独占连续的地址空间</li><li>可以将连续的虚拟内存地址映射到不连续的物理地址，减小物理内存的碎片</li><li>为所有进程分配的总物理内存之和可以大于实际的物理内存大小，有些页在磁盘的swap区</li><li>可以实现每个页的访问权限</li></ol><h4 id="TLB的设计"><a href="#TLB的设计" class="headerlink" title="TLB的设计"></a>TLB的设计</h4><p>对于两级页表，需要访问两次物理内存才可以得到物理地址，延时太长。</p><p>增加一个 <strong>页表Cache</strong>加速这一进程，将页表中最近使用的PTE缓存起来，称为TLB（transition lookaside buffer）TLB是MMU的高速缓存，提高虚拟地址转换速度。TLB在MMU里面。</p><p>TLB只有时间相关性，一般TLB是全相连的，容量不会很大，采用全相连映射。</p><p>Cache存储实际的数据，TLB存储地址映射关系，存储的是MMU的映射关系。</p>]]></content>
      
      
      <categories>
          
          <category> 体系结构 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 一生一芯 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>分频器设计</title>
      <link href="/2024/022118538.html"/>
      <url>/2024/022118538.html</url>
      
        <content type="html"><![CDATA[<p>分频器主要有以下几种设计</p><ol><li>偶分频（50%占空比）</li><li>奇分频（非50%占空比）</li><li>奇分频（50%占空比）</li><li>半整数（x.5）分频（非50%占空比）</li><li>任意小数分频（非50%占空比）</li></ol><h3 id="1-偶分频（50-占空比）"><a href="#1-偶分频（50-占空比）" class="headerlink" title="1. 偶分频（50%占空比）"></a>1. 偶分频（50%占空比）</h3><p>假设偶分频系数为N， 共有两种方式实现50%的偶分频。<br>方式1：计数到 N&#x2F;2-1，将clk_out翻转。</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token important">always @</span><span class="token punctuation">(</span>posedeg clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rstn<span class="token punctuation">)</span>        cnt <span class="token operator">&lt;=</span> <span class="token number">'h0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>cnt <span class="token operator">&lt;=</span> N<span class="token operator">/</span><span class="token number">2</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>        cnt <span class="token operator">&lt;=</span> cnt <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>         cnt <span class="token operator">&lt;=</span> <span class="token number">'h0</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rstn<span class="token punctuation">)</span>        clkout <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>cnt <span class="token operator">==</span> N<span class="token operator">/</span><span class="token number">2</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>        clkout <span class="token operator">&lt;=</span> <span class="token operator">~</span>clkout<span class="token punctuation">;</span><span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>方式2：计数到N-1，小于 N&#x2F;2 - 1，clkout输出0，否则输出1；(可实现不同占空比)</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk_in <span class="token keyword">or</span> <span class="token keyword">negedge</span> rstn<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rstn<span class="token punctuation">)</span>        cnt <span class="token operator">&lt;=</span> <span class="token number">'h0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>cnt <span class="token operator">==</span> N <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>        cnt <span class="token operator">&lt;=</span> <span class="token number">'h0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>         cnt <span class="token operator">&lt;=</span> cnt <span class="token operator">+</span> <span class="token number">'h1</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk_in <span class="token keyword">or</span> <span class="token keyword">negedge</span> rstn<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rstn<span class="token punctuation">)</span>        clk_out <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>cnt <span class="token operator">&lt;=</span> N<span class="token operator">/</span><span class="token number">2</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>        clk_out <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>         clk_out <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-奇分频（非50-占空比）"><a href="#2-奇分频（非50-占空比）" class="headerlink" title="2. 奇分频（非50%占空比）"></a>2. 奇分频（非50%占空比）</h3><p>不需要使用双边沿逻辑，和偶分频的第二种方式类似。</p><h3 id="3-奇分频（50-占空比）"><a href="#3-奇分频（50-占空比）" class="headerlink" title="3. 奇分频（50%占空比）"></a>3. 奇分频（50%占空比）</h3><p>假设实现7分频时钟，需要3个完整周期+半个周期的电平翻转，可以通过两个3分频时钟 or 在一起得到，两个时钟相差半个周期，通过上升沿和下降沿触发得到。</p><p>需要双边沿逻辑；假设实现占空比50%的5分频，实现方法：</p><ol><li>采用正沿和负沿分别实现5分频</li><li>占空比为（5-1）&#x2F;2个源时钟周期</li><li>正沿和负沿产生的时钟信号做 <strong>或</strong></li></ol><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> Odd_div_50p #<span class="token punctuation">(</span>    <span class="token keyword">parameter</span> N <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">(</span>    <span class="token keyword">input</span>       clk_in<span class="token punctuation">,</span>    <span class="token keyword">input</span>       nrst<span class="token punctuation">,</span>        <span class="token keyword">output</span>      clk_out <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">reg</span> clk_pos<span class="token punctuation">,</span> clk_neg<span class="token punctuation">;</span><span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> cnt_pos<span class="token punctuation">;</span><span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> cnt_neg<span class="token punctuation">;</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk_in <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>        cnt_pos <span class="token operator">&lt;=</span> <span class="token number">'h0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>cnt_pos <span class="token operator">==</span> N<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>        cnt_pos <span class="token operator">&lt;=</span> <span class="token number">'h0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>        cnt_pos <span class="token operator">&lt;=</span> cnt_pos <span class="token operator">+</span> <span class="token number">'h1</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">negedge</span> clk_in <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>        cnt_neg <span class="token operator">&lt;=</span> <span class="token number">'h0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>cnt_neg <span class="token operator">==</span> N<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>        cnt_neg <span class="token operator">&lt;=</span> <span class="token number">'h0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>        cnt_neg <span class="token operator">&lt;=</span> cnt_neg <span class="token operator">+</span> <span class="token number">'h1</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token comment">// clk_pos clk_neg</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk_in <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>        clk_pos <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>cnt_pos <span class="token operator">&lt;=</span> <span class="token punctuation">(</span>N<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">)</span>        clk_pos <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>        clk_pos <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">negedge</span> clk_in <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>        clk_neg <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>cnt_neg <span class="token operator">&lt;=</span> <span class="token punctuation">(</span>N<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>        clk_neg <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>        clk_neg <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token keyword">assign</span> clk_out <span class="token operator">=</span> clk_pos <span class="token operator">|</span> clk_neg<span class="token punctuation">;</span><span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>还有第二种方式实现占空比为50%的奇分频，N为奇数  (可以降低电路规模)</p><ol><li>设计一个计数器，计数0 - N-1</li><li>设计两个使能信号，ttf1_en：当counter计数到0时拉高。ttf2_en：当counter计数到(N+1)&#x2F;2时拉高（组合逻辑输出）</li><li>时钟正沿控制div1的输出，当ttf1_en拉高时，div1翻转。时钟负沿控制div2输出，当ttf2_en拉高时，div2翻转</li><li>最终取div1和div2的异或结果，作为输出。</li></ol><h3 id="4-半整数（x-5）分频（非50-占空比）"><a href="#4-半整数（x-5）分频（非50-占空比）" class="headerlink" title="4. 半整数（x.5）分频（非50%占空比）"></a>4. 半整数（x.5）分频（非50%占空比）</h3><p>假设实现3.5分频，正沿计数器循环计数到7，分别交替产生分频比为4和3的时钟信号，平均下来得到的时钟信号为（4+3）&#x2F; 2 &#x3D; 3.5分频。但是每个分频时钟不是严格的3.5分频。<strong>因此，需要对不均匀的分频比进行调整，采用负沿计数器计数到7，分别交替产生分频比为3和4的时钟信号</strong>，将正沿和负沿产的时钟信号做 <strong>与</strong>操作，得到均匀的3.5分频的时钟信号。（注意，保证正沿计数器先产生分频比为4的信号）</p><img src="/2024/022118538/image-20240221164423487.png" alt style="zoom:67%;"><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> Half_Int_div #<span class="token punctuation">(</span>    <span class="token keyword">parameter</span> N <span class="token operator">=</span> <span class="token number">3.5</span><span class="token punctuation">)</span><span class="token punctuation">(</span>    <span class="token keyword">input</span>           clk_in<span class="token punctuation">,</span>    <span class="token keyword">input</span>           nrst<span class="token punctuation">,</span>    <span class="token keyword">output</span>          clk_out                      <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">localparam</span> Naddp5 <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> Nsubp5 <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> pos_vth<span class="token punctuation">,</span> neg_vth<span class="token punctuation">;</span><span class="token keyword">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> pos_cnt<span class="token punctuation">,</span> neg_cnt<span class="token punctuation">;</span><span class="token keyword">reg</span> clk_pos<span class="token punctuation">,</span> clk_neg<span class="token punctuation">;</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk_in <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>        pos_cnt <span class="token operator">&lt;=</span> <span class="token number">'h0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>pos_cnt <span class="token operator">&lt;=</span> pos_vth <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>        pos_cnt <span class="token operator">&lt;=</span> pos_cnt <span class="token operator">+</span> <span class="token number">'h1</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>         pos_cnt <span class="token operator">&lt;=</span> <span class="token number">'h0</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk_in <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>         pos_vth <span class="token operator">&lt;=</span> Naddp5<span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>pos_cnt <span class="token operator">==</span> pos_vth <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>        <span class="token function">if</span><span class="token punctuation">(</span>pos_vth <span class="token operator">==</span> Naddp5<span class="token punctuation">)</span>            pos_vth <span class="token operator">&lt;=</span> Nsubp5<span class="token punctuation">;</span>        <span class="token keyword">else</span>            pos_vth <span class="token operator">&lt;=</span> Naddp5<span class="token punctuation">;</span>    <span class="token keyword">end</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk_in <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>        clk_pos <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>pos_cnt <span class="token operator">==</span> <span class="token number">'h0</span><span class="token punctuation">)</span>        clk_pos <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>         clk_pos <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">negedge</span> clk_in <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>        neg_cnt <span class="token operator">&lt;=</span> <span class="token number">'h0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>neg_cnt <span class="token operator">&lt;=</span> neg_vth <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>        neg_cnt <span class="token operator">&lt;=</span> neg_cnt <span class="token operator">+</span> <span class="token number">'h1</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>         neg_cnt <span class="token operator">&lt;=</span> <span class="token number">'h0</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">negedge</span> clk_in <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>         neg_vth <span class="token operator">&lt;=</span> Nsubp5<span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>neg_cnt <span class="token operator">==</span> neg_vth <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>        <span class="token function">if</span><span class="token punctuation">(</span>neg_vth <span class="token operator">==</span> Nsubp5<span class="token punctuation">)</span>            neg_vth <span class="token operator">&lt;=</span> Naddp5<span class="token punctuation">;</span>        <span class="token keyword">else</span>            neg_vth <span class="token operator">&lt;=</span> Nsubp5<span class="token punctuation">;</span>    <span class="token keyword">end</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">negedge</span> clk_in <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>        clk_neg <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>neg_cnt <span class="token operator">==</span> <span class="token number">'h0</span><span class="token punctuation">)</span>        clk_neg <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>         clk_neg <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token keyword">assign</span> clk_out <span class="token operator">=</span> clk_pos <span class="token operator">|</span> clk_neg<span class="token punctuation">;</span><span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>半整数分频还有另外一种实现方式，以4.5分频为例，步骤如下</p><ol><li>设计一个9bit的移位寄存器，初始值为9’b0000_00001，每个时钟上升沿左移1位。</li><li>生成第一个时钟脉冲，将移位寄存器的第一位右移半个周期（采用下降沿触发的寄存器产生），将该信号与移位寄存器的第一位和第二位进行”或”操作</li><li>生成第二个时钟脉冲，将移位寄存器的第五、六位右移半个周期（下降沿寄存器产生），将该信号与移位寄存器的第六位进行”或”操作。</li></ol><p><img src="/2024/022118538/image-20240527093457853.png" alt="image-20240527093457853"></p><h3 id="5-任意小数分频（非50-占空比）"><a href="#5-任意小数分频（非50-占空比）" class="headerlink" title="5. 任意小数分频（非50%占空比）"></a>5. 任意小数分频（非50%占空比）</h3><p>同样不能做到50%的占空比。基于可变分频和平均分频得到，在长时间内，得到小数分频比。<br>比如7.6分频，保证76个源时钟周期时间内，目的时钟经过10个周期的时间。即对源时钟进行 <strong>6次8分频，4次7分频（6*8+4*7&#x3D;76）。</strong>5.76分频，对源时钟进行 <strong>76次6分频，24次5分频</strong></p><p>以 7.6 倍分频为例，7 分频和 8 分频的实现顺序一般有以下 4 种：</p><p>(1) 先进行 4 次 7 分频，再进行 6 次 8 分频；<br>(2) 先进行 6 次 8 分频，再进行 4 次 7 分频；<br>(3) 将 4 次 7 分频平均的插入到 6 次 8 分频中；<br>(4) 将 6 次 8 分频平均的插入到 4 次 7 分频中。</p><p>前两种方法时钟频率不均匀，相位抖动较大，所以一般会采用后两种平均插入的方法进行小数分频操作。</p>]]></content>
      
      
      <categories>
          
          <category> 数字前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DC_FLOW(一)</title>
      <link href="/2024/02206923.html"/>
      <url>/2024/02206923.html</url>
      
        <content type="html"><![CDATA[<h2 id="工艺库文件解读"><a href="#工艺库文件解读" class="headerlink" title="工艺库文件解读"></a>工艺库文件解读</h2><p>以90nm为例，常见的文件夹如下</p><img src="/2024/02206923/image-20240309145119997.png" alt="image-20240309145119997" style="zoom: 33%;"><p>CDL：存放spice网表<br>    <img src="/2024/02206923/image-20240309145242615.png" alt="image-20240309145242615" style="zoom: 15%;"></p><p>打开其中一个，找到INV的网表如下，可以看出是spice格式的，l&#x3D;0.1u，表示的是90nm的工艺(特征尺寸）</p><p><img src="/2024/02206923/image-20240309145339988.png" alt="image-20240309145339988"></p><p>INVX1,2,4,8,16,32  X后面的数据表示驱动能力，描述的是signal上升和下降速度。不同的数字电路结构是有区别的，m表示并联管子的个数，w l相同，m越大，驱动能力越强。或者通过调整w的大小，描述不同的驱动能力。</p><p>ULVT: 极低阈值电压</p><p>LVT: 低阈值电压</p><p>SVT(RVT): 常规的阈值电压</p><p>HVT：高阈值电压</p><p>EHVT：极高阈值电压</p><p>阈值电压高，leakage功耗小，速度慢。</p><p>40G 40LP 40ULP 描述的不同的功耗</p><ul><li>db</li></ul><p>db文件夹的东西是给DC读，不给人读。由lib可转换而来</p><img src="/2024/02206923/image-20240309145449601.png" alt="image-20240309145449601" style="zoom: 25%;"><p>其中，ff，ss，tt表示不同工艺角 (p是point)  PVT对应不同条件</p><p>可以看书有2个ff工艺角，工作环境：1.32v，125度；1.32v，-40度</p><p>2个ss工艺角，工作环境：1.08v，125度；1.08v，-40度</p><p>1个tt工艺角，工作环境：1.20v，25度</p><p>1P3M_8K表示1层ploy，3层金属，最高层金属的厚度是8K</p><p>ffg_cbest_min 描述工艺参数，min表示快的逻辑，hold time；c电容最好；</p><p>Lib中包含了工艺库中标准单元的时序、面积、功耗信息，通过查找表的方式实现的，即通过输入转换时间和输出负载电容找的对应的信息，</p><img src="/2024/02206923/image-20240309145628255.png" alt="image-20240309145628255" style="zoom: 25%;"><p>INVX1的时序信息</p><img src="/2024/02206923/image-20240309145659989.png" alt="image-20240309145659989" style="zoom: 25%;"><p>如何定义电路中一个反向器的延迟？是通过查表实现，由输入转换时间和输出负载电容决定。</p><p>这里有一个DRC的概念，即max_transition, max_capacitance, max_fanout, 限制了查找表的两个维度，transition_time和最大load_cap。如果电路中出现了非查找表上的数据，通过内插或者外插的方式得到，为什么要设置DRC呢，是因为超过这个限制，得到的PPA就会失真，与实际得到的结果相差很大。</p><ul><li>GDS</li></ul><p>gds    保存着标准单元库的详细版图文件</p><img src="/2024/02206923/image-20240309145822475.png" alt="image-20240309145822475" style="zoom: 50%;"><img src="/2024/02206923/image-20240309145834084.png" alt="image-20240309145834084" style="zoom:50%;"><p>上面是VCC电源电压，下面是地VSS</p><p>所有的标准单元有一个共同特点是height相同，在芯片同一个track中，只能采用相同height的SC，可以划定不同区域采用不同height的SC，比如有SC7,SC9，height高的唯一好处是速度快，但是功耗大，面积大。</p><p>Lef   描述SC的简略信息，是GDS的子集，简化版本</p><p>GDS记录了芯片制造过程中的每一层尺寸信息和规则，在pr中不需要这么多信息，所以进行了简化，LEF文件主要记录的是金属层的信息。定义了SC的尺寸，位置等。</p><img src="/2024/02206923/wps2.jpg" alt="img" style="zoom: 50%;"><p>​<img src="/2024/02206923/wps3.jpg" alt="img" style="zoom: 67%;"> </p><p>Verilog       描述了SC的rtl模型，里面包含了各种原语（UDP）操作</p><p><img src="/2024/02206923/wps6.jpg" alt="img"></p><p><img src="/2024/02206923/wps7.jpg" alt="img"> </p><img src="/2024/02206923/wps8.jpg" alt="img" style="zoom: 80%;"> <p>需要注意的是 specify的概念，定义延迟路径的延迟大小，这里有两个延迟时间，一个快，一个慢。在延迟反标做后仿时需要注意这点。</p><img src="/2024/02206923/image-20240309150126225.png" alt="image-20240309150126225" style="zoom:67%;"><h2 id="dc-topo模式"><a href="#dc-topo模式" class="headerlink" title="dc_topo模式"></a>dc_topo模式</h2><p>dc_topo模式 指 在综合时考虑物理约束，需要ICC阶段生成的def文件，milkway和工艺文件tf。DEF文件只有物理信息，没有timing信息，流程如下：</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token list punctuation">1.</span> dct生成一版网表netlist，给ICC，导出floorplan的DEF文件<span class="token list punctuation">2.</span> 根据icc导出的def文件，作为DC的物理约束，在dct模式下综合，得到的网表更准确<span class="token list punctuation">3.</span> compile_ultra<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">dc_shell <span class="token operator">-</span>topo <span class="token operator">-</span>f run.tcl <span class="token operator">|</span> tee <span class="token operator">-</span>i run.log  <span class="token comment">#   | tee -i dc.log, 将dc运行结果写入指定日志文件</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><img src="/2024/02206923/image-20240220161903358.png" alt style="zoom: 50%;"><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl"><span class="token comment"># icc 写def 命令</span>write_def <span class="token operator">-</span>output name.def<span class="token comment"># dct 读def命令</span>extract_physical_constraints name.def<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>注意事项：第一次时，topo模式需要创建milkway，第二次进入dct模式时，已经有def文件，但是不需要创建milkway库，直接打开就可以</strong></p><h2 id="DC前期环境配置"><a href="#DC前期环境配置" class="headerlink" title="DC前期环境配置"></a>DC前期环境配置</h2><p>ddc是专用的二进制设计数据库格式，可以被ICC、PT读取；</p><p>synthetic_library是DC软件提供的库；design ware library中有一些优化的ip核，在优化时被调用。</p><p>target library是工艺库的逻辑库，用来查找reference的<br>link library包含target lib，还有marco，ip等，用来综合和优化。</p><p>link library 中， * 代表DC Memory 内存空间；<br>在link前需要指明当前current_design<br>link后要check_design 检查是否有丢失的pins和没有添加进来的实例。</p><ul><li><p>读取设计文件<br>analyze elaborate，elaborate 是唯一一种可以指明代码中参数的方式。-parameter “ xxx”<br>read_verilog命令会生成“GETCH”库中unmapped的ddc格式的文件</p></li><li><p>工艺库</p></li></ul><img src="/2024/02206923/image-20240305004108655.png" alt="image-20240305004108655" style="zoom:50%;"><p>Reference library：包括cell的尺寸和管脚的位置，就是milkway 库。milkway物理库中有不同的view：</p><ol><li>cel：整个版图视图，布局布线完成后被使用，生成最后的GDSII文件</li><li>fram：对于ICC和DC-topo使用的抽象视图，仅用于布局布线的最小数据。</li><li>lm（逻辑库）：具有时序和功耗相关的逻辑库，被icc和dc_topo使用。</li></ol><p>designware library是synopsys库，综合库，默认的标准 Designware 由 DC 软件商提供，无需指定。</p><p>GDS可以产生CEL，LEF可以产生FRAM，不能产生CEL，用LEF做的FRAM出gds后，需要到virtuoso中或者calibre中merge gds得到完整的gds再去做DRC&#x2F;LVS</p><p>Technology file：定义了布线层，过孔，DRC的规则，金属和过孔的电学特性参数</p><p>TLUPlus file：寄生参数rc模型，rc参数查找表</p><p>Layer Mapping File：匹配不同名称的相同图层，匹配tf和tluplus文件</p><img src="/2024/02206923/image-20240305004609790.png" alt="image-20240305004609790" style="zoom: 67%;"><h2 id="理论基础"><a href="#理论基础" class="headerlink" title="理论基础"></a>理论基础</h2><ol><li><p>标准单元输出信号的延迟取决于 输入转换时间input_transition和输出负载output load；</p></li><li><p>如果设计中只有一个路径组，如果关键路径无法优化，dc give up it，会导致其他less critical path也无法优化。默认每个时钟域对应一个路径组。</p></li><li><p>做静态时序分析时，路径的起点可以是input port，clock pin，存储器的输出，路径的终点可以是寄存器D，output port，存储器的输入port。</p></li><li><p>在工艺库的查找表中，如果输入的约束在范围内，做内插；如果超过范围做外插（表破了），影响仿真结果。</p></li><li><p>在先进制程工艺的工艺库中，存在INV和CLKINV两种不同的反相器，CLKINV的N管的W要小一些，是因为保证时钟信号上升和下降的时间均衡（tphl&#x3D;tplh），便于静态时序分析,PMOS的w大概是NMOS的2.7倍左右。</p></li><li><p>在DC综合后，会生成sdf文件（带有实际电路门级网表路径延迟的信息），将sdc文件反标在上述的verilog模型中，得到具有延迟信息的电路，利用verilog和sdf文件可以在Vcs&#x2F;Verdi仿真结果可以看出延迟信息。一个sdf文件对应一个corner。</p></li><li><p>DC是如何计算三个反相器串联的总延迟？第一个反相器的延迟tcq是第二个反相器的transition，电容由电路结构确定，根据查表依次进行，得到三个反相器串联的总延迟。</p></li></ol><img src="/2024/02206923/image-20240309144041702.png" alt="image-20240309144041702" style="zoom:50%;"><img src="/2024/02206923/image-20240309144202884.png" alt="image-20240309144202884" style="zoom:50%;"><p>​对于级联的MUX电路DC又如何计算延迟呢？<br>​第一个反相器的A输入到最后输出，会有很多种可能的时间，DC会把所有的延迟计算出来，最长的时间用于setup时间的检查，最短的路径时间用于hold时间检查。这里就引申出静态时序分析STA的概念。在电路没有工作的时候，把所有的情况计算出来，进行setup&#x2F;hold time检查。</p><img src="/2024/02206923/image-20240309144231306.png" alt="image-20240309144231306" style="zoom:50%;"><ol start="8"><li><p>setup time &#x2F; hold time计算</p><img src="/2024/02206923/wps1.jpg" alt="img" style="zoom:50%;"><p>1 2 3 max  4 5 min &#x3D;&gt; 检查setup time  1+2+3 -（4+5）&lt; Tcycle</p><p>1 2 3 min  4 5 max &#x3D;&gt; 检查hold time   1+2+3 &gt; 4+5</p><p>6属于common path，如果两个寄存器是同沿触发，则6不起作用，被抵消，如果是不同沿触发，要看沿的指向（不同沿的延迟是不一样的，需要分开算）</p><p>在ICC&#x2F;PT中，有相关命令考虑common path。当做STA时，common path会导致发射路径和捕获路径的计算cell的delay不一样，为了消除这种悲观情况，引入CRPR，也叫cppr，依次抹平common path的差异。</p></li><li><p>Verilog RTL代码读入后，生成的gtech文件，是未映射到具体工艺的，GTECH.db是DC软件自带的库synthetic_library，不是dw。</p></li><li><p>DC综合过程</p></li></ol><p>   ①翻译（转换）：将RTL转换成门级网表</p><p>   ②逻辑优化</p><p>   ③映射：映射到具体的工艺库</p><ol start="11"><li>level shifter作为stdcel，在lib中，同样具有相同的track，L2H level shifter需要两个电压，另外一个电压端口作为输入端口接到stdcel上。</li><li>降低功耗可以从以下角度考虑</li></ol><ul><li>降低时钟翻转带来的动态功耗</li><li>门级电路优化</li><li>静态多电压技术、多阈值标准单元</li></ul><ol start="13"><li>多阈值电压的工艺库综合策略：第一遍使用HVT管子综合，对于关键路径不满足时序要求的case使用LVT减小延迟以满足setup检查。</li></ol><h2 id="环境约束"><a href="#环境约束" class="headerlink" title="环境约束"></a>环境约束</h2><h3 id="工作条件"><a href="#工作条件" class="headerlink" title="工作条件"></a>工作条件</h3><p>设置工作条件：<code>set_operating_conditions</code>，用来描述设计的工艺、电压、温度。PVT</p><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl"><span class="token punctuation">[</span><span class="token operator">-</span>library lib_name<span class="token punctuation">]</span>     <span class="token comment">#指定工艺库</span><span class="token punctuation">[</span><span class="token operator">-</span>analysis_type<span class="token punctuation">]</span>    <span class="token comment">#应执行的分析类型，最慢，最快，基于芯片变异性的延迟</span><span class="token punctuation">[</span><span class="token operator">-</span>max max_condition<span class="token punctuation">]</span><span class="token comment">#该工作点应考虑执行最慢的分析，如-max WCMIL</span><span class="token punctuation">[</span><span class="token operator">-</span>min min_condition<span class="token punctuation">]</span><span class="token comment">#该工作点应考虑执行最快的分析，如-min BCIND</span><span class="token punctuation">[</span><span class="token operator">-</span>max_library max_lib<span class="token punctuation">]</span><span class="token comment">#指定最慢的库</span><span class="token punctuation">[</span><span class="token operator">-</span>min_library min_lib<span class="token punctuation">]</span><span class="token comment">#指定最快的库</span><span class="token punctuation">[</span><span class="token operator">-</span>object_list objects<span class="token punctuation">]</span><span class="token comment">#设计对象，通常为整个设计，故很少使用</span><span class="token punctuation">[</span>condition<span class="token punctuation">]</span><span class="token comment">#工作条件 </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="线负载模型"><a href="#线负载模型" class="headerlink" title="线负载模型"></a>线负载模型</h3><p>标准单元库中提供了stdcel的延迟信息、功耗、面积等信息，但是没有提供连线的延迟。在dc阶段使用线负载模型估计net delay，在icc阶段根据版图抽取寄生得到较为准确的延迟。线负载模型的计算方式：根据扇出和连线长度，预估电容，电阻和面积等参数，通过计算得到。越先进的工艺，连线延迟占比越大，而且集成度的提高，造成了布线的复杂，这也是物理综合走向前端的原因。</p><p><img src="/2024/02206923/image-20240309142358349.png" alt="image-20240309142358349"></p><h3 id="线负载模式"><a href="#线负载模式" class="headerlink" title="线负载模式"></a>线负载模式</h3><p><code>set_wire_load_mode</code></p><p>top模式定义层次中的所有连线将继承和顶层模块同样的线载模型。exclosed指定所有连线（属于子模块的）将继承完全包含该子模块的模块线载模型。例如设计者综合完全被模块A包含的子模块B和C，则子模块B和C会继承为模块A定义的线载模型。segmented用于跨越层次边界的连线。在上例中，子模块B和C继承特定于他们的线载模型，而子模块B和C间的连线（在模块A）会继承为模块A指定的线载模型。</p><ul><li>top：所有的线模型都是top层的</li><li>exclosed：线的延时使用mid的来计算</li><li>segmented：分开算</li></ul><img src="/2024/02206923/image-20240309142504896.png" alt="image-20240309142504896" style="zoom: 67%;"><h2 id="时序约束"><a href="#时序约束" class="headerlink" title="时序约束"></a>时序约束</h2><h4 id="时钟相关clock"><a href="#时钟相关clock" class="headerlink" title="时钟相关clock"></a>时钟相关clock</h4><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl"><span class="token comment"># clock latency = 内部延迟+外部延迟</span>set_clock_latency <span class="token operator">-</span>source <span class="token operator">-</span>max 4 <span class="token punctuation">[</span>get_clock clk<span class="token punctuation">]</span> <span class="token comment">#时钟源到clock外部端口的延迟</span>set_clock_latency <span class="token operator">-</span>max 4 <span class="token punctuation">[</span>get_clock clk<span class="token punctuation">]</span>  <span class="token comment">#内部时钟网络延迟</span>set_clock_uncertainty <span class="token operator">-</span>setup 0.5 $<span class="token variable">CLOCK</span> <span class="token comment">#包括jitter、skew、margin</span>set_clock_transition <span class="token operator">-</span>max 0.08 $<span class="token variable">CLOCK</span><span class="token comment">#指明时钟的名字和占空比</span>create_clock <span class="token operator">-</span>name clk <span class="token operator">-</span>period 5 <span class="token operator">-</span>wareform <span class="token punctuation">&#123;</span>0 3<span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>get_ports Clk<span class="token punctuation">]</span><span class="token comment">#CTS综合后的时序约束</span><span class="token comment">#CTS后，时钟clock的transition上升、下降时间，内部延迟时间和skew时钟偏斜时间都已经确定</span>set_clock_latency <span class="token operator">-</span>source <span class="token operator">-</span>max 4 $<span class="token variable">CLOCK</span> set_propagated_clock $<span class="token variable">CLOCK</span> set_clock_uncertainty <span class="token operator">-</span>setup 0.2 $ CLOCK <span class="token operator">/</span><span class="token operator">/</span> jitter<span class="token operator">+</span>margin report_clock <span class="token comment"># -skew检查时钟约束</span>report_clock <span class="token operator">-</span>verbose  <span class="token comment"># verbose 详细的输出</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="输入输出约束"><a href="#输入输出约束" class="headerlink" title="输入输出约束"></a>输入输出约束</h4><h5 id="约束输入-输出延迟"><a href="#约束输入-输出延迟" class="headerlink" title="约束输入&#x2F;输出延迟"></a>约束输入&#x2F;输出延迟</h5><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl"><span class="token comment"># 一般设置外部延迟值占周期的60%~70%</span><span class="token comment">#设置输入延迟</span>set_input_delay <span class="token operator">-</span>max 0.5 <span class="token operator">-</span>clock clk <span class="token punctuation">[</span>remove_from_collection <span class="token punctuation">[</span>all_inputs<span class="token punctuation">]</span> <span class="token punctuation">[</span>get_ports clk<span class="token punctuation">]</span><span class="token punctuation">]</span>remove_input_delay <span class="token punctuation">[</span>get_ports clk<span class="token punctuation">]</span><span class="token comment"># 设置的input_delay 和 output_delay 都是基于clock的,也可以指定基于clock的上升沿还是下降沿。</span>set_input_delay <span class="token operator">/</span>set_output_delay <span class="token operator">-</span>max 2 <span class="token operator">-</span>clock clk <span class="token punctuation">[</span>get_ports A<span class="token punctuation">]</span>set_input_delay <span class="token operator">/</span>set_output_delay <span class="token operator">-</span>max 2 <span class="token operator">-</span>clock clk <span class="token operator">-</span>clock_fall <span class="token operator">-</span>add_delay <span class="token punctuation">[</span>get_ports A<span class="token punctuation">]</span><span class="token comment">#-add_delay 指明还有另外一个寄存器与该端口相连</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="/2024/02206923/image-20240309212251864.png" alt="image-20240309212251864" style="zoom:50%;"><h5 id="约束输入转换时间"><a href="#约束输入转换时间" class="headerlink" title="约束输入转换时间"></a>约束输入转换时间</h5><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">set_input_transition <span class="token operator">-</span>max 0.2 <span class="token punctuation">[</span>get_ports A<span class="token punctuation">]</span> set_driving_cell <span class="token operator">-</span>libcell OR3B <span class="token punctuation">[</span>get_ports A<span class="token punctuation">]</span>set_driving_cell <span class="token operator">-</span>no_design_rule <span class="token operator">-</span>lib_cell invlal $<span class="token variable">ALL_INP_EXC_CLK</span><span class="token comment"># 两种方式都可以约束输入转换时间，</span><span class="token comment">#当静态时序分析时，当出现违例时，优先修复input transition time的违例，因为他影响下级延迟的计算。</span><span class="token comment"># 第一种方式适合接到外部引脚或者pad，第二种适合内部模块之间的约束。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="设计规则约束"><a href="#设计规则约束" class="headerlink" title="设计规则约束"></a>设计规则约束</h5><h5 id="路径分组"><a href="#路径分组" class="headerlink" title="路径分组"></a>路径分组</h5><p>由于综合工具发现同一组路径中最差的路径没办法优化到slack大于0，就会放弃优化退出综合。通过路径分组，可以将其他clock group路径的关键路径也会得到优化。</p><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">group_path <span class="token operator">-</span>name INPUT <span class="token operator">-</span>from <span class="token punctuation">[</span>all_inputs<span class="token punctuation">]</span>group_path <span class="token operator">-</span>name OUTPUT <span class="token operator">-</span>to <span class="token punctuation">[</span>all_outputs<span class="token punctuation">]</span>group_path <span class="token operator">-</span>name INOUT <span class="token operator">-</span>from <span class="token punctuation">[</span>all_inputs<span class="token punctuation">]</span> <span class="token operator">-</span>to <span class="token punctuation">[</span>all_outputs<span class="token punctuation">]</span>group_path <span class="token operator">-</span>name CLK <span class="token operator">-</span>critical_range 0.2 <span class="token operator">-</span>weight ：权重设置，建议值为5、2、1三个档。如果设置太高，可能会顾头不顾尾。<span class="token operator">-</span>critical_range：设置优化过程中的余裕边界，靠近关键路径的违例路径也会被优化。<span class="token comment">#reg-reg的路径设置5，less path 路径设置2，</span><span class="token comment">#默认设置1，设置权重 默认值为 1 权重越高工具就会越集中力量优化该 group_path。</span><span class="token comment">#这样设定group_path将会把这些不同种类的路径区分对待，优化时给予同等代价比重去进行优化，不会因为某一部分（如input逻辑）时序违反最大而不去优化其他路径。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="/2024/02206923/image-20240307010436686.png" alt="image-20240307010436686" style="zoom:50%;"><h4 id="报告命令"><a href="#报告命令" class="headerlink" title="报告命令"></a>报告命令</h4><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">Check_timing  <span class="token comment">#约束加好后，检查约束的一致性 检查是否有路径没有加入约束。</span>get_libs <span class="token comment">#获取当前设计的库</span>report_path_group <span class="token comment">#输出当前设计的路径分组</span>report_costraint <span class="token operator">-</span>all_violators <span class="token comment">#得到设计中所有的违例</span>report_timing <span class="token comment">#独立的输出每一条路径的时序</span><span class="token operator">-</span>delay max<span class="token operator">/</span>min <span class="token punctuation">(</span>max <span class="token operator">-</span><span class="token operator">></span> setup time, min <span class="token operator">-</span><span class="token operator">></span> hold time<span class="token punctuation">)</span><span class="token operator">-</span>from 起点<span class="token operator">-</span>to 终点<span class="token operator">-</span>through 经过哪些 pin port<span class="token operator">-</span>group 只输出该 group 的信息<span class="token operator">-</span>input_pins 只输出输入引脚相关的信息<span class="token operator">-</span>max_paths 指定只输出多少条最坏的时序路径信息<span class="token operator">-</span>nworst 输出该端点上的最坏的几条时序路径信息<span class="token operator">-</span>nets 输出fanout信息set_host_options <span class="token operator">-</span>max_cores 4  <span class="token comment">#最大四个核处理</span>report_congestion <span class="token comment">#输出当前设计的阻塞情况</span>report_design <span class="token comment"># 得到最大最小的工作条件和线负载模型</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="修复违例"><a href="#修复违例" class="headerlink" title="修复违例"></a>修复违例</h2><p>如果电路中的最大WNS违例的时间占clock period的15%以上，认为电路中存在较大的时序违例。需要做的：</p><p>1.检查约束 是不是出现问题<br>2.检查模块划分，组合逻辑是不是穿过多个模块<br>3.重新编译优化后的网表<br>4.修改rtl代码</p><p>如果电路中负的最大裕量是比较小的，认为约束和模块划分都是正确的，不需要将网表返回到GTECH结构，也不需要做逻辑级的优化，可以使用compile -incremental_mapping 增量优化，DC所要作的是进行门级单元的替换，即在不违反设计规则的情况下用延时小的单元替换延时较大的单元。也可以根据违例情况，添加选项进行单独修复。</p><h3 id="修复hold违例"><a href="#修复hold违例" class="headerlink" title="修复hold违例"></a>修复hold违例</h3><p>通常作法是插入buffer，但是可能会带来建立时间的违例；<br>hold的检查一般到cts后才可以得到准确值。<strong>DC 不修正保持时间的违例</strong></p><p>由于反相器具有再生特性，可以在长连线中插入多级buffer，目的就是降低rc延迟。</p><h3 id="流片后修复违例"><a href="#流片后修复违例" class="headerlink" title="流片后修复违例"></a>流片后修复违例</h3><p>对于setup违例，通过增加时钟周期，降低频率。</p><p>对于hold违例，通过升高芯片的温度，增加Tc-q延迟来满足保持时间违例。</p><h2 id="常见命令"><a href="#常见命令" class="headerlink" title="常见命令"></a>常见命令</h2><h3 id="Synopsis-Tcl"><a href="#Synopsis-Tcl" class="headerlink" title="Synopsis Tcl"></a><strong>Synopsis Tcl</strong></h3><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">get_<span class="token operator">*</span> 和all_<span class="token operator">*</span>返回的都是collection类型的句柄，而不是list。<span class="token keyword">set</span> <span class="token variable">foo</span> <span class="token punctuation">[</span>get_ports <span class="token operator">*</span><span class="token punctuation">]</span> <span class="token comment">#得到的foo只是个集合“collection”的句柄，不是列表，用echo和puts无效，用query_objects $foo输出</span>get_object_name $<span class="token variable">foo</span>比query_object更有collection是DC<span class="token operator">-</span>Tcl特有的数据类型，描述多个属性元素的集合，为了描述硬件而设计的。<span class="token comment">#Filter collection</span>Filter_collection <span class="token punctuation">[</span>get_cells <span class="token operator">*</span><span class="token punctuation">]</span> “ref_name = <span class="token operator">~</span>AN<span class="token operator">*</span>”Set fastclk <span class="token punctuation">[</span>get_cells <span class="token operator">*</span> <span class="token operator">-</span>filter “period <span class="token operator">&lt;</span> 10”<span class="token punctuation">]</span>  <span class="token comment">#更有效</span>collection用于访问数据库数据，list是用户定义的用来存储数据的。<span class="token builtin">foreach</span>遍历list列表，而foreach_in_collection用来遍历collection，foreach_in_collection cell <span class="token punctuation">[</span>get_cells <span class="token operator">-</span>filter “is_hierarchical <span class="token operator">==</span> true”<span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>echo “instance <span class="token punctuation">[</span>get_object_name $<span class="token variable">cell</span><span class="token punctuation">]</span> is hierarchical <span class="token punctuation">&#125;</span>get_lib <span class="token comment">#获取工艺库</span>get_attribute slow time_unit_name <span class="token comment">#获取dc中的时间单位</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="link"><a href="#link" class="headerlink" title="link"></a><strong>link</strong></h3><ol><li><p>将设计与工艺库中stdcel进行对应。</p></li><li><p>将设计连接到这些库单元上。</p><p>link后，进行uniquify，创建同一个reference的不同instance，以便根据不同的物理环境做优化。</p></li></ol><p>Link 命令不会去读取verilog rtl，而是去DC memory中寻找模块的getch库名称，与工艺库做一个匹配，read命令完成的是在DC memory中创建模块</p><h3 id="compile"><a href="#compile" class="headerlink" title="compile"></a><strong>compile</strong></h3><p>compile_ultra会对违例的关键路径进行重组优化，high effort 代价较高，其自动调用high map effort </p><p>compile 需要显式调用 -map_effort high</p><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">compile_ultra <span class="token operator">-</span>timing<span class="token comment"># 通过在关键路径使用 寄存器复制 用于优化综合的时序问题，使用compile_ultra会自动调用，可以人为的设定寄存器组的数目限制， </span>compile <span class="token operator">-</span>retime<span class="token comment"># 移动、复制、合并寄存器以满足时序的要求，如果设计需要固定的寄存器位置和名字，不建议使用 -retime</span><span class="token comment"># 设置set_dont_retime &lt;cell or design> true</span><span class="token comment"># Dc默认只优化最关键的路径，通过crtical_range可以指定优化范围</span>set_critical_range <span class="token comment"># 同时优化多条路径，可能会优化关键路径。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="uniquify"><a href="#uniquify" class="headerlink" title="uniquify"></a>uniquify</h3><p>Uniquify 将多次引用的模块的个数拷贝需要的数目,然后对他们分别命名而得到不同的模块名，DC默认储存器的模块都只是引用一次的，如果使用uniquify，可以使得模块的各个引用针对不用环境分别优化得到更好效果。（因为在物理上是独立的模块）DC可以把他们当做两个不同的模块，根据不同的周围环境做优化。</p><h3 id="for-formality"><a href="#for-formality" class="headerlink" title="for formality"></a>for formality</h3><p>DC在综合过程中，会生成svf文件，记录了设计的boundary改变，寄存器的重新定位和路径分组信息，这些信息可以被formality形式验证工具读取，默认是&lt;default.svf&gt;，可以通过set_svf &lt;name.svf&gt; 修改，一定要在read RTL之前进行。</p><h3 id="report-芯片面积"><a href="#report-芯片面积" class="headerlink" title="report 芯片面积"></a>report 芯片面积</h3><p>三种方式描述面积：1. 晶体管级 transitor 2. 2输入与非门的个数 3. 实际的面积</p><p>report_area 输出实际的面积,也会显示综合后的标准单元个数。如果想要转换到与非门的个数，将报出的面积除以与非门的面积，得到2输入与非门个数。</p><p>查看综合后的网表有多少门</p><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">sizeof_collection <span class="token punctuation">[</span>get_cells <span class="token operator">*</span> h<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>查看2输入与非门的面积：</p><ol><li>打开logic 库，查看NA2的面积，<strong>tsmc65大概是2.16平方微米</strong>。</li><li>tcl查询，NAND2的属性 attribution <code>get_attribute[get_lib_cell */nand2]</code> </li><li>单独综合一个与非门，查看面积。</li></ol><h2 id="针对课题组项目"><a href="#针对课题组项目" class="headerlink" title="针对课题组项目"></a>针对课题组项目</h2><p>1、由于数字校准模块的数字时钟为经过DTC延迟后的时钟，所有有 <strong>100ps左右的jitter</strong>，在约束setup的clock_uncertainly时需要加上该值；</p><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">set_clock_uncertainly <span class="token operator">-</span>setup 0.25 <span class="token punctuation">[</span>get_clock clk<span class="token punctuation">]</span><span class="token comment"># 0.25 = jitter（0.1+0.05ns） + skew + margin    </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>2、dc的跨时钟域约束<br>由于SPI模块是课题组原有的，不需要对内部逻辑进行修改；SPI按照10M约束，数字校准模块按照125M约束，定义两个时钟为异步的。针对异步时钟，作如下约束  </p><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">set_clock_group <span class="token operator">-</span>asynchronous <span class="token operator">-</span>group clk_100 <span class="token operator">-</span>group <span class="token operator">-</span>clk_1 set_max_delay 7 <span class="token operator">-</span>from <span class="token punctuation">[</span>get_pins xx<span class="token operator">/</span>Q<span class="token punctuation">]</span> <span class="token operator">-</span>to <span class="token punctuation">[</span>get_pins xx<span class="token operator">/</span>D<span class="token punctuation">]</span> <span class="token operator">-</span>datapath_onlyset_min_delay 3 <span class="token operator">-</span>from <span class="token punctuation">[</span>get_pins xx<span class="token operator">/</span>Q<span class="token punctuation">]</span> <span class="token operator">-</span>to <span class="token punctuation">[</span>get_pins xx<span class="token operator">/</span>D<span class="token punctuation">]</span> <span class="token operator">-</span>datapath_onlyset_input_delay  <span class="token operator">-</span>clock clk_1   <span class="token operator">&lt;</span>输入延迟<span class="token operator">></span> <span class="token punctuation">[</span>get_pins <span class="token operator">&lt;</span>输入信号<span class="token operator">></span><span class="token punctuation">]</span>set_output_delay <span class="token operator">-</span>clock clk_100 <span class="token operator">&lt;</span>输出延迟<span class="token operator">></span> <span class="token punctuation">[</span>get_pins <span class="token operator">&lt;</span>输出信号<span class="token operator">></span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>基础：set_max&#x2F;min_delay这两种约束，一般用于异步时钟的数据约束上。set clock group -asynchronous或者set false path设置 对这两个时钟域数据不进行时序检查，但是一般需要保证跨时钟传递的数据要满足最大最小延迟，而不会高的离谱。比如异步fifo读写指针的格雷码，如果延迟时间太长，目的时钟域周期太短，会导致传输路径延迟超过两个周期。</p></blockquote><p>采用单握手机制进行跨时钟域数据传输。原因是SPI和数字CORE部分时钟速率差较大，单握手适用于慢时钟域到快时钟域的数据传输。</p><p><strong>异步复位，同步释放</strong></p><p>ASIC电路必须要使用异步复位，同步释放电路。</p><img src="/2024/02206923/image-20240603155426193.png" alt="image-20240603155426193" style="zoom: 50%;"><p>在dc时，set_dont_touch的有rst_n和masterrst_n信号。在ICC布局布线时，需要建立masterst的复位树。将异步复位同步释放电路封装成一个module，防止在优化过程中，修改了网表，net的名字发生变化，封装成一个module后，直接对output端口masterrst约束建立复位树。</p><p>复位树对复位信号的偏斜不敏感，保证延迟足够短即可。</p><p>dc约束如下</p><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl"><span class="token keyword">set</span> <span class="token variable">rst</span> <span class="token punctuation">[</span><span class="token keyword">list</span> u_sync_reset<span class="token operator">/</span>master_rstn nrst<span class="token punctuation">]</span><span class="token builtin">foreach</span> i $<span class="token variable">rst</span> <span class="token punctuation">&#123;</span>  set_dont_touch $<span class="token variable">i</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>获取同步器输出的复位信号：**<code>u_sync_reset/master_rstn</code>**</p><h2 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h2><h4 id="dc-shell中执行bash命令"><a href="#dc-shell中执行bash命令" class="headerlink" title="dc_shell中执行bash命令"></a>dc_shell中执行bash命令</h4><p>​前面加shell &#x2F; sh，比如 <code>shell gvim</code></p><p>​-tee 读取标准输入数据到文件    -i 忽略中断信号</p><p>​| 管道命令</p><p>​cat file1 | file2 #将file1的输出作为输入保存在file2中 </p><h4 id="帮助"><a href="#帮助" class="headerlink" title="帮助"></a>帮助</h4><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">help <span class="token string">"set_input_delay"</span>set_input_delay <span class="token operator">-</span>helpman set_input_delaysynoff <span class="token comment">#取消 工艺库lib文件中显示的底色</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ASIC数字后端流程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一生一芯-CPU流水线设计（一）</title>
      <link href="/2024/021950375.html"/>
      <url>/2024/021950375.html</url>
      
        <content type="html"><![CDATA[<p>将整个结构划分为五级，相比于单周期的CPU，在流水线设计过程中主要解决数据冒险和结构冒险和结构冒险。</p><h2 id="数据冒险"><a href="#数据冒险" class="headerlink" title="数据冒险"></a>数据冒险</h2><p>将数据旁路模块bypass放在译码阶段（id），与教材中放在执行阶段不同，原因是可以减少寄存器堆的一个读端口（译码to执行阶段 写寄存器的时候，Write back阶段已经将数据写入到寄存器堆中，所以要单独设置一个读端口读取写入寄存器堆的数据）</p><p>数据旁路的数据来源有四个：</p><ol><li>id译码阶段的寄存器堆输出 </li><li>exe执行阶段的结果 </li><li>ls访存阶段的结果 </li><li>wb写回阶段的结果</li></ol><img src="/2024/021950375/image-20240220111048796.png" alt style="zoom: 33%;"><p>判断条件:  </p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token function">if</span><span class="token punctuation">(</span> <span class="token punctuation">(</span>rs1_id <span class="token operator">==</span> xx_rdid<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>xx_rdwen<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>rs1_id <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>发生数据旁路<span class="token keyword">else</span>     不发生数据旁路<span class="token comment">// 如果源寄存器的id为0时，不能进行数据旁路，因为默认寄存器堆的0号寄存器值常0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>特别：如果在exe阶段的指令是load指令，且发生了数据冒险，需要将流水线停顿一拍，等待进入访问阶段才能得到真正的数据</strong>。 这种情况称为” load use”型指令，需要发出stall和nop使能。</p><p><img src="/2024/021950375/image-20240220134957838.png"></p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">assign</span> stall <span class="token operator">=</span> <span class="token punctuation">(</span>rs1id <span class="token operator">==</span> ex_rdid<span class="token punctuation">)</span><span class="token operator">||</span><span class="token punctuation">(</span>rs2id <span class="token operator">==</span> ex_rdid<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> ex_rdwen <span class="token operator">&amp;&amp;</span> ex_lden<span class="token keyword">assign</span> nop <span class="token operator">=</span> stall<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="控制冒险"><a href="#控制冒险" class="headerlink" title="控制冒险"></a>控制冒险</h2><p>控制冒险的处理放在译码阶段，而不是执行阶段，这样做可以提前决定指令执行顺序；</p><p>采用静态分支预测方式，当预测失败时，PC地址发生跳转，跳转地址在bru中计算得到；否则，执行PC+4。</p><img src="/2024/021950375/image-20240220144307189.png" alt style="zoom: 50%;"><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">assign</span> nop <span class="token operator">=</span> jalr <span class="token operator">||</span> jal <span class="token operator">||</span> brch<span class="token punctuation">;</span><span class="token keyword">assign</span> jump_en <span class="token operator">=</span> nop<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><img src="/2024/021950375/image-20240220150606788.png" alt style="zoom: 50%;"><p>针对跳转指令后的冲刷，如果没有取指令单元是组合逻辑，IF_ID寄存器直接冲刷即可。 如果取指令是时序逻辑，在冲刷IF_ID时，有可能指令还没得到，导致无法及时冲刷，在下个周期写入到IF_ID寄存器中，导致错误。所以在写入到IF_ID时需要判断PC出来的addr和写入IF_ID的地址是不是一致的，如果是一致的，就可以写入。</p><p>对于带cache的方案，当时hit没有命中时，会进行读分配操作，在IDLE时进行hit判断，即使发生了跳转，addr发生了变化，也不会hit，所以无需担心，不能彻底冲刷流水线的问题。</p><p>对于只有axi的方案，需要在写入IF_ID时，判断来自pc的地址和 ifu模块锁存的地址是否一致，只有一致才写入。</p><h2 id="数据冒险-控制冒险-冲突"><a href="#数据冒险-控制冒险-冲突" class="headerlink" title="数据冒险+控制冒险 冲突"></a>数据冒险+控制冒险 冲突</h2><p>当译码阶段的指令是jalr时，rs1发生了数据冒险，且是load-use类型，bypass模块发出stall和nop信号；bru模块发出jump和nop信号。对于IF_ID寄存器，同时收到了bypass的stall和bru的nop信号。<strong>此时，产生了冒险冲突</strong></p><p>解决办法：<strong>先stall处理完数据冒险，再nop处理控制冒险保证处理控制冒险时，跳转地址的计算是正确的。</strong></p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">&#x2F;&#x2F; exauipc a5 0x0ld   a5 595(a5)jalr  a5 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2024/021950375/image-20240220152550379.png"></p><h2 id="代码调试-DiffTest"><a href="#代码调试-DiffTest" class="headerlink" title="代码调试-DiffTest"></a>代码调试-DiffTest</h2><p>思路：找一个正确的版本作为参考，自己的设计每条指令执行后的结果（寄存器堆和内存的状态）进行对比，不一致就停止执行，报告错误。为了实现Difftest，需要在DUT和REF之间定义一些接口函数。</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// 在DUT host memory的`buf`和REF guest memory的`addr`之间拷贝`n`字节,</span><span class="token comment">// `direction`指定拷贝的方向, `DIFFTEST_TO_DUT`表示往DUT拷贝, `DIFFTEST_TO_REF`表示往REF拷贝</span><span class="token comment">// 完成将程序的bin文件拷贝到nemu中，大块内存的拷贝</span><span class="token keyword">void</span> <span class="token function">difftest_memcpy</span><span class="token punctuation">(</span><span class="token class-name">paddr_t</span> addr<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>buf<span class="token punctuation">,</span> <span class="token class-name">size_t</span> n<span class="token punctuation">,</span> bool direction<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// `direction`为`DIFFTEST_TO_DUT`时, 获取REF的寄存器状态到`dut`;</span><span class="token comment">// `direction`为`DIFFTEST_TO_REF`时, 设置REF的寄存器状态为`dut`;</span><span class="token comment">// dut的数据顺序 npc和nemu需要一致。</span><span class="token keyword">void</span> <span class="token function">difftest_regcpy</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>dut<span class="token punctuation">,</span> bool direction<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 让REF执行`n`条指令</span><span class="token keyword">void</span> <span class="token function">difftest_exec</span><span class="token punctuation">(</span><span class="token class-name">uint64_t</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 初始化REF的DiffTest功能</span><span class="token keyword">void</span> <span class="token function">difftest_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在nemu中配置相关参数，生成动态库文件<code>ref_so_file</code></p><p>在npc中，需要对动态库文件进行初始化。通过 <strong>动态链接对动态库中的API符号进行解析和重定位，返回他们的函数地址</strong>，调用接口函数对REF进行初始化，将DUT的内存拷贝到REF中，将DUT的寄存器状态也拷贝到REF中，保证REF和DUT处于同样的状态。</p><p>在合适的位置调用REF的步进函数<code>ref_difftest_exec(1)</code>，然后将REF的寄存器堆数据传递到npc中，完成数据的对比，如果一致，则表示执行正确，否则停止执行，并打印错误的结果。</p><p>上面的数据比对是在c一侧，需要将verilog声明的数组通过DPI-C传递到C侧。</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">extern</span> <span class="token string">"C"</span> <span class="token keyword">void</span> <span class="token function">set_gpr_ptr</span><span class="token punctuation">(</span><span class="token keyword">const</span> svOpenArrayHandle r<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  cpu_gpr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">uint64_t</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>VerilatedDpiOpenVar<span class="token operator">*</span><span class="token punctuation">)</span>r<span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">datap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="结构冒险"><a href="#结构冒险" class="headerlink" title="结构冒险"></a>结构冒险</h2><p>由于只有一个内存空间，在取指阶段和访存阶段同时需要访问SRAM时，发生控制冒险。<br>解决措施：流水线停顿stall，Dcache优先级高于Icache，保证取数据优先，取数据完成后继续取指令。</p><p>在译码和写回阶段时，需要读取和写入寄存器的值，当访问的地址一样时，发生结构冒险。<br>解决措施：判断读出和将要写入的地址一致时，直接将写入的结果旁路给读出的变量。</p><h2 id="流水线-思考"><a href="#流水线-思考" class="headerlink" title="流水线-思考"></a>流水线-思考</h2><p>发出反压信号stall时，会让整个流水线停顿下来；<br>原因是每级流水的上下游没有握手和反压，当需要反压时，只能跨级反压，并且让所有的寄存器保持不变；</p><p><strong>如果每级流水都有响应的握手信号，就可以进行逐级反压，上面流水线不一定全部停顿下来，可以进一步提高效率</strong></p><h4 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h4><p>实现srlw指令出现的问题：</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">wire</span> <span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> srlw<span class="token punctuation">;</span> <span class="token important">always</span> srlw <span class="token operator">=</span> <span class="token operator">&#123;&#123;</span><span class="token number">32</span><span class="token operator">&#123;</span>data_A<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">]</span><span class="token operator">&#125;&#125;</span><span class="token punctuation">,</span> <span class="token operator">&#123;</span>data_A<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">>></span> data_B<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">&#125;&#125;</span> <span class="token comment">// right</span><span class="token important">always</span> srlw <span class="token operator">=</span> <span class="token operator">&#123;</span><span class="token number">32'b0</span><span class="token punctuation">,</span> <span class="token operator">&#123;</span>data_A<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">>></span> data_B<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">&#125;&#125;</span>  <span class="token comment">// wrong</span><span class="token comment">// 存在特殊情况，如果data_A[31]为1，且data_B为0，srlw的高32位应该全为1.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>如果srlw指令中的data_B &gt;&#x3D; 1，srlw结果高32bit都为0，两种方式的结果一致；<br>如果srlw指令中的data_B &#x3D; 0，data_A的第32bit为0，两种方式结果一致；<br>如果srlw指令中的data_B &#x3D; 0，data_A的第32bit为1，两种方式结果不一致；第一种是正确的。</p><h2 id="分支预测"><a href="#分支预测" class="headerlink" title="分支预测"></a>分支预测</h2><h3 id="静态分支预测"><a href="#静态分支预测" class="headerlink" title="静态分支预测"></a>静态分支预测</h3><p>认为分支跳转或者不跳转，有50%的命中率。</p><img src="/2024/021950375/image-20240722200708161.png" alt="image-20240722200708161" style="zoom: 50%;"><h3 id="动态分支预测"><a href="#动态分支预测" class="headerlink" title="动态分支预测"></a>动态分支预测</h3><h4 id="两位饱和计数器"><a href="#两位饱和计数器" class="headerlink" title="两位饱和计数器"></a>两位饱和计数器</h4><p>连续两次跳转或者不跳转，下次才可以判断出 <strong>跳转或者不跳转</strong></p><p><img src="/2024/021950375/image-20240722201032850.png" alt="image-20240722201032850"></p><p>缺点</p><p><img src="/2024/021950375/image-20240722201703859.png" alt="image-20240722201703859"></p><h4 id="PHT（Pattern-History-Table）"><a href="#PHT（Pattern-History-Table）" class="headerlink" title="PHT（Pattern History Table）"></a>PHT（Pattern History Table）</h4><p>有很多两位饱和计数器，选择部分pc值（某些比特位）作为索引。</p><p><img src="/2024/021950375/image-20240722233858059.png" alt="image-20240722233858059"></p><p><img src="/2024/021950375/image-20240722201409392.png" alt="image-20240722201409392"></p><p><img src="/2024/021950375/image-20240722201420902.png" alt="image-20240722201420902"></p><h4 id="基于局部历史的分支预测"><a href="#基于局部历史的分支预测" class="headerlink" title="基于局部历史的分支预测"></a>基于局部历史的分支预测</h4><p>引入BHR（Branch History Register），使用BHR寄存器来记录有一条指令在过去的历史状态。首先，用指令（beq）的PC中的K位去寻找一个n位的BHR，n表示记录一个指令的n个历史结果。将BHR中n bits值和PC中t bits做一定的操作，查找PHT得到预测值。</p><p><img src="/2024/021950375/image-20240723003728648.png" alt="image-20240723003728648"></p><h4 id="基于全局历史的分支预测"><a href="#基于全局历史的分支预测" class="headerlink" title="基于全局历史的分支预测"></a>基于全局历史的分支预测</h4><p>引入GHR（Global History Register），记录所有跳转指令的结果。将GHR的数据和PC中某些bits做一定操作，索引PHT，得到预测值。</p> <img src="/2024/021950375/image-20240723003842439.png" alt="image-20240723003842439" style="zoom:50%;"><blockquote><p>参考</p><p><a href="https://yufoo1.github.io/docs/superscalar-processor-architecture/branch-prediction/#%E5%88%86%E6%94%AF%E9%A2%84%E6%B5%8B%E7%9A%84%E6%9B%B4%E6%96%B0">https://yufoo1.github.io/docs/superscalar-processor-architecture/branch-prediction/#%E5%88%86%E6%94%AF%E9%A2%84%E6%B5%8B%E7%9A%84%E6%9B%B4%E6%96%B0</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 体系结构 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 一生一芯 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>awk用法</title>
      <link href="/2024/021721611.html"/>
      <url>/2024/021721611.html</url>
      
        <content type="html"><![CDATA[<h3 id="Awk处理文本数据"><a href="#Awk处理文本数据" class="headerlink" title="Awk处理文本数据"></a><strong>Awk处理文本数据</strong></h3><p>格式：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">awk</span> <span class="token punctuation">[</span>选项<span class="token punctuation">]</span> ‘匹配规则和处理规则’  <span class="token punctuation">[</span>处理文本路径<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>处理规则：</p><p>BEGIN{}: BEGIN是在awk处理文本之前运行</p><p><strong>&#x2F; &#x2F; ： 使用的匹配原则</strong></p><p>{}：循环（每次处理一行）</p><p>END{}: 当所有行执行完毕后，执行END的操作</p></li></ul><p>原理：</p><ol><li><p>awk会接收一行作为输入，将这一行赋给awk的内部变量$0，行的边界是以换行符作为结束的。</p></li><li><p>刚刚读入的行被以:为分隔符分解成若干字段（或域），每个字段存储在已编号的变量中，编号从$1开始，最多达100个字段，-F 指定分隔符，默认是空格。</p></li><li><p>使用print打印，如果$1$3之间没有逗号，输出时贴在一起，如果添加”,”，$1和$3之间默认用空格分开，通过OFS修改输出的间隔符   ‘BEGIN{OFS&#x3D;”-“}{print $1,$3}’</p></li><li><p>输出后，获取下一行，执行上述操作</p></li></ol><h5 id="awk变量"><a href="#awk变量" class="headerlink" title="awk变量"></a><strong>awk变量</strong></h5><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">$<span class="token variable">0</span>:当前行的内容NR：行号NF: 总字段数FS：输入字段分隔符，默认空格OFS：输出字段分隔符<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">awk</span> -F: <span class="token string">'&#123;if(NR > 7)&#123;print NR,$0&#125;&#125;'</span> /etc/passwd<span class="token operator">==</span> <span class="token function">awk</span> -F: <span class="token string">'NR > 7 &#123;print NR,$0&#125;'</span> /etc/passwd// 输出第7行之后的内容指定<span class="token string">','</span>作为分隔符，-F<span class="token string">','</span>-F:  ：表示以<span class="token string">':'</span>作为分隔符<span class="token function">awk</span> -F<span class="token string">':'</span> <span class="token string">'BEGIN&#123;FS=","&#125;&#123;print $1,$2&#125;'</span> FS的优先级大于-F指定的输出指定分隔符<span class="token function">awk</span> -F<span class="token string">':'</span> <span class="token string">'BEGIN&#123;OFS=" >>> "&#125;&#123;print $1,$2&#125;'</span><span class="token function">awk</span> -F<span class="token string">','</span> <span class="token string">'BEGIN&#123;OFS=" "&#125;&#123;print $1,$3&#125;END&#123;print xx&#125;'</span><span class="token function">awk</span> -F<span class="token string">':'</span> <span class="token string">'/root/ &#123;print $1,$3&#125;'</span><span class="token function">awk</span> -F<span class="token string">':'</span> <span class="token string">'/root/ &#123;printf "%-10s %-10s", $1,$3&#125;'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>正则表达式</strong></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">awk</span> -F: <span class="token string">'/^xxx/'</span> /etc/passwd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>条件模式</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">awk</span> -F: <span class="token string">'NR > 7'</span> /etc/passwd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>算数运算</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">awk</span> -F: <span class="token string">'&#123;print $1,$2+1&#125;'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>if判断</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">单分支：<span class="token function-name function">if</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>双分支：<span class="token function-name function">if</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>多分支：<span class="token function-name function">if</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token function-name function">if</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ls</span> * <span class="token operator">|</span> <span class="token function">uniq</span>   剔除重复行<span class="token function">ls</span> * <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-u</span> <span class="token function">wc</span> 行数<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Sed处理文本数据"><a href="#Sed处理文本数据" class="headerlink" title="Sed处理文本数据"></a><strong>Sed处理文本数据</strong></h3><p>非交互式的，流编译器sed。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token string">"command"</span> files<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>sed和grep不同，不管是否找到匹配的模式，退出都返回0.只有命令存在语法错误时返回1.<br>sed在文件查找模式中时，也可以使用正则表达式RE和各种元字符。正则表达式在斜杠&#x2F;&#x2F;之间。</p><p>扩展元字符集： ？，+，{}，|，()</p><img src="/2024/021721611/image-20240521094609655.png" alt="image-20240521094609655" style="zoom:50%;"><h6 id="选项"><a href="#选项" class="headerlink" title="选项"></a>选项</h6><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>-r<span class="token punctuation">]</span> 支持扩展元字符<span class="token punctuation">[</span>-i<span class="token punctuation">]</span> 修改源文件<span class="token punctuation">[</span>-n<span class="token punctuation">]</span> 取消默认输出<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h5 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h5><h6 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h6><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> <span class="token parameter variable">-r</span> <span class="token string">"3&#123;d;&#125;"</span> filename <span class="token comment"># ;用来隔开命令 </span><span class="token function">sed</span> <span class="token parameter variable">-r</span> <span class="token string">"/root/&#123;n;d&#125;"</span> filename<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h6 id="替换"><a href="#替换" class="headerlink" title="替换"></a>替换</h6><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> <span class="token parameter variable">-r</span> <span class="token string">"s/root/alice/gi"</span> filename<span class="token comment"># g:global, i:ingore 大小写</span><span class="token function">sed</span> <span class="token parameter variable">-r</span> <span class="token string">"s/[0-9]\&#123;2\&#125;$/#&amp;/"</span> filename<span class="token comment"># &amp;表示查找串中匹配到的内容  </span><span class="token function">sed</span> <span class="token parameter variable">-r</span> <span class="token string">"s/root/&amp;LIU/g"</span>filename<span class="token comment"># 在root后面加LIU</span><span class="token function">sed</span> <span class="token parameter variable">-r</span> <span class="token string">"s/^/#/"</span>filename <span class="token comment"># 在开头加 #</span><span class="token function">sed</span> <span class="token parameter variable">-r</span> <span class="token string">"/root/&#123;n;s/bin/uuu/g&#125;"</span> filename <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="查找"><a href="#查找" class="headerlink" title="查找"></a>查找</h6><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> <span class="token parameter variable">-r</span> <span class="token string">"/root/d"</span> filename<span class="token comment">#d 删除</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h6 id="追加"><a href="#追加" class="headerlink" title="追加"></a>追加</h6><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> <span class="token parameter variable">-r</span> <span class="token string">"2a111111"</span> filename <span class="token comment">#第二行后面追加111111 </span><span class="token function">sed</span> <span class="token parameter variable">-r</span> <span class="token string">"2i111111"</span> filename <span class="token comment">#第二行前面追加111111 </span><span class="token function">sed</span> <span class="token parameter variable">-r</span> <span class="token string">"2c111111"</span> filename <span class="token comment">#第二行替换·111111 </span><span class="token function">sed</span> <span class="token parameter variable">-r</span> <span class="token string">"2a111111\111111"</span><span class="token comment">#第二行追加多行</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="反向选择"><a href="#反向选择" class="headerlink" title="反向选择"></a>反向选择</h6><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> <span class="token parameter variable">-r</span> <span class="token string">"3d"</span> filename <span class="token function">sed</span> <span class="token parameter variable">-r</span> <span class="token string">"3!d"</span> filename <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h6 id="修改文件"><a href="#修改文件" class="headerlink" title="修改文件"></a>修改文件</h6><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> <span class="token parameter variable">-ri</span> <span class="token string">"<span class="token variable">$a123456789</span>"</span> filename<span class="token function">sed</span> <span class="token parameter variable">-ri</span> <span class="token string">"/^SELINUX=/cSELINUX=disaled"</span> filename  <span class="token comment">#查找SELINUX开头的行，并替换</span><span class="token function">sed</span> <span class="token parameter variable">-r</span> <span class="token string">"2,6s/.*/#$/"</span> filename 添加注释<span class="token function">sed</span> <span class="token parameter variable">-r</span> <span class="token string">"2,6s/(.*)/#<span class="token entity" title="\1">\1</span>/"</span> filename 添加注释<span class="token function">sed</span> <span class="token parameter variable">-r</span> <span class="token string">"1,5s/^#*/#/"</span> filename 添加注释<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="删除-1"><a href="#删除-1" class="headerlink" title="删除"></a>删除</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 决定对哪些行处理</span><span class="token function">sed</span> <span class="token parameter variable">-r</span> <span class="token string">"/root/,5d"</span> filename<span class="token comment">#root后，删除到第5行 </span><span class="token function">sed</span> <span class="token parameter variable">-r</span> <span class="token string">"/root/,+5d"</span> filename  <span class="token comment">#root后，删除5行</span><span class="token function">sed</span> <span class="token parameter variable">-r</span> <span class="token string">"/root/!5d"</span> filename  <span class="token comment">#取反删除</span><span class="token function">sed</span> <span class="token parameter variable">-r</span> <span class="token string">"1,4d"</span> filename<span class="token function">sed</span> <span class="token parameter variable">-r</span> <span class="token string">"1~2d"</span> filename <span class="token comment">#删除奇数行</span><span class="token function">sed</span> <span class="token parameter variable">-r</span> <span class="token string">"0~2d"</span> filename <span class="token comment">#删除偶数行以0行开始，间隔2行删除。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="模式空间和暂存空间"><a href="#模式空间和暂存空间" class="headerlink" title="模式空间和暂存空间"></a>模式空间和暂存空间</h4><p><img src="/2024/021721611/image-20240521135320324.png" alt="image-20240521135320324"></p><p>小写g和h是覆盖。小写G和H是追加。  暂存空间只有一个。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> <span class="token parameter variable">-r</span> <span class="token string">"1h;<span class="token variable">$G</span>"</span> filename<span class="token function">sed</span> <span class="token parameter variable">-r</span> <span class="token string">"1h;2,<span class="token variable">$g</span>"</span> filename <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="正则表达式RE"><a href="#正则表达式RE" class="headerlink" title="正则表达式RE"></a>正则表达式RE</h3><p>处理文本，做匹配。正则表达式放在两个双斜杠之间<code>//</code></p><h4 id="元字符"><a href="#元字符" class="headerlink" title="元字符"></a>元字符</h4><p>^ ：匹配行开头<br>[0-9]：匹配数字<br>+：至少一个<br>$：匹配行结尾<br>. ：匹配任意单个字符<br>*：前导符出现0次或多次，*b &#x3D;&gt;    b, bb<br>.*：任意多个字符<br>[]：匹配指定范围内的一个字符，[Aa]<br>[ - ]：匹配指定范围内的一个字符，[a-z]<br>[ ^ ]：匹配不在指定范围内的一个字符，[^a-z]<br>\：转义元字符<br><strong>\&lt;：词首定位符**<br>**\&gt;：词尾定位符</strong><br>x\{m\}：字符重复出现m次   o\{5\}<br>x\{m,\}：字符重复出现m次以上<br>x\{m,n\}：字符重复出现（m,n）次<br>\(..\) ：后面匹配时所用到的标签 %s#\(10.2\).3#\1.4# </p><p>扩展正则表达式元字符</p><p>+：匹配一个或者多个前导字符<br>？：匹配零个或一个前导字符<br>a|b：匹配a或b<br>()：组字符 </p><img src="/2024/021721611/image-20240520220050065.png" alt="image-20240520220050065" style="zoom:33%;"><p>shell中的通配符 * ：任意多个字符，由shell来解析；shell中的<code>.</code>相当于正则中的<code>?</code>，匹配单个字符。<br>正则表达式元字符：由各种模式匹配操作的程序来解析，比如grep，sed，awk</p><p>grep中，匹配模式在“ ”之间指出，可以匹配多个文件。</p><h3 id="grep-文本处理"><a href="#grep-文本处理" class="headerlink" title="grep 文本处理"></a>grep 文本处理</h3><p>grep [选项] PATTERN filename1 filename2grep “\-v” filename<br>打印出匹配模式的行</p><p>返回值：0表示找到，1表示没找到，2表示找不到指定的文件</p><p>ps aux| grep “sshd”</p><p>\w  所有字母和数字 [0-9a-zA-Z]<br>\W 所有字母和数字之外的字符，非字符<br>\b  词边界\&lt;  &#x3D;&gt; \b</p><p>[-v] 取反<br>[-q] 静默<br>[-i]   忽略大小写<br>[-r]  递归文件夹寻找<br>[-o]  只显示匹配的内容<br>[-c]  匹配的上下文两行<br>[-a]  匹配的后两行<br>[-b]  匹配的前两行</p>]]></content>
      
      
      <categories>
          
          <category> Linux基础知识 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> awk文本处理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AXI协议</title>
      <link href="/2024/02077053.html"/>
      <url>/2024/02077053.html</url>
      
        <content type="html"><![CDATA[<h4 id="乱序ID"><a href="#乱序ID" class="headerlink" title="乱序ID"></a>乱序ID</h4><p>给定ID事务的所有transfer需要进行排序，而不同ID事务的transfer没有顺序限制。</p><p>同一个事务的AWID、WID和BID是一样的，ARID和RID是一样的。</p><p>不同的transition可以有相同的ID，在执行时必须顺序返回。</p><h3 id="AXI协议"><a href="#AXI协议" class="headerlink" title="AXI协议"></a>AXI协议</h3><h4 id="AXI3和AXI4的区别"><a href="#AXI3和AXI4的区别" class="headerlink" title="AXI3和AXI4的区别"></a>AXI3和AXI4的区别</h4><h5 id="1-Burst"><a href="#1-Burst" class="headerlink" title="1. Burst"></a>1. Burst</h5><p>AXI4对burst length进行了扩展<br>AXI4支持最大256 beats，AxLEN位宽为8；AXI3最大支持burst 16 beats，AxLEN位宽为4；</p><p>只有INCR burst类型，才支持burst 超过16 beats</p><p><img src="/2024/02077053/image-20240207000854573.png"></p><p>实际使用中，很少使用burst超过16 beats的操作，因为长时间占用总线会影响系统性能。而且burst 一旦开始，无法停止。</p><p>axi4协议规定 一次burst，最多传输256笔数据。</p><p>fixed 向固定地址写入数据，适用于向FIFO写入数据，</p><p>incr：block memory传输</p><p>wrap：cacheline，一般cacheline大小为8*8bytes，DRAM数据总线是64bit(8bytes)，burst len为7；</p><h5 id="2-Write-interleaving"><a href="#2-Write-interleaving" class="headerlink" title="2. Write interleaving"></a>2. Write interleaving</h5><p>Q：WID取消了，为啥还有AWID？</p><p>AXI4去掉了WID，不再支持写交织（write interleaving）。<br>这就限制了写入的数据必须和写入的地址顺序相同且连续。不同write burst的beat不可以相互交织。</p><p>原因：发送端必须要缓存多个ID的wdata，不管是maser还是总线interconnection都必须要增加大量的缓存，所以增加了面积；另外，Write interleaving增加了系统总线设计的复杂度，而且很容易造成死锁。</p><p>WID是为了写交织的，因为AXI4规定所有写数据都要顺序发送，AWID是针对多个transition，支持乱序。</p><h5 id="3-Write-response-dependencies"><a href="#3-Write-response-dependencies" class="headerlink" title="3. Write response dependencies"></a>3. Write response dependencies</h5><p>修改了BVALID拉高的要求</p><p>AXI3握手依赖</p><p><img src="/2024/02077053/v2-0160a446a10236e56609b0bc7fcc541e_1440w.png"></p><p>AXI3必须等到了WVALID和WREADY后才能把BVALID置高来响应，也就是说只要收到了所有数据，SLAVE就可以发写响应。</p><p>AXI4握手依赖</p><p><img src="/2024/02077053/v2-12a2457485825157ceaaa25f358b7ae7_1440w.png"></p><p>​AXI4规定，必须等到AWVALID,AWREADY,WVALID, WREADY, and WLAST 都为高(不是同一时刻都为高)后，SLAVE才能发BVALID进行写响应。也就是不仅仅要等数据通道握手，而且要等地址通道握手，并且明确了要等WLAST。这样能保证响应的时候Transaction是真正完成的。</p><p><img src="/2024/02077053/image-20240720001925305.png" alt="image-20240720001925305"></p><p>针对AXI4协议，不支持写交织，所以在master一侧，必须按照写地址的顺序进行写数据的传输，且在master一侧不可以进行写交织，因为没有WID。如果是AXI3协议，是可以支持写交织的。</p><p><img src="/2024/02077053/82a7e18995b611b1ca1956e10247545.png" alt="82a7e18995b611b1ca1956e10247545"></p><h5 id="4-Locked-transactions-原子访问"><a href="#4-Locked-transactions-原子访问" class="headerlink" title="4. Locked transactions   原子访问"></a>4. Locked transactions   原子访问</h5><p>​AXI4去掉了locked 传输。AxLOCK缩为2bit，AxLock选择是否进行独占访问，BRESP和RRESP信号表示独占访问的成功或失败。slave必须提供额外的逻辑来支持独占访问。</p><img src="/2024/02077053/v2-52896f5fa4a0dfe4c2c6a4a4645664a9_1440w.png" alt style="zoom:67%;"><p>​Locked access作用的对象是总线，一旦发生Locked access，那么其他的master都不能使用总线了，在一个复杂的SOC系统中，Locked access对系统的影响就太大了，万一发生Locked access的master出点啥问题，整个系统就挂死了。</p><p>​Exclusive access 作用的对象是对应的Slave，支持Exclusive access的Slave会在slave中实现一个Exclusive access monitor，如果monitor记录了能够访问的master，那么对应的master就能通过Exclusive access来访问，其他的未记录的Exclusive access就都不能访问。Exclusive access对总线系统是没有要求的，只是对slave做了特殊要求，即使出错也不会影响系统其他部分，最多访问失败而已。独占访问机制不需要将总线保持锁定在特定的master，不影响其他master访问总线。</p><h5 id="独占访问的过程"><a href="#独占访问的过程" class="headerlink" title="独占访问的过程"></a>独占访问的过程</h5><ol><li><p>主机对slave的一个地址进行独占读操作，从机记录该事务的arid和地址。</p></li><li><p>一段时间后，对相同地址进行独占写来完成独占操作。</p></li><li><p>如果在读取和写入访问之间没有其他master写入该位置，则独占访问成功。<br>如果另外一个master在读写访问之间对该地址进行了写操作，</p><p>slave将awid和arid进行比较，如果一致，说明该地址没有被其他主机访问，返回EXOKAY，否则返回OKAY，独占访问失败。</p></li></ol><p>独占读添加一个slave的表项，独占写查表判断是否hit，hit返回exokay，否则返回okay。</p><h6 id="master视角下的独占访问"><a href="#master视角下的独占访问" class="headerlink" title="master视角下的独占访问"></a>master视角下的独占访问</h6><p>master通过执行独占读来启动独占操作，通常会从salve返回exokay响应，表明slave记录了要监视的地址。</p><p>如果master尝试从不支持独占访问的slave进行独占读取，则salve返回okay而不是exokay响应，master可以视为不支持独占访问的错误条件，建议master不要再发出独占写操作。</p><p>在独占读操作完成之前，master不得开始独占写操作。</p><h6 id="slave视角下的独占访问"><a href="#slave视角下的独占访问" class="headerlink" title="slave视角下的独占访问"></a>slave视角下的独占访问</h6><p>支持独占访问的slave必须具有监视器硬件，需要为每个master ID设置一个监视单元。单端口的slave可以在外部设置一个标准的独占访问监视器，多端口的salve可能需要内部监视。</p><p>独占监视器巨鹿任何独占读操作的地址和ARID值，并监视该位置，直到该位置被执行写入操作，或者一个具有相同ARID值的独占读取将监视器的地址替换。</p><p>监视器会监视AWID和AWADDR是否和监视器中的记录一致，一致返回EXOKAY，否则OKAY</p><h6 id="独占访问的限制"><a href="#独占访问的限制" class="headerlink" title="独占访问的限制"></a>独占访问的限制</h6><ul><li>独占访问的任务，读和写的ID、大小和长度等控制信号必须一致。</li><li>地址必须和传输字节数对齐。</li><li>独占访问的突发长度不能超过16 transfer。</li></ul><p>对于不支持独占访问的从设备，独占写总是会更新内存。对于不支持独占访问的从设备，只有在独占写成功时，才会更新内存。</p><h5 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h5><h4 id="大小端问题"><a href="#大小端问题" class="headerlink" title="大小端问题"></a>大小端问题</h4><p>小端对齐：低字节在低地址；<br>大端对齐：低字节在高地址；</p><p><img src="/2024/02077053/image-20240327100544616.png" alt="image-20240327100544616"></p><h4 id="窄传输"><a href="#窄传输" class="headerlink" title="窄传输"></a>窄传输</h4><p>当数据传输的位宽小于数据总线的位宽时，称为窄位宽传输。通常通过wstrb来控制哪些字节有效。<br>当从机自身限制或者其他客观条件时，比如从机每次只能接收1个字节数据，且不能缓冲多字节数据，<strong>主机就要进行窄传输。</strong>可以将传输数据都放在数据总线上，每次传输只需要改变wstrb即可。</p><p>32位数据总线，wstrb为4bit；64位数据总线，wstrb是8bit。</p><h4 id="信号说明"><a href="#信号说明" class="headerlink" title="信号说明"></a>信号说明</h4><p>size[2:0]：</p><p>AXI-Lite协议<br>    不支持突发传输，且每次传输一个数据，没有last信号；<br>    支持多master，多slave</p><p>AXI和AHB传输对比：<br>    AHB突发传输的 每次传输都需要发送地址；并且每次传输都是先发地址，再传输数据；<br>    AXI突发传输，只要第一次传输地址即可，后续的地址都是计算出来的；地址和数据可以乱序，提供总线效率</p><h5 id="4K边界问题"><a href="#4K边界问题" class="headerlink" title="4K边界问题"></a>4K边界问题</h5><p>在划分slave地址范围时，划分的最小单位是4K字节的地址范围。为了防止在传输过程中，出现访问slave跨界问题，需要针对跨越4k边界的传输进行处理：1. 超过4k边界的地址直接舍弃 2. 分成两次传输</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog">addr<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=></span> <span class="token number">2</span><span class="token operator">^</span><span class="token function">12</span><span class="token punctuation">(</span><span class="token number">4</span>K<span class="token punctuation">)</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="握手信号间的关系"><a href="#握手信号间的关系" class="headerlink" title="握手信号间的关系"></a>握手信号间的关系</h5><p>valid信号拉高后，必须等到ready信号拉高后，才能拉低。<br>ready信号不受控制，即使在拉高ready信号后，只要发送方没有拉高valid信号，接收方仍然可以拉低ready信号。</p><p>协议建议AW、AR通道的ready信号默认为高电平，否则需要两个周期才可以完成地址通道的握手。第一个周期拉高valid信号，第二个周期拉高ready信号，并完成握手。</p><h5 id="互联结构类型"><a href="#互联结构类型" class="headerlink" title="互联结构类型"></a>互联结构类型</h5><p>点到点型：不同master的五个通道可以独立连接到不同的salve端口。</p><img src="/2024/02077053/image-20240614233224590.png" alt="image-20240614233224590" style="zoom:50%;"><p>共享型：多个master的五个通道是共享的，当一个master传输时，其他master不可以进行。</p><img src="/2024/02077053/image-20240614233338740.png" alt="image-20240614233338740" style="zoom:50%;"><p>混合型：兼容以上两种互联特点</p><img src="/2024/02077053/image-20240614233407024.png" alt="image-20240614233407024" style="zoom:50%;"><h4 id="提高AXI总线性能"><a href="#提高AXI总线性能" class="headerlink" title="提高AXI总线性能"></a>提高AXI总线性能</h4><p>在AXI矩阵总线中的较长组合逻辑上，添加一级寄存器，切断关键路径，但是会带来一个周期的总线延迟。</p><h4 id="减小总线的面积"><a href="#减小总线的面积" class="headerlink" title="减小总线的面积"></a>减小总线的面积</h4><p>在总线矩阵中，并非所有的slave都需要访问所有的master，根据系统需求，减小master2slave访问关系。</p><h4 id="AXI-FULL和AXI-LITE区别"><a href="#AXI-FULL和AXI-LITE区别" class="headerlink" title="AXI-FULL和AXI-LITE区别"></a>AXI-FULL和AXI-LITE区别</h4><ul><li><p>AXI-LITE只有single传输，不支持突发传输。AXI4-LITE低吞吐量，适合配置寄存器。</p></li><li><p>AXI-LITE只有一个主机master，多个slave，没有仲裁器。</p></li><li><p>AXI-FULL支持突发传输，outstanding，乱序，交织等。</p></li><li><p>AXI-FULL支持多主多从，有仲裁器。数据吞吐量大，适合大规模的数据传输。</p></li></ul><h4 id="AXI和AHB协议的区别"><a href="#AXI和AHB协议的区别" class="headerlink" title="AXI和AHB协议的区别"></a>AXI和AHB协议的区别</h4><p>AHB是一种高性能、低延迟数据传输的协议，AXI是一种更先进的协议，提供更高的吞吐量和灵活性。</p><p>AHB是一种单通道总线，读写只能有一个进行。AXI灵活性更好，读写可以同时进行。允许插入fifo缓冲数据，可以进一步提高总线性能，降低延迟。</p><p>分配给每个从机的最小地址范围：AHB为1KB，AXI为4KB。</p><p>AHB不支持乱序，交织，AXI支持乱序。</p><p>AHB低功耗，AXI高功耗。</p><p>AHB不支持写选通，AXI支持。</p><p>与AXI相比，AHB总线延迟在开始传输时较低。</p><p>考虑一种场景：在SRAM中，需要地址和数据都准备好，才可以将数据写入到内存中。如果写数据和写地址不是同时到达的，有两种处理方法：</p><ol><li>故意延迟awready和wready信号，等到awvalid和wvalid同时有效时，产生写数据动作。</li><li>将先到的地址或者数据保存下来，并且控制xready信号的拉高，等到暂存的地址或者数据使用后，可释放ready信号，相当于深度为1的FIFO。</li></ol><h4 id="AXI原子访问"><a href="#AXI原子访问" class="headerlink" title="AXI原子访问"></a>AXI原子访问</h4><p>考虑一个场景：处理器1读取某个地址做相应的运算，再让处理器2写同样的地址，当然不希望处理器1还没有处理完，就被处理器2给改写了，导致处理器1计算的结果不确定。 <strong>最好的方法是处理器1读的时候，处理器2不要去写，等处理器1读完后再去改写。</strong></p><p>在AXI中，用AxLOCK信号处理原子访问。对于AXI3，原子操作分为两种：Exclusive和Locked。AXI4没有Lock传输，只有互斥传输。</p><p>Locked访问：如果master正在访问某个slave，其他master是不允许访问这个salve的，需要仲裁器支持这个机制。</p><p>Exclusive访问：不会将整个访问路径都阻塞掉，允许其他master对互斥访问的salve进行访问。在salve中有个监视器记录互斥访问的地址，其他master不允许对其访问。他可能一直处于loop，也可以进入IDLE模式，当互斥访问结束后，通过中断唤醒，再去相应的访问。</p><h4 id="Cache-support"><a href="#Cache-support" class="headerlink" title="Cache support"></a>Cache support</h4><p>如果是CPU发出的读写地址是MMIO的，AxCACHE的信号都不能有效。</p><p><img src="/2024/02077053/image-20240723143123624.png" alt="image-20240723143123624"></p><h2 id="总线性能分析"><a href="#总线性能分析" class="headerlink" title="总线性能分析"></a>总线性能分析</h2><h4 id="总线性能指标"><a href="#总线性能指标" class="headerlink" title="总线性能指标"></a>总线性能指标</h4><p>决定总线接口性能的两个主要特征是 带宽和延迟。</p><p>带宽是总线的位宽，延迟是指事务启动和完成的延迟，在突发传输中，延迟通常指第一次transfer传输完成。</p><p>AXI的读写地址和通道分离，可以有效提高总线带宽。</p><h4 id="AXI、AHB和APB总线"><a href="#AXI、AHB和APB总线" class="headerlink" title="AXI、AHB和APB总线"></a>AXI、AHB和APB总线</h4><p>APB总线适应在低带宽的场景下，APB协议很简单，总是固定的两个周期完成一次数据传输。</p><p>AHB总线适用于连接高性能和高时钟频率的模块。虽然AHB总线可以通过扩展数据位宽提高总线带宽，但在节省功耗的前提下，用户希望通过极窄的总线宽度、极低的总线频率来实现很高的数据吞吐量，AXI总线应运而生。</p><p>AXI总线乱序收发，使得带宽得到了充分利用，可满足高性能SoC的需求。</p><h4 id="AXI和AHB传输特点对比"><a href="#AXI和AHB传输特点对比" class="headerlink" title="AXI和AHB传输特点对比"></a>AXI和AHB传输特点对比</h4><p>AHB是固定的两级流水方式，第一拍传输地址第二拍传输数据。AXI只需要传输一次突发的首地址即可，而且可以传输多次突发任务，并且数据之间可以交织，大大提高了传输的效率。</p><p>当总线中有慢速设备时，乱序的优势就非常明显，提高了总线利用率。</p><h4 id="分析总线性能"><a href="#分析总线性能" class="headerlink" title="分析总线性能"></a>分析总线性能</h4><p><strong>BUS带宽计算</strong></p><p>定义总线上有效数据位宽是B bit，最高工作频率F为100MHz，最大理论带宽为 T &#x3D; F * B bit&#x2F;S。但是一般总线传输都需要握手，无法达到最大带宽。</p><p><strong>传输时间</strong></p><p>单次传输所需的时间（总线授权开始到本次传输结束所需时间&#x2F;周期），每个传输包含一个或多个单个传输，传输时间则有长有短。通常有两种方式描述：</p><ul><li>最大传输时间：设备在传输过程中进行的最大传输所需要的时间</li><li>平均传输时间：设备在传输过程中的平均传输时间</li></ul><p>影响因素包括：</p><ul><li>读&#x2F;写多少数据</li><li>传输过程中的握手环节</li><li>被访问资源的响应速度</li><li>从主设备到从设备所经历的层数、bridge等</li></ul><p><strong>延时</strong></p><p>指主设备发起请求到仲裁结束所需得时间。延迟和传输时间之和为访问时间。</p><img src="/2024/02077053/image-20240802214755617.png" alt="image-20240802214755617" style="zoom:50%;"><h4 id="如何通过代码分析带宽、延迟和传输延迟"><a href="#如何通过代码分析带宽、延迟和传输延迟" class="headerlink" title="如何通过代码分析带宽、延迟和传输延迟"></a>如何通过代码分析带宽、延迟和传输延迟</h4><p>带宽</p><p>分析方法：计算读写握手的次数，并实时输出(counter_r+counter_w)*4&#x2F;T_all * freq；</p><p>延迟</p><p>分析方法：计算awvalid拉高后到awready拉高之间的周期，乘Tclk得到latency</p><p>传输延迟</p><p>分析方法：从写数据通道或者读数据通道的第一次握手开始到最后的写响应通道握手或者读数据的最后一笔之间的周期数，乘Tclk得到传输延迟。</p><h3 id="AXI-BUS-OPT"><a href="#AXI-BUS-OPT" class="headerlink" title="AXI BUS OPT"></a>AXI BUS OPT</h3><p>吞吐量：Throughput</p><p>Maximize Throughput</p><ol><li>match the internal bus throughput with the memory i&#x2F;o(PCIE) throughput.</li><li>增加数据线位宽</li><li>使用interleaving交织</li><li>明确burst突发长度</li><li>设置outstanding的能力</li></ol><p>在slave的接口处理AXI通道的数据，提高吞吐量</p><p><img src="/2024/02077053/image-20240811154753995.png" alt="image-20240811154753995"></p><p>添加FIFO将axi的数据与IP核（SRAM）的信号分隔开，因为IP核的数据吞吐量是受限的，AXI数据流是不受限制的，必须要解耦，将数据缓冲到FIFO中。在Font-end中，数据和地址独立的。在Back-end中，将地址和数据lock绑定在一起，添加一些组合逻辑，完成IP核的操作。</p><p><img src="/2024/02077053/image-20240811155037615.png" alt="image-20240811155037615"></p><p>AXI-stream特点</p><p>用于高速数据流，没有多个通道的概念。只有一对握手信号tready和tvalid；支持无限制的突发传输，没有地址。</p><h3 id="outstanding的讨论"><a href="#outstanding的讨论" class="headerlink" title="outstanding的讨论"></a>outstanding的讨论</h3><p>为什么要加outstanding机制：由于master发起请求后，收到slave返回的响应需要一段延迟，在等待响应的这段时间内数据总线处于等待状态，降低了数据总线利用率。<strong>使用outstanding机制，可以在等待过程中利用该数据总线，提高总线利用率</strong></p><p>master发起请求到得到响应的延迟称为 roundtrip latency；在AXI中，影响该传输延迟的是握手信号的等待时间。</p><h5 id="如何计算最佳outstanding个数"><a href="#如何计算最佳outstanding个数" class="headerlink" title="如何计算最佳outstanding个数"></a>如何计算最佳outstanding个数</h5><p>要根据roundtrip latency来确定最佳outstanding个数。目的是 在latency的时间，数据传输为最大带宽。</p><p><img src="/2024/02077053/image-20240816225613005.png" alt="image-20240816225613005"></p><p>最大带宽：freq_clk * data_width &#x3D; BW</p><p>如果outstanding设置的过大，会导致数据阻塞在master和salve端口，过度占用外部总线的带宽。二是需要更多的资源保存未传输完成的任务，导致资源浪费。</p>]]></content>
      
      
      <categories>
          
          <category> 数字前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 总线协议 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>低功耗设计</title>
      <link href="/2024/020534087.html"/>
      <url>/2024/020534087.html</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="28d1eff5436b4d771896ce5f7f625f47638a081db65cd25143bcd41ecdeb44ac">d5a264002618c049c19ffd39573eb471e1d95d5ba2706c349b6708cbcc9f980eff9ea31fd93b0a455686be9285107678ae06c00c37cc6faea159dff73a1a92ed29f870354a0b1df747973233c0bc32232741cf81c8a851d583dfc6f582b2cf9a0337bcb66e9467dd9c89eaea5856cc4b24794c5eb0d7862365c638f906a65ce4819590bbf8e159c811b5607f275951be59cf753fb764dd26ae5dbdfde88c0733cfa1eb1318c839d013df90d9df02a16507b875496bce17753ed353d480d6e3c66412b33a6928e9855e74e1cd9acfb6c5340bc9f7b7d596fca7590d7ff29aa8d482e4be6d83de569cc718b2a2187093d8a5840932667e965756eb8f7b03279e8e8428d17eae4a8b340efda696d34fdcaac720f5ba2164e1e533a16d2f37dedccfb28e7965da501dba494bdd55f4953a61baa84792dfe7e725a91c5f6da8b05381dec7ffed1e26e8235fbe5be8069fcc62e6f03febcb3104ad27acac06ea36f5c5bc13be6554e29d2f92af7014fae89771ee4fe0aeffcad7374359d30f9ec802bd7eee04d21bd403aea9f151484191bc4ca7414f18200d22c1b7b299860a9fbef9d1540dc3697abff4c003796f4da637edc4447253d0f5ed4b1a797d0b3c0701a48f8a9b0f63aca9aafc031f2ce10bece17e12bc44068e0c05e3bdfd777762cda4d28364aeb42acc08bb46a1de90772695f821e6ffdd1280af5e240525a6e99847acebefdb46ce6ccbd9ce7fd0d2d530637451edffa1bb024e26e77c3629e6f37e0e45e4ee78c83adfa8aee1cba477999625265013d8467a853da3440b83953073cb4bb524ac96040ef32ba319e646056188cff6b4a6b080f5bfb8b4233c70d259d4105a4871efb0132102d5a5a392ba055960fd12a8ac0de3fa174c7f8e4db355d9dfd40170158531145fdcce64a8a654075b91e071c07241e34f38d4cf44eb211b0f573be00af369c3ed54412ce21c2fc99c761d1903c135fee3b584d47ab009febd6d49008569af8510b3eaa088b7c45c0ac5b6d3ae8f1ee2c41b9c2dcde4fafc495ea462ec341951f486da6267255ac1b05be2762bd528f4257141f25632d79a49fde666dcccdabf2d6648e533bb0fae10e7859c4559da4cc4c9f6712430871cb1925a18cf4364bdb2732a648848d376cc263993faf52f869d5d3cecb0ee0d52be7f75c49d9c7f6a0e879bee363e09ba6c06b61b4e4f9dabfeaa4019ce77d80df954c990e9e5e391ce307b05f0f786894c4dddbd2a85a3288ef91e95fcd6eef1d5f540a3efe63d74cbf45d25e6b23c3666e891ffcc1a57e0d122fa90338686c670081bef484c7b7a9a9d5e8045a799b10ed1f65363b57e918fa65183a768fd5716a97c6a95f0b2d7af8275b0b44ad8ef6cbc8a4a57e7e6fc471500db931534d8015047a2ed6c7e69ed547aba42d1a9a840feb140b716d810fe20de8f386d58f63b4f52b0453cb3fd23f4559a9cbee43db570dd05548053cdd6aa14bc63bf7a9049261725cd0c9f889bc1a7d6728f66d7476cf9ef8b435cc582e3340018ebf1767a035e98df8823ed84693035fdf472dd54fa83386c95550e7fafb67a5fd08b075f1ccfe6d8371aa8f81dc563a92d90ae5250eba566e18ca163fe78fcf293b859973aca71efee646aabb64bb2e83b07b8551b0668365963fd0abcc8ac67a40a37fc0836e5f09c17449b64990618ae41ad22132f8093be324245d7e8549be839f0a496b27161a6ea30d393c39d604af399adcea6163ab33ac3c3227175b234d450bc499cb93bce802e1624b8b0ecfd79641721576f0ef41fdc1135b182095e76a019954d3e1489f54f791d76e5e9a2c8d6cadd0b84bc20f5797b00f0a19b90bdc35dc0985aa92d3274c7b0ba8963758568cee9884a3a183631bf6b25c219265ef3d7bda6c1b3a731933e3497b9fbf74061848495ba4db38220239cf4a0ac1107f991821f14507057623fd92b29e3de4fe101a11d82b00b449c3eda23f4eadbb32de866050717adaa59ca80080cf2073a7e3bdd9b750174f0713245fd07a0962ff5bbf7e7e3d22d80a5ca3e7e4d2b5ba2880fbc1d336c57f41d392eb0e305fd2cf6b7cc1296588b1cdfb5a71ca9902479cb1aa6140a6d3608c09073a6f38ad7689c0797b7ab17706243b96d0419d255ad37583f317773111700e7549238166e01ff897d11c93ce816fd1de03866ccbf918b7b6deb091a7e4ef136985448eebb550ec68649e9b349f59bd96c9c68cf59df652b8a50c608a12601a01ba4baa84b00c14a402cbd8b90013356597f8ae7917a91e84b132d9fd7b6c14af10257dbc0d6e91badd897e27278920914b451e477b087143b2128e2aa84e4ab4e8077a98e6594c32dc5e5c12b06e4d63e5af6275b72fb7da16231e5ebeca8178eb39e946a2bb42124845273a8b76bb2ac332f1ca2f45f3e3b7380f845e43b85831b1349ae5d60d96a143d5687cd27a3c72763d6c5bab4257640ae48c51f176a2d17ad76e99edd646c05a8430e3e420d7c0531843235b7c5c5e8be44d40353697d6329a4a853c43945623dd4bc90e883d9212b84e5a783b09d0e26909c2336942f82875b8994264d8f1d12107ad258851a7046197dda7aad40c136040e3f73c7a740e94e07e1bf43a8fcf9abe99cfa45118ce5d2a56f0b34ef1c7d13056af0e02d1dc35ea44320bba52d37b7346f463284e048b4f4f2ee554f6d1d6484b3d39be10d57b7091e927d8b529f62842bec43f02b59b2258cfe0d27a4c900c2e4820bf599e0801ac66b193c593c2fdd8125ae34a0c2ad482302f2208cf6de5bd3b3da6f3c42c52142fa87495f353da0dd8220385442e52cc7044d3c89917df3f212dc1fce034a50f3a9f3881ae337184e15ebc6b845de6216af420c27223aef6ec612bb3e4ab5a414d68ba07378106a9ae9b11978b1f2e60a7fc58a354c85cd06a081e006144c655a97d8763c268ecf7a32ec6167e116b292e9c0027ce02aebb17fbd074b8d01f5600b40ebca3174cac10c2c8876511bdacbae418d95e84e804a0ac995b128979b4c5300ced4ad91757046452eb4d8406fdfc5dd405c9d77acfdc975295c9350c966238d61ba9b01bb650c363ae4660f26c9870c9434ace9bab7d7b287a6011f8d7b5d60fafe8943dbef592c442a665859c3ea6dfd190bfd7436278b5f2d3a3d5b351b51cb406fb788d98ff4254e48f38993737873b040ee2cbed36173ce59d0ed68191e5469690c16b97a9f167a3ac070516be977007d3b05db588f4534c08857680fa0e72a39ab113044bdf33b6dfc1c56e4ddd1c72767d0aa5ab53f9d74f8d05010c5637515f42e073200cb7ef59d45be0ae84ec52c534f7efb59b2819397ebed23bf2ef80459fd21c7f2ff6c5c2c258b522b825dc92e46c63a0ffff22d6c664260da7cb912607d684eee88df25c9e7d66476912b982cdffb712052d87c27926a9410b90252753a41d576d05d07b01e61ee8f312f20566c0c478b6746e216007c9831e347e2a794a744a738578b6194e5420a6e3bc5324ffea9367decb29da738c28d5442dead4f3b0a4b85a6c55f9445b1127a7c9871fc2173c32e22d841e502bea29e8f0b21904739c0593b05b050dd8634099d5f0171a80ad34d4cf29028c419f1c43867a44a306505ee0cc8bc2e966c76cd145e67a95ff7911a0f374d5df7f3470d29c892d735ad21c9bd656981c497984c0414c4d44653874d10cd7f51c34a413c6c1e4f88bccfee7bffd3c65848d847a8cc4b3cc4a5cc2a26b95d9c32f770b7540683b5bcf8e869e3aa7dec209e7a377824ec7862655e0a941c76d3574c8dd3fd92cdc1d703f7678ddf0ef372187c51d0c029325c3c194539aa94f33da7375349182b36d66c50cdded93ae3d529998cfd095ce08933ae5dc73b882a774aa89763e3fb80760badba7258034e1069a599b350e2bceca1192517ecc2b4069710a3358a7ee419b74d9564af4ab80edb08e5817a24f8a5b5e7ce4799073361e88ff6125c1e077ba84e09d5e647dc918051667988f8a66b2d7a22d178d2533381dbca45b0813c1bc33668f480654c9ccc922d2aa547b0ee5ee2dec6e9ff954688b167048ec5997b9106da6ce44b1cb67f860e54e0bd0a2b426ef9a02b252b2c7adad19239856942bc2efd1e1eb8c67b80c8bf311f1e0c4b0d9523db546a690a064494ac601cace1dd9c7ca6f8b3c5f100cf14f741dd6486cc3941a48a9b6f9d7f1cee64b3cc62bc5d764a49d33853463b1ce82289c28452824315415d31735273446d0781cede9a24bb32ad30ee81589ee9e926cfea877b79d7727ee8430a0efea1a2c8ec32ec2c13d46cae0d0d34ce2f1fd0b5fcec3fe536af493d5fdc89d5579cfd4c25c443207111ac7d3729faf02ed6d8b74cc1270132125dd4763c49c45c03796d36b0364a35a01299df53843a3beab1bae0d09f0e15136b5fbe16c89016ee84afdfea00e4584f85cd004597856aa4c9637b47b57ad228a81e9c2e9660e1b39863aee6a526305ef5ac8d975786228c4cc046ceed06749efbb8af395038981ea22d885aed5316d8e8559315a4383f8fe63b1fd460d646beabc0fee9bcc5b220eef7d7efd04b1cd4ec701c0ddb7a84469cb36a3599ea990ce17d0b03c8ce6ca0aac29297069afbd0524661706280fd58eff30687710a8392c0e4b0c9595d75334c97e6159383ae960bb8e72cab8e3ddf73137ea798ee9c10803b2bf693daecd3ff0bd69e7c949d50e2d2a76461c24d218a04ffa464818b425a9ae5211e570b6768715a42f038a02ed81bebc2e82ae86824d7bcb547a832b95ff8591823deb138e15a8eb33821fe6699f0648371f351d2c9e0bb625da2986392f67512665a6ca61dfdf63106209283f7c780f4a7964bea7571941ca95e52ab0d4c8b07575f3078655a7ab14328c071f2cd4623c68af8483d8b062f3d7853bfade95d6ef93b5992de3ae48c5acf48dedc7aa788f0babfd8a2ef7723902cba5c72ed6323ca54314c13221e9e29968bc557616169d5864ccc672cf23de251327fabf40c3e83755d5c2907e0382495aaf055f9af829feb89b63e9b351288ac9c2a7cecf6d426e5296c2425ada1d5c12a585a1dab835c0dd034e6d6c5ccb761674ecbf7ca0b4eacb668a775a5c41c9933e6fcff4a7ef64938e819f15778214da2c316894e5082c4205b948239bae10e06e045601d8e03adca96aa68b7c65d5875965cc281d4d026807ea1eb7eb3794ef9547d71998e0b491c60a7ff9e668d00ecb1191dfc7b082ee7292a6254b913e8e5ddee012785972e7dbfdfe473ca85a74b9d02156cbd3c02d52b38342cfc626cd8c28156cea88bfebf3626b9f1b64e5d8609057e72ae0c0846388e434b21a28b61e60ef8a1848dbf0a73413647fd439180488c3f2fbf08c7694e8ca75af08efb1bb7243e3e62dae6eca5d6e4590adb3bdf81ad2db1c7a7c4d421ac2c5a3ec2d7b14e5d4619895b4e73db730c75aee40b571600d9942f88a56e14f267aeae53de11f222260cd22bd80f5d3cfb43e598a0cfdb378c70237840ba950449b828da4c5cc9040d11617155e9555f3a2bf50807c5f7abdab8ed484c34535252b5c2e9b0e3042e6b7b1109ca2cb43b227dc4aa77314ac0a5486a10b67f25fc7ed090a618f437f64a4db213109ab4e0f9bb76c7b62fbbec70eea28c00cc36c98ff0030ba6519de7767ca469d4dceb368f59f565e8371d4e47d72165876e254159da9051f15dcd8f5167104cc6a8941308eea2dc403d304ffbf5de2c1d4f41c0f7f8fcb57639ca02a4f8f6ce905d4a1ea03f8ff13881e61566b5e915c42e8aaf19fa798745c4f08c55a4013751696be1144481f07ce4a64d4a0d4eee43f4ee23e7d1516b6fb2494f715c89fc0615c5293cc3813daf6ad352cd4dcad4efbc63ba196d30b74442ed6bfdea8863d0bddbecf6589e49fa3767b9f43419d922c98fb476c71cf5acb861ad24ddccd3a4711d8d11abb1cfd323807e82fce3d0d5b26a4cdc760cf4f4e557185aeaada7d72008888e21b7ca2aee5ec0656e4f48f5757f252befcf0011b6254403d41151930a9481986613c453c196a4970b2c45db1ff42c5b96bb972aff689af6640c4e584966e1198ac7c816d08cdb30f2d1a1c583108e907e0897e4c86bfdc8db32785975bc405d9a9bb2d6eb22a186267d56a9b67b2ab8ffc1ba70a69eb5d3c830486d5453bbbb8fc8880bdb6bdacc15d386fa5e9c7b2dc1976f66dd736fbeebd37d08bf0c93c55cc95faab27c0c21a0521da41366d7bff6deb66a923baf77359723c1eb8523dc794d19fc3b79842e7bdff8d83e1f692862ec3bfc6b87132f37edb7a009871b8958911aae33c8dd11292bf2c4c0cc6d05c8870ae02e31b3761d4c2098b4b1a80c9a23ca3280b1fab7221e607b4d3498935d34097fcff38666e81df338c5c55f88a1dfa649ab7f235b43ff2c42e1d5a6ce7842430e4e7d2569bf6bcd2774e551b838dbd896a13d7c0d428f5ebaa55bc5ef7f933129e4e2d1ae36032d2adf651073a16843928689d7bcd5d645e48a2aa588c4857b960c4c3a2bedd7dc869a1438b4f1b151a0d586104329687a5f4b1337bf80e8f584ef663f7c38a259dab940bf0d5047380989613a5d62088ca15448c2b25b9e725ff24c161827683515b7aa34b99bd0a3b356e06f85bfcd74e28a122eb35683da2d172d34f55c3b14f6bb7f0b0f60306521c5f4a39fda56abccd9bc9b2e08e03bc910f76078a2189bfd684776b23d38268d01da98816d451e4c775af4e3edcb64b7c91174845d76a13a03ad2fe2cf928441a2dc66476a6ea3e54e375dd0ee816065d4c1ef4b6fb69ed96d4a208a45d1c062781b513540f7f3f2e690ecf752985bc0f21eea0a7f8626685346767aed4f5d2534f967cb5b28f5a48cdf2117558b1f69a1a4ba9f5950d98fe30c53cc2c302309bbcbcf30bfcc624a56fb45eef818ff4ff238278c2c3e0a54d53578d890d03a0ba12d1066a692583a7ac7a593aeefa894287bd52c8ce16ff8ce959803569dfde476a31d79236b9b5a781b9adad73d70cb21cd0656aecd922ede118609c7b361569b828d236206819d589ba043a12c9275682c318ba9cdf721040d23f1333085e18d3e7c1f3ea1c0a29cac5e22c7c0e853ffe8bcc2e9bab44dcf5df628d742acd342cec589ffe8d383db8be7b0f9706dac57941c71adf28ed471c41dd4c6df524da0a562ee20f0add1827fcddb62d1a24073c39460da879657b384e0475af5cbe08b575a0db9aa451b214c3c1b3547fe9338aedd07efa8dfb78545d4a49d6e4440eafac861d984c7274db8c157b5e6c3c88e69ef0333fa0802525f63a379ccb09813000b3dab76920f988167132d5578d92d32bf1e9a761f6dc27e1fcc362fa91d67ea193019f74406454d0098c28914c75d77ea292df322b4451ccaf40b679944aee525ed492dc3f33ed4df06599bbbf60cb0a494e3648fe732b69cd3b569b3714e32bc06b6bc4bba14dbf1ba0caac7a03b8b05ee515dbed3f6db3264b0db093d8234c04e0988be357ca61d9dbcfb50ef7bba0aec9afbb053181f309c9c8d5e5e3cf304b07624845b3abcb5a276984d585a746cfba37d27c540be03e3f33e6bc640b85e68acf417c3ebc6f6b160faf7ac7625e2432d16b9f98aa8405e7ad9705729c0182bf832788cd8d5cf2643a59c79b362d9759fdde7111ed44a1bb4d5be0fe55f62c5fb0a372ae3f39d76ace3e33d193035977765573859506e62dcbf2fbc0eab0959bff92ca90f2931c79cefed12a39d6b59c82732dd8dea97ec149d1688ddb12f91c49d230443fb9ff486cd97ddecefa742a29d57a6d6a695302c61eda0dc64812b4d10f546cfe375fd5741424a0ac265710ab06b9a96886caba24bab92d41b8f6e935b8479a0fa1c71451795083cd1366f84b596978631def48a861b11b8c9308690a5dc1fbac040d104d8ecfdbdfb2e3149fdf92335f2c0452daac216a5511691dc2956606ab250546003bebe6fee6157550ca4e96b3b1c1d5dd16832d33c375e7e28328cdd25ca736a9fcc35cdf6fe3cfb76688b17710524251c23b745350ff45212e5d3693a6625107cf08d9b74a56edd6fdbe7c1d15132038568d4cfae2b3c681e2510a24228561aec57f7db56f86a00e8c69e97c79d55e831bb1993adcb10ccb3fe82384f85f5051223796e29a9e4961b6c6007ecbffe46f5cd8c57ac6a4e5128a212b8f869ff83af9f3b8be5d2726ad1c5bd9b5c1020589464b168c9deabee480cb5c5bb5bfff896e9a2c5ad8eeac9749ee6eba0f65ceb17461bc503908fe5b9bc920c6beef6d72d46f817cecdb5176e7061e6ba9d46f2f46951f4032f3ce6cd20474fabbdd5408ef1a88f44d831bb67f2532d95cc03335688c953df2a92d6161f74f0c6d5f56c4fa69620ef32efc1997010ff9d0feb5f90587505544be7d960604f1acb0bbc11d7dfeaff92dd6d0dd2c82039d8cc6e69c18200184707d191d4c097bf0941c9f54797d57f8231ad3e9fc676b62770afac6e984bd7e142264be1fde394e6e37fc4cd4d55c562d9002217f8546c0e6076a4355a2ffad4ba70a680f9d40bd5e63b8c9f82cb71e925cb79cc3783c79cc63e08b75896bda134e25b183f39f27524fcd8a9e024fa035075e58c61102879bedf1db921b6d8914eff5709d66301471209de49ecedd046a9fc19dc48b6958be61d415764537a3f088c81df04006adac7e870d8b5ea3636488c4deb936f2e96445aa3cf116310103f02da2fc407b6df10bc13d6f92de794ee7c7b8c61cc4a37c620bf246d2bb47ccc4f28abd933868f149f999609a958b453b53d5b7d84348c93facdb65dcd8a51f94f725d142096d8622b74b9971ea394ecd4a80a79614784ff0e6175157e3a5ae9a1023ea63e42910796f9e454b00a8d4f371e4719974b44996cedb3da3922a1e0806250f5338c09d6876906cec6437054d2a064bb2890eea8b582ce2dc856c6814e3894162c2ed0cd60b3aaa268c2ab488de832576b11cc04c1a5d235e64003f45b3e2e1df47c413cfe83bf1d4538f1ff4f708638a3c582e001903996a9de61e6d5d24323930110255bed0c0e385a4651b084fb3b9eb24f5812362cebe039ba8905f8222ba1ab117dbce2b69bf84e7b10a2b735596c205cfaaa825c4eb6458e885b00a9177ce53fcf1b85af609ad2dd5108a12b8028a91814f9dd0601967fb54cc5f2eef744f1ae2ea580c3c87fba5333589eeeb6d8a234b468432bb0120d306ed5a67e551a99674181d59b38b339a94a2b0cc56d632cd67ed8a8b0f3a9e586b1380602cc3374d051c7f20df4755c26eec8aaae25e1da226cdb4666c8de4e93f1fcb636f49b7537cb16b3f39a4bfd7dc165aacb91042d1d21146d05c5b843898dc7c6d2b7663ea55860cd60f1ac1fe69381bd26baea177a742417f2ab678863d1d3f900e496ffe8bdae3032edfc3fad666e9c2721e951f5aa1cfd5882bea0b828736d84c2e569fed44a89e4582f1a5f3009cf33aa37799094bf7810eb639f85a49144285eceef2f1c7daea1bb7875a066a4e170a981f76513b924bd31b0799b01acc36ea22364ff59330d7e63296a73408249b2d56dd1ac6bfa2ed1e5e1d34c0672531c3744bf147b244077ee00af280bf6dc0cd0f000aab3467a0f36af88a8d9a794a5971a297299e346f1288e22a1975ccabb375f9c55a09726ae80cab089aab834e30995fdc06e7e0d77179e6526e674410d810e3e143173435498f86d0cb4ce78f57ed475ddcc5b14957a4317129de3360b5e921b0bdeaa223c54946f7c437c3c4cf80fc5569f344fb4846ef22ed1578a0ae063692960e06a4ca1451bce74d11d204114fe07e4c6122356d008b0bbbf902e76e0fa08bf5daf5989ced9b0c8e1da52b5f90859c6b4c376db8dfe3d59002bd1631c079c817fe83b5b56eb46f3f2812efcb5bba753389ffe669cf4fe8126ce90d8214b43f7b9161c97afc54887ac65de462b2045f1d8097bc506f1e18a201db773a4e6484b7843a5b3b6b44fd0c0b44f0e95b0fb336a58c6b10da68b93b515bb5ae4413d245514545cb07999045c9bcc24ccd255fbda730af3ea2209bbb2fe0aa4b49e863acc53003794cc2fc4b081ef5966c9835e2de3e93cba82aa74a1e37533450b2954440245ae10566401b02a0eaa0a45f56e28b3d3a605a25e11c9f66053a986d8d7114381006ec28cbaad499a94f058755d0553a844281b6449143558c768ce63e5beba24fe40428457c2f22e6d0fdca69a0403ab71471b4aae85c361c6becf91b0735f81759a982ba7ad8b4424efb2d3e2cfa09a2ef11c7cbb9d21c3a2c68b6ac6c242031e3179e0b97eb599c781901acd98773e044776dad1e89a0576c9e7795c1ebc0b529297707918ddd45053a5b66800a2b5e0f1e58199d7714a1001af766fbb734b7160304106e919b7d6454871ad5d2e51d611220232ca3ac3223e4bf432eca586632ee66e8bd1299b2973a9481d179d427a5c716ca2c35424ab02f229918d70572cd5a1d309a6cef0fd8c1d7ca74e720e35559c25f71eb33260093aa74c199e77e557db1e6766c057f19c5462c14c0a0a23ad7ade750d61f353b61deb8e0f215f4eb67555b415653b977e023c05e4247d86e776ddbe298a226e3bf59f5c448a2e71b523dec0de96202fc898fe996f7512500edb3a7e2a669b6dcedfb939f58651e4e369ff0ae115013726ab155b47824d9adf478369efe91864646da2c5c43104e87a8a4b1a57550771434ae29427ceac5e26db82fb3d09f69a635bb2c2c5b39befb15ad84fdb4baf842036cabb6212028182da242e7432fc0be70a5dcba30b186bda648a6d0c4be79d636c34673ded5243f1c482f036233be4368cb3a4c648d5e3812c98a337a217f92fd47501617c52619aad3413331cc84d4e46943d24e5f12e06ddf5ab5b80a9d8a43b6ebf127a6ed224d2780f93a57510f577ea43edeef7f674a50f75b1ed93a355c26451cd81e6a644539ef479fe6faa6cec69c1497285a57e4d2d642480f54a71c862b929f92244cfb4074ccd23a5362366bc08f12bbb78618541fab5ad61a5f1feb3ec8d09e35673fb99a3512265335370f7c26968a187ff0353a31e8c0b259142538d0b0a86b1fa97f01a4b60bd7f8aa84c3a04382082b356b0d905bf3ccf6681ee781deaa648d6cfc6a98919338adec87667493db4f4afa2f20ba0fbd8aef5e571114a85745a1207c795f1e488e83e14207ebb2c583775c9625342f04fb2c278e86bd6093a5bc259771dd698f04fa30aec2d544e2a19791486b0cd51d99bdbc4b1e7fee6c7df5e8a3bbe73c6eacffec313bd6d3689da69bb5a4d14659b5c657b37b03d46666b57c6d1561e1bf01dbf1673a6f8c560b9455bb509d6ed198812787eb4e25fdf7b3024d38467b4266e35732d16496094f41f82b1bae3fb02f80e5c94d8143d85983ee76ba383dccf53e8b53cc5a7b8027532e065315f99f94b71d2f38d6a88973d0c1eb9a921db17e0430ec5bc317311674eb5382afefcfcee383423c4b8dd5a2d19cdc304d69e8415a39f2c6da8cc77fe12a73b6b33f0164044deb8426c0203939907fe07247020d14ee6eb28ba57485d41c4021b811319ffa026862a1c8bbe060fd971e0f453f525e87167945cffbc4e9d6a06d036ddbebe47997eebe002e260f9abeedd204498f36b5f951b221a28f6ff57a6117f59d9a4287d2fe498078efa3f756482cad0792630a494348ab0ee29d4aa1737d00a2c82192dc3599b266d014af03b61719a3db859b99582c6f7d7061351cb6f1bdb2899061af5f13fa4e9a6dbe236d8b66cac0a88ad944c5b2dc2e82fe3aa583168e11a1658c131c4c2064e298d4a394fa33a8309c576dc903e438a139e35c5c470ad9aa334430414d87e3a006cd7dc5b9d0491ea9f50db2b315f8011088c01a07bcaec1bde58a3e89c2ff7e7380f624bd7f09b65b1f2078ba61fd9d831b7685ca6941dc96baa7523382fa28098dbac1206d832583a1112c69e799481ffcd26fd6b36d8e5559193003e1d43fc8220eb31bb11ff0238d3b8aec4b16e5937cfa8526047f72d425a4c7eb7577cbed59f2a674f180f8847b4ba31a0fe985ad35746270a23f7122a997c97a65879c437245dbc5cbfd02a899abde3860622e7ee2d4999ac3d572a8e82c91c6fb9e7e8390bbfb7838201542594a71a1bdc973a22b21a8c6d992e66530188a77ba2fe75e1d71d1d0636cf10255b4051fdd7da9a07bf4dc08d24c01abe4ea1a9b2a2b761f012542247f3346fa32c179e5b81b919eadda4b270d67ec87f5337c4dba273e2f3bbca290ee5bf3620f0a731950d6a1f94a29283937045cf266994e8c9d5aace68a75aa1437a107246dd4ed0b617250e0ef75655358999b1cac3fef0e7fd3ee4a199dd108d68a2cfd9612bf46323c86bb4c3cdba9c10c71e060fb5b68da4b99031d38e5959c60cfbf94be103d8c5bb56d449b87d5cf2e4973ca467b5ba894fc723c2362dc786e472812cfa29e883746b83a463576ae6c1e97b143861be71c081f9cf356fe91340701e154fc034ff6791a17769c1f50b962529fc5d7a83a883f33000e83f2c2ac085f87e3287447e7391385d645aad2b34e6cf721a08b36d04c1c0242af806f9292a835e6f7d2082b548cdce0def4534afc7e5389ffcf5fa35d2ed04d2b81fc82bbd5a845f4a6632c23d9d1e92a3e15ae10f14655d2995207d21661690ea2fa7bef36de8569759d24aa77632d3b5213b510b5bcf38647182d5fc4356b6760d8fbcd5edc6821acbbc5383c4f8656ce4c4b5af2212331c9ae2edf3725b822ae8828c30517b96a920fa8c4530a6c4b1e4de8fd01899213b32158e2c70a5241d6dd2a7e3087afdbb59bc74d6350478c85c14c75452117a256a742435d166a51f3e5398a3f495c16f4dc30a7f125d611e2726bb6cd11ca98dd5d67be8e46b8fbcf64e31a4b33b226a489980ac5f71bae4182dc66455bb2813edb3c1c9b7e05ed8c24799d67e46589efc0c721dc6710ee7d332e39b70aab432fc9c9eea5f5869744b7abf3786bc83318ba0bd37f3a4ecad07b2178c08ddf7d691d0c443dbc032d79ce089316b0c013946d2c16d4d12232b774a99591e30ebb2e7aafa8b1525ec19137db999a34a0dcaa588ec97e5ce46c7992b3f80ae5731c00165794e3377bd09b2ab6da6a3e2a42e6a325f70692237f2e404333ec204294890e908580d95583a28913e6d256578293dd70dd0e09bb5f57fde0d02a43c42955639a13640c8b540f8fb2569a12b728088c0ca3a8a2de6482425eba00743d30c6de94a0157b2a7c3adedadaa3239b7588d619d1768890437e2bed28f33b0f070176d3e9e69f86a7db291072821bedc7aa425daa2fbc4650e9f227e96d97c6bdcd445b9ac31deb5c0b8c391b20d375baf56511deb729f84b00e58f14c7bce6acf6751d555a9c28f972dc7df575fa23469d697a02be9f8e77c86746c823b8d8dfd37511c77e5ca948ff890bd5c383167819714227dfd06c321b33ae9b8235c6ff614924c19300635dba3f78ed56ab2a98dd3ee7b1b91d711578ebd9155dd4ed8fd364ab19b5fd510181b6104cbb1fe48125c7cb5f6bf04238180bddead3ce9abf3390959d782db34860b71dda676603d37f0af07e8227a07392b879735bb0f887f41bc6fe23d5d8c90a6cffc1b43108be935436d094f3a630b370d7a38cd634696f5ec06a6455e5e733269e73d68ef3cae8be09c6e147e166824bc1f913ff1b714337e3c7dc0c75aba92a4f80ab6131dd41d88055ef1be7f4ea2466f791e6bd77b07a491e2aa7d7f36f967f3121844712881d64cb239dae8852caf06dd8ef051492341e393fd819fb06b9509716a804450a064d3e4ff2cc5eb9de7661cf0aee755715b538fcd29250fbd03f1498802f1b696c8dee16b7d98024927b5c96257d449a02c4a9b25b6e3462e5c9bedfe1b546ed3ef3b4a2688921980998c98c4ea90a22a5886bc83277f8b25ec2a92973be676899525cca808f1178af10f721a6bffe2eae615158b2847b04614b531bd466e1e61193a7680900724a0f12c38661eeee94c0512366ffa7cffe2c20175ce96f02b861516d6bea5bd2b3a1b3a64581dc12e2a4791e36f728807009753db9cf854d60667c173682d518d69f73dd8b5021f0f3d962c642d2acb721d87cbe2f74e5a0ec86f3f495a2f5f32768962298f2fb8870d3af2c67435685e174af61e181cc24bdc4ba1fbf51f55e6adf9172fa8b343c16d7a99543c2502e02e68d6409b8305f284aaa7461ffdae4ffa4c5147cc9bed527cdb82c0e6f6b874a2904f2d8855ba61d8ac56c0179564ce90fe1c6a0b2a001f604228a292ded0b828c8a955237beb783d156bde230c206c80a4d32f6c2ba8960c33bcbe22a89d3d228c04c3b1abb9fe11ce81f541a4ca8a30a0bc410018984bb10e92b1ef1bd9eb400d32728281c0143f6bebc59936cfb22c9b3e764e8e5f573029a2a6714234d12420497b596a51804880d7ee9acc72f2c8707747b6d8b823489884b221e25ffb3e56767017f54e42d5bdc6d85e5f4bb29723f120ae5d9cdbe46767d61fa0e5c42a652e552daabdb434ab04bfceef541026e9625964ef42c8fec1a8cc085e3205d3bd0dce0a53833593c7fa47dd6f6ea470ad75e33e1254bfb1caa5db814a52e8bc14b2f208525152f49dc839850a4cbdccca2635b15dce51ea204953fde00111fcaeb1d717025001537d8c0ddf643198f49dc10347f4592320edf10949c154d2d555b8a52afa4c99b5f2a8bb10a7ab8ffcdb041be66ea805d9123c0a81c9a05a5ee7d64987e6cef9497ab74576cc17266ce66c91b28456f0b259d368c2d76b1438159119abf55c7a01388860a170acf18df653cb719b35103bfcebeef2d0406a9a49e092f417acf0076cffaaa14c7b1ae36572f60b82c9abece86dd9b02fe5372cd32f1ddd22ef36649a265365de690692347c41f42daedbd58845bbd8b916b0fdbb0b6f1a2572d0eba7673f0facbca6fc40ab1373382df4cf1a4869d11f498daca39fcc8655650ec0556b2ddc43d0638757f31c715218bdc016df7cbb9cf63dfed034172eea2f93eaacc2f6b764b0dd992c8e2f16bbc7dd3376ecbb1d82668be669910cdfbd8d640610d1533df0524d09dcabb3eecd39f5ba3247cec47a504963d3f05eb757d1ac9f29602a599cd24d029d1bdd7a8732fe4c12ce768071752724ef6b8e4eb2e818a38790aa2ba924cbaaa30f6f1d608d252b3c007ad9e576c5d7d6476ee92fc5c34ec51df057e12cfce562ffc405e7f628eb853432ecbe91efd3e05d22c881118492f8aa0c47aa3a65821e6c8c463e45b6c16e9b16dfcddc537ffe19899dc14b24476ae383d440a3ca2e4d31f9eb812b366689a53cc38b36212cf1da00130f6381f5517fd3b85f1a8dde567045b441c518ae4be592532a5ee289a048d991a11d0b2c29e1f602fe3fdbb365b29bf44f1f6756b8488b4ce65676b1c97bcaed07ed37361b4ff8f0e47e1dd72c499164448ee55e138387ba4363ce384eb829d94f0cb1d72a4a4511559dcf35db806ce079438cc9ad47667a380d37d5796c9c6625494c064b133655fa7ccb73aec83eb2a56fcc6f3d0fb7a170bf2fe82e3c99fb66cc460944ba00c41549a599e87d01130b7f09bba8db9aebaf63a78efe171efda9209dd4d2348be5623edfb1322af480cb135cb3ad7ee2b8e5b7ad7d7da2e08fd3e6a5a52af8ddf748c49475611e33409f6917f09add410b593dff1c2d4efbee16b725b5cbeb0e78466649992e4cf15bac72a8a92ac8bf43295f0ac21cf9859c83713fbf25493e72883000ce66a4cfc8dc5710f0bd2f9181445d32504806f9d94f82ded9c6f36dce9e6aa2398922a7a205971d4d7f15040b3089ed73fe39953550a0c45fe4f31320d4980d1d630a7de2a1cf9c9b3e504a8d8280118eba98215a41f6de9ea1dc3c30c2cb0623966be67c93ae96a9530dd416382e5eb0a50f8bc43aa127350977239c2dc8328ac58bf209fe94900a16d31ada017073ed3a105a4eaf80507887a2287cd2b0239d9b238e2c60a53277f0f1d355bc532f8283cd42206eb6de162770772cd242e326fe22317e0bc66abffeecaf3c968e6111fe5ee8a59e5280f29fc1bebc33d077c5555409557b082f61403afd4ee5988fdbe55f9d93d3ed0b81b2c6ac29a594cce00b096ca43d358440854c105161638e216f5e0e5ddd9ab5abf9dea3dce775e4490d07c502d6609f694baa94a869210615c1b31c1664c3df4d3439e9df350e5f61a52525efd8aae3b3e3bb76500da2f2292efce064a92db97fc6958f100b96b34c31436a134fb969f518a88053ad5ff41d5d308c368526bf15e936b986d6436406efe66a7f8f975467c5e207dcd0672fa146eaef342c22fd7f2fae6f718628be64fceed634f29085a854a160df4513f4011ab63dc37c10e36eaffc2138e19f71b9b1474253d8ad8605ae210aac6e016bbfe163f7ead99fad52f16ac0f78db0113060620a637419fa7bbfea93df7c03498dd8c08a41a52861ecc6fa165c1c774b46b7ecc33bf16f590276db7c19c2c03f7796b747a9c75e81ac9ff3c869383f0575ef98f1b7b64209bde96e4db423b7ff08d1dab2b4b4757846a3c708af8cfc3f5a74cbcc72421dd234bc7d926cffc9d240f9801489bf9b135f54a146fcb9620a22db0194d8ea224d791a9f36e29646092e759245d8d536382112bec6af200240f00182903d5e919da1dbeaf68ee4a8cbb298c7802b8e0f6c578d5acab78668eb88851580aa25631f7292e0342d8c0b977c69fd3cef74d45e8aac65f96dff3ebb056f5f6969d50a59ca4a44510fb3cdc6f131957942f7c2a546d6b7cdbb662e5310d91d2b04d545614eab3b976a722b7689aa2c22c4217f681f6aa176351c15b1b45864ae8757359d8159b80465705e44a6c9057130b5218fdff897cd5610539f363c4d2cc94e8a54dee4761a9096b77b7f20d2adf4c060c29410f5cf5d73061f51dea45a51565a06e13c556f7ac1bd10cd6aace6ed287dd29d9e6e483117627e41ae38805aebf64aeee46228226b92892cd4d760527bf839eb3acfd066b7c76898df1cf15d4abf84b3af56cb7b7d2fa8daa471089534f7fa86145a8670de2dddcc141bf172f0cd9b5fc9332234a0443ba5a0f47afab2e8f184e4c881032ca97a9b54aa0ebd2ca024a8dd04c3d39ca4791705fa13ba6074d4d07427bbc6c81d02b6f8a82c82453d04c1473bea6eb58a9b06dab6a6ffdc7d79676655ac96fc2833702b20a57a45c0278ae8c825721cc87ed247e7c6dc4605c7a167a2c50812312df4cfc65cc4b0b83442639fa71353d101d8f80d46bcaba3c0d2d42826d62c26c733ec1132df6284cd87d59d957c3a43b6c458bd0c2576c66c242e4136bd5170e8661a3c36a45a5b39ca976ca0f560bbee03234238af7c35df01379f8541bc1f54a840060a62a547d05b5a00ae363c9bd7122490421a591d57befdcd3e099ea6b30f759f029456af34259018422714564f615e021a47b2c1e8b70860a62492527c97675044ca54895b30fcd20442cf0f7ca7486461f65619de3a41e094f8e14ddbdb43e5ca58f76eec76909be1d36415998294f63b1c81aba611801f99da5bc2476525801629aa877ed98a58545db45217feac338db761981da27b72155e9c9536b8b3c645b6eeac8aa12450c5e9e42245420152d9a04f844c47706d06e61ff0991446aa9a5599492bdd2dcfe069a50ae941c3baee7f4cc9addf55e7952113f38590be96ae98f92b77778089fc6afad889133ce07f0a41859b09f6f9dd24f7c924f5c2a14aead9ca34867c56c7b368c0cad78f432c6b58b72394a0cf530aef180aab330af6667cf9b85e6fd5f439f6a61868c69e1c49a921a1b04b503ece3ab98553d4a9193718d2245d1e1b6d1b3d69315bc88406f38b158d6401d35b31e8dda61905cccf81ccee4d6a2cf1d60b2a956dd5713c49cd26ca49ec1ded0a765c92e32465b7ebc47068a854d1353cc2c6d2f10ee902f0f360ce2f6328281ea0db02008a11a6710b5e97c57de253c5ae2c35591b36bba54a1088ce0ebf1d8ef94b4b65112ee55026ff5a655d83662c341adc420d0952565928f772d4e815d5798958019b25ef6680f32d2de4be8921ae6683b0848712640dadbf2ae6b5de590ede7b603249d0f7ac67fe99ce086571dd782ab6bb649f469c8a6f441caf1ab4a48caf02d2e10635a99f1fa28e5dbab87ccd7e7277b94bd386e6a30d47c52cebd6a6a1f4fd76e6d166067f16955facf081e2b391ce22fea0b84f7f0a8108a1ed0a12cfc95689346c963d0546d77fab7941e48084d3a0ad8b13b662da4485f3fa22e8f13a68ed946d7afd9eece0aba284f7e405b2a7bf1dce423372543dccf1d09e873a2f70f49e6153a95e55347e39b70e619b251342e1d8e68b9dcc747ad8f670168529abd378b258e8f07378c9e7bb62b5124c4d4d5fa5a5a3b1ae23a38505d5ff8ecc7157ba6547b6b963ca540def0bd16528e666e45411db37ff3f1c18aa15b84333be8b675747b55e0cc94a39f8ef7ccc28f0a0077a36911d2e45a6b030543fe83c8e06e46324cb04e8cc40f6d06554a50f29b7e3037f0d636e3c17b1b38e39ea335a5541924bef2fc0793f383afb47880fd0a45c227de3f0bc9cab3b55684d3483e767734f17504600f0b939a68d15dfd03ca0ed686b99149ceeeb4f8ab0cc22330003eec92acb01444a049a516405e46f1aaecd3b178eb464f44833225ac3a488d3aa265e1390a5bf506de6f44cb2ade0dc582ad8a7b6e1cb159acad3a3e56c43e6d603c14da744b0c7df359bef2c66bf1e1af3c9bb4ce15d11a8322a6cd38e20d6051a05ee8b7c5e7c9feb33157e77f32eb22c2108aa7d5625071bad1140ee3fa7aa1014f48f8cbbebb422e059716b5386c29b0d62d1d94382fe49ef014a30a338a606e0b8f592c9301da7760338166f7e94b56202db89b3dcdf602f4430396e4ee3ffecd048d1bc09da5ce3789f9679f795da5f6a66d64d38f5dccbeabb7c5d81632d85c46bdedb22262609721802eebe078c819b4a0e0f47025d7e0a0cf9ce22b40466bca55122aa00f157da75cc799779f4d0e2be5b4bc12a695a53a8de4ecfecb96664b8f59ac64b20863d019e55c23b63b6609c9b0ed3fda9954b2e4b8e0e28bebe52bf0568676215e923f50009496a39ac40696d89e8e4398b649820d1808a4d80986f8825f972286b7ef53c9873f936b7af68449c0185b61c04d14a63fe61444f4cc645eff39435d4629760d039c78ca44ed261e084ed7ae07781647ceb03c1acb3581e389218a8af2f8d500ba8224d6c25ee97ce8cafa19eff17a900de499dd5e23a2730f86ecf4529419f29e41a585d73a90e359bceb5859d78a8b105679010357af8dff84f5fd8fe7ca8c467a193c4cfb510072d93981fba30b134efd327821c4d6e1b3298018ed25f338588914e37f6dea460188aa534048e7e001c8f3c1ec424d0d24df0c9239e9ac78738999fbda04b4717e8eca86a9a815ddffbeb74f20f5106dfb242226980f7765a5595bd25f7963c8bf0bfbdf8a450ab5b17a92f22136cdc908b724c89950120f5e63166863c53d5dd928b24b92b743c56180b4a666da79de49e8eec77b24f7f2b243d44adf038ca3922b94657fd74586de406ec7f83ec3955d8a14a90ad09d78843217aa68fa2dd50b4431d929d4242f10e12af256972ddb9113d652f3d21bf707c7031a5320acea10158d94431f504f1b61af554ed6c302c4c7335130d7c9a77abdffd7986729ef5cb6807be6c1c645f08323c8168e42a379b784702eb17b5e4fcdfdd4e0c6a23898c620a18ca82795d75a5d5a9f293394a785ad7856cc697a2ae957912d5529e74db20c2072e42e5aaa321f020fe02f0882e3c1c3c8cdd5c6acb33240d50dffc1b3a5b3e96d5b6c5eacd1e74e4061c99faac62277bf865c6f9a985c740d71be5befef9bba3bc5eecf3bb13aec7839ee75df57b738ebb23756d675d587cf0c8c54153747841d9ffdbf36c5e0b468c4e648d3981f68b62c77e0e7ab26f650e95de2b11db7d200ef04ba67e78940627c7922797c401d8a684d50a9d8eb96f85b76164d9d3195c24710124cd9654532e7b5ccbbbef60dcba78cec6522dbad0444498eccc59269463e6d70a936440119c0be9e943b1d97a281a494c2f73bd4a8638a41365da8076e28dab547962fa30665e1f0977df103d61dbaf9673464224c9a90d5d8dfa3b98331038db798bb39a3aca41cb4c79a7a7ea64f5bb7b5fd6cba9ad14d387e48c823ea18e1e5cee9bcc2852de695bc4ca0e3c6458323f189f1ffa6a68a2240376045e8b3132505f4ac66be4e3a172a9e69d4601cb34266115e6da6c81295a28fc104a2679ee83ade749cb2997dc7da29ce19e5d15c982679ca705f299082eba8b922e414569c586a44bb4fac683dad1f7dfcc434a13140de20ccfd9d3a252e52356d5d56905f96678353976947f10f5e648ebfb64a24c2ef32a6f8c8124d5f39c90e826237fef4c4817ac501d1af55f743ca4322057f4d62c216d83c4b7e6a74f90b99130aa5c4bd711350ada199712d23e76e5c5b9fb0935f1ef41811e5bc3008f96ec7271b78d4927f4e6868abc9724761961ebd6c4bd6c99a59c74044e657810d31e9722fe5f0c7838e48993925f093fa08e61e15090350f2c401ac8669a8ce3b6ef6902cd3cb00832697ef976e33b360726e8e16d5cd87a852b1ab2f1451ca4d80cf6fd5f49a5e9c6c6c4a793f64e6624fc05e9f2003112bce652874e3e9cfecf3fe25fba5722475620f7b1361f5d882c1e0564cdee106deb1b4bd550082183f0cebe0835b9384d569fea5243234b5301b3c543208c87c151fdb1c234905c837f5279eae8158b89162682cc69cf40d8fbea554795da2053437932d70df9facc8f36faadd033fe68f4602c805a847f629ed29606a896314a9f1d74e80651c4795939108be92cc4d094b487c39e9c10554ffde8924bbc91ef3ad136ebe7d0dcfee209fda3042b22b221b8ef24f5b7efbe1d5cb405ef8e46496605f00ff59eb7ee35da4efcca27ed16082d6088f3b2c635ba817a3dd1f361a9bcad6cc45ef66769257acdd63e7355407f23052b29cea472f3658d94cb78ac663bd79f9c877a2faa23433f8f6a227849b155a7694841f5bf4fa8246dbf930c694f3d4a7dc8018f44534894bcfd42d2e6436ceca14736c8d541df2545b20485751c45725af6edade591cc7c7cb4605e977817aa2d78eef584cd453e8e086fa16922f3b8beb99b86c0f5925fa434c044ba835cbb452cc6663e310edf2e03a6d64458b126013fba7d5482f59b865266da7ea16fcad72db710bdb91f9e169df3342bff27880e7846226bc5d5f36466de27274710ab744fa828fbb84c6a2fb9d6e0aa97c7eab59ae51f3685637f1e34758fe658d6af98550e46f7d5fa2f407f897444ee6a27958707de28c5071b64cfd0c29eeecf0e50f525475e6804d46ca88c03576739db7d4bb7637550df5b80620512351cbc76bce0bc35f0234c4b1ab3eda6025710068800565c6633b202f8043d1fcb0e3483212a6d27912f4d5382810902ade8fd82a13c8b16102ca7259d5962db04cd7c53559945ddb68794efaefcdc2e81e5397e263de552687208a7f7e2e2d2a06521e1f71fc57ca395c7b80417f7d751573aabe8b2c510bf7ef595264addd8d39f0dc7ee73ef1bae45c2e5b3c9243d836feebbb0efd958eed021148d5146bd9bbece7fe78d2859cdd2ae279dcec6bdf5aaaeb3ad3acdfbf3924074524f0605cde5d44f9467a78048fef84a7c0b881497161e41c0e970fad6d81319a5e9762f48fba7ceba7c1baf1d5ee859d808143c39d7fd63021122d1f48e064205cfb45d2e825d3719f8893a5bce79e99b63256293750f9ae087d5c0fd6cc40ad4c6114d4ff33b32392cc076e1ae029f354f7c1a71f7e5bb2e4a2e17d7635100b4777a17739ceb8dcf2676b7945295097699f63aa95dabbd4eff7c5cc9a1110fa11f3e4de2d410261fbdf47d74eccae2f400bb30e2bb7b7128ab963f234edfcd61ed0cda1bea43559a28c872f7ee85140d9f4a549b72adddc02a345772c53aa079d0b15431ca8f1e767dfa1c67128d7c133d22c196741b4f88c7dd0ab29f38d731c7b5ef7e4e84b9167efe0830a613be2d9d71b397afd493ca83211815d27dfab73e734526a2e2818b3ece8091c0bb985ae2a990ec1f99367aea13f8e5d51a614c7353823eaae62fff4bf44156b92be047429c66b61342d240c897c8aa0b7e9a17a150a3110b19a1dcc29e85acb07a9be53c183935e1c1b10df2e410ed2d09092568e76df9b4d3b51ed52754d1a9d80a63c6678df8d85243772b2464dbdc9cfe772678a6440ce3e0fa0100de14c59b7e50fb15c8471ffe814a7b8fadb649d94189098b2d1c75ebde50e72070db3210d33063f6b906c270dbca480048ac2e185667d165272cec5344b94678da338267393247ed4a6ae9e07034d2a42d7f7d1d9818d060d6f323667393f87af48dc8689d761e7544bf2989dab81ec6b2e1e6a302fdbfd1dfdd0e4f7508a1159aaecbd80292ec0bb301ae47be98e80130f98fe0fd21a7c51c696806324880e4bd5e97e0b3b893483d79ceae7c0c25b109f7dcc70cf2a47b3d41d08148abe960933ae4876e51b05b5890a7d5179c9349147adf79b7f454be2dfef870bfabf95fe9c866495dd13fe0abd32e6d8fbb866397e3529889b85b5afbadf736475a4f10abcb3f82d0c38b2a28ea05d29fad21753a639e75a1a411b4f33880f598e144f37c5a9127372d8c6aa27cdc24f9447886a36be85c8dad7aed7541cbb9a51c5efb153f8f90cee29fde8e3ba45aaf494a3a12c7cbec5077447bfef5783efc5f7bbeb9e8254476a836a546ab4743465de464ff524654eeabe5a0ff85eeef596b906e788d0728dace2265e05004fbb2d4cb1a770dd8af04649c959fc42be2f8681970d968ff4b1b1e52308eaff151718ed54adaa25e692b6dbf1ba5a59f94ae21282f1fd367a6f962b78f71d93c9f1bae388cabfb7a53a20fd36bcece27099829700a41457cc2c6fd20ac697e5a7c12f774fecf98cccb7c86d79431bc49a8c546a3483f617da2c898925e23e1b50c1a0d3f70f899bd35ff2e12adc77aee5bd165da043a82631d21909d9c0cb058eb43a3a413930a58ecbe6ef316babed5234efd58dacdd157541b546cd9e46db184efa4568a94a59181685351593b58e536949c8a89ac4449a926ae62b7c8962ef91023b257dc5191b5431a7ac34a9acaa3b278baa7f5d4f61e9c8d95e4aed67625c2851f01754155007640d22b8e495b1982b811c7e05fb431f872be920add2317c3e5a1ef6f47a0bc6fc5eebc572fd30f976c62fc82622b177625ecdd34874dd732f47f6a57625dc6358e15ed5e3282c0545974128fe112ea26d6b2f59d37d32de8435061dfcdddb60bc5ab45f2e100c9caca87b3ffb0982118f920a0959b5626120ca4be900031fe5fb70c36e4c3753853531ba3ff0041cee24c8accf2bae1436292cbcc8956c1392c5120ebbb7f1da772855d1c7a62e9f67824991e8102cb8eae7fd505068b1e503b5d538eaf73afc1a38eb2a5e8943426c13c2fba76bb88e52af8f9a83c8f7bebb9708dcd4267bb0a33187902f93fb72ac616c218eaa974886101713b358e26df6285599a79b649282602019e6ac83a741171ca1dc0e10025e5d5425785aad54b9c43ef74ad2e7ad04adcb60ce8a436e40ef593e719875d532c1f5a469f01a6a5ad4c17a724f2e52527864d9ee6dd83b412a8cc156935942e5305e6af135867c8e805b446acb722785ad3fd6c7728b6f26e1a085c6c4a3222f9a6288277e3701708ecb527def8bc5ef55cd526031d2da72ad589ab97197641b7097c3e514932427b5a1e48b5ba84898768b209ab33208802f1a4702e2fb14773be05922ae642b1d3d91eb3861b44bae6f8eccdadfdd3ca188d81b0e1ca07fc78580aa56ed6e71abd5d2e2f37f9917bcd4f60e12a8b7a7b5c7b7e74dec3b61f6413d0319cd102773439f4ea795f38f6414b6c06a18bd43ce19ff362d97e94bdaff301e3fd9626e44154e10fc15ce518f9f91bc808d2a84eb1f91d67adc002acb8f5f2bcc2207b782074940d6031a91aab083b37dcfa6e9ae8d03ad919c39f9d4aea3732c34f0a6a2b27d5ce0cf27f3254a07c4f492671f69e22510fb106c706eae28f4a562cb980a260ede4dd017ffac74bf82c122e8681f4e687c20d993389f0694c5bed16529751e996ca7bc3e5769424f3f785bdb3c62decc55a4a57b732727cb6e9a722c753880bc7e3cf015db692b38f800b806088a73069422371687411cb78aee315eb25746ce792a88901b2b45452c2f77688bdd68da4d5b38f7e39ccfeb2870d27798affa4471abb9e083b11004880a2149d439ccd24971c734b19fd5fa196fe16f438cf2e00a55f25ceee2d128bbddbf90641251035962306c88f3996683afc5edf651c9aa746164dba4b0af17f07d02ea543f30b151e0d935503d127674f69dd9e2b67b53e661eeee304c8a5717cb12b4d9910d79ca08edfb0b7fbc9810a0c7783754fcb595d1a2543f7645792852b8f3dba244af3adabd9cf3b3122d39f6f707c2a8c3893455b188573df5ecbb97ccdd83ebd2f91df9a893610c49aab170ef445565e3715fd0df8a65740a6f1f8aed53b5f6564e00f3640d20837aedfb254302d4967c3b9fbabca174b52a8b1a866102b8244152deae37568a5fa908c0b8edd71a0bbdacbd7eb2a1757c1aa188d0550892b3fa3c30876d0928e4541c7fbecd13d58bc63c16973480cb33ec6ed3469e96a1ea4b15e144ca0a568ed17191adfc7ef908f215ab60d64e8118f5d5529c412128225ec584acbb845d67d43253f03ec1a6a631103e82267e74fc7cc55eee3f9f14335e79d63f0550b74e7aedd5ace51dc051bbe1f182b98d204cffcf3d6654e688c768e03b0190ecda9bba36660f267d4ac21bc98ce457f9413f4b0cbf2c798ea158d73f3d77af790b558eb0a657ee955e6c26a5ff54a0d584fb2c6bbed83508950649d8cab6d1c5c51c9a737449a2ac00b93ceff9c11a88a60caa613178dc373f209c5fc26cfce5de28421d12fbb9765d2d40366be4a0ef5ea930092c52c4504401f6aa8d9932ba238f9e1175b657c03fa12d5c4b195e5bd68adf34c8e800fb52bbd0bf34918f2b7c84652c82332d3162b71008959a34f0f8272c601802d1df07748d88ba9401ada71e53b7c2a65c9c63af216be2a273469006d0c9e36f4aca6c8fce8622445ef2e1ea10f378054ca426f104521fb414c856bbda7dae43f42712e34bdf05b3344d7b0a703dbcf9bfaff39a56fecf4eefc0bb40630985f208ee199ff0444ec476b96e73bf48a7bde19f44ea0bf84d434a67c27430118bf0e2ab5a3c3b2d31ec21d77fb1d29b9462228654a0008c290bdae644f2dc097ac0e13a1344d66fa65c62a383f683398d7a99ed4ff17b28f18dff033fd0f5e435f2ab333fa2fd400e4257e62a9c55ebb5e98105c3b79be8e4d065730ec016099ff36ec4d7565b4c5932b52b6f8a71c93282ecd4c1b42592788a3c7b3ce1af517e5851e528b69204ac833d436938cd89d5670a21546ab8d07ad324a4da4fb481b3a2a34f1095b5d833f9e22eb91bf0cf2620eb3c83c0c849e861c02a6b95519220c2759820730a164557457e4111022ea233febc66a86cc223d9717968a8a1a6259cdb5c8328bc1d146ae099fdad8ceda6a15fe45cbb4353b7922b665aa500b10b6241e38979938a3f1e9705495620389247309750410bafe2cb2e7cf5f6795b68091bc27a6705f135cb8aa4cbd080380a75128a6f2198790b756fa0524220ef5d831e1413ce5c66a14c6fd883d0550f9d868629e87667da2d74ec122b2f1468dd4027cb3961db23216433e7cd93bc4760e7bcce76a9cf1ed9473c61f46299639e74b67b0dec13f8806054fefd926abc6a3881f7abced9df3d14a63f746b45d116f602cc399fae44dc5a2d07bd0ad649183f19903d0c531a32245fed2c0ea301e247f21c0b10155aa7fac341fd23834546d79c0ced176ad2629f44e80f4700009b844da5ea389773881b536fe517dcf3e9adf56a4f85662e39804ed0d6497f605ed2105ab00eb2b155bdf3899da7d0beef2896aa8df3f612af86b04fc1c2e56460be766493b02694fe4615c502bbe4acd72750844db64ec0172b21221ea9eeb1774c46042b4602ce3a4c34998f3e9a972c901c06aff221f3364cd401ae55671aae393747ff073c61e08bbc905b4b8805b1243049d87e7c72ac0c188a7ecc0d904b7ddd2438b0f450902ceffd594f0d0dd213db908d6076eff404f919d63432aa0976bc80e93b9732f8efb12334cd23b35631cbf46ff70e9de41cbe1960fdb0a2813fcf97d5da95913225fe9a2fcebbc9cc912d3b6529a56864e05cde3dc5861b6b0c56bbe5e9dd8884fdb5720e679d11424cadb293c1e29dd94245d5d83dfa0216538be4d1800a76bbdab4a17928367d11475c9390bfdee5c9929e01c96884760a27af3f966e77cc984e427c8e3f388aa9d189036cd08e7d25e878194d003af31b7ab34d7f19087e0a14396f2a267035ab36f5ddb9061efc19174d62e7e3770b2c622c1a240dd5a9361fcb012b2df0e54877dc8c7413a4bae2d06e8ec47cd6d052b13be535b245a2cae80362b9a3c9b805b0bfea3633885d25b959529407e1c63f119178292e93174f1dc389e2acfa409bc8457afe3c58adca316b18de2b5a888008d59410789bb162243d0f5623323cc1f13f601807e779b270c365a0555b8c123f4adeccf30c15a71b5132e7b76b2f17246e35efe44dd682dc52abc6a6f8dbd845008641870b9fb455ef9872795c9469a2d27222dc45e0468a9ccc9fb29dad07199c9bb225f9fb2a51d1e4710a012366067302860755dde952cc4a8e017ba337ecd3567c28b07abe10910460059410b5127204b99bfa7a7323eab9bb562731c49e7e61d08535bde1d9940ae7ae6fafc08befa61df9279e766962397aac505330a39ca186c902217ebbd7315ccc90eb3797648ac75f810ca1436041bef9d85b714cf9c444a609ef00866542a00f9faae6d2639422997e0a0f26e50c020bd6bfcede996b7c9841fcdbe76503acf3fc9377cb4e5bce0de337f4e7a9d78b79f13062e7678afcbe9e00ee7ddf2cdc44a54f37444065bbd4adb3ef12b0f2995230e44864f366d2db11ccd6fc04d293a7d1e4c3cda0c24e247ce6108471a2f4122f9a9af34d966ffc758c470eb2b5ec550c83b3e737956536a7a0b32c3377b06dfabc21bbfee9af0a742985ee253877c430442c27495ea6d668a3d0ce5c98325309b797fbed4306ce98b336bb7021ca65113dc2cb6586b24c755bd4b7b2fc22563af97ed4a38cb646756976191c73e769a3b9e40eba1a6dddc3b63cc4d6616ff55faa19db6bc4ff74f3ddd4df05e21d3116231b9a4a0c241fbe3f60c8b9d9bd2920d10f814f9f4fa545c719b4a42887df2603bd30164d17c113c375c48b4820b23484dd4f9a4a05de61326bc6c380d53a194402eb4e2032879f8292589a4072753714a1a48c7b08b41fecfaace714ba80adf1378a3e38966718709dd81f25529bd85686a3776dfa4d170b696e96212283a97f27d5c95763a6cd77196ee2cab0a67ff81cc48b4a59609fdffe284a6b26b2cecd9a6537b8ccc15dc70d51b03c621f87f8a7ed96712c5c2f7d621eea5cdb2d226d8d2af74c61313cf62126be5ddef878258d113ff6a5d9401103fc8002cff6548274b0638f8132fbf7db5d47a4e3ae6b3859d495aa231c0ab78a9b5144190dc7d20e5e2b0093870ee8949d47800997331a689265c33015bb3ce380233dda8f6b1108fddfb42bfc5b09d916095e6ca294b2e26e32ea5be69e573aae2dcef487c8870da0602aee77e7ef17ce0cc543d9f9622ade5ba709b33668a208f6abba0183f0dae02f71ed801185b48a4d1789aaf151f4a6e50013939b50993c9faadeaff773ab67daf918db08e00c01875f491b9f59af48746bfa3bfa05167f053fa5b9e4811ce034581f23748198cc7297f0b023528feff9a3c6dd04c22af49a780934dffadea659203f50c177542c8f4e98471c493175005c99ec8224fe0b16113e102d7abfe146a7f9f3f2fe59e892b2f9117205115061fc50c90cf1aa196d44ed023b7d8ab31d3f4062ff0b330915a826559e015db928cafd35f3990ead454a079d04e0049ebfe9894e9c9d4be9a863db48f6754e2439858ae04679a900c01ca59114f7b832469b285dfef90c9f75209f1f4dc82b49305cb9b9a5f47d6c79dc6aa804b453a7137e213d70d344c0d27192ae8464f4dfa161d28d297b84736372f4b9fdd40b3ee30cc1124806b96e30746d853c26da46856a7894a8f49a5dd5ae3494c535cb32f070152553039d35b3d1ee0411acaa1113f2e2b2361da7d1e489e22058a0f94613d1587d10f3e9631249796c22db6deb096ca9bf58d115b25d13488940342183fe6ddb02b77f199cd720faf6c7da5028087526d54fbdb8bfea184c7180fdd1316ccf6b9861dfb33dac819d4a662281afb37678e480f81fccafed63459fcbdc8fc91e90d08fd8144e96b374e3f841b22ce1c590d11a5a8f602211444aa65c85ab45185c9453dd3d7614e8f726837bdcac9a8f7e6e7a69a35bdcbc8fd5cf85286deb4a3b9cf5d02a31cc1063b4884b6710564b4f584ba8c8f595bca980f076b419f43b794c3cff50aa8a7c61e1186e5fa3c63c660fcca1722b4641dccc2ab5993d019e4aff295451c7ed7d657579a7dc1fc5637627e96dc5d53192c2d577521e78a03af9b38478c503f4cbab29746d2c34be8765ecb0c678921b7e941c7b28739d8f24c3a72c801063ddff137c4deced300a56e4bfcab8ea2fa299d668c281adc78c2e33bddf9270aad61b140b5ffc727f8bc150e97a6300be2cbd0cd8c19aadc5dba3488f557695407444fdfb3fb24fc890c0a5c0f30d477c12c194e0f491b750c7af20049f86bd5ee4f60ecf99212a6e0edf49e303e2d5646f5a3367312d3e07468f0aae45ce7ffdb9b71d7f0a9f87ec4ff5d7edec73e04b76c320bdfeaf98ee57ba149ed0f76720052ca0a08a6a52e4c48966aea0c7542d61717afc30e58eb2790e25b114b4a0c3664864bb23329e9c9b3c249cc77cb86e72275a88f3b2e0d1bcc9468b6df2e1917bfc2ea05c15f7f04e70a055a2305502ba12e4e83379a700d7a0b71bc99aa408e5ecfb4a09a1457f292a2b03fd02841c0ee50732f5894d75a5165964c912bf053f44a85b4ee9f2c83e815ea205ed2f9246536e50e3408fce1e17f30b1fb178f01a7c5456eb41f72e9639eb15241b19e58e877abb151978b5f545a8c548066ed8141e898778b5a424e3ec866a1b640f25f1d3825854bc115c76aed32e80b53e4c012eb7f3df56158afeeb578e06f6c7897850c3e4dd550eac5b14b6c540b306a1fc0ba778ea7160741db726161be3c03757030dcc493c4b8b0a975d6a9ebed534f24818289397c9abed9185ec714e4c5882ba1868d0a02e0b099fae1f1537352516451890ced281c3559302c53bc9c167ce52420fbd4713911609d7d6287577c6c97a824f220232be59ceef9e62bc2611574d649cdbeca78605aaae8cd23ba03f5ddb1556a9f3f3e7b5bb60fdada98fa6f26a06b1d61368fb6c4b41fb3739b1db498ada0d60c89e1296057a3923d22b89eea1423f589c791879ec804e94274add954a21b290201c1effe75c5922cdb5ad6b0e4dad50454978c4d9107077d38d43a40573e1ad8440ad6369eb14de19ce733741c7de3f05b9d504c2c3b866450cd1cd9fadcf6ad15ccca9271c344a3b327164538a4acfd5f616dc3328c5c429a0052224ab050f88ab75e279490262743daac20ef7228f3d4f9c0dfc1c471fa548ce18bebecc9d925272a47b7e719debfd5a151b4ca5dbc0dbe2f60b0b89322609f85d72f1babbe56c4e3271c7597d0ad51711f080b239ee2eb8e3ac046e31c2b7fe3e366c7b5461601c074c182c1c2076dbcb62daa72ee87ce5a5f4c515358375d18654967b06ec6c3a96a0fa958035cd0d7e0b1eeb700c1441d0680957ec0962039b567ea2e82459a25aa3e8820d98fce183c74737dabe1d33e31e3fc9c1c880fa7e891262ac50d13e0c4b5fef19c4de5710b4d657614ace7d4333923f8a4698ab661e0b9772e79e4015da04ede6959951f6702d3c2c8db9729a992200bc76deaf46e8cff2fcf4ef0eea2a00a7b2cb32247b253cb908d9cc65716064ce38b65645769f0d5b7fa1f141324355cbb9ffef421fe0ad5a5bf4527823c138783f42d8532ff7e62c0c970a898eeb1ba3509c41a9b04ddcde2cffdc3f495225f115641e42f32a25c607e29804363f48f4bbde624a3c1905ca9dd206bf3217b6b5cbc46238be08a14d0b3e7581b787cd887bcd5649687cff684e3100bbe7b07d52803498703f6ade923c90b1c5a4f1e28db1be890797db02e591a03cd2666dd8573f28c4af4d081474da42a79e984db5e6ca7e8e25f64a2f3fa9da8c61106bfec1fe356a6ec328385d404f5207eabad92ce70f1d907d2d4bc3bbe7018420417c3415fadb2d028576063675610e9c292404390fb4455eadf4628b59f7ef6734ad29ac02fec9bfb8bd80bd8f533e2b380cf2dfd31ff77833b4e472921252b2f088dc5093e0349785300cd31152a9c0b579f018b8a12a9e5fab2cbbb835c4949f1649d637affb999e328b2979cd8203e7bfb347df567cba263b95673f36161e94b6931fadf2e3b3d8291b87f8ad4bee838c319894f3d6c9692ffef45d484627e2bc55923bcd1c3b3d97863ec0ad93efb634f2ec5bed196eddf363710ca8fb65f0714daf80462f0607d9d8d97a9403a3266ccba41ba70ec3eb1bc95c90c26a5fbd7a37a1f0643181dfa9bb3a07ab0326db10f64aa1d5a29765cb580ec56451d25e81206788070dcfd12c9fbeca62d85c76e88affbb79104727e0ffda3511bc80b4c946c1826140c43ff07ac13f71e91c665df34ddb0a08a28eca6f2ac69ba00886fcecb3108a4bf00155dd54c4a1e5cc19dc587f4cd2dd4bb981e45e76e56abb8d264661ce8d20de691f9bba99681524bdf3359130b74704bc0fde2fe578dfd06702b9d4de03fadce955b8129dd6c351f51e8023254c6ea6d7cf36a83faef568e5fc9de6883c881dfc55f876a92084302b320e0775fbcaf7a42883c0f4b8a8421f8e1ac04107738e10e37e9d99016a03a94c99da2b05265e44e357bdc233c35a85d6188bd1285a0f727d88261dcb8645cbe83e980c7ae1abe9fa62821a92e1918319f22f4271fe0634db0d7c14cf649818b2de2c8401148b001fbdbd39eddf8c787195b2271b96dff53e548d53638d2ba92c44fd7c45118c8c46a51796179c3adf2b7c1c46ef16467fbcb12100bc640cc2a6961fb4fabfeb97ae2904166715d124caf70464f5ddfd59bafdcae6f167bbe64740c595b41d033ef4999770af77d3f114731ac931a4bc74c4a2284557b7929f78099ea2643cc97180424c982d96eaa11be5e0ad10156752fef60eaf68518752b940da23ac11408de5ab4612b1f02eb71814c9ef7aad24b3d13cf320b1c516dbebd3daf6c8d4d79d797fdf0a76ad5131952506f1b9a18c8979009e7431918eb4f460b3202e31332388f9a1d05212b167ef3e3e2a20924233be54399b654a86365ce131a4fbf6bff31edd01c88d03524e3e0835862511211920dd43dc0b727266d190d373acee2a81a5c0b4ff01ca7dee23f1a53ef56be2b3ef3d8893e665f082417ef3ed87a9e6322ad26a873fcadde62c7eaa216e23913dfb67b4d6fd9b6cfb2236cec768b8f353ac21e8db7bcacde362c29e069c14197dbac2aa3e602825cc5e25ba9d4a6a32e799332d3b87a1758fb9922702676d6b248fb55611be3b4f59023051463edaad8ea302050cb8341b4c24c7dfe44978c51680d2661675758faa7ce56c1511accaa04bdbf42c8792b39234cc53d96e94c22808d622ef7e00d0945aeec4757a33bf03596345f1a5a816077e470ae613b31541509f5c9f2e39644a552dbe42fc5502a47f08bbf59a840c4745718114e221beb8d260680cc47bf46039e289002d90f9cfd1796663bb5d46720e2a96f1dd53315f0099c6abc63259fe573b644ecb6aabf0cf9f53fa867a200dd0fd161bfe667ca5b78beecc192233b7a9bb0bb077ca71bc30d8e107295e03c5caab7da7449507949befe823cddbdc5848e968a6d9303e0a89a1cfcc3a2b97f9b422d6bf2bd17fbc76ff69424b855aedeb5295b1c5f3491f6a6e28b00270aa13d34e3f43037e10bca7cf32d5f9a6e4de6732092714f1b85a9cf589b6d7b3cb45ecc9dea37996d610377a4a7435b5a0042c30c753b11c2e949328c047ab4d4edba5f343c49f680ef5441cb97925db364ca345bbbc9512c4556ac96cdcafb967b42afe5376e96514abd0e00dbccbb482af56d21586d02574e841247a4fb7471afa940f5cd812ab4683e5445eb0488a177f662f424adcf7624f995f69f3057c755db8ef3aa9d3acc6d8a1986e8adac48228c72eb7689c7387687aef5404b637a113cb1b1ea89661e2069b0890d5b0a819478e64b329f186bbf9f6be71d67fa7d3413af1cef3ec04ef2474710a606db1a989d3a033df877258004b387a0f22aebe601977c2bcd18988790465233dab9df6c595ffe8ddbb11598767eefcaa37dd474b731ed0aac34bcdf13e84449dae6042956663ea6e9e32eeb0c24e9bda46dee11f564e7b8a6009eb7847cbea95126bbc776d57c6e3b3895ceb7dd315081489ba4bcff5def1c25ba0ad37bc32d1b0ec1ca027163bf6f8314e1bb0b048d836318d87117b8ba6d0207d3978efe328a7d1e0389c075cc0cb6a556f249817c82bd5a4a1f0630e966da3d48faf37d220684434607b64a8b778a4f3cad66796d649514c39ff06664041037a3335db53802926e601708ff9a404d4e712e8202f066ad15dce8b8c0e9bec244c48ab22e0a05b8e0df7fa3ea4c657a40f05cc61d8feaa3592f8fecebc2b48f1e116357a253207e5c9353278d2b44a601e56e67046c7a376ce7bb10da513334e5a24082e755f92891f2c69809458a6793b94f7bc9804d5a531df8d4ae154178fbd048a5d5a5114a926122c48c2d1fb017fe1c1d99eb62ed10e0dc3d54dc563566c77dd346e874c9759d3cd13c895004f4a28f51525b353f2e2c7cffe888db36b0577ae27d7601518fc0e3f059f2d9ec23d2f2a356fcf9feb1d3be1cf19c862c4a51e169aac40063149b9ed1877394a60c86ba2cf68db0039d54c18602892b3efaf55344055db10a04594d970d67d42595a794a2467b16af7d6ae3873eb9be70efe9ea9680499454dbc8dae20033c18598c92ab2ab91e27b80a0cbd5fa020ebcc4b66d6f23067eec6ec652766bfa0af64de03149d9f255aef9634b32e756a3a4dbaae6afcd3de474fa0640c32f5aa0e6dbd0247051fc08a49191b99ea7d9992ebaf4aa077851bf014424549e596aa91b4e841dd69738d30bb4dcfefcc8c6788df813bf9c7a4c3a2b09558eeb1811039e28a6d96cd165fcfecc2ddbcc21bc172d161f964ca04fed1e7bec6272f7a34db192ee114a8fffc6df5c261d18529a3852c8622968cee0652173e29cbc7a38da246e7781e018ad7017fe4eb240768ae854e00d90a4cdc9ecbcad7176e807601130e8a273b6cb2e65cfc3f78693c9e6ed061bb8dbb9bfd79e715a64ae19f4b2331a602c9a435e5272b607c559c21524a3abd805aeef14112db22501d30a00fdd2a6bd9c079363aafeb08aa260f93bf0da37b56e03a06a24c8de2b4c4c76df595f4ea7231d9a018c842fa6bab505bfa1ef353b6e148e81a0295d4a17857f6c9c85a9b9908d65d02ac98eb7553ecb30539903418c48e2d6479eb603767851cf00df477e23d6fc60d4cbc826fee757d0718fff531d6614da84a2d7fbb5bd40fb1fac095b7cd67dd942a4371c8054124939a7db40fe41cb69e8d9cfdab76a7f3eb37fecf67e8b57dbb681336c6ad55ff2905f7db280f9cff6e765d68c3d58b3019c159b55c86e3e417b9b0f34a5bae35d06e78a48e7ed3070ad49a252b0915d3ef9c18dcb6dc9d3dfa85109eeb3d7a7440a2491199249c2a19d7f0a52a35ac91ee9570d54d31408cac1c03fb435fa227046c3bb6e7394c505adcfc74dda5b9754316252181b9a1565f71e59cc2bdc0be7bc74b1ab3bea8e9e10a636ed1773142e9a97cff4665dcd7aed117d302defcee876fbad83418268564a277e54e11334857daec17c82f1c237d7631ab46e30daa2e530c6cbc8456d12cde23975bd19eb6156d0d435aaf5c676c2470740341494bd2f32a7c23aaebf7b0cd2350398cfb80ae424c047ab56c733576d1fe6214fa32bac663237a11b726425c7bdc0d08eed2b1d9bb042a86340357831354897485266c018a3da39697021b800086cccb6d254c6f8f1a127e25b37119b100b85437e8bbadabbea446fbf0c8dc74da6c81048c446640b38e4cc5fe2413605f258aeb11fa86d9cd4eee17a9a9fd5db2061bbce0ba53607b6c5124873b6557e085b71c240b44c03328e1b94b7b5aedd32a845ecfba3e0dbd0e918a72b632bdf8f81c9f7d62d34328256b68ce3040ac8c7c9c6d14e97a1434eb615a856c4f3aa2bc5734f11bd53053c2186b71b44b1d8fbbec1856b9b7bd2e19c6796b5fb806a37a14c3411fea9e738a1fe126af31d4f0f499bee676849bb5af51b68586caec1ca9a48efee2c26c71dd91591c9a4e2cdf0415cc71c8adfa140bf78367a5647ca4a6cfb5fff879f2683a43802c7805998f87ca49b2c9d49d28a864eca861aeaf618dd66c893cb9ddf9a19baf9561a0a59aa22d93a2c0dbc04fe87f359ee95111f9bf7853cc07104ca16db5c7e8362614bf71f5af96a870adf28448e01c92787e0592f06592aaa0e48343ebe8c4ca444e080cdfd793135380d3b31e72f511b00f294cdb7814bf6fa61ab8ceb9475c690a8e7863ca959d613f44427a6e2ceec77d7699063bd3a4e6c8a3bf33070adeab2b6aabd9871c9a60491c10e678aea96c56a2949d635c356e78aeb4896d86874146dacd1731acb4a7f51b52c26619a69f50f4f509de7890668aa1695b53350b56241f263884419700f0cb259db18975e9c72f2253e9f0f3d9b74b37bce568915e419c30b62960f1d53aeea5cf9e805e1b7104f3b11fdca0e0829565b50d425b6a1eb3b09a61c66019dc3b84b398a84b5ae9d81319fe336e2ab4d155e471e89dcbad4bc76eff93f80410dd1ac618528df47d4a925bdca1360cfacc82407ef4a9dbfd9df66c14ff155d0ac9b17f38014827fd2ffb7b8743ae09909e75c9803430c37648a334071ba1b66e53aed52221c40b47e249c3e029a030595d861eb63abe8096934df5c29563e4ba8bd9c91e87897b75f76d3d7c63f97b6d6d7e35c6315b3c423e7dde8a8e49ec39dc62a22214f314f823bcb1f42e4ccf17848bd46469229c615f6e9d0a9cc4ce349762d6b2d70084c755f93313214d805b6511c4ff89de7531a2e53e320c69247a1a6dc8bf437b972f074d2368afcc384bcb54c631278a32709871d5d6c99efda90e9c47775a5ed724d948294d6f5014db7ad5aa1a0b15e411ccdbf220f00105439c91484948447b3e49f32ea85a1657405e082694501d69a14b6195be7bb139332c0386e6fecaa1c6335240968458d48efdb100dd1aa06d6fc08b41c183174cf2d67e97aedfe2c04859f9058257f9b3dc37bcfea334ee147075cc5cc251131fc41625fbe737eef6fd7f065a4a542c7968596b1ec976b16ae81c2127cfb0a8e2489650d48e23d6428e238834ea1be02f8fa734c2e81a929c7124c89e6de72210a7709299805a62ed2a8389515e4d72aa7f04661d5a29f8d8d6f3e813d42be9a06c254f9758322e9549ab15e5671896ae03bcb3ca6e1ac257449fd5f86247e769731f7dcfc1f3b36e4aeb74c0db13afe90b27c73feae8e68dbb4eae033f99f6c0591a8ce42fff84fc2ee36aff869bf5a7af54a5062843490f8c321f81b1cc0e7ff233e7580c96dbc66cf3c9d5da654b9e07afccb8d25722cbae438b6e9a3bd8b6ad3254e75f1b72573f0b1b8721bf77e4de009e98e6873e38a4fcfc038548f8f44e2bae4dce0cadaba7fafa8a7f097695b6bb89750555579faeed5bc7677b65e70de4814e442c9c90bd1d2742b2f17e3e654cac00ae902e858675df17ad33cbc4db56d5ac7622f994f11d48e537dc47491d7dbe2b50b876ebac914d877558dee97176d9bf608b80497f9b34a8aad6fec33caadfeaac00fc6c69c71b12c516d05390b17d89ac0d625f7e69b7a7a34ddd616a70a90d868e2dfa6b0f4f92d746d5de4c3dba806d8c5ea855a5b36a59998db084726b17bdf336d529c592f5b813cc781c04fb00a9b89afb685d7058088a0b2f71ee10bffc6374d3812cf0e08ba9886cf73fab9d76d4b43f1ca6f64ad37581cfbbbeac3f92a4ebf8cc82bd0301584a4219de414becd2528653f5815b76c417ffc8e3427e48b04fed4d2bbab9d2f9040af263f2578480168889d08d355daa8643efc872f8d650f0fa2b3fb980561c7e4fe2fbc4b3e06421dbd213c4970431ec30d9b56f8e04b5263cc96d6ca3c01c3249018667e8bab69b3c1f3c3fa70e5484b5c5e304b0ade0096b4e4f1dc23a05ef4b792c3a4ec03bc0ba479319fadb80b5a6cc089599c626974838ffc48e61c4d93cbd7bf99f2c6da1b619f087fd9434cea3990c1d18105843332d767d718348c718dc0ad6cf098b280bfac6c26559812c6b741c12bd1ea41f8cb1542c18474fb8f7ef734b5ed6938e6e0057b86f985eb0fd273986b5ec94b2266429fe8971475f103185a8733c392896461696da8db042a1b03708bf6a89f6ad19c3f38d7be7a4a1dec4fd42be46032dfc8b4122886f81b905e4439b9cecd2016c46c04c79b3f29e7f55f7ee1fd0fae5c208c7a1c3d639bf4a5ee6a8be4ae4d2d35212ea7dadfb6f4dc3b8d919d93d54f860fecc018e9534058cfd9296633a8f54d9cdd383737a9f6c0474a1cd330edb02450d07df347bcef9f383b30413ebfae8486c60b41ad748213e74f7b875c2cada7ff229e9612030db2ced6a8989ad88f60f7a6bb68f8fe56703369cddbe1a26b1da58792f6f64ebbb028c90c7388d092570e44ad25f00979da8b20176df7f340c9e0c43753e15c048430cc1e57ec97e7ce3116b14d03ac04c8635b5d351fda17ff7927f8b67e6476efe1dec4822add0e024ff9c2b7388eab63de573cbb9f19bfb394826d7a4d97e8e5056c8f087ec59f734b0223740ab40935277643efd3ec089ffe4eb88cc7936f0fbaef6afcde3e76744c2120c5562cd72285cf5fb9cb16717b0ff59009619776e5a539b1d31e505fe83fd0adb01d31ff3ba1f16a4277921e9ae086f526e7f8bfb51ab0979a2b48548ab616234ba234d86d47d07111ac2af65fd3e85646238792e818c67182c436043132faf4dedeedf421099ff578c7b9c16cab9a40ab4c53a62bbb2a028da62c15dc07b53530717dd3eeef28184c8adb7b50c1fd1b7571402b4a5da8e807a032e971ea55ad05381b21274ea4aa7d0f19c1ba2b0a96c90c276f3bc7191cc1a047c939db1135195371f26d6a372baa01aa1310ad1f391bd3e6274f671f6bcbd546c5c5dd4e7900a33fa2706853201e0ac5ccdb77ec1dd9e686e1d9981371c5b3cbfbb9d8826828014295abc0d9aab6ced42694780bf0573914fe6095eb394d29983202e8dcdc56321af07624211fb8f190f64fe4df2594ecf82247bd559d5f68f8c4030c07b842fcb18bcb5826a290a1e60507228ffbf8193f1733ed69ff5bd06e02b6f51fa722e5d881b3080fd697da65062ee2f5dcd8a9a366b5777355354ecf08d584969dd76ed356e98c5ad23230e93216a147e785b7e974efa49002a41472c4b257bfdbf7e4ea9c84011e10e998ca66b5a76ccd7f8073753061b8768ad1c2b4353742e195d2e3d35608bb83596dcb9f04d1be4332275299f9af80720a968b3145f8f4fa8c5c1ed6a9b680cf8bd08ad35bb4856445454fea28697a295eb555f0093cbcfee15d987b5604e1f92698f626dd828e65c262a62e294ea78d304fe380fa33cad6b39a0d96d95979d4428291a692979aa1ac0172b00ca2108afc055914a3f2daca672e70d0cd862e40f8b5f4abc46d714a1189516e2e6cd950c191422a1326e9adbf4dce01aa3b2357f32c024e5c14aed78c461d5c1cf01b080768aff3f588e2c1836cc8467f43bc8cf80e56e730989d70b5237c9ebe991cdff34afaf2b86c8050d6174461463c6bf82f431868b64b6b8f2984cfcf41d4a1d476ff8133b5eb9d6ea357cd9adfa8fcaf6e3c3a3c04b3a81396ef253b15ec6fcfe9c7b03f53cd7104922ad8786ccabfdc4d2df4cb1b5d5412254c00ca41d078b68d6517f458ab98a606d5cce4fac0bad2207cb29908e723d0237454b68011862180e3c5984cf15cf7750211f15a50daebb96ff8134a3a1a4aa34e513c940531da3ce11c0002e330254060e3dc043ce42f3a1947f7193e25df7efa2301b51d030c05ae007f595b33e6e0fafe817654159b40c341700936a65e5dcb00a71d87a029931f78690d8bcd635f1b2e1a311835856ec87a5b3fcc9feeda4af64a6eaad85ad8020f076d4e8030b92f9c658a8593680ac03be65c26b24c580196314db950e66f70ea539c07884309a8cdb15e14f1b354360621ee9866468c8433052e17b9caf2d35b6f366e3b9e0e6b66fed01b1293e8b6f11770382ef21ee82f7a202d7700cfcd1e6b8d604157567c2cbb4f496b3e42c7f09df45090d7d06390c350a2c02deba26db529e1034ca5ae59a4d77a0bfea0d3454de7fc7cc5598c3497cc9454731af0a86062d9ed4a664c9837152224c9be98ae024bee07a6fa6fd46ae8060009df9ca70bb43af40d2d9b3091319bc5958ed95eba17607c14178ddfce35a30604252f9c436614b9091e48e0c94183f830c0c567e23ef3b1e835ec4658091290f357b69bac4cdcc1ca64e352812e30cae11e84389dced6a0d08cdf3cd3e7565c7b38d9970bf28faacd06f28a7be124c198f6dac54e7c1d72a9ef6a417ab8c79eac872133abb798df327f9cef3882e405c89c5ecb09f07bfb1972108b2d40ea6a75e16c2bbe106d74afa28e8e825d965fb7f9e7696bf79ef361f43366bf769dd458d5c2c17746c884686196c52f6602417816022a70d7768aaeb9f7b97191af8f5ae93f5d010f2399274a610bacc692938c68757110772f7ae7555c058548bde9ce56520285caf8b9c1948168ec7d555df5dc163c0a0223fe8a01b5c8af285223a2aa761245fb4e8181ddeedc762feefef0b39e7073963e180260556e6c220e693ee830525d4825467b9a7e2ce46866eebca31d3b4786b18bf79253f0082b34e3d30634b5d868036506393085869728552f0181ce5ac273f6b47c30fde46d5c58dd80eefa900d1abe1aea64df8544d96d421986202b3e4ad504a85fe3bd14a18471522fa5529d9acaaf1d76ead6fcd768797c1bfe55449bb58812b59793fc14a1705774eeb1b47cd188a13c18894b446e0a3ca4ee58eb6ef05f70f07496699d5a7cc9e68b31ae58fe0f45e039adc0372268d2646192e60551bc813f1b3b662bc1bb6be312af8a5b4cbffbd786a3c21c43104552725f7469c7b6fc041daffd99999d1f1a76bb0c6b726c57b3dc8ff5a9143c0e7a33eb2382f0a8bb68b28c0dd0aa864dd3bbf25b0c95f81a4ca04f0a6d33af87b37630b3f907d7f37c8e8d2b68ad4ff44dc3718afb15279857b5cfbfb5799fb1c8dc4fbe029b408a48c0a1cd228e209400f03d9681212aac86a7262795b5b8dd267e6e279186c205d8ce29067be13675e2ecc9f03610ea1c9d8b01659870335ee6e01091cac1f7b1f6f8323bb0d131a21e47fb5ffc5c211ff58098de7f4c1ad7c6d0be6aacd77a2547f29bd0e87b6bd8761cf2752712e7848221f2c0175dddb7f07ae6526d40c8d3e7b3ee98eca3597df8cde6897021e0f04002fb5ab55b2e2e0f4cef0f9ff28b10ceab7426c7c2291a71dbd803eb3c2c98629bf02f46ba750fc9c8450b012c5a503e4e73750c238a809cfb09cf20626a462a4cedd8e13d40ec7cff2c8a4b44f25bad3173ffc09e72e59cd5220cfa92cd984ede8ff65e8c75bcf4fec50fcbd11471c8e7703192ba33f12934f5311136fe531c8eee904b8bfb5b69965158acd7a8425fd55f492073eb59bf6e22bc61f8639be20a938993d339df2a7585bda17ceb269f82800063da76cb3d2b68005d78dd078d43c0c65d4936a0e8d5491cdfed106bf2acd742993f177d98383f4189e56fc3758455f6eb3fc83f06824606b02f0af01a7a6708c6c7a56f6a4f233c699439de26fc2bdef29bd4f6dd5e60c3f2a1c9d6a2a4522c698ca8675e6637fe7d080e2837d8c88cce4dbae4e098235d3b9f81f015ff814e8a41136aed5df9e4b1d2c69c0f2c0c1033ba0852ce5e40aa79f3682d64f1be482cb58c3ca548ec477e544dd06aebf5b663880acbdd94a642bddec5dac4d48a2239cb46612f1da0050f17c3a3c84cb92ebbadd8be5992b1305c13b3a6ae72850f391a303e80aa07ca023084c90a27aef8d93ed6f0ff96ddc95b6ba7fb3498f4a5951a2a7a79090727c2b77170a7f8aeba76f7fa038fd49ece4e60afd5552de98b786c989c43e8d9cb0f81881cde04870d10370b9e9238d7901a878d9208d9ad440407a2172e899d59128bc719e64933e50d21702721e8b4e293651a89b3a0dbc77d35aabf4aebb13aa2a6246a70b186adf8fd83f228990f5346903c5b0b6b539a224245da22fd56d8658dec9e7619e8190720186e6829f5c327ed82c07306d6d2b5128bec786679ba3914d9da5842a102793f5329ef97b4783bc7418935ac228c2cbb664c8e56ed15639d96d61c1afbaac31e9b86a6ce54b0bcbaa71a9e34d70f5e32568ea97b396c51a04b34fc2e90176406b674d651e2c8e9c6364190123a0fd34274c0a774d786d52377e81a3780fc5efa03f0a7212b144a29c6c449785fcf37cc6579f38ed8aa1a47564f4daa508535986d6c5c5f6f0cf7c9a33c1b4d5525a41f4c7dec03dc6d36972c6bf8a1acaf2b0190e653ad185eb1a6181a972a0b3fb404df7a277ea5e79cd128a118bc646c727a7bd215ee7d1548430c766a74c30ff8b620238d909b292e59ebdac5e2f45caff2a51f53a2fe8b05114f1e04f056472bc6363222ebbdef9db69755d99f8117f2635604cbff7f453d27a098dddf5998af78becbc20e32de740ffd2cdad6925b07b115973c9bf60032197f63b9a15787382d929bdd010dfc3d4fe5b0cff608208fbef87369682563bb8f91fc9872d01ff0981e2ec0e2b15b2b1bab39f143320bc8f8483301bdf8770aa29067311c77781f45400d067cba05d58587861f655fd4e172654ad8fe8148cafb11352161b6e0cb191ce03455f14b90e42e9c5fec31775124b4f34de30353ed716f375d29e97bff04e5bd4404d2b09aad646b2c4cafc65e868d6fa449e5ce1fbf87c128493304a4a319bf030aab67f33675c12bd6ddb32c61eba9ca1a4de5d0d61efeae9375638acc12acf14478aa1aba8dafb0c2e41aa7432364b11817f072161b27351ba03f18c2a7093443c8fd41f2ac188802d7cc9da346562e9edef78a5206c098be02a35359de551ffece4f787088f336d1bf4375a166e75736c103fd7b5e5c22bc9d29a749d2a5bcfdf4ce05f3547c1d320226baa2611077dd00f2e6723c45b9fd5b86a2d6086007499a084db8c13a66a02a93bfa24a36d65a6d89e09efacde6d49b78fdda3be5f0ffeac4f3ff4566e16057fd032216e73bd24894ce88b87445c1b43e95ad0066b8e3fff3c643372ae5fb8050d9071bf83baab4a78986598e7650320fd223ac62476d8861a6c2cd910360b34d32ead43ce37fe3216dbe2bb1468c5347ddf94815789b2b4b01bea73b03bc3113adcbd6f9067359cacbcda046b256599fd916b7343ecaedf9311d0d16226a85d977540a77f78d04dcc9b16102546ed70063575e808eb1d33ed835b39ff808758475dad3e8ea667192df1ba94cbb5481e6ff718c437982b459373bb629f155355f7a4c7accc958cd7a13333e4fafc67af11fc02ea26c80b9b2f601bde12ab402640dc91a33ae5373d41da3f288e4566da6d18bd376951548c4dddf124b0d7f82999b3f79af267dfde34a173e26279b47ebae4fcd66e46f1cf8b8b711d1ef75fc5873a5b8152caee020a143c52c50e357935d945855f89a2634cb1922f2a5f3d0d2f8f7a2d38d83a7248b7a0208e67f0fc73dd49c72ee7c76493bdbdd1bdcf99ac5661508c5e90845c903a763b83597b0efa17c5b4de5e322208c90339867763be71705ec88986708cc7c5f9eeda5cd06b3985cb7beda2b825e48736bb18683e1dc3681e3afa51c902bd12e7df76725212ad5cb91b243a1c166398f408d93204d526e9d20167ed6bffd4e3b81f9ded325d82152c579c6eac00d5f345a895c17098455a496b9d5f2268801947a985de440cf6e540ffdebdcffce064cf83f6524ec28926133cc4638fb578db92e4cbe997ec0d8eb56c8b8bcc3d21039091d0cb560a1bb06beb81d4c118e97092e69fdc837130a2e3115fa34c2df8a67d4c887f04d6f8aafa4d3721775e1bb8b0581983586fcd8d2afd19b5229635a1a825128814c4ade4360416dfc9e5549710059ae361ec0b7eb9bdad19f6c81e2c47d2ec552abdee346f7d3ab4893b09ce37cd7642b984ed1b05d856db26fe37269acfd25a3897c976e754fdb0f51d20807201ca88575f636aa28449668ed8b242dc1c771942fddfdcfe5ffc66326a5b53d404f120c5bf2d759280617a31c5fb5655d10011ea8f56e0d53168a89f4342efb42b7a87536aeeeb4cc057cad50505f467e6e4ee545fe7f3103172eedf1a2b3f0aae6978cac4e6596b0f88ba515b47a3d6d71ba68a769953cc2daaf68403c796c475150fbfdaa6cd08a9ef371663c849561a866418698dc1f34d62cc8a7cdd684e7c012e50effee9d107a8fb8d9b7555c5aeb25e8b1729df1396228fa3ec2b60cfd1ca941a758132a38fbb32aa26063e18a823f8d78d882c451aa8bb9e0e8a6eccd639eed3845ee57353db205c9993448e5b4842d71c6e552d9870f8a7fb98fecc4f4c74949bd071d900d888405b99fb7ac9db19513f9016d64474b7919d6465c7a9199237e7ad36fa8f0bc3c7be07509c7114b723252b2ce2d9b719b8a81312ae964e6554be87cb94e982592cbd9e874e52f629928357860ce82e0e46bb62ccea1a052f2ab44a2c24c6cfeb1322f7148118fb468bea86754f6a183f58a7112d8bb2b628285a524f27569427c4f2af50a56a2e764a513ec2331cf29e64c32cb82962039ab6cfe63bdf5d1d1f501d5fa50ba6315a077f28c780765ede469d49eed3a26e2695e1aec53aad4e5182026336411d57dff6e104a70e7f2e3b4745425babe929a7d6dcf518ba5fdf8300a21c2a35fe23613350192692f2b77e597fdea03387e3bc90a3a83395ff625704482b5ffe207a46b036d238acee0e357ae43b08f73bceb244be387d65c3e27172faf014935c14b02f103d059518c2be1ee1b6a8ac03ccdca4490e5fa40c95fbf4f7c81d6ee4f2c7034b4829a76e8c799a3ed417e915b191c4463f1b2cb0300c99ee11fc6279dfb799e44bbb6442a60c704bdc19e472ebcf444134f231c13614f92303bc1f1ed1dfcb9f7551d76989d4ff9edcdc76f134b716a8dccf2d90a660c961c12bc56fd0317752bca5b0509894773f342ecb00134d0a9a257c7bc91eff7dcb6f7196ecb2d1a2df82e35f875bca7d57059a3d62a8f19a181014fac011f785af48f9e4e83842d1b3322eff4c25e09662e6111cca635b07d2b4acce07ee520fab295e4886652bce190d20c4991d26704c7804dace7ca5ef1569cc01454928d105386e22d1b585e8e409e040d1523667a2ab4d2f49b430ff52a931610ca68ebf76e976492b3e3e37093be2a015278c807a0b824569f74821ea0759c5953f38db2352f33cea485a7c402ab6d7e3fb1b50b8ed25bdc9cc882e0ac4637e50d99be12535c5544e7aeb5dae83ccb01d5c5e50babf0a0a55dff690c4fb2893a9303e44f9f27c78dbdb2c82410cc4c4bffaa9c5a448c0f214b48f003a2763125bd423d74b0647bd60d86b302c36e470df9ac80c69e852745afabdbac621a50f60131addb91fbc0f24c64aacc8f233979c4aa57c59174711911a35d45a1be24387c4de59482522d2755067534d49df612916989c3a73cb9df2d20c4118917ac4b6fd0380c2b5e7a98b79766cbe8ebbb851deaaf2eb964ad0d58278353a13a702c1e8f77fbff6aa851d0b3fde154f2852d40a886ff53099c690cf7ff8ffa7135beee9050f30b68e1ae25734d6f1977a0be42740e03d33a9c7b3f0623a81d208c4f418e7c968c80ded5c8950b62b712aeefb8d1f1219bf45a9d2a5959f6e321bb719c326eb99e91d9b01f652125543d3c87975870d552d4305d2c883014e7f69d012b07a48c0381d53eeabef1b977215ffa190aa9e5c6dd2e89b72bb64bba5f3eecd948b00b98e1f8c9205a7814938a244297e6d72bd08c924c689f695bee6f4ff07a7d09c1acd4edb7c7e741bcdf4f37afed8df7f9f41bf753d6635f23b876e70273a201fad84709a74b5f19bc9242a39071a8198d8126fb07b1488058f6f1e33a9043a829b3f9b8d7a9a993395ae7f7565bea063c27c153e0e329ebeb7253dad411c14e872265962bf128cee355bf5d18f3becab1aeaab45bc6bb2d4e478f98effc9f7ebfab7d9c206043f054c5cf7f7bc5f624132bbf2e69fa0aeb63f4253d79b9ca3fffd3cc509c6f9e2b3833e1b5e34fa0d7645aa1dc798bfdb2468ee894acfcc625bf7be4df7334b94d7c44012aaa4c2d47aa895e1441c9cd3bdd525bc6d63460209fb53a0ebf24e087a3e6ee4558948bc50a25d78f208ca2895f46dff24906263c708736996a654c35effc0404c92c1547cf8abea54013096ba77bc0a7310f0a3554eac1948cc3523ee055de6a6a0f3a845b1120dbea54a4e9efe6d551dcf9d820479513c9759b55498fd33f2ecf364820e4ad27592128574a67ad26989931e4e3f3fdaaadfe3901cdb14551053dd57877e56cb47c9698eb3c4d3f0ddeb7fff3bf93cd1f2129ec265aaf2236adc657792c06e5bd37c681123c05733ce751f4199480938b84c49187ce6b2db76e40d5c0074ff22392196ffd1d26a0926041420cf85c2a7161478b213e3b14463d27436820fa45e3352772c588873c405d9150d153bc37899d26ab113b7f25f58e09ccc7ad477fdeeb992b4645a4367658d1937b1d5fdf73f6817233357bf1cf4f047d62898bee76102a3b9bc27e444eeb814be3053c43d28ae526ee377b353dc285a2993574de8781dcbb0883226ba5c6b7d9588d791bd528d204883ace99e608ed64c14b445e81ab999313f71c3a25a84cdb6101b65e3c5c5ed7afa43cdb950d5b4d1c130a857c987796fde6ca1d9d633315a1fc1937298b45c9efedd15c054dfb16fe68c8136d2026f10f225a86d674f6ee4e2564430610080da382f822bddac06e6efee2372f73ef4b340be24555015f6d6000ed07ac96f359b05d45717fbb1c8727c3da395c547a810782c21fbe1239e1c0da2bfcd12f9bf1b4d241e624f429f4c26918e0e8bbdf02a235d2bbdaa89cd6482a3aa794252175cba6a453773f4a254279c91a94616af98ecde871f93851e02d0b15e02caf0c1f580b2f9b52a06641635783a00589eb8b591db11be3a6695c3b0f8fbe8b58476b08f2e4f4c2ef32156a7e69e0bf51bc6d66d3d4ca1c7b0b2f2032d96133e408d7835a4dcfd20e7b88d47d4c4d5ba579cba8e68fc0c8b02ffaca1a8547ff22e3cd9cb00256ccee055a8388674d15ac7a54ef436eaab3388406d0a5cc90eca40128b0b28dcc381fda7518c6b28e89fec24d94485e79cd09bf6f215c1131287702e5d56fbf2054cea2c4637d99b31ce6d7a2fa5ad42e6b3082c50ab944c5892ab4cf4811fa3447a95f2f7dcf32113850cda19742a9cac7bcf2a13b81441da1316661752af5ec6f603e743d1f6366d03e64b4415833dcc1cd02855f541e90cf4b4a8eded077db707583649030ccdbbed386f627dda6949c547519a1529d3f79660be3a9ba88659199a0ed837933d2f0967056720c1a4dd518648e542fedab4cef633bcd7261f83aa149f7b5222596bb07d2cc94e2d3c97c69d740aabf9f0db857aa2a39ac86ff953753ea9ea9a0ba33106ef2f2b90bc6f7900aa6155c57c32d2523cc0d88255bff46674f50a3aae49a380f1b82ca75cdd72532f77cf703bb4a6cde72dd470ddc84386e84e28860b82e8fbc9d36d73797b3d11e18c6cdb2dba046c6b1acb9ecab353ecbb3126062cfeb0520aa30a3cab0c03e3b36bb2a4aca6f8cf322370d2df33378e21e3acc7fe350d0133a8508e8ed50e027a3458645d610989049480be082d898e9e1352da9571088cbfaddd035b43c290aec4ba75ab8d092c15c17c7ad6b8d0616f1b21644828e8ab6b708b08fe17f810805c001bbd2cc9950d5a238e7f0a2b7497565b356dcd29d530fd05ca7da62f47c1fbdbc915c5ae9436af960d56a2eb3fdd44c614424ea7301528b4b077fbcd798eb5756ccf2b457e0d88c9242b26a74a505e623817fa68f90e99ce0f5c6dffd00a7b1e476eb1f19796b12b05bbeab197bfce8ae894e005b4fe9e177e3fdec4c99525f6ced4e6ae8dc7a1cb1003e1be5a994d90594634e61db8e9b2f756547c4dafe1a29f65ba3847c10d37a7ea068f5b9700a49603b87245325870cd7f31a4901538787440756e60d140f352256a5bf04e058ca436c68000f2688203551999d4feb507c5d101bbef662578b15c8f85361222614dffe954912fcb1562cc51b3b8144e8d7cc310c48922df0b433e46e6f0343bb44b12587807fbec304eb4858d4be58c44bd85001e0040664d0c905ea428203959eb6e5b15d491a296971db4a0f83fc17c5bcca5f4a794a9a7cef6d5b23f7f11275d84cadf023df29c3875705d1d7bf810632dc02dbe4ddf0f81e6c0f3f27cf2eb4de20bfbd4bd678004e756de76f5d799ed0a4b07394c498b1250ed0c177db9e724de552c0e93f74d4c8b73a8496b3847480f73d3a46cc428e36a60b19200553deb184a3d90bd3350c970125bf5034c0f8e775ef514f7340dcbe810954ecdea87d6ed1f3692e9c5f6fa29ecc48397fb0d3408a701d8095ff6e9f25e8cea9085ee0be1978a88f0df8d40d449bb824c80242f1e7df185dd182cd706fe18a1b800ae14d41bb0c9fa3f7e7f6a0a721aa3d340c4398c7284875819d1275a3d061730714379ae984379a57b9dd049a865c3dfbda22e16baa3fd8853f092b787fef6dd9e2d82545b028309b89a2a188f754faf498f79b3bea8830a6c2521b2ca5a0e3641f49ce0e2e45f631390b50b23767b17cfab731e081714c07c271367a0016dff301c04a3ea57001d2dc2bf9f5edeeacc3840ad7b452a38ea1c22d25a37fc547d885ae209e3f62518f2b6c5c8b3d9ec520fe9887d535b85172cf3d88dbead1ea0430485bacba8a99ebe74d3dfb312910d3a33f1ca8592c45b9506fe1485dfc62e1bc4330678d8ddd7a4227b8580e676e8ef9458bd0d0b7f6b8f47ee9fe91ed1fc2eb062ff84bb2d98b284d733fb074abd32b02bb781a7c327d39668e3e78b28a89c60ae56b49721a71d499398f1506abc3cd65ad3691a52f9d42bc316c22713750686cae6b02ff56d2ed311a899f63f831c6eb9e0e46746fdc204aba3659f2cf92cbf64e4023a149f4ebe7a5cda9025392ed7a2e4a9873ae39fa4c304ef1ec532ce663c6b1011b14f112c2a54a2144bf2037f7f9efefca4e8f9d27c86ca98ceefef75bce5adc2cef06e76fb78f2a6a8f8673cdbc5b42a51a14956b52275e7f722a0c9ebd8b293b4c7499f1165fb0182905459d3ad07fcdd066ce58d25c9ddf19b3627e78bd8b5c09ccb3f296965ee7d325f268dd169537e871e92de4312f99850bdd56f0c7b45690a875160557cba9a41171563b6921baa28a9b199a8be7ce1e8a83df4507cf1d5aa31b55774c56147a2c43ab331edbc0fb73bfd4803f5d6b3aad6a0b1fb5e552d1d2a2fb0979b446169fc2a312ae85963aedbdd146951e479e243b451b09de8875996fe73000f3339d0a4937c075116e9447854b1dd02526762769c5f5cb193a66677a2a2b15e71b3bd667c17a94c01ea860294fb25068ae58f2e6c1e4e654c01c517a367a273a1f19e5f0a45a20384feb42c069822d70a55bf51404adc2701892fc7c78e76d97c571335808fccafea42bfd9bc09915b169d3227604303b5964cd6a176a8cf8e3013e5888753ce7ea8766c57c527fb8bb630b5222874a0633ee7712fad90448868c719f54e884a6ad0b94455a2f4e91b17e8a5775e86662388b5ebbc6c737c84184985b191162787fa7adf22acb6995a1b7c97fe3e9cdff25f8ab6d328822ec424bf8068fa49828c0d19e267ffaf82422201461a46d4310ea5d3e8ab9f26915f61a795fd2feca8328c120e47d9edf9b392f4eab1b938ccfb3d6dfbb79c106f0ac25003c3e3e22bcf514567f51274d80bc1b1303938cde1b837eb3915fd8d529d5615f92b14bc7f758ead4e53075ce655f146862584292307792fea099172f14aca7d107ad8aeeee69b26bf569797a93a96460cb16b99360eefadced96ff5e6dba926ab5ec29c4b8a1466203dd9fc38824a5d9d33dcf0a22c1e3f3ca7c4bb9a487e59ca25fb64fa60a5e3f3bc23297c10be4a01fbb10dc80df09a2dc41702d661d23ab72dad6765721a4902fbaa49c6267492b151d97c90d04ef668e5de93a382e2cbcdd175980ab13ab57b2a2d69d548eb7ec5964f7151cbcadb5d1c78d8b3c72a282339347a461040f5b0a0b1662440ec226180b27bcca54cf391731054221926651708505a39288084ccf5fb96edd3b8527c046074129e8c70bf1f4b84c1b3ade20d424cee9db0bc976e557a318acf68546161f73b4bf29ab6985bc88e0b508aa4b844acd530f76f050b9b51dc4d66415ae95eff0bd8145985050759dcff91ca5682ccca2df8eb3c4c68c7c976f9e9adfbf09a28166572f6ebe7a69857e69752584d043f1f0a63c0c82af4b1c2408cc709df6efe9508cc75d7a8777c1f572e546a116c9c25461ce091c7242f9383eebd28b665e4ff7a671b67fd2bd5c2eb8ae84a20e4cd62264b93c18b8bc031f6df2e5be3c93ca2278a43f03eed2aea7f8a640206086653307310401215ff97a823886e636e0e1d9ad79b462470f9f4e7eec68110dec8b864c86c83ffe8c8a86d53dda90453c232f2301b108b941e6827622009bb995172dca1b14b048ef1c0020d56edebfecc0cf5cfb9725ca48c7de8b01b00049d7f653eef82a092e70e5532b529b6681bc9de9a6f55fd8b84ef099e81afdec26a16e998b2d2e9688a82d06380170791848e8faa4117a5adf998816da13baaeb2314ac3abaaff2d0b04887f1131df0eda576e87a311843d5712e9b14e347f06e0cdba027fd991c5f9d0054995a856025061837369a9cb2909bffc5aac7c5a037423a6894898cdb02b523a7cbc34d68515884841326744f9a619a3035013c2fc3f5dbf694b90f3007527e1f6d24fa0d577a0bbeabd551addc4def29ca2550be2a3baf85f8d23afcd319e76e82e50b276988077f6071ea46a6846852f08fe318a0bd0a591a1818d07938c65df44a1cb2e986f1927a956d3708fd29933cb22024a96e994e55ea1ed0fe6a92fdbf706625ecf6288bbecf3dfeb3e97a3dddec7cbe48fee59eb8d756a0e7be4ec449fb18b1cf080d92f4e3c41ebacfb1e4739d1b78c4443a6b3786b3b86fc9ac467a70e2d1f596a5afae366a5fc4202c3a1b2662e467ba9f7669e9d1b707c601f7fcb3df58bf8af873abb5b304e23bd88111634dfc44d0b0fdd2b4a06b1a375fadf1debf574e8c08a19e011d2ee80bf865a423999ea037f058b526eddbea6654de7374e4feb8bdeb0a0def245827e6b70345332d24d7649ec3973b521d4a29c714dfb081c07995585d66abe032fc1a545d57703dcb4c07c6e40faf4451ccce2cb32c0abfd3f154252d8d871552cc921f7c008de7828918c16f24c4fbf3e76c8a48af4e8daf3698adcd5b933c49fba80be5dcc63c330f5e09733456cb5a5474010b00aad50aecf974ed69c4b56d8b660a28adb5d4038d04f0ca9b78db81e42fd619bf3ab4680b49c14db322fd6e0d4e62aa5bfe62d9c975ce2fe229875040b94dd52055314707ede761929ea5a489147313fb51cd3e07f1eb84c5575304539bfc3d19e42f64133141dd30454eb490b54b9ce4c6c0dfe4cb1c20761099a2613bb9fc47b8232d8df2147c4ccfdde501c9f2981c94692ef109743e7cec39676def3bb08665b11d7b6aebf4a0ba71bbc5a6d5351aa44f89c0545b598191d9b63a5194aa18d801c3b9d4511c1807a317a40da0e259f99bffff8761ea119ac07818d28661ff54f7dd564b655995845445e123d585ca3618331499a4a0f65905464450e8034f9f0e3ebea880361a57967381994663f10197a2c38127fc2f94978e9f294ae7578581dce465da7e8b2f3e51f239f8c9429de360d7747538dd7de62852a58ad836b5bbb58575a132e6964afa3b12c91f25b04f0341d3c8f2f71ae9545f39011f77ba028ffebeb031cff79525f6d9417e2a87809f3796d376be2615eac5f8a0703d6afc88bbb54cf8c62158da627f1127a2c03be3949943c4e4de42e5a399de0986b1825a6ccde15ba7df7c0438da9cce162f040da643d3daeda882c2c37aff1370dd7bf6ad82e5c748cba5f7acd04ffce30f2735485a90d7fba199770ff029b3c0e4ed48c301759f7fed9908459eae633ae3c0333cc39edf574b5746871f5ab2578094fb5d0fbea93d7b4b06395554c67dbea944ce77b6d5bba5dbd46f51f9b9b90c1ef0b7354ba9b179f1044b6fdd669e510499a97983eae941164d5d3f7729733a12334fae53c4a84123bce8c5a3e44977bd9588d724d85409205cbeed23046eda1f40069f190df5019da3d0fe25919e6d1a36b37789ee0164b150c429652dceb5de7a5a1ad412947c127001feb3aaeee985049f2e65ff13ebd70d2190edb8dafb16df155abe913aaeaab2eff5949f443cc5e7f9901e785feeba821c374a5aec92dbe0a16b40ee3c310bf8f3b139269aba28ef26ade9da4f0d6dacdd28e88605e5546d490ae77917a864752261912e74d4983d542f8790a1854e27b9221220cb362e2ec31a052104bf6236bb5fa471c530c138a7831b6fb3641c6a49e1c11867d92759243bc2e27a39f0ea119f8db585cd15839861febd1406ed2ffc7aded5a4b301c6a7a96637155640bcce31de57fbef55fb821b30ee61be920bf30ed35cdbeedf8640f92e8e61ea9aa36c92e6b939e5248a1c1abfe73effec71f62f48e8acba3f1785e8c29ae8827a8af4106b89260808c6b7c88b81d3d736776f4f9ce51c00cedf53b2cd75c5dc0b06712f5123741d747f3cea30d5dc2f8f46f278ad64654464cd12be1a6ba97e59904ff45868d7d71f26efde7a1b659d2625ad85fa18069e8fd177daca12932581ac21b61eb9d32113a9bf6a8858c626bd41c2d0147eb599fe39100c0463cb59ca93e40210d8a36d981e38c57bf75671fcdd18920525d64572280e5934fc8b1a25865bae5e9b07ce444e2210a52c0b25de2d6d499a56be4c3c888491a6408bb07e4f1f4f66a1309eb0cfbcb94737dcde3290531d788a8937fa19788931e1eb0825591428ab52d1fc4017bd88fe6d007d097f86959317dba8475d105143282e1a774f4f969eb63f492cb0bdd1fe47486b52d1903dea15074e99bbc49d9396ff66d31abea7ddbdc1e8d936d50acf4fe910279c4a3d80284265577cd5ea0e89d9a60cbfce7cb8236d6f4eb133ed3af3dd3d2f0d2d183aca3acee4ff864548c5bfbcf474f956eb276c5c9e0fb5f368e52bd639ceac685e72d65b37fcefe2569222db9c2f84838399c7cd917dfa71893a960cdcd12444a8be5c19f2125cb2ac70736db81acaaaf72680d8d14d8721f9cbbee55399239cac26d5466d5ecd1acc819cfd652b06a699337c6ed94a3fcc64c6d2f1ddfcfadb812640d7baef09de7b6b5c3c00cfbd57d5e02cc84b9ceb24a5f6a6651207f5c39c046e4c09f8bb976800be3e37968e7012b1caefbd81603b96d9d078e56ce09641703cd9f073d7c97841b54505fca09cd264f54bdae786bf16fb6401cee2ae43fb41b1684cdd034c1ad5a32cd98a490a07fc85da373d432060c1d13c7d60a1260f6bc5f88ba72a906c02ccfbcf64668d51a62869c72a7e9e6754cc0402fd1d34b155264aa83fdb004e0c0d906df7a6f178e76a5d62e5c53e92fe12e6b9e050571cfe5746e369b496a1909bb77002e57e9bbee3364772c0b1b22f17760ac172e5864c0926c0511b650e6742f126ff6a901365ccd151c8b54a632b2708654a60ac5b7e5342f4027fcc43d98ee6404b81b2316c1bd9fc6b49fc4998f2211e130c986123ce65534329dc163a36f96e8c2116fc4fa38b794f15bfd3a106ddbd29f4bdf220c509d2c8e42033a62c82d172cdf6318401d1bd2dd1e633c437543b1d31dfc57cfb0f021d1e2cae1c26aea8945c342a5a11741648d9a96b74f04efe2f0a49a389d94b6e4cb3413adfc9f99852fb6da402edb5fcd488caa3d986d829c521a94cbb46778dea7f10b55c5e315b109bdef374276600c8d43035a95359fe668da0214c36a865587346131392780076c209db27f289c2c8ec98756ac8cc3fef1fac2b66886aa8b00a9fb4ed7628e3b50f5bd43f1b20880ba9bc2a66fe17586973e92c9f5c6593bbd77bb919a3c3ec0b0240d57568917506adf995b0478de0ed80ca4ba5a328baca8c5105cc7c85fe0d0e0fbfda9b09f6f085a1a363bf1c288d542f1d2b70230604ccfd839d792d1f8c7ed8a3afe698e86aa22b9721519befa354610b8f64f63f72f3cfd9b8f07061035204c188d9209268367eef52f1041f0978441d3530ac99d2f7f84c5577405e8200ae2aefbe5767d1fcb2d87e5a8bb74c77bc55f15ea57fab1c0a0bcc8923a8749d3d2b58632f084bdd7e23950407a0a59d1d498711dc62bc2aa17d40cf8fdce0bf3e0d266c327f8d470d1ad33205a03922c827508583dfb6f602a8ccf2a8a3692c24ec6523dd771c8537972924d62e4b93b696d617deb4f22a2ed84728bd949e677b43bb96ba6302570222152703d2ff3f1783c9e0c910280b3d4087407330e5bfb821fd94dbc5bfd2aa8aae5aaf012642b732b2cc1f782977e1852693dcafa535a75eebacf109f2200840396a83dd89923e3a2823643cb07d47689456274b0acf56a3d089f9a0dc06e9dd28ac49dd94143fc2ad2d7ad16c3cbc5818e679471e16174a6f5c84ce5800d50e06f5e02a10cb93c5c359308d3ae445108d6536a7133a607b84a4d20740729a82a526fb08a6259ec4246349a9636ac5f42af92ff207d31a52ccaf243bb369f2333e5bd297a3408d0aca1773c37cca979bd0dac7e101314d7817f007ab301562fc67efa8418a35fc3bc0e649a3388fee4fa5591ff1d4697b2098d40521bc08fb451b6f93dc6285656957736dbd5e7acb10db350362eb5e498d2fd6a4057339b8674aff1faf8311371066eea50c5ebc6b837d61635a0f9755def9df9fc75041d5b8c7b1334c4c88bc228529ec36aa9126ca5197155601a28a3bdb9e70b63e8cffe125125b95c652f1008bbc31cc1962d2c4d2a32232fac3465443647b09d04fba5b7ea9f4a476882bdba908199201d56b0d4b7894e5961a92beeb1cfefcebaa978ec2511c5a5ac4e83d209f449d6f850648b291dadcb844ce631c39ccc355e57293943cdee8ded95007d567a64a94736cba7a489be4953c647a3578bed043d4d51245f577c4e47128a4f8f9902654b2c60303881daa64a05cb7c7a54bb1f59264607ef827ab9e9e984ba4361b476a58b45e44d52a5c30344b32dc8382f80bfb504245dc0cf3146431e299866fb821767773824b4fb9f43a6e28caa4e71504f6997e7088195518efce7cddcc7a27188506b6905b9e0d736373d78b5b154c4dd21b412156ebc34645f713d6f74c472c1e83bfe0d68ea69763edfd5f4a8b04039c4fb6660b891099dce3e90020acbf5e8d86753e929f3f67f0fa528498214592a3c462828f03acf8502da55b294f85214ca74fa5930e65f0474c60eab7fd5a23a47cc912469322312f4e8b44f4a8a66c8bdb2790faae00251a57bd0a030752eadb2a90da99608d9ae2dde4e0cbc93baf2e17d7967b83a80668ca6708a40bb1608480c7caf783e49f081d5af281e284f582580beaad45535025c9c90aaa4caa411db49cc4b3ca7bd77d9d60dcec93f5ec82e6b782883103a0df4c75d82641a60537a6273941a058e266fb63d0064b1f5a6d0d54a7398a66d3df761c7cce2a9cb2b3a8dc98ca3cbfcc53ac25bdc0d3b2d4b7a3865a4efc7fa7805aa41c54ef3fe2148c6b7c9d2107d7eebd3fc6f84336596f4bf97509ee28b63e1775ada395c3ef359ec654d7c88f6084c5368366e186c699ec6aed1c2bc64f6c197016f63b07003f042c99ec235f67480ad75745e03c7b1e32f7848ea00ca2091b2b9d85809a3228a517c7238b9923eb35bce84e3efc10de8b40fee797605939fd9880f001574f017c1d47e42265466b603be576c60572816dcd8f9398919c616295b642e442f86ef37ebadabbd9426b9041954efd6501b4def334d65161d6f8984f28250a681c90d192d6eeebe06a7afa1b09387dcf837b36a129382911e30ad35561cd0e83625af677abb4642cd2a4299834d4727a5e137a7d03861e504322a1a1b4513c96cd094af481c374e25433a76a8ad564d8e75338178d45cde3ec4a6f44dd2701e1829edc9fad936bd16ecd9c9ebfd083e9108bde097b2a1c785b6587aed92928f0d1e57a490a51459306c0fefdeee71fb9531057ef1e3396acd57ab7d28be0d679b80509aa64ad99faad2c44e159ee1fd0da09392e63e55511a99e757724ffd51a6d09baf416b45ec68752deae708ccda59de78f7ccf5066d446ce1c629c3ad3e485bdf1d0beac7fe7d4ea1ce37d0e9d6db5d8fb5425a2659a79a57bdd16fcd51342e3dbfee3a6c81b5a0def67fb62084f68fdb770b998656e360ff11832c8fa30065a88646beabf82314ed2fee8fcf4da36624a37947bfaed2b8488982d89d96ef39890501cd4281b2fd736eec3431bc5ddd50391d063544eb2915dc26272bf943733bb33c854ebaae3592b620ffab747bbf90b2e399cc4ba30e92d09375ce9babc74e3aceef16d777ea6db39407ba7784d4e6cc940159c6732bde0566fabb07c13c64da65b42b4cb4c9aa044f743bb2650846c59c95e94ff0d3a1a46c65b0291893f5e0e54f7ad20c72b6215d1a5530b57aa981e65215fd4683f6e8a14fa27bff6dbacff799fb7e947631fa3d36afcd189ab5acf5c09d6df9d35522021afadde9d57c69b1b0633b65e9b477a5b9e65e5241e55124b0bcc267d1f6136e621bfd3c08e47348a1051117e146c83ca1f4c41f6d31dbf7989fab245c4847d92787cee95700381e9accd714de567d6803d13025f811e9c59bd38cc6a33907501de02d3942a71d360b8e85a7ba1d6f26e3afd7bc9324b885851167228f6477bd3d155692aee44e353959dd6778c22df47b87fecd7f0c460aa41c202f6582ba3fdfa377411cc2552737fb827304392e570e711d4d3914a71a23e1b40a4e71b0ea52eebe5a4a05aa1d5887d7bfedbea78cd350b97cc7e44139e5132e1da735f13196782870d42aca5e5b1a1b4c4d6ef78ac17af432022feeac663ce1569daec6ad6675c2ff8f73f72beb5eb73b5566ddd1d1a2fed99fb0104fffcc561b8a209667e48d4550b3fd4df0e0500361ca5642e7a8ffc0447c08dd4498e095b575c68fcccc8b114edf422bdf38e4c2226766c2be7505bb0ef347341ddb05510216b977c8b7758e517b5ccadcce4280993b59309912dfa52bbfb5f18c391a042fec060b9999d6bbeb72b71c8a6ab34cdbd4251713f48b439663910b800d8f187041b857edd24b7e73d56e0f5baadaf66a8abf36e337332be401c0a84279c643ebaccd91c266fe1c46cf25623d5714633ccc54236ce79f973ddc819baa6f9ba45944e703c16eb7d3238adb71a2d74148bd10255c3097a1f3512b0a569fb978c76e83f496d083b9f04c4ee96a8ee533535b334dc0a63ae73a6280cf0eb175576f202a5cc93650d95521b131a6d2d4f596ba84d0bc5a16dc25c81680f254dae7176142cf36566878e5cbad5a5c4b8927f473024fe34c6a7583eb774c9b1a4a6c76b8920e40dcce4327f2954918e2e7d3132192d078e10f76d6ebdff1c37f97944b56da84f5960c47609dd9ffcef61238737673d4f7c987211bc55ab22e509587149207fa3ea6e7bcf5c0cdb53f5c7412a4801fc774f0225cb18605a2693f548cc7bc7e3bc1e189fe664505fda37aeadb7c1f39ca6b22645eff3574f416f4395a65740badada84b18d624e6ff76fb8cd93452387c7db69cd1b317abb6c3d090badcb0edd1aee6745d17e49207dd9f31417f1858d0eaf7409f881cef4f44cd5d1d86ee41681e99cc66431dcfcabc365e65eab851ab6721bdfaa57965e2b78ab605ae7e4cd208b9bd3cda0833ec856a3c90e96f03f43a6166aa8b7ed6ddfd88e7b6c210be53debaefaae0e8700435f2ea984b26829b852e24001d7993b3c97bd19dc7027b1cfa7a16ebac93cf106d183295277f23dcdae5fb2c9b1c6a73a9eacb10254f4aac78d514c9aa557821a42d06aa3882a0923fdbf2cd97659dfe48345fecb0b05d44dfb6c2e8e28ec322a23b7ba058df25cdc801f2a8c30c97f888c232a73ff6911320636b024e424bb544b4387a5660987cecf5898564232d524d72c3abdf674338585dd912dff09cce9c339ffbe581287e749c2df50af38d71956c5bd3ac1f23f432a6f491c0e6859386dde8b34488cdc6194a306e29bed587cf9e8df239e3950466b482664c9599bc67d246e02c7134e4e16646c513f8b7254c6c3036b7adf679a525f7411bb5f5f08dcb0e218ef9be9aa6b8dada3999eccb55cf6c546711ee7161af76712f44734407967bba4a0ef0d8b9d78d6afa56d704438b949c72775c7b98360b49462d741e5a356f76706afdbc82d797393a7d3c44377e94f3c52b86961b8323a21d8bfa89dc95e2a8dfe6ec434cc9bb94ba3253eb17d9796b7f62060800d4e08313ccf3a56f48d664dc24f81d842c585419ce739648d2e185eb943d14a56c28cce25a0b044422519f3059ff58088e3732ca86958e7d24130f803e37e087a8a68d745416f768a61a75066a0d10848b9d70cffc90ea3bcac7f4cd4cd61ca21c836c61a4c0d41d42fd1f7f8e6e6daf8580aa4f2777fab55839c959aecb2d811d27d709602de4f67ccf46bd1acc666af73eae397e981fd199606eb522526f0ecf3a5f9d19c48dfe5e03bc3553b12301232970b5088a333c1ab5a9cb236f416dbfa2fcacb95ec10982dc3ebac2f10736995a3945327351650956c9edafd9cb499ac3e239e61d4c66c5eddeb01aa2ebe83036d3f49bcfb63f44bd9e4acf96f4e7ea5cbb592820127741c53e005471239f31150ce123cdba7bccb820125c9601ba72a06d372bcd412e54c7bcde4e6f05d22c207d72845e5381b87a57a3cbc0ec9fa9168454ef9db005f7849b0fa4e422b69214ce6b9d3718e5f8356313cb1afe61edebc2aaf40f9da4aa468472c1e60be8fdb1460ea725d55f67c72334b2a77d21b9231760ece04eab8eb9cbe9623f90b8f9f1cea7903a0369134e6d87ad244e3ca5ff9c4e958c8befa2f44d529054df9f824a519c1c5b3f3ad9b4749ceb0c46b858c0eb1edee678083ca6d20411db217742564bdf6b9c49f81cd4def72b917318937b20fb52e1e73638de4649740955a23a057485c6376cb9b48cde668c12e5e58ec15e167ecb0edad01f86a06a5e2b0649657a974f5cc31b0cae7acc0d50b85632c2f73bc34f6c8e274d3052902c284c5bcbd58b020c69eb77ab32b34f17b958761e3fd56f71ea1185cf513454939e6507f005e5be8b735c9f4ba1a58ae1ff854faa96527e851f1521a0080eac113bfd4afd770d98a536893694b092c6670374df7cb2cb817e50338fde33cf086835f4e096dda5debd1919c5c965ce20c15880a0131c17e0554b043f73f28bf2409c9c8d81691c1ac32ac56533278afc8982008c539c9c4ff2fbc9046ed4a1be4513753d852d5532261e1db8d9b12a434ff11c00216512d26d62d287918f8ea24b30e6b45e07cc30f167fff9d5fb020a0ff6d016784575768685c4c158aa6dfffbeb277760c15b706d8cf1f62cf1a41f1bd917c61f09f7365dfd56b2f7cd1bd4cd8228dc90c3e67cc3e8aceec38f146cca32a46a544f678685a3c90f5afeda47af3e51a662e6b75e72fc5f1858a2432e54fb0398e21eef693ef19442eb61e40c502f42c2124ba9b45f4bcb7eb731e59e967ed6173f3f43544770ff5575729911dd7207cd3c0ab97428710c58cce6e9ca3a430b365d0a1ab0b0e1d7cbe7f6a0fcce8b5267493d299dfcfd792a5e16e6d4f7e14c16bf5f7e166176be1d5df44ef83bd96644b537a24bfc9a90104fb3cada9337e15b4a6246c4f46fc4f9ea79f7662592b4b3f423efdb9b80d0dfc06a99c4a2bd5bdb01afeb87854849df0149393c8c5fecafb1d522b362ba2d23d47c99412fc67653cc770ef93a1cc8113f3780a8f3fd5cd77aff514450aa90e0e79addaf0522e567bde9a6180a9753e412665ad87925612d82d02eb5729d24602869a598d01d178bd950aa5f6800c0314b8d5222a9effb1712766486c5b7493eb929d194712230097782849b715739b05d2076bfff1ec98fb00676872d09ad14f518f7c2211adb27a05e6e0b10cd8a0e96f3c3674bd882893875cff13a4c95554ffbc8376da9ef7db2323cffee03120b8d58c4091bfa4a0f154937ad8e2b3335b9c340b5903952be3b1d51ecf8e6270ea3a8533bfa72818a3b058c228af1422f55443cbcaf4033a7993e023ac29717336fa76f732ee60d471dae2e87080a181bb34e0408af47e648a60a931bfefb55c51402a235543cf956d0d6a842b54dc4e3655e9eac1836f4e26455ec08ab8ab6c325c2770ae8e0e93aaf1a6fcf255e2f87663981c17a844690a2bed43c20bc8184e7e1994823e73bbe7eb43c6dd52f8792b9041a50fe28e90a5b48dab38d9f1cfe3be9173dfe63d22969eede89</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> 数字前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>计算机体系结构</title>
      <link href="/2024/012760393.html"/>
      <url>/2024/012760393.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>reference</p><p><a href="https://blog.csdn.net/qq_57502075/article/details/131935482?spm=1001.2014.3001.5502">https://blog.csdn.net/qq_57502075/article/details/131935482?spm=1001.2014.3001.5502</a></p><p><a href="https://zhuanlan.zhihu.com/p/601688983">https://zhuanlan.zhihu.com/p/601688983</a></p></blockquote><h3 id="流水线类型"><a href="#流水线类型" class="headerlink" title="流水线类型"></a>流水线类型</h3><p>超流水线：<br>    通过增加流水线级数来缩短指令执行速度。细化流水，提高主频。用时间换空间。超流水线技术对芯片的工作速度要求比较高，同时硬件系统比较复杂，需要占用较大的芯片的面积，因此超流水线结构在嵌入式RISC处理器中很少采用。</p><p>超标量：<br>    一个时钟周期可以获取、译码多条指令，CPU中有一条以上的流水线，每个周期可以完成一条以上的指令。用硬件来换速度。分支预测会预测分支指令的结果，保证获取指令的过程不被中断。进入后续流水段的指令彼此之间有数据相关，需要对指令译码后，先用 <strong>寄存器重命名</strong>消除假相关关系，然后把命名过后的指令分配到”待发射区”（也叫保留站）。</p><p>处理器会同时“监视”待发射区&#x2F;保留站内所有指令的源数据的准备情况，只要源数据可用，指令就会被<strong>“发射”</strong>到功能单元开始执行。一般把处理器这种“监视然后择机发射”的行为称为<strong>“动态调度”</strong>。</p><p>指令执行完后，结果会被按照指令原始顺序排入一个FIFO队列中（也叫做ReOrder Buffer，ROB），这个过程会把乱序执行的指令恢复成原始顺序，被称为“重排序”，处理器每周期提交队头若干条指令的结果，通过这种方式可以实现<strong>“精确中断”</strong>。</p><p>相对于标量流水线，超标量最大的优点的提高了指令并行度，每个周期可以执行多条指令，提高指令的吞吐量。</p><h3 id="数据相关性"><a href="#数据相关性" class="headerlink" title="数据相关性"></a>数据相关性</h3><p>CPU中，一段程序会被编译成一连串的汇编指令，指令与指令之间具有相关性。一条指令的结果会影响或依赖于上条指令的结果。</p><ol><li>写后写 WAW</li></ol><p>​两条指令都将结果写入同一个目的寄存器。</p><ol start="2"><li><p>读后写 WAR</p><p>读指令和写指令的目的寄存器是一样的。</p></li><li><p>写后读RAW</p></li></ol><p>​真相关，一条指令的源寄存器来自于上条指令写的结果。</p><p><strong>处理器内部实际存在的寄存器称为物理寄存器（Physical Register）</strong>，<strong>指令集中定义的寄存器称为逻辑寄存器（Logical Register）或者架构寄存器（Architecture Register）</strong>，解决相关性的目的是为了程序的并行性。</p><p>对于写后写和读后写相关， 解决办法就是用硬件来管理寄存器的重命名。逻辑寄存器和物理寄存器之间，通过重命名映射表保存映射关系，对于程序中的指令，源寄存器通过映射表找到对应的物理寄存器。</p><p>e.g.</p><img src="/2024/012760393/ef7954cbfc134075922c6745ab44f752.png" alt="img" style="zoom: 33%;"><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token list punctuation">1.</span> 在R2=R1+R0执行时，重命名映射表将R2映射到了物理寄存器p2上，将R1+R0的结果写到p2中。<span class="token list punctuation">2.</span> 在执行第二行指令，对R2逻辑寄存器进行WAW的时候，更新重命名映射表，将R2映射到物理寄存器p4上，然后将R1×R0的结果写到p4中。<span class="token list punctuation">3.</span> 执行第三行指令，需要读取R2逻辑寄存器做加法，此时就会去查询重命名映射表，发现R2映射到了p4物理寄存器，所以其实就会去读取p4寄存器的值（R1×R0），然后再做加法。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="ARM、X86和RISCV的区别"><a href="#ARM、X86和RISCV的区别" class="headerlink" title="ARM、X86和RISCV的区别"></a>ARM、X86和RISCV的区别</h4><p>X86是CISC架构，在计算能力和功能丰富性上较强。</p><p>ARM是面向嵌入式和移动设备设计的，RISC架构，注重低功耗和高能效。</p><p>RISCV是开源指令集架构，具有扩展性，灵活性和可定制性高，</p>]]></content>
      
      
      <categories>
          
          <category> 数字前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>电路设计（RTL）</title>
      <link href="/2024/012448005.html"/>
      <url>/2024/012448005.html</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="8c4199180ac2e62aeda0726ffa8001cd98394f0f0d62ca8c2e4b864a22cb6967">d5a264002618c049c19ffd39573eb4712e2cf56c6bba6686eee9a3219b3ecd9fb61d191fa8fcbeb51dd7947e117b46f1f35e6c0de09fd4032f95843e04dbf4c12980d21bd26477ecaef16938b9ae44e459a3f8d711b09f600db725f7396dd269aa463297fea53066a960a3e053c198fc917ed8340fe45222f18035078bff8b33d4799d85c490d53db15d861da9701a76a1b6aa18a46a08144fe9599de66fed450c2216f8ec242eb27de8181d4d1ed9f88d19a63c4fb5d173dce974f3341ac1f4da85ec007e3d9114b2e5e062d9e7a6dc6445cca016e8c60e852ad7c687637655db7cf4bc17ec8e3cd4a3c45cd1a9cb7c01c36be50f20662cbbdbc10812de621b9e234bef819b1222c10be0c7af3b08c64841184c96481cc4b93684c91b6bae9e69b894347e17be4305543221b4b1f41fc9d6193faf2db2dbb069d1e2bf73df79597fc88fd620d6a5c60ea9243ee3921ffe99fd847b5447c7daef4bb053f1dc8972c30755bb3fbfd2aa9dfaa4f8539f7d1199a51b0d51ec31caeef9834914b0c89166ded124a0bdd8e99aad4f288da697cb2678974b8b0d00bcd3bc6dcf397857bd7c0cf97c686a8c66aa7fb0c6ba4ddd2f78af79d2719b53f643ce892197b12b3fd053690318b59d74878bfb261b6428fd03c61300a776776e5262615a6a73febf857b3276de678179b59331d4d622a304b95c061434d9f46229fbcef3619147224bdaf5b587fdbb5ea54e07a78ec70caed82c6cc2d61e205a6fed9b9e67457ca92e01c47d43ced43ba08728601eae139e8cd5c8f2626472bd3d564e7939a33ec31ac2a189b76f3dac44c8be1a0d5d879ddadcc8056eb5de82328af68f12bda476ca35bd40b15bff79207cf688a5a70253d0f8b6cb9ed8c263354520b683b116f5440f45887a1ad23b84ceebc4abce47a5d8b044a254d1b70ac7344b257a33ebedf1bc9bce1c4c127ddbf13f53f6d12e7ddca02442bbd93fe3aa7edbf476cb16192e430c19937d6f755a3eb9752852f4ac71deca8ef1ec483ab1c60a3ccbaee11bcf530f307d986306b5869e422f3ff1dcc794d1dd1da1a4b371cf591af85c0c56a096fe6a9b235d6387cefe66091f2befac79493e734d6764402ea17d84901e6b26568be7c2eca9052965f592db457cccd149b87a68693cf7273ba49dc78a26149eaae28e16fb29ff4747d573690850fbe65b9a51db0e49a03563e58d00797601e157f410afa5ff113dc7d59a3a9ab79e3a5d3b4a9f49e6dfa198d73c56636f2ab2f31c562b41dc4420168a557abbe17625733f4256666fd56b44728fa5d4f6b7d5cb74ce2f2722d8d86ea3b7ca176a4ea3df5cdc9a154dce4734e50b8d526ffefd77c65dbac072505ff31de42f3fa1cd268f087f1baa70c2eb3cbf3e0bf7752e3da15e6f3b5c4fe3969d3582f459e171050cef1e7f9d2cc06a6f163e857b2e9ac686253f2f5a0b9cf39e11eb6b4c026e4ccdabcfcefc9175f6f47a31900706d7231ed6d90ea10a90bdf05d035b2cdf04d74e1b9f757da2eabfca7566a08a6618e2a8873f297ddcf90a437b339bbb23336455e8f86ff0f6732bfe0c655111d3f1a61fada5705c21b2e87e1216cb44e778abcc937c525073fab46e08e7cdb207e828eeded9cd221958bfd669d47f2cba4c5d84f73482942cd9f08bd60b6700a95d7a816673f190373124e454fec575d6cefdbd855d5bdb2215f4ac232b8aaf9ad7ab707bb1ed2e7a13071dd95f0a85c326ee1698cd4c81556a029979a6539c7c43debf5a42874f7b41986c4de217e73a96493db783cbd6197544f9001afa29726189031d57b3ffaa3c0e674af509ce0adbdcc11b86b9ae27a841f9283ff90516e6ae81ebdb7500cecace994ac144d9e5fa039aa886ff3cc623ea50f979fb6b37c25acd75d2e8ed73c5174a5d34554c6287093a4f0d324e241faa3107389688fd7d906beb91c195622442fdce6f9f7e2426d749fcac32fbe5117dbbc207e7794915e932a7a3b026f0dbd3786ff96c0ede579cdaf6e71c110bf737125e3832a1d24ca4c369696803a3a49ee97fbf2fa40ba33dd8f531668797940ffe0d75740f9f4e12cfa3139ea595bf15859bc806a28c94d53fe7f60e600b5a4a26bcb005958c4045ef9500ba9b37528d3a95cb65af3e35389a1ec857ca12821d062894956d67727bb226e0093223d57b4216dc8a03a1bf5a9eb15f7201b2aea21c5cd5f9d6e1cd0f7b86363a7af12c28a67c80955dc95dc1875032d28b777255e800ad7345a6fdc3a4e71c7a8b46a8ef08861ec44ca49a4af134a4f360bc38f1449e297db7236d5f4e7bee9cbf8bd5802229811cd2e8bf50d65d405a5fc170d0961e125bc19ac80637d457b2e2f10ed6f90b371409e11148bdf52f34b229e089c073a849418426d71ee34374bd1c1542d634302915af632e8091a3653559dc132db79cd49b593a676863a5e9fbaf206ea7df27fafe1b18c9eda88a7b4185ea0a29af5e845dab01a6bcc0729d0b1b65d8dc74f05f3120219bd96fc11f45e514e19f2fbbdefe1fe742d650ad349a01f121fff272c7675e15fcdd7103f30872c8602e6dc486d449aa1b73b3a45371331a6b679d7d2508130f0c5f08b2c0399b76a41192c1d7c82e06ce5e9124c9d4010e1b5e6fa178b8a5eabf3f78344e1860fe9105416a0fddb732be96b4314f84527bc9b8be32ecb412962a914b3d713da629cb8b2c3e44711e739d67e6dfb149e7d9db86f0d6bd33139701424f24774015670e2705fa761bea67cda52ab2ee7ee96d9593e63880701e4c844efe7771580f2a6b87d947f4b99c46c0d9499c186b6d75322dfb35a003a149439d43682c8373626c68aab3e263470a0f2eae7ca9e54c1dd6172986ecfc1b4d992b5601bc7656118050e37809469cc185572f8d10e31b07da912c1d3637a4c1a9910576e0dc65190c58ce8748d425b83f62bdf81c13acbde46cbe9326fb3135e1ee9b862faa483f4999834365ac8e9b8855f3576f18fbee30d670f726a7190286b293c260cbb5f7fb3b4908104fb13300e470209516327f783ef38b41d93873e055b1446a3294760c468223177b4317dcb469fb95fd8d17c4cda42c480d0bb44e0078c6cdce700b8205009e9afa226e99623df7cfae25bf54e6e204b9d0e33a23b3ed77c96a26cb7329ded7478d260c8713d4f450b679e0d8deb8f1f0833b09f31292a6a93dd3266c99b5ad8ef9a746e2abfd44b021de413a698a42cacda083570ec89f70795fe3de329c82d3efaae51add57b7826cb3ea3bf8269a3738dfc0f972cb850518b41704ddacf24236c51fb33c40c0894e45b8d3577997c3af2c56c40da539cc640939cd254079e90eeb691b52668a8ffb45f3bc1a10491d300e809bdafe509db958b8d57071f157a19d4e357e13ceb011aadeda3606a828bb621b763c54e7612136defc94c85a020de6237501b9934d04d3d3bf5b06f9ddb45463496c19fa70256fbbb2c2526bf0084dc086394baedffb3a195a9610ac5f14fd54e3b58e60c3e50415de18b2aad29fb5f8e3cd027d6a7fcb01d245c43e07c81d8c2faa24852a5fb798b2d15d50a79892bbcd3bb0cc7a5d352dc2aa27128e79e6d6a6ced4c8b5afc5abac12ae7fea49b4d0d049056937491c79cbec4d5f9826e75d3227733229ff4aed19aded3030763fb3952338e3a7c9237830181a04cde1c7847b7efc71c02512c86c3e9aed200c4a1129246e1374e3ebb3cc85848859e3f87053ff6c2962fd9154988f3a9c1aef825d112740ed022e393833625bd3998e8330909be7228252dd984b1b66c377a65caaa4893b1c052729e8282c54cc6ba944d4ef7ed916c828680c52963ab414312574bc26562b26254fce1e2249678af7331427c99b810ec609e2bf233e35816df43a2716f6c8b442711d35c9c5515c0e97f12a020dff068c435f0fb12d0f53094af71ff42226473323f15940a15ee39b2e27f641ecd07efaa2a2fa881606703052e4d0a3789dbba1bed18b5108ed7a8d6fa3ff986d73034933c671fa3759d6e4eb69e812a76a3e90efbeb398275c32bed8e964c192d2da2484fb72b23e7571a87dde8d80a0672f8aaec3b82c5cc4d122daea3c50796890ba4a13d874b7a7ba8b55c47d36bdb7fe83280594dd8260a202fc75173a7f28ed16bb6af238dbcb46840f3774b0a37778a343a528e2b21f0e6c0f35ac53a4048c827a698e566bd906aa8d67f338327f40a4deb6e58997af04b5f30e8653a9fbe4f8f4f1b83c2000c291773195fcf4db840ab440be799cd07061f0a18688252d027cb306ac3306c068ca2a2654799f6e713bd057b08ffbd8b27ba1b9ce81de616cc0fa16b0a79769efb8b52463434397c317ce7209155c09a654bdb024a7e1ca82d0fc81c5b942f70a5d40243cb325dca53f3e1b8b5f70f1e262a00883f298237b757cb3e77d24554850e791e2e7866d59182fb528a7669e71e0cc55d90f3cedc1ff88cc46b3089dc5d5de78de9dd7625820a8164d1d0cefff520e90ae182d3836564a5a48ab207ec2063c36aa66f9ad681ca678ee59ea08f4948df7c711158432e01256dbe9563299ad691d676c80ede9101d0d4673a83629f5250a317398a1e13bb0f46d30807d107c6bf4fc57b480a1dd9a01112c3dc145c9aad762d6c8825f4b5470f23c5cef1a259d20fefda418c966e9ec2af9b3b69cdfd71b0d69face97beee8c9eedaabaecd8576badc814eeb681b59168277750cea9770358089b5d48308050612bdb32890b631dd9763584f2837ad983edb753cc34ec270e6840d6075c56198a517af231ba7e1cb9f32c4ae44243ea25938a4340ec8bf8656b31bfade4f0e0bc0f7a48c42b1383b054f6739af3d55818a1c9d5be923d03c0ad40875376d719697753e4521f4522d47e98b2d30bb3522d8ad2046a63b77262802cfc618a622dcde3a197772ee1b59b8de28a7f3648977b16cc251a3334ef43df0c60916fdc6257dbaa5c388e7fdaf9454039bf0de1d48a64d639512ce8ee14dbe91712325df36c08556efb708a445e5ab7ca8fb8c75d6ced9b7390533cec8d0af57926fdf341c6d30b47949e63bb1054ec3f079c2aab3eb054709058f982f9c02926c172a364f3edaa158aece3eaab627f95567f048d23549fea592fca813ab6bed00df161e71351de77961ae996e26dc2615028eacd296b094c9c39774b8f3fc9a7e9b5e19e7406bd5254de48ec24987124900309869492b6c1ab641179dd4c5ac63454fa98ee0002364df9802a2588716cd41c468f06c296e14725efed4566ab92141c57f8494576fe211ff2c96697280fdcbfde7297a9f7696d2232c89f4599079393f7a517fd9b8dc8bb159fd765bb58c5440e0c68020c1f46d2e8b2647c06c01e84838d87e0f2a5b377980ff469f223c470231879b1d81503cdee7e416096416b59aed20bc391e90c387a3ee8f06c5a771548f35c97d7d53e485d0adbdbbde92176927df381f1dbf61471be79475ab9d487cf96303a72e668fbde90e793f18c5c1cc2fc92e32a7e0ff930d8630589bdd7fd459b2076db230fd815ab8662612a731b1965fc007974eb9967b944c9864c289b4bab67df49ca7f84ed5937f27efc64b6075a13df9b46a7cf4cdb5c8982cca88654fcbc5242225559aab0da0a2f07417bb94ac16e34b5fc5fb5d9084b6aeb8039a6ff3fd645979aef3a20718c595f18143b2b49af6b41bf60c737db7084bdffc7c8ee41dbb7389934fad88949a93a20a626258034e1d3cc3065e6cd273aac130a95796cd5a6858470b74cbc6e4042c5e072bdc37db7dbf7ba3f4d2b2b175d167cbd2f260f651a7763f16bba61446418a3e27222a998535475a1167d84145f505db18a8741f50817bf4bc63de940ac5b78cba485fd0523a23f48c0743eb9b78e99b2c698c71c1cb406e46bb899560b3116d5076d30e0624d0babff63f4b0ecf5fe5982cfae2976a0c248574b9c911cb51ed634299b33414f7ee331aa4bdeac1bb79f608f87adb4cbdb067a369eb63c97c978b82da3f835c83ebf0d7eaed022959361b607b05d4b990b0da5deb1c72012c3c3df4b7b30ea9ed3e72a4af84612540a36a9024ca1162bc86eb72b899b62900a3bdd945a516dfaf63e8c82145b706a9ee412c1c34b8f5794ac34252caac36e20271685c79c7e360e82b2de0b282a7d10d0b2a82658f535a9ec046e8822b3d2f5ff269a9044efacdc0bcc6ad9b50ce09f4c7c52df1f5881690a649b3c35b4d365551358424d3a65e133c6af6ae75fae1c7d28dc9d42c6f636374a8936d421b64534e8bbd4abe567cba3b73af003b2660d0434aec3fe7fc2966e80591c932caf6e3b8b67f15b20007877269a8cfee2b21f2a242d28928c80d6ee72409c434b33b09da08cc621949c69f16a25f7fe5b8172ee6ce66dbb8c4404a367a242c35253062ae149718ca86aa2d2ba9fb1451e75c282401eca1bebc83738236379ac0888676964fb65e96c2d6aba49a54e564a94c09372597f8d6d6d2d62324271ab5622bc5b873be67c355a0172d6a484da00d93847179e6afdd7aff942c00ccfe116b13147fc43b4ded7c15a5f195649192340367a6b3003c98e67bd999d989c68b16bc3dc73c9f5a44e643980ed9f7a8fe519dc5c529cf598d55663802b06b468a621602f4c77bc6031b4e11dea92611f68bc00dd65a0dda2475d2a3d5ecd9ffc648068d9dd6b92e03c1a9514da596d027e02da0ee31ed7e3297f5c2e4cada8d25224117937bf001288660d770ceaa1ac0eeb82717a72433da90e37e6771b36ab4a8cca1715bfab2ea18144b350de576a6d7189d3c543a9c6b3a7e3456c71546dcfab211c030bbbfe23e9b2adcaae17a4c1e469c1bb9483d5822299511e1bb45b11af0cf08ce311b875fdfb13f33845c22ecd59051f40d24787106aca87ad66b5b873711d4d01ba066a6503de87a6963b87270501da5f8a05e76358e954d22a4bd71b783fa5e15a4b2f9c51350e84771b8dd1864e8a61118782f691a03d666401200b83c71b67c0ca56cb877ea4dd9736d455fb9ea1dbb3602228777e4189cae4a76e5c52ba0589e2f7c6ee3da80994301bc2f3c990b49ec375a33476fea65854e222b21ff8d70f185c77431efe1ebbf2c1233528102b07116bcbb38247103aaf86b4fd9493ae3db10c95ceaf01294180f3c8b3788f7146c0a6e00ec50dee2276448da7fdbf4d029803abc113013ff2e9521c7f6792b556a4b09c22443e0393e48a6246600b37f19712890628118efa45eead6578c1a38f2ce117b8ee98866f6620b56427f857d9518937262881c6a5aec706ad32974c6b07b609d98186a2c13eb1fd7dfe4f968bc151a7c043584ff13a859ed1803c5432547b68721daef0486d42c3ee5b6a3f479077cb6da7e1dae31b8eb41f8073dc250ec18fe1ac0b3fcaa3d4ef184f880afe9040da5c099cc1e1ef762dff8387e73a579de8c3a611f201fe844f2a1ff33c81f9eaf9fe4cab1a047425cf57cf9e17b377271af7c2a5b10c60c3b6ef33fffec628f8a6082f83e56f8b47324430f8fa3c15febb43b26e251dc8cfd0c4d9bca76b0f8a63a510d948b7388551b21cdf270d8101c52da3f2673490a3021e01d651b034081d8114cc0ced88f42b3488bcdc8f5c00255e14e059a3ca9c57ea041290797da7dd58d457f7cbee296b3dfe4d606882a43d975be4ebb8b920b5568abc9859e9e4b7a033a16f09d7ac10d151d97918f4c151e28f9f627a299ab06435c57a99f4839fc13ae8cecdd3805ff122865a8e2c5d901fdb00b92e4b4ff9543ad48a443721d64a1f8c096cb3e4f2576bcda57a69ec844818ee9cf25b8dbf7926c4587709f13f559fa875093ce378b4b642c1d6539e31e012fd32422fbce89f3bb913d4be6a52505debbbf596a59c46533385878ae9cd4489b84f54f3160bf4886087129fc3400e16e5ec267d7b87b3b83d8016b31c2e1ed1845f8a8a6a79ffddf81b120bc3b93eaa10654ec78697eb8682d5f814e927ac13924b5f0502f927aaf9945635b735c322803b95b8901c9905f6287847b3034414e7d034ff45fd710c145dea4a2e2b5aa3e2a6eeecc0cd63d7bcfc6339b52f1d5e129171b991815f3c24e15521017355e2d115600b0a106b721219b395b5453dff563f69c7fa34545c886c12a8094f71cf52242f0885c8084647da9ec528c2e539ca59090a0226c02cf90a74f46f03791e68b9a94721d90dae570b99309ec0b283143451513a15ae2b8f55c4e65c5dbf1ab82e4b6d2648a2898226c5853fadac92bec181105fbb61ef48ca07f7303d95250f721a2f32260351ef0766037f527cdd3a1cc8d76c6faed83166c43bafe3ff74e08e287fd6c255cae2dc65ca7e959db3009a4eb5e866011e53c9bc0f5ee5e3950770ba2dc4fae0cf679b697646a220862d7de5e9d8c6fa632a0bd95b344ba8841275bc2b868f13503c8b411a181f0fe692f99fcdc66c823a1bc4624bca6858522c8730b3d5a86d8a83798e4d6c308fcd9c4b42377cb506853000bbdfcb065e1fd901929976ec4dd005c96f86662144a086d4970551ac97895efab67acc14a30a1abab10264c87db17aab53addab2aa3516be2eb722a002f8ea1f895ed05c89861e43b3bce26f66f34249ebd5ac8b2bb8d06348345a9fa5e3eef5450bfc85b29108aa82cf50e806094be1084c1fd9546d65e9b6b6913848a09d19cf636b67020abd9ad8299201ec57148a7d83b2d59e592568efc8520aff1193fe03f6ed62aa7651aed99698a9b2821e800855865e84a05a1264dc1b3fadaa24c1496cf4e5dc1143961891a0c257604693c8267adafef3c8352dc4d4c7756ac1147d3c18a8365eec3253ab06b20dc4b42d2204874b0cf5b249b65b814a116b3384da4e1eb85dc56e475a6630d5e6362e2c67c3230b92a996deb6ea90bfc1b4391192e99dc7d29624365c916bea36ce5a0cb73f73650f5a3b11234bf90bca9460025d60cbdda6cf15e6c7eb0c4bcb5cdffb91640d05edc06d1bf693942d813fd64b3cb4049adf3c1654c894b68f5329e5a11b0eba3204949421fe08f30ed5cfd3b8a951ec7e08c4d90e353659c393b2aadfc5be763e7e4a96022274666ef75e73b64d95a38cf07aa0f14beb98b5f168e5a5dd53716855ecb66e5862dc07023b2428b83012d63f36dd4200f5a4e4071829311d4e0d84043b471f61472dda5bf0358f189137ec38fea1b645d25685167a07c1d41e06794415d7fdf8bf6631bc14961a7000902710c5604fa89a43aaf6a329ba21ba80f82773c79815c33d8e893e9e877a7a8816d8ee02bf6de52a23e75d33688a6b87d00644e42f3e015430122c0688c364d5c8d0da63e4d69a631c24a7d5d6dc538389d2447b90039481902f50b7d0192bf2036d3abf49948ac13315fa77a87a14fdfca6afc87c2bed0192322de91c0c82cfe1232b23122e800dcaee51897bf9437094298c493c24395932a7945ce13a1022d17d069ddafe08d1618454ce49b2ed0f8eaaca80c1ed76acea87a00d317e817cdfebcaf054c59b429fe0130e797251f14de4fdc1c5e3756d32d683ab858fe13acb97ae2a49babe7efde0f76a3e978489eb4a38300d52e5fc85a9978bf5398cf61e4808a14d387593c2fa15eda47588ac81b89164f415162298bf606eb9355fde6db7bade4ccbc9d07c6dacf76aac0a14c8cbcd01e3bac401461c07a493fd5cd62f9b8b3a48f1d6f921d91199dc9871655efb6f75fa70cf715bea2973eba5088b089accda841f09379a683bb220af8072154c1b64572ba275f78d5547f7aa7b3b4c7ead5529534fa1c4410d968f02c46a8200dd201932f1bc81be342bb9368a22748987177a79e112a164e818517b70c2d2b4a760f0c2d56c527b64918ec2f7d3ee2779fc5d549789c2b6a68a692f76d7e4d3b03c8232811a17d8e66ba8dd4cc932e670de610c0633a5e567930e6745876500d6a63173e953826b7afd2e9ed996a9d4a45a8ae9e3a01175b3ba9182e7d8a95c43ef7e5e274ee5ac874b14cc4fe9586d745d294b04362bdd24a267960b7799d05a561e2ed5b16030bf3a85d06acb62b080452c8bdc404ea76477a9cc8339c64db3a1d0a83c34892d78774329fc9569c37864fb7f7d25bdbed74f9cb1f840526b3f7eb9e7faa433450ed5c076e1909ec3b78d1429d8959687c34a70bde34df09ee17373e5868d693e64a51c9f0340cc82a2f160e3cb00c09b95c16976e4c92f4f23d1c4bed41c7b4574ffb32aba251bc9882a5adb73f4c8fa655df6af22dd7af36698579ba43200760db7816e1e94ce06a4410214bd47f5c81419060df265f44aa889b49de9e84371daad8429eb53a5b053e1e3768de52628ed1594e3b73c3bb584023c1c9c2e09f689d80920e070f77ed1eb2c89124255dfcf4b1abcd34d8d304096dd5f04670e2996837715a9a08937acc3b2839333860146e90a9807e1cdaf579db1c4514f002dda2d33ebfb501fcacc52a0d9dcc33da05398d02f326f0e0c53a6979515bc93ce34ea4484e49e63635060b85efa37775ce209b651c5071bb6e6498d566c98ed41bc761dad0b703265be51a9089bddb1a3ef64d621d68758da81a35dae59d6144252a7670be7ca71d4a391bf2f598a2bc42f93ba7e4ec6f91583735135201cce465e05b70e9559972ba4d5a8a2d90e774101790378b7ea6ea0e7b0f49a643d05f55d4aa87daafb2e6037825c1b70e1c7858e17f83b83f0be088c04fea655f0dd2b2c162cace5d08fda70ca490c358f3fedb82e3f3128ed4753f40156d85f0f34214bec4ec1064fbe42a52b732664cb7acb6c5c20187e53ba10ef8a6d91938005023d8e6aecca839fc24a6d60e3375af3270731b18a0c6c45e45e8dd636b6c8f96f93c6984a20816b7f1320d6ed8fad3657c0d2716e5e25ac3dd31518e6347112593b2b173359375b72bee9c81903ec4e041b56c22e778eb4fd385565cb6f6c96e584f8cf909d0fa4c0222505b5eeb6b2e2286fcd0601c6a57942aeba369e66053a70014dfc4d6a393aa9b9c779dff28f7f5bf168c9595b2e5d3b0ccb724fb3d5d7be9cf332610581711708548a1db30877ff31099d81989a7c84027cc17fd835b83b691ed409408c47a2571850d41c0ec79be20b3cb78aeff1c3b6c256d5cd16eb3489490e28b648abd0bd701197a8e7b17ce804b78a91893436c4d207c1329d4eb15d0077eeb2fa660d4664d4f98143e46036146acf7a878ec159e6f5e63bba6b76e31ccf6da5d031fea4f30e48d9e259f3d7feacbad1f2293f4aa5d05e3470bb302d11210e1ac1a8385d525aa86c3c537968b088c3264ce0db2088e9a880a57342cdebc599a66ce5c6f5215051e05113106c0a2186655c9e676790c75c828eda83d8013da4a225bcd0d0f5d0d361ffdcb3b62aa9cf9f96b757d2122fd047d574e2c036a3e723b7638f85ed142b61296d01f4fa6cac77d14a5d3c370a1a776020393e66f0b43753f087d924ef6485146587addf6de36fb33ed995b93757d9bfe0516c67305f24dca9c772432b5c7bf80e1716c4c44d94dfe73a8c8860e82feae2dcff0fb50c5676020895126925b0e3442d34c1f0e07eeaa113f19180ae1dba0c2bd9cc422ef0aa642908ba816477b0045346a854ed4ed5b14b2d6a82583c5f2c739da849f191e48c06db20c1691e5f4424d246c601d1fe4a61418abc857dcac851e282331e4504673136e66948692ca6020495b9c3b4cc1e6a26defd7661ba833301dd529dd6b643923a9f88226eb8dfed7f4f2dfd9f895ba5c702c66ddf18c5f46d0cf9d12404bed18b3aa29d8658c1c4b508fed2cdd4e08ee88ee1670455730ff19f00661e031b5b1a956ebf082672145fca8e264c21c5ba41a5f5498347837b86ccca4d90eb28c55f374907305e74d907049c58e20ce41bda6354656d9c60d7babb47bddd284bbf94bcdc7219dbe17cb7379a412fd8b5fec135402dfacf491b6ac70dab89fe3c3ed271e9333bdf02907d47e1f4c3f4002467dbad4922b12914dd37101f274bd7628bfbe6023c7124d122bb39e506d4c9db4b62bf6190bba8d9c9b6cc039070569509fcca16e51ad0c069c730a128bdd5ac746b324fbd50aaf05c2a63a7a50b6daed92301d93cbaec532bcebae535ed7380f6ac9f5865909a0eca78283da0cbbd3945c68a3e21727de6c385c5ee675e36bea74fcffd2dc823c08fbc592c4eb08c48f385d8b6858f450025545b1b04ab013a90ae14920624959dbc02d776c1afeccfb8702b0fa444624a4af6bbc9462c35efe29ac67e8f6ba4bba2452638223db7b6ecba7e2b8093be417d5e6620b09b4f37e98077ab6f23e7bb8fe77abab2c21f0ff50c32cbab7769dea7a20502c998fe112971ca2168f1585a3c12ae1c085f7e45d7b743c8fc57f012f2b84d2c995b2caef490273748a41be7083e37322946585e2e53041e927f5309002b29d9e9e46d98f31aef2d4244e8e9d87cbb745830e76abd56c556781f220093c57072bce9249f6eee16bc42d2a512ff03afc82be6469c4b202d077a0213a3d2642f1048caf9b453020fc92ae7a24278fa05540acfb32c6298d677e953841b32c79414d7b67a945bb5a6148002bcdc90c7be00ba4c539c65f47cb62bfc41bf97c5365b099acdb0a3c3c8e4d413619f18b0eae7c4eefb7e08853373b0de6f0420622be45bd88dfbb4d033d2124da3da1ede784e702044c25c30f65859dfb047c9ef2b851e4b8ad53bce9f102513973a34822f39e71ab21390b99745e809259632755a1e1c71d583ef20f2694bbe7cedeee0c30c017284f11b9b0ece6253e3e0f359b93248b5b22a098575100531d40f5ce340365eec0886718e794efa446ac42c9c1b129002f15d2b9b6440ddbbe67233208e102047b54dc2d74cfff5a3944dc6c7fa2f44eab5e7c13ce4707f171900fdb63397edd991c94081ebb2495812fa2a6e7f198a9fbd1927a1a5bfdb27f109d92fa40a2663072721ed5370f8befb3a6458f71056050d183e815a61065b121f0ad600801143871fbbf298adce7012ce62fdf9dc88dfa7ff45e65dc6b1ea5c6dd17eea9e2220dafd8eb94b2e86744576a1ed6daae70389cbed04a999b40bf7cf2e9eea025c33ffb9a0283fd71c7a90493ddd6c77fd3f2af2e8f690094c37bdbf510f14b516078a55750345cda188f3f79d1ee31d5183a620356a3e72e804705213cc5a9a5866c5ece3ac8c2ebee721477f6d630a8fded40eaaa23781498d50c54ea6559e70ba96f5d89e66120cd09becf2e8f6f689b1f516944764727ef9bc8cec6e77539cf77546f5b96b5ebb1e145e05e1888a719d32d6c48fcd1daaea5899cd830c26dc6fe7b6141e16d7b7d9047e7f41e148ddcd6d26f459e5fb5ade8b0238613264d4f3ea49e6f064e8d9405350fc08be9411d8e0f6a50d39d2cbcbf6e796fc86843ca099b345ee82fa78cd4cfc6a86d63af41d237876eefab077484b443e6be38addfd2f6a17a5a5fb55f6338675788977808490258e9f2473ee5c67aed0899fbb954cd011a955d1722f75065e2e0de040fd96af2f28bff4ec64cf60874a980262eb986164334b01457a73791ea4606f07b654cd01d41a4866b2a57685208e7b4154aa4c4ce9d92e88a6900e76b6add0189df8d620bd2723f5801092a7141afb5dc09f505e6b76608806b09cd5016ce243b60b7cac07d240f4aff0179feb026348748d119e96b7e7fbbcc60f61bca139f18160837ff26745b5a0ac59de9a21493263ba34e08d5cd5ae5f908f70437d725b9d75edec2265a970a00b892fe902638ca735cb1b66139936bd9338a7b32eba5c17603afb9703913773e723e6593d31f1fa29ce87aef1416e43d6b5ba8c7c79b2c616ed255595dfe02d976eac077fa514020908bf3449f73455897de0d72e46457d452e5266812a1a18ce3189e94926e54f6dfc59d9a79342a77263bda90cab8dc45a4d576e2932f9362532c5e6504ab1c11efa1f364c073e25146bb5e0694c3dd5a44b2372a68236e5b4f74cb4d860ec2d8110533b846cf10475446e1d7c512f57ccb10ebe8c8af6867bc3359cd44ce7edad810aaa8e30c71dfa22bf3f832d9104e6acc3624b04c77cda7df8ccb88e52ecb9c4818c46bfe7983257bbd86f1db0ff1729e94b835dc3a1f463b8cc5b0468f23afef049e08b53bd7662f824677a51adf2c809c3ba5dd3ab06554362efa3b89598a24530cb0c1c36960734767fede5e337414e3f9087148199a2d01cb805d9611874e4b919618dfe91f4063d170d030fc4fcdd7d2ff75001dff8de204ed85986ce4a1c3578342c943f7b730c4867f5dbd03b66a9ae94aff3efb5b1144a1886b27e1da970275e7782a6c52697d0a31d60cb5360d4cf7514ccb766049ea78b9a9eafb8146ebac049e789dd05920d7b70553f3f845d25bf6b2e1a252a6ce03cf3d67427d25eb02a95b0a7fa4947f6f7241f812a993712c44fd2e197d2b6adaba5a6b43679c97c1342f9c9dbe674e123d681e41355e2428be4f2f2207ba863a39feea0b88d2f3e3816471c72488801b33c3149c8406fbdd0d4fdf19025501756983f891978faa9f153caea23e8ee2fbd64f8e879f7344187bec03e2a7425671840a6baf14933b8520e520a6506d1c8070cc9bb16c601d1701d71eb1e5914a0b782a33f58ce3eb433cb62f8daf408d82a0b89e15804d4e61277555392093dcabb4823414b050fcf80400f8145412174728380776f46a2ac1f36e694f52fc3f3734d7368aab3aed6018d3c7f7341b8ead247c316cee29d0d6730e01a6ead1202e68f7af122e22fb2039cd874660a5df645a4a726171642a8b3e7493fd5cb5e87f38bd416163086ba7953856b58e2e6ff47fba529002459b4e7d31b1ab7c52209c056f62fdabb0f30c4323c47fa082d081e673f92d42ca588aa5fde9c9a53374d92c0a1c78c4b2ebfc4b2534b15c4032fe09b53505ca106111f9502cae13de695fba87c9ac60cceaebdab4dfbbcad707163edbfdb9e0553cc769cf0854881da1f544d42c67f005f67ee9c83a2eff048469fed698d0056fc6a333233036a992e286fb0ce53b732eeca06e2de5b3762e6a07c2f323ca6b339d60681ca112d7522cb6047b943447e774606872809258cd3d541d4380a2884c83f3d5dc269c3f618072eb2cc2870ca45dfa7617612cb7e9da15bb76fd19fe7d34d094bb030f8386e6024fafbbf491167082e331d490b2f523aba3a1a45301a3a13fc96a781a388f5f71a6218022f1f3a6e1795ecf120c4eef8e31a745d8a90b4f4e22fb35eb9d08779fcbf0856d99bab5adf6e9b2d880ca2509b9a2f5fcb30391e5bf4d91c5365f742b66d384b47eed7e6d6ab2f68e62ccc0e5b7969438a0762cd3491abcbc46bd574e9ef531f3d52f4041b5f1968f3b7450b1ba017da4d01e37814e3869c557bd5fbc7aa0cadc3d55b30c78b8b062946b3e4b56b5108adbd5817be7eb1f5f7790264d22edf2de4189bab5b0486678f764c887acf49de167682ea8e0970da297640970aa900856fa9dd960ab28b96939a9c801f9e66c398f2e01ef0855a1bea983905b91b1424cddc043317457abe65d2701089be743340d3d1cd36196b7a1ccd138c06772e9d6132055c5d2c7b0c3bc9fdb6f88bb1e6ca5c226c43edf405d2a18c90324442a13e2566cd6aeb60dd420dfb766b700032b6adfa7b56a9a937cbae8edc8144abc2753627a5aed9abac5e28c8e234622d85b71b6a45a4e0eb5e144247e476db2ab351d6836cca89634701ff5b827015a98f877334fa690905639b2ebd01d1b69ec5f3acc24b7c032e4079ed570c32ff9da9c9639102782aa50c5167fd8e8ce83b5ecb0e41d36a31d7c3f82cd5f54efe8fa75b2c4fd8f7a01037739aca8252606ba43f0bee8d02d5b650862e9f80e6ca31c86f92f987bf549f1ab1c95179c20e679817126eb95478119666f38de4daa362a7dce8c06a225f895a82a27cf4546e3147723740d23e1b1a391119a89c6631d3291c1e07744aac5c79d49722ea016c31585b3a25c501ed5d0cfc7178b6563fcb421f13f45ecac507141b9c71df1764f36baaf588114c639628dcb481db238e1e0cf9700ee9bdfadc9922bfc28bcb99351e4e34ca27c36b3635c6ff3c6b45b7a023522b26e25d8ea7178f032e5c25d73f163dcecb0ddb2835c77230acc83e63282495a83743d65d04b92c78e7b595f6652d16d63bbdc913626b8aba1ec2cd5045b04b597e8d3084448adce6d0c8de61d06614048823b8eef4c2d67499b482785b08039ccc3ec2368e1120c3543109e296b8a10d98216a46eab99905c191ba05b2475f72f78eaccfaf85f75e700df3b7625f7793ac1d84c1723efb19353784492e2df9d659ecb26c02bf58921a78388dc1c2abb59de81075530bfa8dca092339b2ff1692330a6935633236d3e4891e4818bf7f9a131158b75bef18868a4002f80324709784c13bd705997151dd2342f9473592799f1a80b33f8693980aa4354507fccdd15e705ccff324ccd918424ff2325987f70fdf30b1d05c3e83775300519669341ea9d60cce52c18fc8b052cd6f9050e0b8c08f2169a544e61711eca47a76e77b590e5a4c29492ba692f2743d389a1debd60779236aa43fb24adc907783f3f67b5f039a5f9055be666ae7904b6b1fdf39345e028a3b92323a6e7535b1d4a4063b65b6cbe4b7f2f3364b5824c816267e3dde9b742ae5ee9251db9d20abc0cfb3575eea0ccf3f95429eae43b831fb41bd039540c41dd8e0e572ccde265f17dd5ec829eda140a3aa03eb31905da798f92a0f6ebfcd2eafc679f37d9b7c6758f9a17e660ce075dfea86a6974a53b7974e2bcb59c831a08d3731e1ede194d3ce7e4e161edb51be75b5ebbe16e0c1890e57768fe83e1dd73f2789303550ed8c68b9311f9558459e6a74d9aeadd8b8bb690934f922a108dd5da2834b7c94c862a98fc1f07e3cdedfa7a19dbe421cd4c4ef8575d91cbcd22d8f7e0784bdf8b07e5c6b52bad2f02e4fa40d4ead5abaf4b26245bf30fabe95779f32eb419ec7b4c0fb1224afaffb4f64685d5bcdd20be6ff007fe4766a04ff2df3d95f410be8b996850ea3ff5c477e2a82b9f40a14b2246eaed70e23cb60515b92b610f2c7235d4696e76dce9363f85803edd623eed845c7a7468de3e6aef40ac1bf344b058dbd29d7599c41588d2005646f34dbd19dcba583e30482bc13124e898da30d1f96cfd81784ed1f8c1d9e3fb0e27fe5cca04d5e2c05647929f4486a7ce08d0f67489a363511338d0afdd76b456390bdf7929c30ec9a987b00fc0d664f81610cc60d9b491dc6c58d3179f746fc2741d6944d56ea072af043e8463ee9e11a0cc2a5d28ec48d0e31b39660085e283f71f7eacc1f4a98cebbba58647fb0feeb5e2126216bd8abf29623bcd39eba84f73f3a9206d4bdde1eb092faf10291b577808688dedf6f929852ce0e2fe1e6bd5144a71ae423afdcdba670b4e357855c40922f01c2e7cbf36f814704009844ceffddaa7f5135f537199f709361e3fb37fce877a0b3b1c1f2c72e5f41d0df54a282c7b624de20f467d8222260de6a21c21eff1e3dac1f1ebe6ca3fd1941f14051cfbbc2a49e0c211286640efd5f5298e7e1e47b362f2f09cc2842a546a072c043383691dadafb89d741e6c40762edb29663902167d4461459031fd5a9a8525442f8972027c33cd9d46ef964f0329cf92ef8d7a8856f40b8bb8ce9ba5413c0f92643672ca1b8ce35f1d70d3c300141cdb2fa6acb071507216819d4117df27833ab386daf904ba8cc76962b23bd43b13aeeb362644baa759334451cb282639df4f26eca73ff83666e00245b743c13304663780842d72b0cdd4ec9ec0eed313e786349d7c139165681769452568c9ad9765362c05a9c38b285af6285070b95c679187eacfa436df7e9bfa535952e5480a4e0bc38b37882bbca95265df5c13473a4e46aaf1eaecd4e3d061ef26fce5ff1e255c14e5fa359149579e944ed9be6a6c4216a527d776e54770f71482d2a8399dbbe2fb9a3efce7c67db7b7396f548b0de10abfae86bed8b668a66621eb7127f2b99034745020a8a885e496a77c06bda0f5c647917b504a83dafdb8a00b70568c548f42d1067264a7f6097ce2dde937f370d71153a28465b1a99641473c90179e3d6f6a5aed6398e71875e6e56eee29dfa3dd09d5674720cfc53e0acc16ef9ffd94cb42a3067f4f2215ff7c85a9134549c3c6f36978568b69a7b554b38435c84594c56d046b303b53bd7ba3c601e97612888292629a9e680b4880bd5041914104a0d3303c0fc5de38849c3d1a1b14276d2989be92209b10d89c69632e69daec0d49ad4ba3d8483c4be02f9e53246d7aee4a5caa492e0b41330ce36a6bce1a4d61e171dca1db83c22f063594d80ae262622a9f63e2c0a667996fd21d7211b76175dbd6799b7ce7ece9469f945de5aa71aefee5799d1c37475c81d4d018189073a747afc9d00a7dda65e85111013240c07d1438b99f689b8c56784c1d4da502cc9327e5ae046308fcf045cf74704339018c1732ff3ad6d4ac8420ad25ea087f859547cdb880ee390f329f393d5ddff28717add05a76da03197d12ab610c4acda7e5584e79b03ea3f1191fccffdc5762a561ce7f75a123b279a04d3f92336a5aeceaf58ae86b65486f4424abf38439e21c382106c9891ae16e781a55f670bfd657f85336e4197800d9006290b7c74d66743f82ad9520627080d44e5775f8d01a9dc86377cc267521aa3f9c58261331f5783f7e1d01c1ae643da66ff9f8e84bc47cb615c72f77f6962fb7cb2370ec3aa7bd15b5651416d228a5cc660f1a4e626146a95bbff582e89158ced7e5c5b178477cc13f6c7bc605eeb801105a723357d7be31044731f425daf46f3e3025da2844d5a6a81e22db594313c5f5899c0dc7f35b028deb25c2c238179017362b5e864ca92dbb7fabbde8f2c351700f6b2761d0c8452e86d4667104a8a14bc5d0193952940a3e5cdb55e15a62f7c3dda50c8f6801eab9d07d4f443f27c035651ea2b533b90f84886c2f5bb1cce3a5d7ba9f6712318dec707f2226489a075c73e883333ea5d5b83b381b8b8aeed98959fd61e7633e4d89defd5f882b9d26d9ed5095c9d25b6f93169d0645dd5c94a56565447518e1c91c13efb30d4869a7757833dd76eb6bcea3237aa3b601498471237973431852949dc531d449124f5396965f97d2be7d750f79843752279b0b0214ca4ce82b5c58e33c0b9455af67221b1234ddbf144f9b99e9c3ca2294fb6e30530cc68e6e5941db6e8d12712a994abaddacabfe9dbd8f5afafa9da4e6889dc7ee19c68619adf1c57909eca28ece5b8619468f44820ae84b102cb5d4021a63c8618e88d5244173a985b5397b1a13f8fadb951d7db1b251805998cef4ec6c08ba6a2f5e8df1b8cf6afecc832c06afeea38faeef834ce962e24536ec6e761a0c7135f6de8e48c2c5e7087a8eaac4e06391532bf068b1513b97e6e5b2d5583fe49f025fcf42e4a862bc96cc37218b63859717a09213045a7b139649a9ae6ea03a628522a4735e6a7a68608eeecf3bcda4f6903833842d47988530ec9c43fd39b0671938910b22b77a3c1dc4784382ed07b529e0d113be55055aba135e02791d9eb326cc5c997344bd8f0f8a24812942bda857b7f90cbeac10a4062fe9e1c97f56260bad3732eb30aa957d4a7baa1c396cf5e5f660c5f421464e044d255d1f9dbdb56d0cef28892288bbb54ed8ab37bca165f070ec9819533eee7dd066aa5d9c462933c4ccefac8adc734eabb7639db0081fb669e6f815ecff28fce309aa151bccfa0cd93271d824ec8771d47ed450b3ba5e9511a971f6ea954803f8b6d1c281d9b74b00ca6919ce8f31974a27a1b1ff6e6c40ad094f1389a9335d6fbd1d087b41b924437a9c7216f259da96f02f05d9a246785d9821df11893bde378b9b3f58a8aea6b1122afe02cde599b95342381dea135f9e3af62ca8f9a34580c6c4607756773edb71521f4152b9f9fbc424bff00171bbd9fb38c04e89aac17d9cb12dcb3bdd81e65ed5c4e5d0cd50de4a6ded25b56cd84d3e04be006d46a9ddf401b2cefab40a7928fdb09389b6d96aba7f97121ff06b74697444b839621533c0d4f929ad0f6fc78943650923e05fafe1b3c7d2d4e87a4dadce26da785676fc48fb5180d2a2bc88334a59b86de52c088a2079ea4a395078eff9dd5b8f273be2f874f1fc83a31bbf57bf363114672aaa6590d63f3f9d15bbb88b5ae504144f9c6ea5d58e67df3093eb72a5bbed6a2d56af4f4e48a1985ec0881a7577b93a8b4e8aac8db3aa3c0fe7e9d96ce12b84af019c7e4127a5bd9a47da0f5b58449167190058a06fe0073e738b86049881e434226c1662f3873e6d73a5b2031c3215c99c3cc546ed9da5b92c72531ca3aab803e06e12b2fdeaf88e3839e37e57ab40133f3a75e72417623041fb2466373085caa34d3506d8b4fc51ca4248fa205adf87bcde4f09d4eb9c9cee0b72ee4fbd6d9af16ef83b0f4da00bf45648360b839b2477beaa22a6c18ce2b51afdf611b363defed460d8bf225f68cd867dedbe6167db36ebd56929bf2f19ec58f2cd6dcefd7d997648efde7936085a362ef6fe9fd3d335cba6bc26383c3938598ce7aacfd2de6351f0c6a9234e14006ed9eca03c69ca772583aa895d4fd4e9463694cc1be086ce8342e94c650182a5183612ea50e675aa513d45ed288148cabab8d25919ceeff20662dd0d3a02f8993ad1067a1eee5ae7e197a4d396ca41d6b64b42c9fdea7fa1dda8077ed61eed4055ea498a59b5e269f146c3138e226e4caf8a5c1060b5eb90fd4b9bf67e3005c5889d1338e3028d46de8476d43b0603d35209db5167a9a1c6217645becefb7e21f8f3628dd6a444444a3f241a4f39cfda3a11982c698725fbe500871e2041d987dd107cf8877afc2fd4a9a9663f46961999203c658b8f027cc412fa0c26d2ef61a6dae42305ba8a5e8636c5554da00f85ea0ee1a8df6abd61d19e2cec471b343770c51f4ad86f6b42512f1766ff5874ae93a931207c63494ece81efbb14ea15d10f4614dfe0a73005b2d0824922e6ea3db13b38dbcd1f242c81a912e0ca3bde3ce2daaaa7dec35145b446b570f84b76fea27c20e16112f6744fd108e746642ee0797308745f2eca938c8711a40d46808239827ec401af9e5855ffb6dcdd64f1a12344f009574e76ea980938316f56182bd1b03bf49cc82fb20b1e54907ccebd52ae942820e7f2fc618298f706432be7744c79988281d8e07c461ac847e519b5fd81546fa0c06ceb3aac06defb23f55ea3a30bd2c90528eb442bbd829c08b1ab0a5a4ab04f8d9022be0ee4099e2bff31b0d4584704c69594e313b26ca5c30adccee3b58a6bc6e70346b6f21f8e7bd241269ec924170ffeb9182ee057953b53ac99a03a04d4c10d5d51cb5b8078538f17b6c2e8be32314732e8b250159dcf6515ff4de2a8b43cb1c48f04e1007a22587543d82fda5b527f2cbeedf4c5f6c017cf8e67554a430553eb9373515f8c3077c72a6d2b76eaca0156af74393be89caa40f09d3f6265d48c4c1cf67ffe0ca0cccd5cbef803d96beeee39a40a8d50a0ec0687cb4bb1005d1a91e75435a4d853d32491eb7beb07534d2c1aed1f68a1ee09831172b199f262aee812a4d44e0437d5e1ea01ebd555591253bda25ae6fee82329bb22c540aa49875f8950000a14e09876cf37e9a72bcefcb04ba1bcd0436985d7e6a34bc788c59cf502c3709c881e92a98fa47ab2337576b534cd2ca00e457cec2441f98517df08de86f637d578a6e6eff2ee91a0823909463cd5e80d659617859df18f4dbc86bb76eb9250379ef57cb09bf1560dc550b9840e45f27d382d0843eafac5b69184c22592405e33eec2ee332e19f48d2058a0646ca44d55d4e229b083e1a09e27570b11f57c8464e03275f1ac54396f749a6100ed02c392a28ae180f87b541168b32d9a30f18d543fa8961bc33b61eecfafb4be682dd3688a289aaa056996bdffcf792ae4275b96c49881a104db9b40ac7ac8cde68906a4a980a8e606d0c753c50cb66ed920e62bca0f9e84446c0cd6cf015b4361d4fefada44a2f0b0c674dc935635baf395b47e4168103630ba96b82913dfc1e3f1477a6c1cfe25c3dc60bd46f6a336e95d7d866cd2faec2007c007e0112a75410fa559cdd33f1fae2c934ec1c9920fa6d5820d4391ea7d11d2f8410299a7773860a7e69e4488ccfe81780a4142cfaa4a062223964961eb4187742402a8949ace1ddfc18b5b927b63a0a6ccdfde19d393e0c6f9ce3bfa9666182f9b94e4c146ca9f69a82812625ba15b358ceb2d4b1eac9793a882f4e7769a359ba061b8fe507e71c80a8e762973fefeb042248fe4e8a184afe167b2333802cbc93533a82c1f908164e470dc0724eab988e1f7e8ffcfb5f6d4ddf67b8eccda9f045f716f61a0a5d85968954f6143d3444feace8652f8707f716215ab532b4e06967628d0b07060ab8b2f2ea99b198ed6c9e7470a87f5d4646504368cbaf1bebb920468df15d349582473ee9e3dea9c1255a9d6fee8aa96bfe93b38c09ae0c9f3261fbdb3b2552c5fc8d26205cb7128094adca631c7d4753c78c0d29447f26b75242c5d733df49f0f06650615f83d43b75420c2355082c6d2cd7eda10f272d938783c79c65810d007cf80b2779ea947f2b299dfa95819b9591001bdea6348854d427c63a28e914c178f15caac9086552e67ede4b66580aea59a96491eb7512516e9cd35547ac9ebd379529dd3979c498b6e12804e4f5be6312aef29bf1ef2ddb5361a3db1a511ba884c091b9c3c9a12ca406d9d03f3d3c5c1afdf1ae748a8b039fddfcf2e273bbfe63fa9abe6d227bcc81c48576a461ee433cf1f3a9507dd583365b83088e63eade8294b3c11e34e5b5ce73132088e6e63d10a35e3ca469b00b80b95b43996f565d20766ee46319359ea1ea5e6e892a7bcb7b7771811eadcd37c5c63b54222187bace6fd4ebe783373b481efa0eca8e62ccab301045d79d8d5e09be93c309b1b31ea0c884e6308167311abcc54fd7f16ea40a881a249edf3f723a50981642b0ca6843174de3c49297a6f0db55afb095380173a53701b1114956972c73fe623aafa7de33aea0ff0c51c2e08124d9fc51d20f406793fdf5833042ec9741a8e880efe9052a0270ae1bc6f22e8896df16d7fcb33006a872f8af851829ee60ab7ef17b025f2bfd699d57143d883adc0ab040e7eaa3dd69513aee2125f0a1a7ddffb1b8df76a12f86d90c08886e80600c1cd31fbfd45bf60a5cb5b00d766ce8cac6038c10116e811020c013d45ad2fa06c2b3a32d5c5a38f8dbfd9302b4573aa15a0eae3075c2a633c7e31d587594e708788530e5b8caddc6256c708c27b97bd41b74cb223cf9f1e498a572f132accb3e5966e915114f63c50460de3426889bea723c56434a83200ad763c010217eb2c2ebbc6cd44dd14ddeffe86053c2ad8b389a9884fbcb4ae0ae36cec7f4b58e07a42d23c06004d858437fb91330ca6141d25277867e46953770867bb0252f87621a22044fc2c41e4c0dd8f1ff66ed7f9812940adb02a8fe163bd39f6fd69120b094a2f2d1e7e14bf67096281b0b68a772f5ea14e4db70190b702e11c6813c5234cccd7fffcdcc5460be4215dc31481eab316b7e4687e19a539fbb1bf5c5cf40253b55685de2e04927e51d72eb92dd06b7e07f0e713d2e7e362403c4abaeeb6953f694b8a28e6a6e326e6c1624ce7da2baa2f7c67cede1c262a24463921a0def489624b84d910f9e8ca8cc528b0a9237c7141c49d1f39375fe6f7dd0ece0b89e8df5a1a46cca192e6ee1a3b3542f7614f185da15567b705e581df8b9268ce7e822dd1d6b734965ce0e5c984812639276d92b162b7e0b553ca51a03abb46ac08bed9dd495ff712cc3347146e78c97949f1eec4dc31d301dc6b5b02b71487f7cded075132f47ee28491631b5a0cba026213478ca88342f5fddeb47204ab44a4d129e47e59701baa6332d174a419f249b81985c4d1f899a68d8c09877aba7b93011d7202b684deec1110b2da275129a73d3796a0d86b284b81095cdceb5e82e027d9bf173b2d3d36fc2e196a0c60e254095f9af73177df9066eb0d919b672b7512040fa44361a4c1f4dbeaacd2b9c80df98734df93206868d91240a79e1fadc59021238d8dc19f451583787ecfda15c19ba517f94a5e35e74b0f851cd70b545b620ec048556da676fdd7fb360023604f34ddf9f74f12485c0c9177c9efd296068b37fc441d33943b0301db30d5033cf78eb4963b7b1638bc74e3a120f5a758bc9c19ff8a24c65b674d338153a87b5a0ff448eca5ffe003520bddb69a9b9b30e0b8d6cebd3203a00a047c4648a581485980a34d71e615a4e3a3f17bc3b7969ca579c4b4cb86f0f58d0bc28c6acf53f28a1d0ffdaef7555d1a4f08279ac338e4fc77cfcb0ca6f5adb562cb3e32d137e69211c81ec2d2d2712a890c470729ca60877d0ac58d84d6c75f7de4d9d37b8d4aed30beef473f64838108d87bfd7e805623042ec78acd5eaff61d70230acf1c9960ee803da35cf049f351a64ec597418b52941b3cef7dfc60fbbaea20b8476988e7cd83f7df7db99f338f45153332ff95fa50b8b6f2f15653885ed0d72d3946210fb6c58e0e7c116a68a351d6a48b9eb81759c174281adb86cf9ac209be3fa114a3f3fc2fb513fc1d463dc9bb202510bca67547897252166b2fabf7c9f6054f234557357cf067c1e0acd4ed66c4fc63bdd03e46bda9bfd629c22cf69408cf304430702e1ed1a5c7e2e307a41af58e6096b540a7a5ef7b1d42988804b40b8bcb138c88fd2a84a67a9018819b7ae6f3ea47bfcccf9c01581550ae003718afd3d6fc3b79d46531c8ca59ab8c452b1568ee4b72956efba14c6d6663331edebc93834c74bc9da4d331d229b088f1c6b3551edc61e2c2c3b40a6f2bdc174d43d6cf382b04506a12cf985cf550553e06a3a1bdf80e8e606c2e52e43ad250ee8ae835e809b84b118d75df4a518e1176da4f75d41d74f004f8497fc4e9f4ca3522e2e921418b43411c17fa4d769195f6f526b01244de3a7d058d6f9f67503783763cb4605787fb8d95b659fc5d2207e6e9cb848197983d0727b198d0370dfa95ffa21a955be14ac157b2b08ad41957c2d9aadbcb48a2c926d49934a42da3aec7e15c3c6d68ddd3b6d938fba386987c8459b351351e6bff5766f4dd54ca8f29e5b79f6194de58a719d3ad6a9d811b6a1d779b845c61c8078195198f971d37f637dfe45a804fb2b9c0255a42d81bf8d3cfe2ac3b4a44cd14e22578d9bb2e83e936aa0e0caab2bc4f70e676f68e4f6177dc31f906e567c06ae9e33d22d81b900cf174df61c287a3481e4b429d59654248fdc5f6b793435ac87c2fd968f047691afdba000e48d807265f5309171d660ca2c3f5a8ca3d43701a4ada865825244345f6d001c90477399d3eec11af8ee3a0579bd6d3057e4c69f1ed7e50b499628f1cc1b1ef22fb2fbac42d6fa724e04f7218cd7495e97d2fca2e27ff3d243cfe49efbd7fb2079516ef1278a4f2366fa1208d60be1fa813248f8b44d342c63c650f1e4852100d03c002a9e1b2eebb105d3038733c45661a2e9d077fcc7e6c0cd3d23f58241029df9d988533d95cc03c729c8e691748f3248fa1e0ca9a80e56cca7e733558a628d3572dc1304924cc1f648251ce9202c43eafad73274e165e73b33e9d261af65ceab0dca95df5ed43f2d15a9e05ebd05e6cb481e03c9ce62aa3c739a81c4a158888186c2113830581087a57fb311ec075000ba752b75f74d73967f50551dfd4173c8a942cb9f0e34a57823f6d39045f627ae497e05a8c1e525c07a71dfa3546ed0d1be01935399b249353978abc1377ac96cc0d1c2c4a312d3750f6133452fb72ada572204b985608d7e0d0353ef9677068119b7bfdb282230e70e426cb26adfc1304446858c2d4049247629cdd722399352dd04826329603287c75071f793137877777aa5ef9041478705d7ea587cdaeebdbc9068efad17816d7965f6a49768685b3d5626d21eb0df60611c46914157618f799886d060d81f3dd62efec3fee64a34d120dec8f7cc0594ee09c31b81cbc92e82569016faac6baab90b2dc969ef10984195058679a5646434c528b7d6b3d1e8392eb796d4785d7ef87af680eca1778c92b95aa35a5e2882e77065fe6ce895e9b094414d53ef64f0b29deb397221d8729b92391a162b8d7337854be96e88b41ef0959bea556aa612073b6a18b4aeec7d5a6dbd1fed1e05513164d5cb38bdf2e8abe21b3c49e029051aa66dd04dc72558644631f24075b204ceb68293f24b7801945a2eabb8f6bdf3dd79156d327c9c2d2a04b3dab3b46b5498a14bf0ac9a649df35f60670f095062a10d5886660a3c1478f7fbde7661a1c96747c2cccd7688817f98f70311043e79dd014bb2351fbf3395f9441cda506d9b17edeaa7ab62c58e996832fe2817feead798a024f70087e33cb54dbacbf76ca2facdbc036c074e27584a012208bb6d768a155ae8a9d6b3f6c6f84be0cb0a98b09570984de3c8dee0f7ec6ee8002d81ec159965bcdd7aef8281958d6bac20213eaec5c9cf80c8a1f243623f631de68174c9959f4d32303704507a81a608436fbb9f1604826c3a5247c0cdc50228eac827b0de2dc7ea878c8112c2a7bbdca7635589fc7654433ecca90ed4421b426e9e898d833ac728318a8955d902dadbe810320dd16cfb930ce5a2ceec2c8ce5d356e50ef3be80693f0e84fdf45a89a8c12a76f55da57edd9084bc280e13480c44a7cd769d4eb748486bb6363e6c8fe7358c8e2c36973c0c51aec94bac579145bba00800aa3dd9a064448491becbdc518d3525291bcaa460de62aa2b47576b8c09a94776f3a46b8136825ac01807311521e423fde10d787e809eaf1a11ffe70e820d3227e65486180373c3ead033c8c769a0809ef888eed5e585c9d87dd76943f70b01dd4f08918cf693d8985864f67320e91dcbf60c62bc5bbd8c98f8615a694a15d11cb776ea1176efb7c6d4a41f9f4a2d2cd4b0acf74b756b2afa96b836bd8f6161d51a72759f0e0826bafe49db54e059c84ede393250b7196fd54615bf278f99ff63a1a75f79b771b73ee0e8a08db9d6e97b47e7c010861d0e6b8807233fd820c56f045bbd9c6f68b7ee145d41624a19accd442d8c500275aa66fa1464aac62698be1253cbe64def30dc203a79e5a0f498d97a82d965546cc5ac33ba9f73ca0eb9817d73c3d837a0c3799b996b279ca5d432d672f92ab59d10976a537c05c0790285e6c7a9ee04ea2b161073f10176cc257e93f5fd5f68faa1ab557299af372ccf7769a525ee660b91841ec9f0ecb62736fbfd4d7f507e11eb95e513a28e9d172f67d35f5edfc8167076ed5df96e73538da317d3409ce54bcf096cd88068d8984d600bc4220cef264e0e9504afce92546da1a1a5c2a413fe5a2f0dfaa0ae0dbcaadd1478411bd521d933312469cc85e3968a7d3c9c3e4c14064ecf70f726c9a5c9f50e42e5349bacfd9e7bdc780003f6408d8eeda1223cef6861b65c5d4c561d023d9450f7a88284326a706513f49529993dcd7816ab4c0cb40e54b4d472ef47a5a64d923439be5e95e2f5efa69f0c1591f6065c41195d5898574fc450fe4c09e01dc607d5a22ac1c94e3c62c10d6fe48cfbfc8d28155740a0b1f1ab45381085cf0190cb02920aa7483d4838bfbd2819ae8664c0e1c872f2bec257650e643eec9cc62c3546160911833988e4246dcb144d85e2ac876d720e1f42b78eea7d3f6699eeeaa862287faea3849674cc0047718fc95aab82bde51a51ac43001106f31316c9ffc2d30bb6915059ffd0ffa0bb8ab032cafbb149bc8dfb62dc451c3a92060ade9e6e6bb310279a8651c497c6f3d3de9424f62e603995cdd329f5ee899c7df284663c8404db93b0d3c36829eabe59d596ae97d526eaf1d01ac3898519e266b0981a961cf9afba52885de36ec49adf80432ea3cadf75abde33aefcc29edaee4b6fceb8977f710a8619270a4f9e072c6fdd85192df8d0e54364fe69ed79cacd1b2b3c1dc7a70dc1f2bb326480b718c87c9ea0dfc2d2742d46ec46c8bd1c1bc580982834e407b4c643ae0c8e18ebbc792487769d7a691ae33ee9b98441d1f393866535c90c05baf336359d80452df431234268c49b7e82ac022f92a0c4d166b7a508efbb8bcbe04cc4fa902bce5fe89fc762bcedf7661d31012c1aed0e50093b92cc1efb703f1688da2b70a29674d6f57c80f8bacf44e239397bf520e9871e7836e529e6237c4b46333e93b3095e7307b31841e02bb749d54c43acff8efd68f4d1eadf75cc2004d1ebf3a6123fd811f8cb59207fc7d38ff09498499727727b247c574da2e6b5de172c375062ce4c6346541d258cf183e8869225b6d5c3d1d3ccbd2d4b2af6e1620f938111d5d5d6d7df797ef14f8a3390eccb6f490c4050a6bce6a67dea86ac133fd67a277611336b82b051bdb2547358b72230d703b11aff48f3e0674a5f6c6010e694170f82dd6265bcdee646926ca93eae971fd898b316b0c305a9916892e9136820c6cc3cc918519bd45002955341d16cd4a4fea4cb8b4da911d39f7de0b39d7fe8ab8ec1f3b8e7a54bcd444482e90025fede6646d8905e38d72d8ea1e3d7a5755a2c141cb6fa36139c3d16af11aa564760f78f7c8f6ee51010c595f28eec5d208e9f95011490a585831671260c97ba87b753ca5d0660bf143a7fe1261572b3f8deada9c1f3967e9edd4c5d7a5642be5b8b87625aa1cf425128386ff250b9ce3fee1d30b1d71da687f6a87be34fa86feabd33641996f82ba0470f56413f07ffcc5420799cc273f574e8973d8a72f31d5953425130f455f0cb53e528c44b9cf8e22bd666da3ab8906a07c4ec112670cf07c4efca9368c3b4dfe5944d0c6996ef18ac6b960c77588f6e9c9060dc9b86a3bbe3f09af06d521e4e34110e1f6131e7e4313796a5d214392e73a9cf36e86c59b3d51fdb5eea44a26792051f176de33d5e46623f1bdae977c2ef030026a8fc6c1dee692f551c7e297136c9302b7c7da3eb122f8220819f7d89dbf5e7f192c3ed12556c95a14a3e643821031f4157bc8a2c5aa20ff1a8539248628ebaeac7c5185b254b3082ce1701690a0af562e2db17f792c4c88252266b52eb25494cf6356ce8760e7604075f28693d346e0b3e00ec53ee30d37aa5dbc94e06c43d2f781e887d722d3754434102f03898d2699f2cf96b5b26fc85fd8c855da19054b3fed2deb3daca9fa4f82865349d00df135e5e70c4464f6e5886fe7bd8763e2ef939aaf91cbce3d00ee23c49fabdc7dbc32b91c09015957dbaaf055e29c9e40facbec1e50af2d24265c059d1e6b73679c98697ed41fa2b9793858b806fe096227c18420886a36c1db2355a798442285859d20475bee860dead2ebed0ce506487c389f651004f6b5f0e0d1641f757903cd271061b9375dc9db4cfae43ff147a20f739dc076e2926a474c5e9f929964433fc25ef9f0f562d3d9b92073e1646b0f9f991db4a73a5c9a32bc6d17ccb63c80e3c86fb52456570b98e6f6cf3d5e782701acfda0f1e24006914b148175d81d9405e273606f3fa31a74e86b4468c23d312d8eba88327a36a628177fe8ee5b474bfff978b71d144a73292758aa3097ae837bbf75cc9ff40a020f63c663006c33bed0f59f9cb31586e59bbb1978bb22eb5b452eeaa5b33a233f5eef0fdcd90a8d85e4cd40f0f833dd4ceac59a9d49c82812bac0b060a8b00b7dee9a537132c6173e90c7afe7a366fb6defc26b963cedf0addb3769385c93ce701f4c55548b846f52f79b042d5140e7fc35b14501844b3a178d740140d8aba1f968c1d4484c0d885dbdfa0c2df6c0519c97792c9cddfb52f8448f7e23981935298ad5f87a11e81366479a6bce21a3eacd58eb9d4555efb90482417810c43d1cc2784b442a34aea92eae233ddd3603a1177a98ac4181b579d29ac0c661790633500b0ee0dadbbf15871220573deebc7de32e167bc43e471c20ceeb50b930ffe8f6e0a96e3b95b2c5c69ee6e92b155869d93451687143e1cabc04e03bbe85554510e5c9f62eec3e76f2a2fbcd5cdf72517d4d6b7ba0bbd810b2551a050db94c69053b7c80e98bf67fd487b3acfb0506693c170067043b6dee7c6cb21aa20f1209a54f0d3786ccd73c1be4b57c474263c17fb9393b8c5845e3db45806c374118f67d9de378424cb009e0f9ad2799182649f584309eb22fb8ade67d551e3622723ff3e680ae13fead057928dcf0b115d2b56722c7832bb12ea1e9af4e8d8e51e85aed8fc1514eb924088e6490c3be310d12c01f5e7546ec1374bf0e0c8f0693f422c5a23ed35845489420b459d73aec59fdf3b40e90c3b81a84dc9efd6a273ce8df52b354944ddf1a7976cf5776bb8aecb675c3da10d1ea7c98d4bf5a90042d18f60ff4ad73aafad98572df97a2bbd011a6d45245d07be21c966dbff656b4962d7704ef3c5c707a3c375fbd954bcc3d4a9d978d9ce1d462856f7c7bf3bc43315eefcc3f5682dfba28d972b028df641474b424f1516b1264755035471a03039971c2e4bc03a1ac6da25016d3e090794700ca4866a7afb76c58e4d9b33c48459b404a614a280426061d9767a8b49322f8e8ced6fb416a2050f7cb899223fadda5c2734854bf870e9364d166073b31234766eb782f92c6b933b6853e41a38b7ada76af103f26f34715c29dc3f81a885c740e2faa1cb9a863748350164428ba2dcf48d23b6695be6d9a342eee8aeede6bd1efecf28ec7df3e258bc429935f16bba1eaae7435456f14589371f80ac34f9c0ef895594eed948468dc80884f1eb6c905cb7fda08e59b4900eb0edbfaa9bb585887f0bc9f6eebf487f23368a204136c4cb9116c4b5fdac8085002f95b7086b918034e660c0925f4c0f2a2b36ff286edd8b5c032686cdd50c4d58ffe6c1b14286d949443da54afc5e4221dc411f8a334f93cf9adf408b93ad0e40e85fab46197fc1380d3ea94d0b428bd10b9337522509cd2f8555e36893abbdb23416857e59df3f6ade24733d879049d1463c38b0ed0221d6bc2ad6259c7a856881fc7a45c66c135618af0a2ca298947b45f67f6d006906977ee7cbd0d68e1579784ce4eae17fe120a949931d9e75c607b4d2227fc57e900a34562e54bc9b796948e279f9d74928e93b11c4c94a9a94e3cd11f11734719966e60aaf8b20c01993ebecdc693e3af538090c8ccbf3640d2bd95ce18cac19a821015a71be7b0bc5889ff5788233aa29197ac0256b155f0e832d4b2e3a1b472aa3584a62cc0bce5914446d52fe4841eccc395eeff4017bc19ef6694e690bc93f99e28bc3f89d593a87070ae80b4bfbef99983ba43a468949f6c435cf3aa2057780a44f476b6d5022d2a0f3787a514f2abd3e3bffd5c9152d8d9813838bd75f5a4a685958715b7a244e42c49d8d99684b3169be5fc9165045ba01e3dabeeb53fe1db868b9710af3653a90f87aa85f7e8e19bd4e96eb59b90fdf842e7e75fe6f0e7129600bce8bf93915f3b0086f63cba77a0b02bc8ced38903b9428933eb4bfe83361ff25bbfb1e42485599cf2d2022a0ef2c296e1cd3b82e4de37dcf029789ad0d08348c1b9ca3f24b4c326f9309cacbcfe54dfb204a0032d6b5a956919517a30ebe7b6e92f333a6ceda06b5b49617795101b868159b0341eecbf609a694fe8f11b306cf82266b4b610d8041662998ce3305598f360265fa9d555354dd554513cdd7b709e66ed7aece91fb33dd78728d2506208f44941c424be0fe9636cf8168477df10fcf3e003cf14538ec1fa63ab010dd23fe5735bbe7e3784e9f78e8b2880e583140e242eaeb0a990ad92e12455f7e29129726e37956542186d1feae36577a98996d76294da90e0360c2888fb4d673f422a182bbf4f625f7eb7ef3fd4510dcf1974efbad603a3eb0b004768bebcee21312f2741b7fc11c8cdb76807639b4e095930ae92b12105d845eb32edfd0598a1c9c43fcfff6cff913bb3acdf9caaf2623054cab75ac667dc1eb0fd07d171b8f29db8ec5477a2dfdc6782d7a1a41685ecdb6d1e1fb8fdc12d9b6cf0147b200b4908e130ba9895cb4bf404d5d34bfd8ef61c1051f4ee8309a2871551c0c3ffa36b946b79d48181b44de835598f990e19737e14300508077ce54d58c3e3489925ad29bd60bbd3964fafb6b09153c8d9298a378cfa0ec7ed1fd0599200a11c362378c3082d01ec4c696dfc932d175ad62549c901bb574892c681b305d7bca16c165c4e5040b806c9ca29a57def0b00e23e1994f3d898dc4dcf6884095bc3ea4a2b0e5efdb0fb7ca91564ee7c65a39fd4323a3746e2537b70dc188176df0d2518b38dfa2616a2c9b349440e71de043e41ff39ab78a8a0d4e91b8d76fa4aace515f4f57c78d1c24d0559832eb9a60081e7fd8b2bc317eab75309ff8724e0588bd7e65dc9361253ec439615ba5c0a840805195fb8680e3222254dba07be88b3c65ac3de05140136b31e2639a029d219ef21b76d053f71e1a91bc8ccdb3d2bccd06e2fe776746f63fe48768fd9690f3189ac36876b3663d651665b70d7a564e86cc0cc50b26a9f658ebb93c8644b1ac7401b52a5d8e056939cdad6397d5feb8451ad51b3025a10f0173ce91f5a345eb65e0203dfd29e8ca2fe4e8996e4ef2001c5baac57fd772977ecf4f86584dd4819b51f48ddd982780db9c2100dc25a5b74c14cbcc8c2699cee7e51ffd9cf3dc610ba78d67117266948fcb4bbcc9b822f40e80c2a073b09811824490f0956da8ada5595dad1573b0164db52c381f1d90ded15c2c6613e86b0badcd2d39b26d02145d7a2e073661a756f220b2a993167b7500dea3dfccb7012ee68a99a2a3e82395c3826ab4ca839ac12c0d1f5a0c44885701617a64ac9fd8aab8b49c9e03c30822bc81913b2cb20188ec4dec1a857c9df8d957edc4d55f6b32efe53a294e0494b664090a47f5d7cc863c2d94cd24779c669a9f9fbab4c51557500a9815f0cb9e540b2b5a7c6de8f5ad390aaa8858d20cded3ecea373911a3a2a90c8304c594098423362c66fc1b7849cf634eea79dadd1bde7fd6c77140acee6b5bf5bc3dd742dafd895610e8114c354114be957eddbd4ec3e7001fcdd7a8b9879d3aaa273968fcbace2931024ba77ff402a506a97e402f1284e657e9f24adf3831c210b87d6b0cec2ada468011b55168fe7677aa19bfb7f0df568f20c2757faba087fd7d54568d4a26075e03e8ba0979368990241fff78ec5451f9affb4b3578ec96f5f801797bad78674b2696931b7e6160f4e570a87aa8f4f2761c84a6ccf993ab8a799f91072fe8f300350e34e15404857d30bc85e750679550378bc788468dd713f7f53a0b2de2efd563f3146a88c6111f42d56f45e829dffa3da7a1d3557337cde4d2112858bd51eb808ee0980ebcc20f639adfd1fd2d30944736be40030f07455a0e699c73598564d68b66aa465afafab283f90280c13e1125e8e3bd401629f091465cffa7d462f4629115632a2f90605179485672c09aa8e118fb6170a6c5f68fcd998907233a1cfad81865ddad8d32e36bfaab1c7ca3ac98965f77c8562be0b1f8b00c16243b26a15db3ad5ce88ab3c6a8cb2aff63735da95f007a847964f080c30f377f3df66a400f578ed2e500cb66da8996c4653395e3e518aa8a5c71f46df515883d7148323f0f867bc81d74cd8f2ee41b968e3f6188375ebda76ce520c581ee79559c5acc45bd64436650456abadf5f7ea82095d906b81601e543d6eec9e4cdc7d855d6b43d9ec15b15b3c71c0f30f022e2592000fc801ce04f226919d1aa65ce03b8e4c5ab855b7311b7cd5917685ae9df11c819225e1bd29ad58c0138c1b905d8d89809cda0b1c3534b62b275fd6b6a6df5d5e4b16715a6a93e295049303eda77cfb3ab6b3a6acc0adffd96574af3c6406b4835a5cec2854245bf9c17d325c96fa8fa2a176cb45875f702a5c7441154bce771cfe1e429e9759b00b67c688fd95c7d40f3454e0194050daaa77df1464c5c122f23702fc2584df79163c3ba00ace94936b2ac3c3cf24902c62d4be495398736030bd4b7b31bb7f4ca4e820516bd545832acf90157c1ed206c4d9380ee51d6ccb5f2777246e81d63442199b8a40b4f1d78f172755fd224aabdd4d2f09dc47b073bd561048d67db942dfa0d0f2913be07f924be84d96f92fdae5b6bd26507146c3199f187719555f922012a4d5ce94f1cea662316e4a5698a94302e858d1838896b0884c18451314474f4918f1d64b206d09bdaa113631466a4d7dbb45985107647f13e1eb39532be94f1e15c487e571b4a0e056d0b6ad363f0486479d601532a1dfc9341728481bbd021666e8477299d389c1335b01f9eaf9dfb5adc369be393819b4cf5fd83e8cf320bfd18cd109a719f2d69995d8fb3cb349428d05c82100a5c5294d0af6cbb44ef373d18d60736d16fb81e58a1952621b951894ecafc95525009fe480eb17288246ab2ec410718984e1397a957a18fc5f494ac65e74f1c2d5899dd07cb6a4a0c7b6e9d1ae63fdb9ec4498c6e22a53f96b19ac789beb0e17df4e437e279706a6b46078fbcf1a7fdcad35467e5a5736e025a340385368c2ced61cdcb2792468ba20ea8e56e3904748e96c44c12b4ddda5a8ef202238219050691dc6fc8a1c9fd4aae4f02bdddbcef6ef4bd10ae3235e38f7363053faaa170d5bf2ad216a9327c061c1ecf589d7ce1df0a69992ae4a93ff176e7582021986e9b3704b3ee7401352909381145fdd87928cca8ddf15aa3965cd5b93548202d991dc56d88e33f06e95b512e575c67cfa465d9c9a1d5460dffd38a83343b504bd5498c1a8bc3bded2d4a4660d80616d9b899b623909503cafc9ac6051c1657868a294faed67c244942a110ee12124e5f8679d48320197ec89939a62346871dbbff2639d3153f40eb0db2e3ce380714aada4bcc500833f7829d3ad8e4b0fe9604aaa152a18bee6e8a23f9a3f7b82e4965a6a31c3c4c9602377c3f9a6191aa337732c5b9c8434a1dc3d4cad51284c807898e3df1fb2eb39a8cdf8fd661b99bbe3e23e6fec301364aee53bb16cebb90e8255a5abe64cefe636f0323cf4bc2a0f4beeceb2a3fb59bcbc6c1aac43ff3a2d0a8556230b75c41f0ace4271463fed9a72dbd40dba8958f35f18c1c7b8f9ae58900790aa4ac60507df7e3bc2b1d3af1f275d0034d8f6b2f5bbbb1026b536f0b1d0cdf1a8566f607c61a60333549c1c57ab6bbdf6ee89a157eeda43581e48bf028a58083bb88a6f8dcaa70873cfaa423d6c82a7f068d76ea62d90b88a3be10cab905f4ffef9e429e7ca3489cdd1d15ee05bd417a15592a479a25192cd03d4d21a09962318e92d9e110ccaebf67c53726d5e11fe2d8d668fc79f51eae0f78bf2e4cdd9d2f92e5e15b017314f1b5cc934a13abb30b85c2ff402d16802a2b445e6a58d1e9a020e735f52de788ce9bb453b36702e1f7f5ad5b00a2c47de40d46a9498418a67690d2f0805090b1304b7674dde67682044e9f995f17f92f9394768eb8edc00c9b79ac2cc86fc84a1812958658cb8f6d2705d86704a7d6493d44b62ff72e270b79eab891cceb8a82a7c374842fc1010116c97b4e4c5e93dc9d28566f4b0be7745121441069db2e582ae129ccb7d4ee94590e77303fe938b6edcf378f2c1cba9ed180f351590433ded101726945f284419de42c02d099e419289ba41e630a28bba58c4d56a5d2811fced6cea914ff462c8fd81ec4ee42a95c42014552be54caf67a9835def01cd991b42303314afc90ef31d10b9d50272a591e1ec12cb8f88aec13bd284b8a35be49b51f29d7cd777847366d22a56be470d3dd30b8e079d7618fbd1be9f5ee10ff978df81688cd846a2a91b21635fabcc3e3cec5a063611c8f822b875bd58224837f4f1843e2baa4a031e66dab1c50db7c263401fa475e3172d07a214395e010e7fadf5c8e586a7ebbafc967ba7e3cc0e455d23c685d503d6ef9bf585836863cf2c8b0eaaf0e346db931a8d8fde207909dd305b9e84a1c70169f9fc4e54204619b8b26fbeee115f635a516781a8185e014b2e6d13190311cf939d307007603b540528ed64a66ea16f40c7eb70d6f8f9b7a63d52b8e8fac896ecb3fa3728fde30e875d60553331e340b1c4fd13bd9b0a42a397003d94639720a03dc4589b8194a00a33616809acba83fe042e7dc2cfc1a0fc62e31961db8ca5020ea95d2570b47e03a78ce0f60d248da5d2d509f0ddb2a1d9b91c3e58bd79268faffb3e4c7edb3552d170f25aca46878369ec3f70c2a1ee7be1ea739f8456047a89f5306c04d1cd3d60fc1672c29a7df6a05866df6d0269b4bd3ef52e473cbdb7004992b32c340326b0e66a0596bbec9dc0e729585ba90379d069f48011cc2c31fb84d5636e9939e682ca6de09837c90ac6986f137d49870393308d3c9c46b21bc69c1346368d03ee24670fb69a6d01d434764767dc0949d32478ce01ad8d6af10809e24b1e2eadfba60a42d701acd4f72ed23ba7f0db6588e21afb09be180ba16995184084e8a5499bbea0f680705e5c8101df7a098f49a434735177e1bf62ff83e7e92c8332b97e82e9a210b0ce91c20e73c4ace69aeb2a0157d77adf06997170b1abb19cd7af8130ebb328c016fec4d42e9e53529939894db10f7469d25c517f90e3125848823a487fb200c9b3b3249427f89aedaf22aa4d92db9fa790863097f6048a0c214930a049c3b3367f912846b00da62b512d281f82db912b0d248707f10737878e2d55f22d50ef514806f47dbbb25a66f83bb6e23369dc2ad7b919b9745e81d8bbe6ae162d6852fb3d58b0f4e3263b43b6317fca62bb506bb112d72df047523db0af1b9135f33ed0925c320d0ffb73efc21d30c64e939e8fc39432f067b54d30b94b6ad6dfc76d32a41c57dcc85ddbe416e5cfc70f3f13dd5998b7a741512bb5ac2f145ebceabdf6884d68d02a12dacfb134cbbaaa944753bc641931e2655dac83090930c8d0645b05eb05ceabdf43a715c1673789a00d4760de83b0c4834918cdd6937ce5be7d1b73d5a192b394149d1830658dd4ca18bbe186ded7132df8bd4a7a41e2dd11ab1503e49620ff010a24b1bdb1fa1ed59d38d74c57e8f8ce7dce09a05d43844adc011c5cdb422a241f79df4dc8dbf9d271c94a69aca745036417c874d38aab7dbfc8a0c7a4a1d6089215872477bc082e2a836bce8049f69eff7ddef7f54975dc235bbe04fb99ffa19de1fbdc5146433f45e01149b6ef190223ceead94ca781b425e81e379ab617dc6b75ff8873cfff321fff525a31239252edb48978fe8f41739bdf2ac9dab1f43684e7946998e0143f98659931ea4d13d4aa422cc0ec7e3b88195778a193ab5e1e133ca222cc95cf619829abf5e5264e61dc24c7eb773bd767dfb457d53e01be49a8c9bbe407689591851346b8e8c6487c36ebec815a19fc00eecb55e9c14ada6e8a40c7fca11e784996251801c5a8ac29a6debf57f92706f7e4dfa387a6a48949a820fb981bb1104ebbe23028e16db95289ef9f3e22c9d4e06e4909b4a2eed14ccd7f6f309340ac276dbd5e6e58919fdfb115513721b6dbfcb021a81f173ad6b717d28fc225857899767469ebd46664b494f306086e57bf022cfe73bd0a1bc329a2f71c988d2726a7ff2d8d6e080a234872af33b1b1c19407ce999f8a1ae264bdc089c488452995686d5ba5dc627108e1471ae66952e091f8945cf3fcc5f44a1426bddff497ee37dcfa86f2fa755f58a9773e42e87289a7f4c711692b67193b935f77270652568c389f362d8642393965957aa706007056caae75d3f62c709ef99668246b37dd1834c71c9d87cf08dea742ce16df0ed0b655dc73a83183430c9480e6930d6dd990a4712e6f9a9ea617eff75d615256ef288f6963d2e83851a1482fd215e1d629d51793dab9404a7e803342f50e93a36c29e493d0c544119fb176e86d64f37d241de4a21cdbb3f12d5186a7a4ede86b08782cf23927279a41b9aa3d090c6bc593b8a1d51ffa8387ec591deb9b193d526b6d08f318198eb202a071224b041fb98f6099a9a0aa056abb758b42d82fc1227efa5f45a0e925da26fdac3544d6e1b38dbfe3184150a5abf23417fdb1de7798d3ec816ac195000d507ab649df17249aaba5b91337d07dfc9577199960b31e12cd6b544e5a5ee5b4f8869a8b555521ba3ab428af0c2ea40f826e5478721aee3c7521775bd0e40122cb714c944c4667a1e957bae364a702ae93d1952ca049013b4bed928c3614ab0cd6b07f0dfd22da143caee8b3f1101cc0fbcb5933a9bc3f43274872019b22de6a3564a378ecd20a45c54f03ae46d8f72f18174bdd352d9b37fd433a95a0e4d4bd2229a915a928c65a97dca79bbfc030c915493dbf24e4a512cbd6c5ccebd42fa8452192ffabc5d8e684b21d4e46e301fa717d414a45d54b1575c870913bc95e3819b708bf30cfdd39e37c0543cf605b889d3cc85f88f6c8e1a4e7c6866032926761a792b9b6a3c6847027f5edd238713a7233355332b0c1e09c30ae32e612e0fb55fcb84a39b64a67abb7a44a170dca314007e2e2ca42c339363017fe244090cab89bfe994ff4005fdeb05e7dd90f4a621adfc0ac4a72b1ac53853228eca897b68cd069a66895e098f0db698c08835d7e28c1ecea9ea6bcab269e2d39f3f890f83e03089cc6dcfd4f0945dfedb38e905fe7e00e52eb2a02a7f9a9dc0283aa71a8332f34db7915febb95937654123d2ea65dfcbe747df551022826c1fb734cd103a63f27f19e78033d49d4286797261e2f0b0608fe70c5f0209218b73596082552681909ff1f6b523019f5daa012f35a39f08f15dc8078b8694c8f9e1d814dcfaa9a5de6907a8230a0eace8d1ecb794ab5c655b61f37ca4a43358a1e4207a6c636c02d36b237e40f77b546197c1fa574db1a7b39c5995a75ec93b72a8e8465958ae6e590f11d49331a12549c0a97319fa3ada0a1c890b07b72c216d4ae816b9b6d7d6c9a3f4a4f45df34b4d2aad2779e1bac7a63c3c3faf69e601d846941d30b0a8175833d59587fb556db9fd191f5eade5b53550a80b8a5bf17bb6cca59c7483fc974a77fc8c1b1931822d39132c93ea11dd80c4cbdafd75354179280b785a73a84e442fcfd769cccf7bc7600aafa06ac9b9757d1d7943dd86e93515e56d9ec4f6b212d18998ca66c903cba19e69d64cd071462c234bfd043f171010bcfdb789100619a2548f20bc5d3337366cde6fc37468d413e1f5e6130eb9850008844bb89c75ca7a0ce0f8debb409638afbf82c64c4d5b1e4e681654f3bfaafe574930bc6af0aa95996f139167fad56c7751da32424676a4d770ac4a1322591dad8c462a21a87c8a71f3806e494c86d29893596f7a76fda997031119c2ba87019a583feea46eb85ff927a993b19bf00d74609ee64aa92f9a2695c7fa8a0bd52a065555a2cba9d4383fb4d2b680e558aec7cd39fbdd91077a14b6a3f2f9b4d8db050346e48b4c0cb6a664766552116cee35998621d678452bb00bc7e8f0026ca3d674c581747e24d04342109adaa243493ce8a956b11c6df47ac6bc2a5ad95c8c47c89f0d9414e79278f81bc61e168229bd61b316b969d98c5a48012738ca28fb5eb6c26480e005df8dba1e4d47e85e491320847fd722530f2fb886c072feb9f79d45e5aff1120add834cbf2f9d335ffae9ec892b18f6cc335ba0ad48cf5b1b95f2dd389cb7f768a64fcc8811d477f8feeae4cb5319e9d59771b0f16ce95c6a656f4d2ceee941705da7a4ac4c4956889a4fe94953c017a7b5344adb1de84f49f0daffc88c69b7e21ba841804253e520807b8694985a3860db1cf6ff649b5ad2207d2a553f867307d8ec5656592ebb5abc5c85b667021cae2f45b2b1c6fa61ebb976b1187e8e2b92691a7ad33500be3d47b656f661083dd9e527a604bd4d75c05a4baa9421aa02d39a7b89453431dad3045fbf38530aff6fb9401155d4847f2464a8d97e03e9c64099843fcd021a65827620de41ec3080d87d2763770da57ab6c955d52f55e0f6c3eb752ee16fd74ca5b935a6b81421692117612f1a193427454b4cefcbd18f327482118b990ffc5de19c3fb7313ed8a144737f0b62c20bc5fae7756a56dfb16291c92d26079269074b20fab90a2440aaa960e0e218b0ba05f31b0eeb9b59dd2325c36cbb2d673a251fbeb491930566d5c3ae802b7fa51a3d01e06c188fb0e5e0aaca3bea666db0f1dc7070abff2cd2acbb414920bf838d28f3ea01f27e2534ee6b7049d92dc2ffbbd5c2788418d13f35b35d0d7a125975c7627449181743950165701efe489d1b17c621f00da444ea320dd83fed7a2db2cd569b01d424939a46fdb085664c3b752342c6685db4b43eda432816a3c28d2a5fdd44e92f97851c30792c8b2725bc73a61ae45e7c1f236e3ebfdcc4cf99b4c9a8e36ec51fba808e4c50190986f35a70ea06ec3ed2edc3bf5a5d01f0787c69b25f775086edab211cec5f17e58d184cca0fcccf4edba163991b6aafb4dd634990c2f49f31c1c190bf6071c28ee6368d230dc1dcf27ebe320a05140ef18704c32af401df744749c24e7d5bf44e60f17bdb9d1f4f54af1f7f19b8c5664deeaa934de79f77bfac56ad3c8372b99384a40e5a0f52128830cae25df17a36591cbd5069540bda3d6075fb8c31c743391746a6d96f5e6f19181703462b9d72dd59224bcdf423dd0a711d3e2eaa63cc4e666724a2f31381c162497edd66c647512dcd3aeba9e1744d524a8434ea6b2fa7e9c93f454fb4c2c8a846145d4f9c90fb485505fa1dfa2e6caa466226f73781cbbfd434c588d0998863ae86817d329124e63ddc07af171cd97d59e4c87e0f25d1de74723ac66d496806507bb17679d0bb3c4405b625725bafad9052f8b5bed983ced95e3cd944e0c8994342772fac40c390c9d3da1dee34f4f6831cfb89d4603cb879073a1faa54ec72ff76c8cbc136cadfef0fcd04551a254604183d353796bc3f4691e4f4d4bf9a0ed1efd1753f08f4017d82602f3a8ec1db33082e9f6ccbec0165c995cff342b694b74c155c8d7de4cf6b576775d15a25954f45db004d17a9a8eb020aac23096c45f553968942bdb50e010e961912630e53abd5151a8ecdc495c6a96a626a32e8b7a56d8b0dabd6ffd03eaf88a64b73b8074b7ee1b9f5cafd1052d02221bb1679bdd2e3867f3570c420caaa6f0d2c61b6f28eb52c14bfc63f10a31f0576b49b4dd38bf77765abf0e09435949c57f5bd0d72f379470db1ad129db571bfe92e13694e9dc84ca0c8f78a8a9f87ba5a22252ef40f2a9b6ff82605861db7b46c527d42e4f45e28b2927c76eb5833a27c439ba539e7d3081c660b5a13622496060cf38e06ea49117f58e8a49181213ab7160cb49e52f45508d8334e0708f30786f5548f0e081d9000d36eed2c52b720fb330eacfa5cc84e47d84fed9732ef178ad15c4e8983ca2ee0b89a3124473b88f932caa2151918ef0254454ca49dd612f25c7adcb6df9a61580c6eb0b404cc615c7f584b83a43956642fb11ed090502bd04de2a74060ae37edd13b4dc89da1d07b0d3d75444b784b2e8012ed05b655aa09790ada18878737e5eab52e2c59729c873934799c43342d54e2fb79c96f959323009e022e07d61834a1e597ea66b3829e77c025c68583de2f1a520992d31b8fc168d3093fa73220f659eb7801e48d178f416bd57bbb0fe9009aa855e7792cdc56a61bf1567b8a30ad3601e6aedb55f4cebdd61b339171e234ad4c8956bdafe57291e6c242c49283f8e033a9a6bdf2aa109f4499d43c886caa02eb7b4c35f8450bd21248d505e0d04b8a7d4b49ddd299c29a7170d58c670cc2ef590d91f3f9c9f9d8fe46662439d49f7d03b7e9b7608ef26a11e51f242175a3f14cd0148bda904a927fa4b0ed607e40923c625b23184fc373408a6f03abc7c48d3a872a34b217e3eda2581f99e3fe78fc09ca1dbfad2e21ad75cef6be312b2d976b913a22c360bfa6822c9e6d109a43228ae1f9d8d9e3f0e54cb0b0ef139d385aab1c8b4e6ca19b1918b90999772adcff159267a177a2ba45adb1236228ca2360e44058cfb463ec06df4725714ae09a17478be54c91009bc3eec83ea08eb767906b59ea00314c47ed1bbf90cf427ee035e9ec8ad5551709284b9e6d2849486a0eb2bc693d9d1d885ab1f3ff5a5d9fcb2990d11c5e4cbfd0bab2ea49d80d727f3047876591d8889efecd2f4f8a17f495b926557dfc6b280fc52b299e4959d4f50498926bfffba75b02effbae6420d84fc53dc95243e8ed2d21fd21dcb83cc9fbfa4c0c13c76c6e9cc07c285143d1a7185bf1cd11aa5a55cb10a45b84854134366bfb96d370a206ca71e990b2a3b8a9d1dcaeb2f864c770b56d86a0cc25af4cf25fc64fe49abaa1e2f127a77dd68ee859d16dcc572e5447e5ce1357727d35580f7675c04b124b54b9d77a40175ad47e6241e19f4e859448cc7bbdd63100003da5a567c5b9930655310d6a862f2db8a09e2f82c089896c2d6fd7440c185b1077cca29a84f7bb2f5b3f36c3a87031df643c046ee766ae2ef6455337d2eecc97bffe7b9aee14263a351c21fa6a814e86364be8c74e6e7d0556eb703875ea05f49bae3cc2761d494673cbd019c244368d358f694a9d461daf83c3d9593054f0fc195ff9b345fd387eb37782b548b58064451ec4637b382bd4551cd1bd42d42486955cbeb6cefdae7513eb4da7f14ca39cf067b66542b2d0c8f38312e559c05f07b11b1451434eac495d34b0e8fa10dcadecc3586318374d2367f8d8f10426950538983da7878118014c3687ba0606df2158904e9a2f5fe016fbfbf2519cec53c71a48b28b5a1346fdaf46b6d5a57bbee6edf9da6c67c82d72aa50c21a770fa8599fc53a780994ea5e9013291f41a6f61b6a1daa8799e6ed1d411af33cc5360107d02ce450adc5464a4488af438625a8c055349ee18a9c89a26c0216c178078a8938a1caa20aa539b8e09df06e2b0693cb768972971351defe410269d05ba97b10064a32a74390d77a7c903f472dd52925c553350975d4ba9915e2af14dc3c7125ff6a3fca3f122d090c88028c61bec684bfbda3f12d3fc6c35760b9a4a2b3f29bf7f5c4b4fb797d8a65a643df518bfa142269b7db7f72c9ce118e5f301ed30c36fb35164c9b83f33008eaec8f324cd38cbb800dc70985c0353304c1002f851d861a0a47500bdc2c66233d78423b70b085b2270a2703e0a8b974404f77ea0a65220fa18056de0a52f0a44a0296ca9b86f5cba8f55529a7aa96aa217efe0946748280befb5b1335b7fb44250ad39560e7dc679c45d5096f8e3895db765b0639adf780fc8209694ae972c71a7629e8177bfcc3b5ae841dd14c332d329586153722714dff14475448eea998095a69c7e45a57ecd6542e86e3b5ee3ce2e9b5ca0602cdace47691cff7cc67d3da9bb9279c7d42cb2b70964e76cf5e8b03c0863084587bf074cf7d97e720780103c686af9e89ff1f18b4147b11df4a952c299006ec6bc38a5b3d6e9d99e454d7fdddc8c987428b1fcb5d03f079cac1d977f37196c6bd811efe682a9bdeb9aa29b4eaee08d7523683bfbdd1cef49f0ccb3af8fbd8f7b44b1a8a9fa6a0430b1cc75f5573d993090b7656c79b8252deecc0c86cc250b5377e68fe8fc3acb662954e9250637c5ccdcedd6d09282bc34caa0c70fa7008d3581c4e86ad7fdcbcecca22d5a25bb85b1a9e8c7afdeba57ad135850b7b8b93be4cf46a6b08130980ae9bd9172f9457c175cf31e213a10e5826b318b48fe5c3c2d8800d37d9cd06b9648ec2d52f7d92652c31aaf9e60004f6dee0ccd13989d0efa46bdbc646f87a26b3d453d86f402d8c4be2fc77b11e5ec8ed643d31a9ae7a99454acbe9384d16f046fd7514edab62150786d48b43a0478978198b09e2f61f6858ab2b41c9b441c46769cee8d451cda118333960d96b9ad97f652086ece71d74404ba994a45ae014663de70de24a40f790b20774e9836488e219c4739d621dc49ccfd33f47a4fe01e390d28ebc3952cde8929e7e96e27d02294a1dcae3577e8a5b844ec8f08930526cd62e8425fad72cd3b0f6d2424704d5061ed317f67705b5972c964adb1fa2ffa0ea1dc8b5f7d7f55fd42509d27f52740ce36ce4552d31fb411eb92ea8e25e7167c5210c9e870cd3ea5a10db117d10c35973e69933d09b663b158d9a7636beca764ff3d50311ac5c23fcc829a6ca1397f28cb1a5238e1f68c4b193a00ddf194d26ae092434824bae79246963530381c963119268084e3e0dd9bfdf23578730e801456f1c8e172fe383a4ce0fc3682be0e533459ef680d8f18f024546e78eb55ab115cd41c5b5079bfa21e797f24b20258a0c2c5678659c618957ce8bc033b6750a297f8fbe0e38b4f55b6e9433609db6cc7b53bb17f9754f79cd3920fc1a5c942e44e3febe2e2fa3989eda6b132ed70978480ea9e436246a773700c6728c2858d42edf4e889a221384c431f5ec10078b49631aa3d90091446dbd87105dc1490c37d5aebf32360b9ba85dbd56bfc8d3cf264d2212650115300aa41f305c014611a9a40569fd6d5ce4b5ef61f22b1f13677ddbef22c4b9dc6e6bc319b848842de127696be0f36082ed14da69eac96eff84e8e177943fb8cf21dcea8c98f8e3fb1cd2e04bd918827b53183a61de4fedbfaf7d34de544389227f46790a65502bba9f23273e80df67f987cecfb656113e4ceaf030aaec835b3dbed8e9455cb287a8c1dbf928b9964ca7e39e1d5976efe4737da7489308a30f1051731d3f4413ee4132a26ff09db732c52ed3c2a1c1dcf84753b5b6afcaab471fc4d450e84dff42c875650af732c041b34612557998dd0a88fcb4c86bb360dd663b55d4bf04c06f0c7fcbfdda0348c6286707526dfd75b95d53204c29dab0a9c2303774bc57846703ee0e09c99447be28bb89ad5b45a1d5a63ecf65b10c61b80eb8b95cd2b5578149c6cc68058c59d9721751736469dd63ca57fc81e7c40199bc46d42d9c436f0bef42f94c1536d4ce83582ad7f38c5b2a766d242b93bf708d244fe097df54df819d35a86c406a3651bf309661600c8b1834e3f8528959d0ed9bdcccdae3b9d1a162c406aad19362db127cffebba1ca4a7b41ca647450794438fac4701b47546e5e0cf2f41841f42ae3ff83edd9b9465934feda5d7c8fd5a79cdd90b9530e58a4f27c1fe2072877e1d0f496517be8c4bc3cbebda9b3250833809b9671508d4b69587957dc690bd755007a08a420074581b8aa4c49d74dabc92887d06e325078a765154d84c2a7a536de4712d1e3e21160c92856b08dc580584559a5dfd5e2170b1281f6888d479f3604aa0715fd60a18194014f885473eaba63a3864f32d1aaf31fc9a306e56fad3684cddffab3c192ba38ba5b0ae46ba2366360f8876249a040f8c030938d79d66a6602e638d7df6587958ccff3b9aa29f623937198bffd1d59f749db4ff346b0a6de537b240f5d412eacedfe95bc40fdbd8ae738ac54e2a0d0b2bd9054dbe7fbc761efe533caf31639b858b486bed879ed1c63a9d3323503c6fa5710c1cf77c3f9a6e0d029549c9f6f1fda423488dde0697e116b598ac1b0e92b102f79e92750762ecdd698638421a1b702affd39c661c03b4478c07e6024df95f0c5c4a5faf2a5832b75b46d5c052ace5ce9e7d59a4579cfcafa5e60b8c3c54bf68c11be63c48e2c173fea0263ad5a4070443b5c9d52be1ee98567930a654f7e99486a028ad4ad8b6786168f2a8499fcde1ee50eee4c4519711467a50c5476a56ee8c4999eb69cc0ebcd27a7a1bb82f2fb8b4744905d1667f152d19163a8cd8550c88ba5d071d9965188b97645dea8bc1197ddde5e804d467f1a37478d4918dc0a78624f627250d5a2d5054b8b1631ac665902d93ffe481eb6b2bffe2394ef1abceb6eeb2ebb6fdc944891b61f35933a39acd221a3d34cd22fa265bd3ae8e93674c6e621a37d74a6516fae00635c7238044fb20f5e8252f2b4ef75aca8fd646b92ab69016c701309041a174ee16ab547aec181c2a2475b270323b18eaf42a7c5c4bb493e8601020342d434fb11bb3d5d15624d1407250c1c114189033deb6295d095f036ac553cca8eae709d06ca2c9d370274e6bab998648ba94286e825088462dd07c8eab373d26e5c49d67fb0b6f4fac1e46fb5644a593d54c45b976886e73eb4d44b1eb7ec8094128d6e1c0279122d181c22afeb2db1db4d5ce1b398a46479fa031b8e2926639c3fc1a1aaeb2e8143c46e121dde767d26dc3ab551250f7aaf4f665a43f7dcd979af7464ef4deec4291b76098b397936c08bbc8acf4db207d6e0f48491bf98cbea76cbf79a8ee44209fa34a676afcd5a519879c6e55fbbe070e7ec45a49f2108aed089d8e2d9528f7f65fde37444ec5980c773181d38f33a12651d963c4742fa03cac80f5f4f6334980cc676bbc08200d50d3282da499994f56f4deb40004a24125ccb3f5e8932aad86692c41b59fbe245e6ed8fb55824fadc4993e48639328bcffc8f1d1e3d3a9f7402d66106482087cc06e36c0e642363afbff3a4cc2e10e72a617b93b0e8c5e4df1505bf912e753c3bcf6ad1a3b080b48957865893c86479ea5dcd1d545c666c1b08768cb34e853ad6840d3368ee221cd89ee99e59d594078d86a215a337e5277e38f8e8fe7ec6f6bed905614438a8a413f7c58fc46d5a7763a034155f9135faac6f69c94d53b84b8e7fa7f1336a2f6c2daf525445f698ce489c6585e3ea11e94036f57095f0c4451706e21508ad3f527a94ead0be2664b2e7ddb0ecbef2384e48f55f223653c4676e4acfe7f4c0881ad58f22ea27698bb0d0cebf6b01c0eca6f598e3cee19f92baaf80e3f026e00b83fa94eabec25e45f7b2dd17c7252afde7507e14f41dd40170e9336bbef82dd80112f30a09ca0e5148c0c1b28abcedf6f17fe56989a81e0f958dfb97d24f6dfed3f5984d0f2074362cc3df0a6fc18105298107a12e01ebee2b58847e9bdd3d6f6f74593f9bce2c336c6149b6c7c8ce0d95c0ac251b990c69eb89eec90ba3a99533849f59578a9d2e345cdd79d571cdc0fd8030019082818b0a2ba87679ce3c05014e545c17bce6aeaa78fd08f7b475ae5d07567befa4fd04480905b5d8e4a3a2e748a4e4ceb73d8f4cbd0c25e1574735461884ff5bb46946a90c17eed95c92986a1562d1759d97f69509069fabd093c3f9c301f4d0a08668ccca7bc6fd9dae29400933e74e6bea88a68469156291de92b13a1fab56cae48fc83009d7823e47d8ebfca7bae8f4d15ad3526fbc894d6db4ff0f434aedfaea7e22c83572e730ed618567590ee4dca777cf1f9d3dffa9feec8c44a00ea386f0d63b44c09e53764e68a67020188c950bef78497afa2379215757b734f356f411c153eaf6a5ea2e43e451803c7ffb7a98ca5c1f2f19ebf43f38e1189b695902bd7a9b088f5b139bd231eee4824e18571fbde17b8a034579e0bc0586f5c1a8e9b3102cc73c9cdee7ee47de8d3e9522fc8dfd2adbfdefea1779a10348ceedbf82e9619d3b001d019b705f4b69e2d02974073c3cf753e6bdd2db66961dc859eac342663114fa16b4385f6bbcf523525c581dbfe51ba2b10468f603b6b2f997f0ad4e2592fa8a1c337be5bfcc92eb7a3bdaaefa7242d044de29f0d4ca7ad15c0683c0192e5928491ab691a6db31bf4e5bee3fc086b10f615e1dab1590859a2e79263a0df867a7bfc98b172d702bd0c65623d467b45f99c26501c0a95ae6fe2050a251ed067c235c91c702ba09dbf6d060f7a7a6917010105df21e58e7a439bf00c352b1c78ba1132aa45c8ff0f65128c916d4f3b7cf3e6e9f4228f24dd1630341c088f53b1e8a12f671ac225b76c5181c1c3d3b283d597eb5fa6a257d0f0ea2ed1f96e8fdc6caead8efbaf1b66756204a5ef48264a97e50ef5ceb4c7b67cec2fa25aaddfe913cb9a84f5524db2498cb3e1e08c90544a692b9f7eff6bf6ae67792049ba0ab18c3116096959880decf948bf5daeac97a65e49ed409fe074be8af9952f867c76d56b7b2a1f7d690990fd8cc20613035503e70d1f2c8f79b68dd72d29d7812b49a9af8c5dcf934c3bddccee7a0d15eaf6d7e46779de989fa2d36e15bba3022d7d4d3fa0aa95e9548e957ac52e576558acdb020def084716b02877e654a14a218e6ddc75ddfd9142dd3f003f7735e8e9dd7293ed8cfcd1c6a8c46012567d2db100a241540320fe31ab1dd58b387aad0503c1e3b2e9c92481d65d006610b005fe8c9fd3b20b3a290ea457c4940404a065766d54ed35812c002546e2f899e126e0263fd4a84d25cd8a930af916e6bb8625978bd19d1e4a85159520fad65d75703d3435a5b41b57344b7e7ef7c0acf421308cb3956a68ac18d0047893a71085f508b63f1d18253fab6b0e0e1499efe425eb97a6a80cabb56dac5053773e821ee3ae07542384031cf862940a19578dd6dc6331ce7411fafe17b63adf9704db112a13dfaca775a139eabbf5fbdbe5db00ee482b7b0c476922cb7f43703d259d4ece7b46c63c2a7c8c4cc2287773d4f20bfdd4574d755b3aece2e97b98dfe0afa607c7f5a9e946e2cd44bb1a2ffaa8da8cd4e5f2aeb6fa4ec74db0ac75345ef81d43f85ceb6ff95fa3681d171e0e8036f586d73a38bdbf646ad11aca081fb00b50a21bf65a97e8b24cf03662dbd7c62f6b11dd159fe4e56c112b8497063fe463a37c7df756e88adaecc912b7c8e5d913d10cc2b194ec744e44bd115aedbf229813cfb768c67cdc8bee65f1b36c8eb61254e87eca52824f9c8d6135401cdcfed9a3a109d17743eefea00bcb5f95ede911a8e86e5f4dfc13f3cfeeeb9ac549aa16553384f5897f88d26e1735044fc4145d7333462ede98792e462ea6b64b11d3e7fe11c6c7c151172f390853165bf0c5474b54838177cdc0466f5e1b3525360dc41e5283cb992e6a028cf7f6a86cbe11b03c7196dd6385946bfb8b7bfef69e55af187acf291113178b014058f439e191bd7af5de4ef5684afa0a34690d35709e60564f4e237a772b4c2e460af7a06059a52695f95e749ad7ed6f1b337381cbbf223be6770691c5a2d76555c25f598dc215c58a8168723a187cff12a1d95754434b5affafe056f29c2d50569bec1df92a9aad5a36721d9fd812cd09c730c48ecf8f0cf2834ac790e5d69ef7cd41e8a491be931eb7177f66c1e6000d639b4905b40a050075a2332d38d9660a5396bad5c952f663ef2234d198971d5c8022a3dcd14d34c3638afda50898df102bc584189db03256c31fda97202ac9afeed33b97e73d91f5f0e848bb2308256dbc0a3dc44396492bea52cbd4c51023488ac8083f5a471358c2a534da0cc62dfa95bb0fbf96d6f198bcb43a3799c288ca769f2a650e737566d79da52bd4e7977e91496d0308f7c329bad8035c6b3bc7d69cae5ffd13bdbd4f97870adbcd1cd627297177332277afacd80d11f85b47eed6dc8f5c57b947c411a6a973abd6e8442f2e8e072729eec80cb171cff3ac00cb96a16c682fea9b9eded5ead158af4f8a45da5ea2c1b07f84a56a2868b4df45e30643aa530e761b5a774def9e1e48da21953c7cb4af333395e67e8593519475a46b362d973844d92bdaa8e87a802a96536f3d42ab4e649580821abb51ecdef0259d55334a5f8b70c6b0cc6aebee71b6a8672a857f77c7a9f57868f6e2186128908ef2cac1f2b30e7dfc9b6281a1fc31257b07c5fdf2facd51c437011103e7c18fe14c26cbe8db01b95609630be3a0178a74db055ad94f2407f6273ad7b4d8237ed4f473b7a47d474098c2e6f0fc4a8f908869d6655564af0fbe92a5551eba9fa792c5f3e847914e933e024d78c30cf74c510151c5bbbf5b5e7be61926f10e149556f88468f5c75d4f118ae32184633d2c5a30fdb2fc52b632d86f11b655d4426656f6bbabafeb068769dd2645cb005892bfbc1bc8800361b735e3aeef4114124e12ee3401112837f1659e0c5eed16cc798fb4ea26ec4569ae031b51347fea4ecf32b43fe7aa1f88476fd0aba1a04c3e6c521248aed4ef9fa965e53446b209bc7ca6fa85b069e99ddb42caeb6b27ffa69df956c8de6e3b48ec1a935efbb6524cd41fc3a0cc2edaa16bcee8d86127a299dc526a71d42e945fe54941b48113a06e839393cf44d28ca31f082d80339cf4a6e02cfd4a5058aed25a5f5057d7b9e0c361bd9b0d0aa074be3f6650946438ff89900cc271512f721b58d3f1722008b5283dd362ba8cbe6ca0a7d53fbcc6e8f4208ec3b4a1d08e1384127abefd5c2e30ae197ed5847765ee6f545c4ae760f2a17bf5ddc2031b9a2c53c936e60cbf7baa9b09bc7f333909a650c92fcf668ed4a1d16f1f2bd0bbf1eee12ee34ab12d2d0b9285dba6c7fda0a6736e8a7f006ce91707b4d4cd6c7af36ab1d46cd5530ad4d8a430ed066b7eec0053a6045ed9393b17ec3fe953ba00827dc41ad1be1e700dc9baca3be021427be5eb6df182ae9d782de94ad171ff47e128b8c48c359b1ca8ae2b627551ca3ea0352453612c7210346d55422da4a8abf1865fb77d6cc56751314670cf24bcfcfab2bf789b67f4494813fc5ff079883ec54b2a6ec878a1940830498918ad1679619af3d2d3e2c4d9dcdd684b56970bc883d2b265f9aee5ac07432cdbd77d32bb600fc428ac3b162459eb6b755af6f2922675c350faa0c5558a19ab8b2ad0d54a67798a352b47a0c10507f5234d54d1f069d5dbb47dc36795d0a12832a92bd447bb02fb0139310d22ccd5d4757949155543a853378cc23b601ce4194d65b520cf883142522c457715a2e780b11582faa45281b69b491de56b5468e179c494d10750306888948e23dd24e4e6faf1953ebd2e6bf85981c94f07760c641e495ea7b9c2f24a174aee874c75840daababc19304dfc896a396c5f012ad1d6a5bffd235823d0fe6bbbe9d91e798799398bfd5c97376ef336ee6fc8cd132d7802fd88cc1278960f9c255d3cea446289c56a929c5a832800956b3a6eb80e5af85344c50e4e7fd7b1517e6d84b54e0ef263ca0ff7ea800328d8f9947039cd97169738875ed6329a6e540fda5595039855952c389490cd2aa172e50be52c7976be6fd7a33489ac83a66ea1344b263a2a5a10a0fc5b64d6d1ebb8074945149ba76a4069d2941a191b7f30ec72a28f5603ae9e8fef751d4e3e11c3400b97a754a8ced6eac29db672db645f9180b8e9907cdca585b629b94837c2f70aaa705e18ab157ab0ecbd2326471fef6b19779c287d2494e12a77e7b84726d30f60aa7c324156e477aff4b88c6b9d107a4fd36b26952e733d784749b7d62758f0e9fd4816feffe727bb6fd9ff5fec01b69b945ba6f0972a0a0cb0495b41a412dbaeabeee982cf189239416340c47417561cd3610f3bbd470aaf313a23a6e82ec28457bc30927c277f80b42d31225683c548d5c3751e46c6e1181a669d4abf92d54452ab046ab3c9f68038fe393c9eda898dec459b1ae853a1edc12e1b1b7c87745473cdab984f0c8f4e4e0c9abd58a0853cdc20c090e0e944049cc3f5b1109156f1d16d76b20fa19db6cdfa83eeae19fae8656d989777c21598e818b1e02d423784773b5c549a6120a192ee4daacca234b72e86f8610523700bbaa346a356a0fe791894f3bac11f27a9f2875ef86e0c525c6b1104a38ae40c6b89dbc248e9c15e3e8126192011eaa1e7faed5c045c3c6b0e4a99c57f375eff8f82a4f68b4169c5d54ea86f648decb74aba688fbe97d674c1d8c73e550c46cc1313accfb2a469b057fa82ee36ed6244494e9ea2716323d0f201a97855c65a592f725e3a93bd9200a8ef5fa26c110ca8e693b3737cfb7d6bc007de56153f61e7001478ffbcef646713c7f59da8d863b7c6c1e01e7e63c8788958403de104d329f1ce4ef07d7deccea85cb5dadc26871da5a118b13356480ece4b098fa9ea32ed5bc395bbf80e07dd9ad1c7f8e7ec3d5ae00c0c1967eac965f25da769d91fca6eb4a288570c9b80acc88d54178784956f562ffe0445282a3731148732cb90684058cd2495140f1572657a95a14ede51eeeaa713352d5def141d8e0537d42540e322d3b1949e13d36cddbb3a0744fed7a0da55fb188343709d92b79b03e6ea37859128793234a37aea757e31c9175c2e7fc7141623ead8554ac0f793704561aae310186f95e0b33311335c3a9a31c7c9d816deb726fcaa4992d13ff2cedb3d43c8eea0c32127b84f82f9e74b2f836cea3ce0646304e849f54dffed5e8ef5e50be817d185fb11d35895fe54839ef3e4e342a16342ca600ac68e7cc47868d1a9b709d19df89bfcea3cb576276952881955363fe14119b1ceb5f8885ae52e52f7388907f3346f657ac6473ae7bde506019d5b0e13cce02f7dd1552a1938101367218ab480c30b124a5f7ed70afdf7c14c0d04eeb52e8995f8744ab2a414140899e7b1c8d4483acd4e322ddea2ee1d4b3023998c647b245488cbd08a7426ac4e2beb3d07cc257daad514f435d5b3a07db67c2a9b4f08459f0f934a3af226b012716f25bcca3dd2bc4e80519aa7d6fa5987bdeee897a49a97e816d0918d743b7b72bc347f7bd111ddd2f26f0970759c31d88fd06a46819d8b46c00d252ec247ecc2350bcccc3613b049a1946197eb7ffc686f400fc3d7a8274ef4c639cd263eb18ae02f5d667e364d329fe275aea019862665c2ccf1a2c8a9f653f8dce2eaf74c25a778aa8d2e21a324b0f46cb947fcf107dc307401f2d28d48a99685f47d9a07632aea86232aa98ac54b90f7cfee19a82eb8f7e21049c8c016bc60945f7e20a7bf408e53f54bec4d0bd0239b522a070ebd2ed71c7bdfef45b0ba4379ad49bcc4bc22f7927a374b7fc50f1db64fabb066ac11138b77305fe97acdac2deed7541d409206afed6e0f03da3368da07d85d6f9c66a4e867c1af8c398aaea27ce62aa99849521350f1cfeadb80bc6d486a17a1599a706d1d89849ab9bd9cc6a4a3291590f70d8273417c6f56b79ffddc0559a0a1a49e010757352bded010d9a2f96d065ab2dbf3a3fa90675099b906c1f3decca057a033aad9d04100e803c846bc20e6f6c4434e145a11e381404d2efabdde245688463f84e818318f8afd5a43ed85556d7d28f460b287768129e6a536d7bcc5385c2a0f8b2d9c93101f008b81999497c69ff5119c42ced5a298ee79ae22e7283d597c29d085d0f1cc0f99b155b3a14de94980028998f45be68cbe8084adc30cd750db0a6712329589b82c7b290bc26d07f191d0517788986c066bf4ecfebec062665f5110ad30c1345accd35f6cc47f8d49b76a480b373582acd29822a7b656704466cc33333925b890f8ef9d1f568c0419bd87330c46a8a8192e9b474786d11f55c9fa06e4bc0b031ff8cb49d5541f193f5f58cb762ea6c7d3b4b66fab66abe0e6f6b3a5dc3c11c9a1f961b37f848650b8f7eb57a9a7a51d3a0ee73b86ebd9f8405d4def0870d58ada29bac9d09109a9b45c25fe71b57ca25120dc6070f852e564760481e664d597dc5fa670cd673df17c628140fe22a58118c680a74afb3d7ecd6d0b44d6be0cdabeb506ff8e0ead6bc1b4c736628cf30766f37899a1fa92914109786980c3dc0b25f882c9785169580ec1e9fb53286b3f7daf59d6a606f0986006316e559e4fa931de5036a45c870244471f2c55e6ebba84cde5532ccd7b81b61278f1f894f44d05b274d196a5d7bb89fa4ce9effe7aab8970d9dd341f912b5f13166bb78ceeaf365f413441da5970100eb21e7acd214b77762c527ab06f24578587655c14e3627c39e336e3a4243fa2817c38171a1ce9e225f65036ee26dda44c117c081fcd7c1865e5f8534e860eb7a34f9f593dd365c2b06eb8cc2ba57c9a1ac76838b78c24c494a1eca6732bad610f1aab64a861a48374eb71d1eb29a91c2b7620bf5609e5fdc49615c84c0a6919f42e879082cfd9437dae452fa63cf441ae6ed62db534b2f430adaa868969b9a7ce6a688a0e162060ecf777444442116435a410b4b6d09e975cf5ea27b3ca531e3c39fc7c5245beebb5af9f8ba22717846b6f7c4c61f551bd807664263ab79b3304c4c502638cc6582ce5798ca5e3d38aa20cda87e816121e0c159b55b6bf712dffa1a39f90e19f1706bd77e61a1f14d3f7baf51796173a2c58c8dcc39235f93bfe94cb2d1aee1b247feb919587d06865a89cbbd1c5e04425d390ccecd35063b21f05f4ee751334720a31ba09730530a276dbb7622c6a116552019e5d3f555e137d72d6381f60b7e00f0b35680c4ea55d452489c9fd9db3a259b5f2ac5bf23e6b93f192f67ce08d0ae36026701eb598eb2034a2211e661bac76532538c33ca160e6699aa3d43dd673c9cb885c8922e8455e2c1d0995457c398b0c0baa116e5fea3dbec2d3c114d98b3136d1e245383995c0432ae1f4c380702d00217d265a7a5ed1567e7a904c1015888d38654c205f9e11aacc6583b7bea0a399ad027455f271290d3b62556c497961b5ce028170814cfd4de8c8775239ab57f5f89cbe356ccd2bd39a94d9acb87ebf023d810778773695474a67df5ba8f2d66db0ef8fbfea7c8ae1f783bbebc0ff57b588ff2e2be0cd1b2f8629cc4dba1c88d7600e46defc377eb3d376d70c8ce4b5027eaf01dea5b3d8270645fed3c6fec00ada112fea6b999434a06171fd5b7936d426d8b0365edff54f4709185deccd6d13966d9282eacd3a92d8cffc213d415ab7e363432534e5d60c32c038707ccfd3e8d88ccd06d5b9e4d6ddbff0f975fe93882926e9045c7737a6433dc88523bdcfb5dda70f4fa5d7ab52df83d93b5ef368a9db3e5d68eff3192b999581dda0cc5fe56c138e0f6d0362aae446d3c3eb48969fc58ab56de660e59a5c83b053757ec65d9a535f1372274682f1a86f07cb5eb3081f4de475de5483ab574cc4067f6eb4cd17b977e8b1c8a3a97a6f95df85833b87d36d5596ca62091a08108d8e9e300d4660d80e4f1231c5f157d49f6eaffb641d1a1da0ccb9f4b67a0e1afac2f54fc47792b7b899a09c5e571d571b49e8620d231de329646ff867a44c9d468f57d7fe6f57407a5f3e66ab5c6623a3c22f040fe55cac1ea27c81dc874175b42b8d910fda1fca7efe2ff41b7d3ce5bd2a00d94632c2f3f47403920dd1ffad7729750af841de6b70fa4fd2b86adc2c9814543db9f768379a9e51da8ce346ae5d1db56c18a37def757939016d49def1ee565912f066d1e33183f7110b425cd38c5c77b70eb6e0d8adac563d77c630c53345ebf260313a4899145623f6a2d24f266f1e20350a8b50ce2e6ae0e597c7138e94bcb0c14f3881b95f2624e8ff26bff093fd1f0ae65a97725b141a9fbf434a55f52a35c6a2bec2b646526f7871a2bf7e6a0dee944e6f3d66ddeb2fc77bc1bd07f8e56e5b5bb29b382a57e630fac03a3674a8a202c7875e50bdf70c50dec7bd818eeab970c4aa1c2f5a4b8c9c865c7046c5398abdce36cc99f52c3701ad189a9f083233c54a3ec0d279021f444d8d10eba698ea8ded9067c529f2c32f71205da1f144862fe2d0bd24a2934d644d9c1f386a99666125b985686b80314e06c699f4d00156e45150c16c78604f5df902a9077f6167be80d700ecd1d2e4024c5528434f89a55de305c0ce403e5b5e83117d155682be3760708677f2dff9d0f8c8d568df038bb63245da1aee2ca1b41f7f65f30c3cb13c7a9fdcec5069a6f76c6eb6bb75d6631781f67267bed226f11bf2c000cfba405868d634de33f4766d52ea53f42d1bb961057c537682e90ad87ff682377b0514ae14c3365a0d3f01c5d55e33c7bdfa6bfc80e15412537cd6e4d3331c1e32c88a0de4bce8a8dd4e4e99b4383fec62789c78fb72be67ef38846a2d6e6324f9ad930f80ebb519371d188d4565151e99783d04a835681608dcbe4428b802c32375ed7e4ea017d0a8246a5cdb42f0e575b6e919b0fd670e8ee1c4aa9728f27e76d0a24690e693fb37cf19507c1feea5c1ce65162deb3ec3e7b5924d011662562b1af47b7d736f93a6521ba551e5a45e0e7656b23b717e0d181af1b624a3e1c84dc83ddd10a745842a8a1fadf4013400335e0f3e04b1dde34a3d4ce226a9f206f47b946bb026885fe5283728f496ff1410db1f00551df150d7520160c8488f24001d8915f8f54bd3b53a810468fad0a5f1c8b174f1223acc5b62507df3d027f50e8670bde79bb6af39b5dc2b3f41f9a35908eb20eba695b970ceb55276cec7712b250494dff7082762cd50cbbe0d33403d4235ed1fad5914155183eafe5e2669f0aa57d1c41416ea9f11883c2c1250bc35fb6d264010557113842cfc315279722b555b305248ca2908cdc7334cf9039242c83eacf8b393f0319c94340bee8136581f08ecdc94dd0155591ecf2cab4aff1adb9247d9ec8662dba271d43432d2d778d62ae6e585ea78c19fc01d70782395b70d85c9618bc2cc55d541e28c973bdeef507d4f436045b977acfca98e5df3b334a94df71af742242f006e0184b37b4689af2911305b4955de235cb880f3dc17bc736feb5135bbb62878d90201d408d340d6dfe38d84fb115f82b3be1917644486bded45ed24de807fa84ffc54bfd79cc658d6adfaa560e256a259d2460611faebe6d56cc891d929618453c68f4cf7d01bcd923f047e48a1b263027aad2156045a629ebfafb9fc02c0cb23f4753d6a42796c5bd937335180f7d1f0f4e9b90cd7d4b69bcbd98dc3ddf8bc704a87807f4af63e0fa43222341191c6d749e0a1ce6424c8f3c9ed834eec90ad29e3738f07621ca16409800c0547ae2d86cc4f01b8324689fe19bd262bd0cc14d1119c7a54bc5d23051aca648b0169146b28d6ad24bc6adf911adf495256e577b01745b0081856e58d780aff27a156b1af9c2725b5ee75d9ff702b8d4e72b1c12f2cb25be47fc1b51fba0f6c670fa8deb7b9fb82971534c703f1b69be411ca65ba22ee31b525e3e4925772fc2ab681e808469d395f023906a299293694221f48f518db4f24ec59bd974f577e815accb6b42d0b16498004244e9ed7c8c54bcf095e65b1ecc669ff77e2fb7a6c45fd025e271738083d07bd6a23f28992c0bf8e44bec1903c965bbffdf680ed481b05c3c2d88314a382002e5c5920161962e4a659209a3503533c43956d49d76d3f47d4daeaff8de43cc8038b9282c56e15fa156f4fa28079a75c17674f89315268734a049a946866d9686cad665fe250715dcdc63c4b62e533f59bf81ee1d222a6d6b7672e75b6d545e6edaca2e78a05f3cf41155941d11707cb5a8f59fbbabc5dd5c207a28f47f01d220eb89ab3d6dd1cbdb49c2d4ec73512a3673b65366c45fccb4d50575f000c00cbdc0bc44de06f7083d125021ff39220489804723f01b1ab8f5d4f2b0a995016ed9374090af8d1aaab69a9f221aeb7d4dd47ae3dc1c8d11ef2ef1638026852a9f6427fad6f3455237ec102318804b78a2aef0fb75bfc2f4451ec24dd794c5960944ad1161efce82ff83021d29c8d163c37f50634d7b5ddd08209ae2713d5835cf2a2a0bf00fd95b0088c75215b6730112de115722a7d5eb226a8c31c9a86ec80b50e8a1aaf339b540cfda0be76ff45592b9790dfe484d22bddf0197fbd15aa6482a309924be12b7c16d78f48d8e0836021cbcbce141ce8661aa1982a7326343c07a7dde07fdbc5d9c756dd1bf05cacb27b892b3908d6dc8ffb8c1c4bb29cb87a0ed7da39399640e412a253ed25b8d1adf5152440fe5049ed239aa9cd0555dbf36d54afd95a5c18537d18b86458d2b208690a8c94005e279f40e9192c979e5cf4f866ecb79ae437702a9555ebfbed741947a4892937256e6113e12d7f56ee65b1d990eea66b10441e8e47d4cc813767a2b982db8dcd5d45e288bca0c2378849791dc52d90e2dadea4000e392f09d6c8e376fcb1d3c7c17eacb52252c93329f582e5f649a75ca8bb53e2746d3f119c10555a9c3972b49fd45d587497a5360f540d85c790ea10cbb3499c1629443070e48f05e5772e2ff91158b269728e07beb8d5a67b292812e24aeb43ae422ceea2f2a7a025e6cfa5281adce2dacaa3014d6d2ad81a07dfec2876ea7d9eb44f301fd0caf4f4b44b149dfa68852f0affa8673768693781a53a482e9b7be3925b3b09a08f6f1e041861136c89e1ea13091de8a384c6fc1e284fefdeef8dc6e1140673a8772aa68d0ea93745d2971f9583e486869bbbef9e6aed4a38ee23fdd2e6c9f46dde2f7a08518956acc5ca53f2c53036ad385b02a6d7b4995fac71983580de84c15987235c7c1c6b22353c837aaba8ffda753c07ea8165d15f9220c1e4f65e59188312535ae02a9c3d0c915f03fb3b75db52ac83c91d985d3afedff342bc690998773ed541da3c7f38332afd6f6f062b7ac449cc39099213676f2926165efc0b501b4638f8f250383ed3f334144106c416ed6563104d9519ec8f770559b3bcf13157395c6b7ce36d8f1bbebfd7a9a0781df1535e6d78a7b69c939a04080019f21f0de467e459a71c32d1ccd9288770e50e1b05b37afed48406c367e883ddd690af3323378c9d4e6031927838df0e8c4b0bd97bfa925a7d7f0aed1420e3dd15092c41dec374e6df9d602e31680db3480ef8562e230fddc5140bce61dade7d20622b3d0457f3991d22c34e8eca5832358d8999b7f9523f456911e98d2bddacc942c167a17c11ac37729717cfe6e3c0baabfb249365f3a2ab2f06d2e726949ead086e9c6a6b7d7bed2f91275390bf9061e5aa72abb54e3e4b772e14d21be71f4411f96a680f14b7dee44bd30d33eb78ec721a00df4e6dbbcb27981b4e3d03fd68b5e2ac10e49e02c186aa16c5b4c638ca05211d45c151a7433447e3b684cd1908635e9604d42205ad2a1ff48de824c06e4db5441c87ef94ce3ebef9ec85e89f9b052d2dd34a5e19aa6f76d4e0be7b6c5fa7c6aaf33358c9d4251173c37b2ddd65b8cf840c8f70870c2289e28747feb4f1a02f2d768b5c43f9a2a452587508f654bda2431593a562e0e7f7e225b927fa9809455cb12ab0b23dd963a6d5baddd7d92a61b6df699336c4d6438bb9cedd37d5c4216850cedbcf5769e9a10a7fc3f8b342092664bd9bbdab7c67a738904d7a8e3f798d30e656d69f5e6bfa6607756d16653a86f09d03849e2586ad33681237a8879eb3438ace5000ff7e93757a384e0889315be2a7a228578b375301c96e50b13835918cf37030c1a4b5f25179bd17a9172b27278a523e8e2d75d69aca5983d59d30a33158030dd1b867818dde25d8791fdc0d7c5ca2a2e2a5dd4bc7acbbc0f8d65f5a68f617e620a8a4097debe106293cf7fc93a4c23e6be809da75efc22c75db2b8103e8722e2c3cf8fe0f248a492d8e1b1cd898fe495356334aaadede4fd679198c9faff87ba2166483ab0fbee94e737c77a6b6d241798b36c75006175ce0205183e39e3a672fc0c8ac7161dca755ca458f1247bd5b31ad93edc1f84699663612303d8120bd0927295dde76bc761133b5081aaf26160ecc8c4112973d170a4044c5b63bee4d16b68a5bcdaf4220c9d24dec6b2f359cffeedda69a7a942f16dd86a021948a8769b3f57fdd71789234b286a1a976f61812ef18c75742ba4aaf2090254e6862068207f6993c1b4e3617b8712cc9b97b3d5f511933f425d6717d74ff94679ced6cbc58f2245b9284f36aab130b29d03bd4b48fd4f9a6706210026b95b1009fbce3d9847a16e4d60e6e5e8bab8e19c2ae52e419cd2fd03be48fb3327385c8ca264e2ae0e91ae33734c31b5c3edaaa4c4e505fa3bf27a88a2828215b7e3354f784e933fb80ed27db7be3dbbd2af05f799c6e851866de7ff6fbf50d20a6d71bca809b9bb348abd356a805d14dfbcf49f3cc32e2aac6d6aabc16eb6b3948b802e6a5e57b07dc66c8f562e8d0cfba166f5afa177bd95b708d6f2d5cdc3296239d5c49f4ac7e8006ce8e0f01f2494077f3ff6aabb9d7df1a0df501c1f8fd4b0a25c5fdead96250847e9de9f0cfcda24fc40990088eba67dcde0ddbd01d69eba9b17b8b30fc3e1560feeadebaecd6cc8423ab66f6e3b4beb6668455b26dc6f1306eca24b8cebcd2f2618594b4b5e5c76694dce1aeca4188d95e67871ad39554e25d342498cb1fba2d0b1fa5891cb2fe686f6646dec0c46a1845832faed8e140b7925e24bc39870905daa28bb72776739d39e7418d8c67041667da032f93d76349ca64e13422109554b14e8415ac2fc4390393fbc56f47fe46292919464c671224a5be163509a81482b8d1581e758b10ee9a97634bad45581950451207ef0129b4507c07f7055cd7d03c35588bfaee9a58b46328a3424513e3ded5adb6590a0690a769935ec972786ba7b0646edf7dcfa9ad7b15c2aed37017adf9d0721ac8294e867c37b1f5a40cefd463bed4021b287a2de92f083f3c7b76a432489c4a9b3e2808f2840494e4bb5ecb1b231762e6300fac22558c659aaa008459dafa99744da6816b351daf02cf770918489adb2a2b7f7ef7093f104977b8050e639ad803ab64475f52e61ee5cb4258bd415356df9682f5bc4d825eddb63976dc11c0458701fe14d706eb00f75ecfebf21b0ef806698241b1d0048b106fe168bef5863731cc2aa23a7156f2a2730757ae80f51e2cb22beff591ddeaff1ecb86ab7325458b3f56bc76286552f61abd7786e80e1a728fec2352cf062807accb692703f1bd3a34a16c7abeed2e122f18215052da62d581596d9b9f7109f68a4e4b41a955a06a299b130bbc9ddce3c8a3c3c2e6237e7c819b5509ac36accb2d5aa221f049ed76bc9e66895bbe9a610c7c6909bfd46bc6aef5a0d77adfa4ab00922669bb571fda040192568a7bd0371b48ddca890865e84bdd86acc5f97168989230d595a631ac745bb9e7a45085e8aff2b4fe4c26e6781d6368421509592a8d1dcca7e1abaa107ad4e310661c931c892b22e8dbcd15d6bde7114eeae59fbc1f74457afb77d4433f1c56489d76d45f813a5f7b7fce5066778c976f97d741ce71d618e35f50d4ee7d0890c0212cee882745f662e66c461c6a3e0403fced6d3de61a3e81b6c19f08c17fb0ec3d102182dd9cd303bf98f9fcecce1e25ccbef8d84833b7f32986e8d32455460baacf968123d91c0da18e02e50bd351b944ee96edcba94eef3b98828d0c9c8b4872bbc2815344a7d925ab2fd32e10c56ef2bf579312a06c2f16ad990b9eb639ab5965f5482285970e5dbe9764c85442cc6c089f33c192b074f82e40ab3056db9030150dc8dfd8d66c5a83a642ce09c00115b7a0c7fc81446fc4c353bc02449d49053cf32c332ea08236a7be3bf32ae0fd1a6e185da0fdfede56299bd5ec51b8cd25dbca16813e3659f73108afc73411494f6bb569f72ddfaeef53feb269e6bfc2562e9fb7505db885cc3cbec60ab0cbeac7b6654c7dfdb7a7707c202abc9018ab4b01150876cdd9c400f5c622a94f357ecda342fccdc1aa6e88bb3af065f6faec6f206a2c6c0247438f8de8ddf743fdde72606b470c8a742a5db894bbb7c46a1d82e14ddce2649a0947c4261728f5bfadf2acb9b6ec8e0e946e05909a211eeacd504c88f40e00843c0259bea2a16baafd0e063c81f6c3412c0f11144e4609a28721992aebc2c4990dd57165afd9351a1c64704596b15f1aec1baae4a41f798e71cc43d730144a90a6283bcf1192acd2091932aea21a5fef39f17923a3c36acfc3d3da5a498d55657e7c3ae0704d7e1a990cc8f46c69d969f10c4a62e3a0a3e73fa3fcd63cca1706b1f7e95c59b8ba88f48d32abb3962c20e804d1413f0e61ed0271035dacab3fd35cad657943fc2d526b583aa75548ae0455880ddec707ac16375e331bfbb0c9738bcb58270275930209f4f884e7689a9385a6e107057e15dc069a98916effb6f2be02c79cba7759534bf52cf2acbf7c8eaf16fb98c1c20f2eeab5d436840d59fda0880dd70e427344cf7666977fa835e42a936473eeef42eb1fa9569a2aad96807cf635eedcaf5c468e3f38442023b0c3cb23c735d2c60c7dcfdf366d77251d698c53a11f34168d50e87de8299f91b755767b1c33b8a1a06d53b15f18ed6c3e17761cbd378942a34e71a4ccbd930fa72fbc1cf31e8fd119297163410d739ec2c14a657797e74b557cb186c32d414063976ec55b05d1c2feb801c90921dea0926802d9a2fee4106da76b06104c9e92acef1f4a2f4a96d4fcd194179e82c7dbe14cc5acea93f8d62d17ba4a6bff23a36a63759aad36bde783a24e13c7eb01df1de7e0cf968b9b70f3d94c777ce293ba8e513dfbf430c31a8c0aebb099372c319a52b1e9a4d554aeddb7cee71a5b202894b47fd6ae278dcf14e803ea3e445415314df10d7ac992f8c2f594b62bce0a28b191d7c8af53d6c6a851dee3bc5376bcf48276c7f275f522556dc37b46541e087c6be93ad97b756619c9d7ee1041d7ea573054b59ce60ef006a90b8650b791178e291b38e7967a392a601c56d6c8ac72b84c7073d9e71b4c80b4bf7dd86245a3cece082647567c2336cb05bf1bbae0b8d0417e609133fd471b192960ccbdb1ce895597895aa29c987dd453fd4d8051f7d49b0d7baa03a6895baa133e8a9d74a45feac869ba655fab898446c2680aa2c77aa05cd2eb54e3a6df9978bbcf0a88d87aed7ea9c0b560e045ae7b59436b159b199f7cbb02b58aeb1eae928abeae8f198d48fe113eacb9e8a3d32e394eefa2dd8649cd6462225c5571a2d48d74d75ef44c518dac37b60729479e19d24268119ead1510153982042ace62fcf89f9d0ff3aff52683710cd0902ab0e7874e24801f5f960b32101034a2a722f1cb01b587439dc81bd1cc23c39acc6d3f6d8be0723805610ed0c92585a4855324b31f19ac0b27159429d9f061e1e46ee71ef08cab03390354bf63591c6b0e256414112e779d7558284c88f6c9a6f29e97bfb951a2925716de0963fae1855a8903b60af7cff51a5827525c5cfee1d88f2bd4398e45b4a161e34e03594df8ffeb6f0c079e76c1c989f54c0b83b6b8cc98815e85a7cfc2d62a666379d0ef5b57fe2cca7f0cdd989011e4b456231b6fac6f541e3ac958638ab0c51fc70f1cfe4524200c15dc2d4d98aa55c1b1e897e4ac8549f83fcfb4c8e9f232a12958bfa4c86a12956e146f98dae2ba7c103e278a30dd3a53974328115762a9cbadf279b5911355061d1dcdeb06ce0b8b11d2b45bd560bb399c4a8f6fbe9fb0062b996df3bad9e0657e27a84431034e46f987bb4f908e894f7dbfdc336e64631576ff820358460678d5a06442028ef222510f61ac0869a6871561da6718ffdb8158a3f9e29d2a04bade5bdaac5f0431f9eac1f2b0314c15d790c4be19dd8fabc85e1c3d3a9923132a7f22e8f1e932e77be30bd5e2f8cd7d05e505060ac33576a6c442ebfb9a83380c96f27f258b810ab9e6dfabb79e8ae2503fff38c1a048d8e68af1ff1f8b610f100c89a89d2883cf091495990180277de01183006c646c69f9fa022cde0c795c0d70c1c3614375cb699ab2c28969cf627034bf6d80f0042dbfb7d431af01bd2c9177ea371a2a11805dcabdce02c09e42c0d1714e143631ce3c0139642c5df90152703087c38e50df784ff950ad0d338e22e66491a96e92f761a84904ce9f091109330f7865ebf4be4a1e5ac1f992f34c497f4ece15434767e648b75ac51d21560345b10b78aadf8a10c861170fbe57c214ead25af4a3a6c5fd32b29e48bc093913632644107324c23c77bddedf0fc22654287f25b4d42cffca1ab236758ae533122299011c251aa5616a8d78538404bf744279f3e234312bb98865a6f19d376c7d7b1ad58e3ba97a7fdd3abd90dbaa9226dc768616178048b71db5ea429ef9c3e2e577cc9ae881a7553947af02b57b00a3cbd63d9e0ad381a701bea0ec81782069fa124c7071eacf68af0838a91d4984adcb2bc530d3571d71b25b3edf165beeabdd2b1ffb31a5f581a5229ad07629826b9a8feb8242bb03e04d8a86de7446a39adfc0a3bcbc1017400e7d60fd622340e6e26403a88a922fff3ac44c340e518909d68be23ce9ecda4fd403cd7a73597643c31202e7eb1a0863485ab201a158490aef694030d3597ad9b7b9f2c661457342932ba81bd3bbe4d77b6c83889cc2f363a543fa9f6c5a02a63573643e13cd69d2202f14dab1c122dd735041f76f72e990de1b330553d30061956717e0400bc73b2ca3d31977ff905b47b0727940ba8275f7db1fa3084173c040b900b6ab2b4bf36043881e97f648c056e4008fa7a40c3b376ad4466f4639569986f89810ba63b21ad0e682a1c517b8809f7717e532b33a4286626e3de1c758788a333fc7bd43621a0b0597bc8b87e120ac08847ca35a5f3493f1382b33f47634c9c328d1fa43c7a91d58fabea1076e2c67046fd83a884d1193bd123edf0d8007927ddf006e9225da8b238559f1ec32dbe8019f9cca91dcaaf3099bd6b0318407b8019b8411dde1132eb72fcf80c186b4e5a4be1a22d690598def6ab1e49e16bd13b0b7fd4a78b75300e7f610ce12a044211336848e8dc23356de899474b9976f4dba77cdb30ffc2210b63f05530dd604b99fc74946e2e4d5dd08da01231e093a4c994ff646f0f4a74f73debe32295c4d360ae96be59cea7fb4dcee1429af75700ec125b61e2b5390b43ef4fdb1fb01d817b1019a3bbff0c82278975fae3a4a9040b1bbd9b15a0b67ebc2998ba876c39517291844a40da45ffa07f68edf4067a36b714b13288806a36f99688be587ac7253e5fd493d6bbf127ceafa20f9dd432b1e9da60ce75ba7920a5eca2c7d22cba23a057208dcf6265515840aee14d163096dbbafd2735b70333d012a57e19022721c851b166da022a921a86266a59218ec0b7b0db06b2d0e129bd6b08f934621af7f83f278b49ba3f11380ce4863f7bd93ff984b93a47f81ddc7fc06b6b9a06633060db09437a45764febecb285544c26a074947aba380ed54484c1f858c07e8d1ef2549cbee0ad9ae8bb83157a9fbe28402cd852477b90bffcc0b27d1340509fcd8f5728cafaa18edf2a240571dfff97c63679d52ff09a1f1602b8176dc7d7adcbaab0e1ba730c719714fe82f47c861cbc3acf53c643fa105c90d89cc84d426fcd09aceba1b04725dbcd30c509c2f6a9750ed0be5934d06f19d150c36e53295f1df9d30b26b367f132c3543caf2bc516ad055ac1d6a5d4a83bec7e958a943522c00b9b43881299a64d5edad89ccd8226256aa4562bd575b49922471be88617e4b6d3d98ecdf5a05b2af6f2ec7e3496763d5f6d2b8537ebf04eaf96701baf7e7a0d9ea077bc0ecc7aecc0e269fda9be164b87836e121f736fbbc7565f52ab3205e378de0974e967d5f63d3ad549b856b531e293681f5093b3cf53c746732ed96c521310e7d5fd90d8c07041e24dd4d52db75a1f894abfae2fdc0299c6218d0201f5ad3bdf771ecd947af8edf347f7b784dc0701ce0772e2b644f7cffd7fbdb36312518d05ed01dfbe9bb56af553bb4f272c217785f5165da1ee4805d2a76c450d302b0fd45411ad22fc31e02ced18719ec47569e98c47a7c3889b1a1141715d079e35b18d7733300892d41ccb837354bed0c16f9c5b089cbe9f659537d91a9e7c5f87c179158fc4d5e730ca54a8ceffbe094525a926c655d4effe0db2ff58b9b5956e6a506c2d81b2ff38ab24472ebc73059f4ec4ed17a4554e358d94a3f5371abc3a2752fd5662075ad8b74f5695a98530bfa9239a5149c93833abf7512f32095ca4d1e8b9e70190e58e7c8dbeaf1764abf57b6999899f83f2cf5f8ac0a550d60684d6e5ef8061e50c9a1eec125cfab703a9ea96f37baae7284ff28e752b8bb2c8eb2ae5a52a84d0ea0ff0ed153577bf200450c6af603f030973416ebb8ed8210df1f7ad4e2ce62e745a8d8a52080b446f4c14bcfdd0b17aead0ad2fb7bbd27e19449fc46b3459557561cdc5b463c4983f08d5582e7a0d46f32ce48d9ef9877123558017aaa4191789a719fe13b6cd89a7edf03d212634226c2a5225d6d151252b79a58b767dfb89dc8f4b0e79e4e4751f41091c42633543a427228d028ed04a48f5b4e7a55bd42db3714d57a4f531e87a8c58347f45a4f74172885c9a79972e882d735d325fbce12a1103d9634ba98e35d91d90a990755285cf90ca35ebd08464eb01a48fa09f3f7de71a2f5f49e8d173393a0fd9a8c84106e1a464b996b513576b3bbb1f468f1ba7d35cce3fe89708196c2fc53713902305ef5ebe9bf6088048633768bd3951b468293cb4836a9345616ae63c711963f9d64b456b2255b577529711951bc2bd90ed95cf9c4574ade9f70c1770e9bc4f07777fa19661f3d32d4603774208a88871d71c44e681023b1ff37e2f56b33762d6082c8ae0c15818301b96aa165d96ec436b0c7ba73d410798b9799bfdc63e9e1f3779f66193a1aee426cbc4af5a19938bcd7b9b848ade94464adbfc23a66111be45feed9ddd91a1f934f71d93af4be58a8c02bc5b5c78e6a392fa486bf36bf85a3ddeae7a79dc5e39d38e6a8fa68138b21a4a3ab0248c3a7070cb9f59346a4c2284488599ba6b7937ed42ba67c46b115cf2a9f2323dd486245e4f82216f5047ea2eb2d37060254d3a991f64545d004d99a13929998f436a9957598ff58258ae4b58964ef2902bd11f652078b2843d3d423f89447346215e88a4a76d1404c43da8bc73d9e4cadbdede16f1466c0bb91c0e225b9c29b197415256723264bf72f9489a42b96761b3ea5e5ef92192b6e491ea931bf99db876cb3656c51c63aadd3d71fb29782891a5a210dcfaaac2ac682a7940398a401b2295c0006a3f7f0d1e515af45900da6276340ced45019131171f507c82213b11cfb52b930a139f5df9a69620cd62d0f6ca474c3defb3317dec400b8885f3459b904ab06cbda4603e98a207c0a1d67906fd35ed2ddc10d1fbe2ba4be470ca9ff83410edfd06b25fb4c6e29d8105555d2170bfe12010fa945f2f6602febbe7dfbf221830652c319328a5df79685bf655f7f67b531607940a1173c3b005ea48f15a3581eb25ed6f11605ff66c10d65354c41889783eed3bcfae277870e0f9e832af4e5167ae0f0715fec7661b305b6e02de0666737a6abe99d1555f31fab7866e671a9e219a7d47928a7417bd35413b605e43ccf7c22d18bccdd5a70351873b956d95211e5d00fb0abfe8fa8dafa46db094545f0c52ef0ae9d0bfe7c2ec575f70031f928659f146a4a0cd84cf191f6b8a75693b8ca25c71eb707011df5700e3b3dfe7c3e67b5d56b37eb8b90b4c9b7283d275642fae2018539019a5ed1c36451e61771b194a5b59615e72aa8880a6888be48954380566aeca1566d36e01a77aa6dad823dc65fa5f88007699d687270c84638e59690d8f2d43faeb47e0ea78463d6c76c5291abd154f699abc24417b421ee647d5d3dbe3333ee91c0db323a5cd8f99faddba47e05d3c9c06efea0bb120da0ad61c37cebe57b9d93c143b82b74edfc323e7df9766bf87afb0f7f7a53c614bf53c8abd7254b5ce2a8fa7040e90b07881201019143951bc767f4b81d45248f7c42ee4a1ba2c1e78a795d433efb45431d34007a2d58b8d424b95a1ad2650118710631fb7cafb989147e61444856e7cdb91d63956fe85bb7a8585e078b522195175ba93163b84751dc6b2ec7d4297d89caaaf14cc28be5758390ce8606fcea62258c7ba01e988dae50860843b91e1bf7d599a1e23400bd7a3520bed1fd23a3725da4dab8b099ec93c478b28e0f54a2b9622b931a5ae4399683f835c7386e574721dc658f33528207c09f6823c453209b45de3ae5a193afcc26d9569ade2965fe0dc28ad2fe5437eb6c2044b9966564034673411faa7fa34ffdfd894518e4d459495dc3adaa7a3d62fa044b0990c9ac33c50ef79d8833084ffe723cd1c20419eb9e4d6dee209db560c637f240b2d4d52f15374f8069c7282107301e6570124fcc134bf0347b858d5936109dc5272653eeef9d37e3e894cafa7797a9f84a76d836e5dd2712140bffcfef7a2fa9c95ddd4ee9eab5977e98dc68e751ea070d4884cac3a7a8ac1e697b0e7dabc5fc906debf092eba096453c81e6ce91a5411c41ac19cf91b2984b58ba7e92e8e1fa428d1a060dd8ded6c0a392a1b14b2c9164f2d74bbe7df2f64e7ebf9a65296d4baa3fc0ab9653972c6394d8a3dd50c6f3cd42d0d0660f5fa74dadbd8941dfdf90667ebf08814d4ed9f3f52bcbc4561e8e243642574ee045147563d86ce13798a25b5850d94d4486424e21c14bb6bb64815e0e31fa70b436a1ae5c431cf23307cd0ac86ce6f222e198eccef083b1767d391898f60dfe762660fba561228433c5e139e5b5ff03d44894767ffac8c066e32b33f2b314ba39f04d7e3258cad71520b35fa6656e694f1175af309da5f7419d76560a3675c3794aacf723f59be9a4b99d1d86442eeadd1147128fa883defd239e94fd3caab93ef23bd064fb2d9267c53a3250cd986162f398b112e74021290644288d4745bc7037dd61c665c56f5d3325b15f4c9d5915a37fde5778bf00ab8ba127acf03a8ddb5f1c9c98159abdcfa43887fbc67412958d3372f571ba91df1a5c6100b10481d69e1a812e7c5be40286ece4a202e6f395faf86e51a8e907866a46126f0994064b3170eca9747d9cfe15770d983a179b03e7b5edc5a88028be635064e009b0114a22badc91d7efe66c4cd1efa524d0b4c956d5e0f1e47f21297bf4fe3124421da3647cf3d2dfb4939236305a6662a7e54be56a1a0ebab883c06d69b0766e1ae4ee0d2d10eca5e910044ab71649afd6f6f03314aed927311c4e10c05a248daabcc9d59e11099cd28c82c50db2576dfa668eac33444836f83cc0ba6a2d63f852b875fb9e143d287230e858b4dc1be44a7b9d242879a77b74b7a57701fbe17911b9b6a93df8b2ed01961ace68987ec7e6cde6c75feb802dc043d7c012304021a4fb7d6ec46025eec3dcc9c753ad1034f519ce5cc84a03ae16f29f3d5a7685a395153dc8d2611376745cc50475fe4635d7e095f8785d95077ccfd4d432857e8b74dd6a5d3895d511959db27443f52b020786078c3fc1c86e32cec9ad9aa8761b6cbb14df9740838d1fa12e6da41ae6456199c471d827c700c83f38a48db12b08d91b6e8a273ec29e12cb78f36c3225a5eadf4b10345caa15e7c3b7175a204a2a288cb164394985ec97240384aeb2a98652d633bbff5ddf67bd7374449b6d0ffde464a04a07a1d12cc98b25e6d820cfdb46488b84588e23abe0917d8e31d310a68112eeee2bc9194ca988ceb8c6724169f71933df3d624ad548a9389bde4ee270cdb755b547da7cea11540f3d652c448e4414b3d1b3ab3ed52950efb6eaf411024f9bc158b487a6ff6ac969aa3982f1beef14eabd0ffffab5d6e91812084f2c9f76a9933e6f8baf0a89aa58d4d3614f655528f84308313726862b536a590e5a5bebcb654e40f88876cd44f21ec714c0728ffd90f9f8db076bc7352b1a70ffb8ae4ddeb5f9d36434776cbd0b62fbe64669a8f8fc7261fd29e1b611e5384bfffcb2d8615daef3e065345e06c57814f9fc790cc5270516c148a867a5b9413e36dbd5de54ea0353765df925acafdaec4acb25df3942653ef6f2f6b8c5cf4e1a0bc8f736b8e8b55c3d040d754e2fa3b1e3b9148a2803401be846b5ad334c75fbc12f64db116111d747519f657ac681273528822eed20cf63ed02f2073b2f7efbb9d1ea0f59e376c637c6b9cb19</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> 数字前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>icc_flow</title>
      <link href="/2024/012139355.html"/>
      <url>/2024/012139355.html</url>
      
        <content type="html"><![CDATA[<ul><li><p>decap cell的插入</p><p>解决IR drop的，为逻辑单元提供稳定的电压。去耦电容，提供稳定的电源和地，降低电源噪声和提高电噪声免疫性的特殊电路元件。<br>Decap cell是小电容器，位于整个布局的VDD和GND之间。当逻辑电路汲取大量电流时，该电容器为该电路提供额外的电荷当逻辑电路不吸收任何电流时，decap cell被充电至最大电容利用decap cell来降低动态IR drop。<br>decap cell是带金属层的，建议routing结束后再加，否则影响route走线。</p></li></ul><img src="/2024/012139355/image-20240121233331816.png" alt style="zoom:50%;"><ul><li><p>filler cell</p><p>为确保所有VDD和VSS rail连接正常，我们需要使用filler cell填充标准单元row中的空白区域。filler cell没有逻辑连接，同时还包含衬底nwell连接以改善衬底偏置。</p></li></ul><p>​在routing后进行的，先插入decap cell，再插入filler cell</p><p>​插完decap cell和filler cell之后，我们可以发现整个设计都被cell给填充了，可以把芯片的表面做平，<strong>在stdcell区域是不允许有间隙的存在的</strong>，也可以用命令checkFiller来检查。</p><p>​<strong>作用：</strong></p><ol><li><p><strong>平整表面</strong>：在后续的工艺步骤中，便于后续工艺的抛光。</p></li><li><p><strong>获得连续的VDD和VSS</strong></p></li><li><p>保证版图连续性和均匀性，保证掺杂均匀性，减小工艺变异，增强结构稳健性。</p></li><li><p><strong>优化功耗和性能</strong>：通过在空白区域添加 Filler Cells，电流路径可能会更均匀，有助于减少电磁干扰和功耗。</p></li></ol><ul><li><p>dummy</p><p>主要有以下几种用途：</p><ol><li>保证可制造性，DFM。tapeout时会检查芯片的密度，插入dummy mental，dummy poly，dummy diff</li><li>在关键器件旁边加入dummy 器件，比如cap，res，mos等</li><li>避免芯片中的noise对关键信号的影响，在关键信号的周围加上dummy routing layer或者dummy元器件，shielding。</li></ol></li><li><p>获取整个design的instance个数和面积</p><p>report_qor</p><img src="/2024/012139355/image-20240123212321424.png" alt style="zoom:67%;"><img src="/2024/012139355/abc207bf21bdcaa65b8339f664292df.jpg" alt style="zoom: 33%;"></li></ul><p>​gate count计算：等效的门数，只是一个粗略的计算，不是精确值。将两输入与非门的面积作为等效参考，即一个gate的面积。用所有std cell的面积除以2输入与非门的面积，得到是数值为用到的总门数。总门数*4得到的是晶体管数目。</p><blockquote><p>DC综合两输入与非门的面积为1.44，所有cell的总面积为41.2w平方微米。等效门数为41.2&#x2F;1.44 &#x3D; 28.61w逻辑门。</p></blockquote><ul><li><p>查看clock skew的值</p><ol><li><p>通过report_timing</p><p>得到的skew会偏大一些，因为skew经过derate。</p></li><li><p>通过report clcok tree</p></li></ol></li><li><p>clock skew的设置</p><p>在长时钟树时，要设置targe skew，告诉工具clock skew期望值多少，一般设置为50-80ps，100ps以内都正常。</p></li></ul><p>ICC cts的相关设置</p><p><a href="https://www.cnblogs.com/IClearner/p/6606360.html">https://www.cnblogs.com/IClearner/p/6606360.html</a></p><ul><li><p>wire spreading（连线扩展）</p><p>也成为critical area analysis关键区域分析的地方</p><p>bg：制造过程中可能会出现随机的颗粒缺陷导致短路或者开路<br>最小间距的连线最容易造成短路，最小宽度的连线最容易造成开路。</p><p>解决办法：容易短路的地方，增加间距。容易断路的地方，增加线宽。</p><img src="/2024/012139355/20200729093453667.png" alt style="zoom: 67%;">icc_tcl:  spread_zrt_wires / widen_zrt_wires</li><li><p>检查placement是否合法</p></li></ul><p>​placement后，执行<code>check_legality</code></p><ul><li>ICC 在导入网表后，没有tie cell是正常的，因为是在placement才加入tie cell；High Fanout Net也是正常的，还没有插入buffer进行优化。</li></ul><img src="/2024/012139355/image-20231224214002120.png" style="zoom: 67%;"><ul><li>后端流程</li></ul><img src="/2024/012139355/image-20231224215828226.png" alt style="zoom:67%;"><ul><li>时序库 （*.lib， *db）表征的2个模型</li></ul><p>​.NLDM (non linear delay model)，65nm 之前工艺 </p><p>​.CCS （composite current source）, 更精确，同时能描述crosstalk （信号干扰）的信息 </p><ul><li>max_transition &#x2F; input_transition</li></ul><p>​一般来说，sdc中关于max_transition的值参考lib库中给定的transition值，尽量取中间范围。transition设置的过小也不好，会导致工具插入很多cell，增大了芯片的面积。</p><p>​解决措施：在DC和ICC时设置max_transition为0.4，在PT时设置0.6</p><p><img src="/2024/012139355/3158545f6cb70988f94b0214218380a.jpg"></p><p>出现上述问题的原因是因为在做lvs时，网表与版图不匹配，可以将icc生成的网表导入到calibre里面做lvs。在icc pr后的网表中，在module里面并没有上述的Q端口，而是使用的Qn，接一个反相器输出的，这个是和版图对应的。</p><p>CCS的lib中有 crosstalk的信息；</p><p>物理信息库<br>     1. LEF(library exchange format): cadence 的物理信息库，只有布局布线要用到信息，pins…<br>     2. milkway：synopsys的物理库<br>     3. GDS：流片用的信息，所有的层次都有<br>     4. CDL：器件级spice网表，lvs和仿真</p><p><img src="/2024/012139355/wps2.jpg">（LEF GDS)</p><p>DC在做综合的时候，把DRC的约束优先级设置为最高，依次是：max_capacitance,max_transition, max_fanout</p><p>DC中报告的漏电功耗是准的，动态功耗不准。</p><ul><li><h4 id="Formality"><a href="#Formality" class="headerlink" title="Formality"></a><strong>Formality</strong></h4><p>只验证逻辑，不验证功能。比较的原理：formality将设计分为多个logic cone和compare point</p><img src="/2024/012139355/image-20240102224954497.png" alt style="zoom: 80%;"></li></ul><p><img src="/2024/012139355/image-20240102225055027.png"></p><ul><li><p>DC和PT分析时序路径的不同</p><p>DC</p><ol><li>过约束，留出一定的裕量给后续的步骤</li><li>时钟网络的延迟的不准确的，一定设置为ideal clock network</li><li>线延迟也是基于库中的wire load model估计出来的</li><li>通常在单一PVT的corner进行的，比如wc</li></ol><p>ICC</p><ol><li>不需要过约束，根据实际的电路计算</li><li>所有网络 clock，wire network均为实际的</li><li>可以从版图中抽取RC寄生参数，计算net delay</li><li>需要在多个PVT corner下验证</li></ol></li><li><p>修复setup违例</p><p>满足 Tskew + Tclk &gt; Tlogic + Tsetup + Tclk2q</p><ol><li>提高Tclk，降低频率</li><li>减小Tlogic，优化组合逻辑，划分流水线</li><li>减小Tclk2q，将HVT管换成LVT管子，速度变快</li></ol></li><li><p>修复hold违例</p><p>满足Tclk2q + Tlogic(min) &gt; Thold + Tskew</p><ol><li>增加组合逻辑延迟，插入buffer</li><li>降低Tskew，甚至用负的skew</li></ol></li></ul><p>SDF：标准延迟格式的文件，描述了设计中的时序信息，包括net delay和cell delay，sdf文件可以直接用于后仿</p><p>SPEF：标准寄生格式交换文件，提供具体的R和C参数，延时计算相对准确。</p><p><img src="/2024/012139355/image-20240103100523201.png"></p><p>在PT中设置clock约束时和DC的区别</p><p><img src="/2024/012139355/image-20240103100716030.png"></p><p><img src="/2024/012139355/image-20240103101023594.png"></p><p>ECO是在post layout上进行的。</p><p>PT自动进行ECO，PT工具主要通过resizing cells和插入buffer来完成ECO</p><ul><li><p>OCV</p><p><strong>只在post layout进行分析。</strong></p></li><li><p>约束输入端口</p><pre class="line-numbers language-none"><code class="language-none">set_drive_cellset_driveset_input_transition<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>这三条语句都是约束输入端口的，但是适用场景不同。</p><ol><li><p>set_drive_cell</p><p>应用场景：Block level<br>从库中找一个cell来驱动这个模块的输入端口port，更贴近实际的情况。这种应用于模块级别的。</p></li><li><p>set_drive</p><p>应用场景：Chip level<br>通过为输入端口指定电阻值的方法来为其定义外部驱动强度，典型的值是0.05，单位取工艺库中电阻的单位，一般为kΩ；该值越小表示驱动能力越大</p></li><li><p>set_input_transition</p><p>应用场景：Chip level<br>为输入端口指定一个固定的transition时间，transition时间相对独立于当前设计中的电容。transition time越大，导致短路电流越大，功耗也越大。</p></li></ol></li><li><p><strong>课题组项目后端的细节处理</strong></p><ol><li>在版图布局中，由于SPI模块与数字芯片core的位置距离较远，需要对数字芯片CORE的输入端口进行约束，设置input_transition_time为0.5；并在SPI的输入端口添加模拟的buffer，提高驱动能力。</li><li>在之前的芯片测试时，发现控制字的输入有问题，有时候需要SPI写入两次才能起作用。后来怀疑是SPI模块给到数字core的时钟信号走线太长，到core时候，clk的驱动就比较弱了。再后面的流片时，在数字core的clk输入端口加了buffer，解决了这个问题。</li></ol></li><li><p>IR drop</p><p>电阻对电流有阻碍作用，而导致电压下降；<br>大电流或者长导线会带来IR drop，通常在芯片的电源和地中出现。</p></li></ul><p>ICC在global routing绕线期间，以GRC为为最小单位安排走线。</p><p>report_congestion报告会计算每个GRC的 # of available routing tracks（#1）和 # of nets crossing GRC edge（#2），如果#2大于#1，就存在overflow，即走线资源不足。而congestion报告会给出每个方向以及每一层存在overflow问题的GRC数量（及百分比），overflow总数和单个GRC max的overflow数量，根据这些数据可以判断congestion的情况。如果有GRC的overflow大于10，则可能走线走不通，如果有2%或者更多的GRC存在overflow，那么可能会出现SI和timing的问题。</p><h3 id="修复违例"><a href="#修复违例" class="headerlink" title="修复违例"></a>修复违例</h3><p>place_opt之后，如果有小的setup违例，可以使用<code>psynopt</code>命令修复</p><h4 id="Signoff-Items"><a href="#Signoff-Items" class="headerlink" title="Signoff Items"></a>Signoff Items</h4><ul><li>DRC</li><li>LVS</li><li>timing signoff</li></ul>]]></content>
      
      
      <categories>
          
          <category> ASIC数字后端流程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ICC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>StarRC_flow</title>
      <link href="/2024/012044084.html"/>
      <url>/2024/012044084.html</url>
      
        <content type="html"><![CDATA[<p>根据TSMC signoff的标准</p><p><img src="/2024/012044084/image-20240120174002288.png"></p><p>整理如下：</p><table><thead><tr><th><strong>setup</strong></th><th>process</th><th>voltage</th><th>tempature</th><th>library db</th><th>spef</th></tr></thead><tbody><tr><td>wc+Cworst</td><td>ss</td><td>1.08v</td><td>125</td><td>tcbn65lpwc1d081d08_ccs</td><td>Cworst125</td></tr><tr><td>wcl+Cworst</td><td>ss</td><td>1.08v</td><td>-40</td><td>tcbn65lpwcl1d081d08_ccs</td><td>Cworstm40</td></tr><tr><td><strong>tc+Ctypical</strong></td><td><strong>tt</strong></td><td><strong>1.2v</strong></td><td><strong>-40</strong></td><td><strong>tcbn65lplt1d21d2_ccs</strong></td><td><strong>Ctypical25</strong></td></tr><tr><td><strong>hold</strong></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>wc+Cworst</td><td>ss</td><td>1.08v</td><td>125</td><td>tcbn65lpwc1d081d08_ccs</td><td>Cworst125</td></tr><tr><td>wcl+Cworst</td><td>ss</td><td>1.08v</td><td>-40</td><td>tcbn65lpwcl1d081d08_ccs</td><td>Cworstm40</td></tr><tr><td><del>bc+Cworst</del></td><td><del>ff</del></td><td><del>1.32v</del></td><td><del>0</del></td><td><del>tcbn65lpbc1d321d32_ccs</del></td><td><del>Cworst0</del></td></tr><tr><td><del>bc+Cbest</del></td><td><del>ff</del></td><td><del>1.32v</del></td><td><del>0</del></td><td><del>tcbn65lpbc1d321d32_ccs</del></td><td><del>Cbest0</del></td></tr><tr><td>lt+Cworst</td><td>ff</td><td>1.32v</td><td>-40</td><td>tcbn65lplt1d321d32_ccs</td><td>Cworstm40</td></tr><tr><td><strong>lt+Cbest</strong></td><td>ff</td><td>1.32v</td><td>-40</td><td>tcbn65lplt1d321d32_ccs</td><td>Cbestm40</td></tr><tr><td><strong>tc+Ctypical</strong></td><td><strong>tt</strong></td><td><strong>1.2v</strong></td><td><strong>-40</strong></td><td><strong>tcbn65lplt1d21d2_ccs</strong></td><td><strong>Ctypical25</strong></td></tr></tbody></table><blockquote><p>删除的bc+Cbest&#x2F;Cworst，原因是这两种case位于wc和lt之间，没必须再去分析。</p></blockquote><p>Q：在检查hold违例时，lt+Cbest下已经保证了组合逻辑是最短的，为什么要进行Cworst的组合？</p><p>因此，lt仅仅是满足了路径上组合逻辑的延迟，而时钟网络的延迟带来的skew对hold检查也非常重要，所以要进行Cworst检查。</p>]]></content>
      
      
      <categories>
          
          <category> ASIC数字后端流程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> StarRC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>tcl脚本</title>
      <link href="/2024/011824060.html"/>
      <url>/2024/011824060.html</url>
      
        <content type="html"><![CDATA[<p>set endp xxx&#x2F;D</p><p>set path [get_timing_path -to $endp -group reg2reg]</p><p>set points [get_attri $path points]</p><p>point有很多属性</p><img src="/2024/011824060/image-20240118232406988.png" alt style="zoom:50%;"><pre class=" language-tcl"><code class="language-tcl">foreach_in_coll point $<span class="token variable">points</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>    <span class="token keyword">set</span> <span class="token variable">obj</span> <span class="token punctuation">[</span>get_attri $<span class="token variable">point</span> object<span class="token punctuation">]</span>     <span class="token keyword">set</span> <span class="token variable">objn</span> <span class="token punctuation">[</span>get_attri $<span class="token variable">obj</span> full_name<span class="token punctuation">]</span>    <span class="token keyword">set</span> <span class="token variable">dir</span> <span class="token punctuation">[</span>get_attri $<span class="token variable">obj</span> dir<span class="token punctuation">]</span>    <span class="token builtin">if</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;dir=="in"&amp;#125; &amp;#123;continue&amp;#125;</span>    <span class="token keyword">set</span> <span class="token variable">inst</span> <span class="token punctuation">[</span><span class="token keyword">file</span> dir $<span class="token variable">objn</span><span class="token punctuation">]</span>    <span class="token keyword">set</span> <span class="token variable">cell</span> <span class="token punctuation">[</span>get_cell $<span class="token variable">inst</span><span class="token punctuation">]</span>    <span class="token keyword">set</span> <span class="token variable">ref</span> <span class="token punctuation">[</span>get_attri $<span class="token variable">cell</span> ref_name<span class="token punctuation">]</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span><span class="token builtin">proc</span> <span class="token function">is_hvt</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;ref&amp;#125; &amp;#123;</span>    <span class="token builtin">if</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;string match "*_HVT" $ref&amp;#125; &amp;#123;</span>        retrun 1    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125; else &amp;#123;retrun 0&amp;#125;</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span><span class="token comment" spellcheck="true"># if &amp;#123;![is_hvt $ref] || ![is_lvt $ref]&amp;#125; &amp;#123;&amp;#125;</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux基础知识 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tcl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PT flow</title>
      <link href="/2024/011821871.html"/>
      <url>/2024/011821871.html</url>
      
        <content type="html"><![CDATA[<ul><li>检查反标率</li></ul><p>跑PT时，需要保证每个corner使用的lib和spef是对应的。读入设计的spef和网表netlist后，需要report_annotated_parasitics命令报出反标情况。</p><p>反标问题我们是看Pin to pin nets的反标，如果这一行的Not Annotated非0，那么就一定存在RC反标问题。常见反标问题原因：</p><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">spef正确，但netlist错误Netlist正确，spef错误<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><img src="/2024/011821871/image-20240118192337980.png" alt style="zoom: 50%;"><p>手修timing</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">size_cell U324 INVD8<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>setup </p><p>替换大驱动的cell。 x4 &#x3D;&gt; x16<br>(有时候替换了大cell，delay会增加，因为驱动能力的增加不足以抵消input transition和output load的增加)</p></li><li><p>max_capacitance </p><p>方法1：替换大的cell，提高阈值。<br>方法2：减小实际的capacitance，通过在ICC中插入buffer实现</p></li><li><p>max_transition</p><p>方法1：替换大的cell，提高阈值。<br>方法2：减小实际的transition，通过在ICC中插入buffer实现</p></li><li><p>hold</p><ul><li>get_lib_cell  *&#x2F;*BUF*</li><li>insert_buffer [通过report_timing -delay_type min 得到的] *BUF*</li></ul></li></ul><p> report_constraint  -all_violators：可以看出违例的endpoint  summary</p><p>syn off :关闭高亮显示</p><p>查看某个net连接的cell：all_fanout -from U503&#x2F;E -flat -endpoints_only</p><p>report_timing -transition -from U399 -delay_type max:可以查看具体的cell</p><h3 id="timing-eco"><a href="#timing-eco" class="headerlink" title="timing eco"></a>timing eco</h3><p>修违例的顺序：1. drc的错误 2. 再修setup hold</p><p>尽可能使用size_cell来修违例，而不用insert_buffer，因为RC是准确的，保证net delay是对的。</p><p>如果想运行dmsa，那么在启动pt的时候，必须加上-mul选项启动多线程，不然是无法进行dmsa优化的。</p><p>在icc中，摆放eco 的cell</p><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl"><span class="token keyword">source</span> iccpt.tcllegalize_placement <span class="token operator">-</span>eco <span class="token operator">-</span>incremental route_zrt_eco <span class="token operator">-</span>utilize_dangling_wires true <span class="token operator">-</span>reuse_existing_global_route true <span class="token operator">-</span>open_net_driven true save_mv_cel <span class="token operator">-</span>as eco_routed <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>在ICC中打开mw_lib中的cell</p><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl"><span class="token keyword">source</span> xxx.setupopen_mw_lib ..<span class="token operator">/</span>..<span class="token operator">/</span>XXX.libopen_mw_cell FMCW_DCORE_TOP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li><p><strong>max_transition设置</strong></p><p>signoff的标准是0.6，在pr阶段一般会过约束，可以将data_path设置为0.5，clock上设置为0.45，而clock path的max transition在cts之前再约束sdc里面就不再单独设置。</p></li></ul><p>ICC中修复hold time</p><ol><li><p>cts之前</p><p>psynopt -only_hold_time</p></li><li><p>routing阶段<br>指定布线优化选项来修复<br>route_opt -incr -only_hold_time</p></li><li><p>chipfinish</p><p>3.1 可以用CCD来修复：</p><p>&gt;focal_opt -concurrent_clock_and_data -hold_endpoints all</p><p>3.2可以让软件自动对所有hold endpoints来修复：</p><p>&gt;focal_opt -hold_endpoints all -effort high</p><p>其实可以指定某些hold endpoints来单独对它们进行优化，但是自己尝试发现没有什么用，没有PT效果那么好。</p><p>3.3 指定REG2REG路径进行修复</p><p>如果违规都集中在REG2REG的路径上，那么用下面的命令更好：</p><p>&gt;focal_opt -hold_endpoints all -register_to_register</p></li></ol><p>​3.4 手工ECO修复</p><p>​如果上述方法都不行的话，就需要手动插入buffer或者delay cell来解决了，即采用ECO的方法来手工解决。在插入之前要确保没有插入Core filler，或者有Filler的话要remove，需要注意的是不用全部remove，在放置eco cell的命令的后边会有移除部分filler的选项哟，这个非常棒。</p><p>3.5 用PT进行ECO修复</p><p>​当然这些也是可以不用手工ECO的方法，而将整个设计的网表、spef导入PT，让PT自己修复，然后导出ECO的脚本，然后将脚本导入ICC进行修复，不过感觉这个过程挺麻烦的，还不如手工来的方便，具体方法可以参见ICCECO流程那一部分。</p><h5 id="记录修复timing-removal的错误"><a href="#记录修复timing-removal的错误" class="headerlink" title="记录修复timing-removal的错误"></a>记录修复timing-removal的错误</h5><p>2024&#x2F;1&#x2F;23<br>尝试使用pt的dmsa模式修复hold time时，发现有removal的违例，很是震惊。从来没遇到过</p><img src="/2024/011821871/image-20240123205008592.png" alt style="zoom: 67%;"><p>之前clock_uncertainty的值不太对，只是修改了这个地方。就出现了recovery的违例。以为是这里的问题，修改后，发现还是有removal的违例，然后一阵搜资料。最后查看了pt 违例的timing path，发现是pt的sdc里面的input&#x2F;output delay设置的太小。导致有大量的removal违例。（类比于hold）。相当于数据保持的时间太多，不满足removal检查。</p><p>将input output delay设置好后（之前是0.35，修改为3.5。在ICC中也是3.5），removal没有违例。</p><img src="/2024/011821871/image-20240123211117779.png" alt style="zoom:67%;"><img src="/2024/011821871/eb5a2b0dce25b2ed55c869128fdd6f0.jpg" alt style="zoom: 33%;"><ul><li><p>recovery</p><p>如果report_timing的path，-end指向的是DFF的D端，则是分析setup，如果是DFF的rst端，则是recovery。</p></li><li><p>电路后仿真</p></li></ul><p>​在后仿真时，需要吃sdf文件。sdf文件既可以是ICC产生的，也可以是PT生成的。在进行带有延迟反标的仿真时，需要注意两个延迟文件之间的区别。<br>​在仿真激励tb中，使用系统函数$annotated来完成延迟反标。<br>​延迟反标的参数，有三种类型：最大、最小和典型。在ICC和PT导出的sdf文件中，每一个gate同样有三个参数。<strong>注意的是，如果不设置延迟反标的类型，会中间的默认典型值，ICC导出的sdf里面典型值不为0，PT导出sdf文件典型值为0，因此如果在使用annotated时，不指定最大最小延迟，默认典型延迟，在波形图中就不会有组合逻辑造成的多次信号跳变，导致延迟参数反标不上去</strong></p><p>icc的sdf文件</p><p><img src="/2024/011821871/image-20240127193058698.png"></p><p>pt吐出的sdf文件</p><p><img src="/2024/011821871/image-20240127193134312.png"></p><p>​措施：在使用annotated函数时，指定max&#x2F;min延迟类型，其中max用于setup检查，min用于hold检查。</p><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl">$<span class="token variable">sdf_annotate</span> <span class="token punctuation">(</span>“sdf_file”<span class="token punctuation">[</span>, “module_instance”<span class="token punctuation">]</span> <span class="token punctuation">[</span>,<span class="token operator">/</span><span class="token operator">/</span> 实例化“sdf_configfile”<span class="token punctuation">]</span><span class="token punctuation">[</span>,  <span class="token operator">/</span><span class="token operator">/</span> 一般缺省“sdf_logfile”<span class="token punctuation">]</span><span class="token punctuation">[</span>, <span class="token operator">/</span><span class="token operator">/</span> 指定vcs保存errors和warnings的log文件,<span class="token punctuation">(</span>modelsim没有这个选项<span class="token punctuation">)</span>“mtm_spec”<span class="token punctuation">]</span> <span class="token punctuation">[</span>,<span class="token operator">/</span><span class="token operator">/</span> 指定延迟类型，MINIMUM<span class="token punctuation">(</span>min<span class="token punctuation">)</span>, TYPICAL<span class="token punctuation">(</span>typ<span class="token punctuation">)</span>,MAXIMUM<span class="token punctuation">(</span>max<span class="token punctuation">)</span>“scale_factors”<span class="token punctuation">]</span><span class="token punctuation">[</span>,  <span class="token operator">/</span><span class="token operator">/</span> 缩放因子，默认1:1:1“scale_type” <span class="token operator">/</span><span class="token operator">/</span> 指定缩放之前延迟值得来源,“FROM_TYPICAL”,“FROM_MIMINUM”, <span class="token operator">/</span><span class="token operator">/</span> “FROM_MAXIMUM<span class="token string">"和"</span>FROM_MTM” <span class="token punctuation">(</span>default<span class="token punctuation">)</span>.<span class="token operator">/</span><span class="token operator">/</span> FROM_MINIMUX 选择SDF文件中mininum timing，组合逻辑的延时最小，侧重于hold time 的检查<span class="token operator">/</span><span class="token operator">/</span> FROM_TYPICAL 选择SDF文件中typical timing<span class="token operator">/</span><span class="token operator">/</span> FROM_MAXIMUM 选择SDF文件中maximum timing，组合逻辑的延时最大，侧重于setup time的检查<span class="token punctuation">]</span><span class="token punctuation">)</span>;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>在后仿过程中，需要care的点<ol><li>input 端口都要给定值，不能floating不给初值，否则内部出现x态。</li><li>激励中的时钟频率，不能超过STA时的。</li><li>有些信号是反逻辑，可能和前仿的信号不一致</li><li>如果出现了setup的违例导致功能错误，可以对比STA中path的delay与波形的delay是否一致</li></ol></li></ul><p>由于集成电路制造工艺的差异，实际电路中器件的延迟总会在一定范围内波动。Verilog 中，用户不仅可以指定 3 种类型的门延迟，还可以对每种类型的门延迟指定其最小值、典型值和最大值。</p><ul><li><p>后仿的各种组合情况</p><p>PVT_corner + fast&#x2F;typical&#x2F;slow SDF</p></li></ul><h4 id="后仿debug"><a href="#后仿debug" class="headerlink" title="后仿debug"></a>后仿debug</h4><p><code>2024/4/20 </code><br>现象：仿真开始没有x态，经过一次chirp后出现x态。<br>原因：在tb中，异步复位信号是直接给进去的，复位信号在释放时导致亚稳态的产生(上升沿和异步复位释放在同一时刻)，将该亚稳态传播下去，在某些特定条件下触发。<br>解决办法：<strong>同步复位，异步释放。</strong></p><ul><li><p>ECO</p><p>在芯片设计完成后，用于修复出现的问题。分为两个阶段：pre-mask ECO和post-mask ECO；</p></li></ul><p>​pre-mask ECO ：在设计完成后芯片还未进入工艺制造前所进行的修改。该流程的主要目的是解决设计中存在的问题，如电路逻辑不正确、功耗太高或者时序不满足等问题。</p><p>​ post-mask ECO ：设计团队需要将已制作的芯片样品反馈回来进行修改，从而修复设计中的问题。通常，post-mask ECO 采用物理层面上的修改来解决问题，例如通过引入金属连接或者改变物理结构等方式进行修复。</p><h4 id="模拟数字接口处的处理"><a href="#模拟数字接口处的处理" class="headerlink" title="模拟数字接口处的处理"></a><strong>模拟数字接口处的处理</strong></h4><ol><li>环路失锁信号pll_locked 传递给数字校准电路，需要进行打两拍的方式，降低亚稳态。</li><li>环路误差信号ek  由模拟传递给数字模块。需要进行打两拍的方式，降低亚稳态。</li><li>dco控制字 由数字传递给模拟模块。<strong>需要在dco阵列的行列译码端进行retiming操作，完成多bit的数据对齐，在数字由时钟上升沿打拍，在DCO阵列使用下降沿的寄存器对数据进行采样。之后，通过群延迟补偿模块（Fir滤波器）完成两点调制算法中  两路高通和低通路径延迟的对齐</strong></li></ol>]]></content>
      
      
      <categories>
          
          <category> ASIC数字后端流程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>异步复位和同步复位</title>
      <link href="/2023/122543491.html"/>
      <url>/2023/122543491.html</url>
      
        <content type="html"><![CDATA[<ul><li><p>常用的复位方式</p><ol><li>带同步复位的寄存器后紧跟一个不带复位的寄存器</li></ol><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span><span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>q1 <span class="token operator">&lt;=</span> <span class="token number">1'b0</span><span class="token punctuation">;</span><span class="token keyword">else</span> <span class="token keyword">begin</span>q1 <span class="token operator">&lt;=</span> d<span class="token punctuation">;</span>q2 <span class="token operator">&lt;=</span> q1<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token keyword">end</span><span class="token comment">// 错误的复位方式    q2没有被正确的复位，并且综合生成的电路也非常奇怪。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="/2023/122543491/image-20231225203911890.png" alt style="zoom: 33%;"></li></ul><p>​因为在rst_n有效时，q2没有动作，所以rst_n作为第二级寄存器的ld_en信号，将q1的结果输出在q2上。</p><p><strong>正确的code style</strong></p><pre class="line-numbers language-none"><code class="language-none">always @(posedge clk) beginif(!nrst)q1 &lt;&#x3D; 0;else q1 &lt;&#x3D; d;endalways @(posedge clk)q2 &lt;&#x3D; q1;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="/2023/122543491/image-20231225204528665.png" alt style="zoom: 33%;"><p><strong>同步复位</strong>：复位信号，只在clk的有效边沿才会发挥作用，参与输入信号d的组合逻辑，相当于做“与”逻辑。这种情况下，if-else的优先级就很重要。reset需要在if中发挥作用。</p><p>使用同步复位出现的问题：综合工具DC无法分辨复位信号和其他数据信号。<br>带同步复位的可加载触发器如下</p><img src="/2023/122543491/image-20240220164819082.png" alt style="zoom:50%;"><p>​综合工具也可能会综合成下面的结构，两者实现的功能相同。</p><img src="/2023/122543491/image-20240220164859844.png" alt style="zoom:50%;"><p>​第二种方式在门级仿真时，如果rst_n信号为低，mux的输入都是0，如果load是x态，导致触发器会输出x态，而不会复位。<strong>本质区别是 rst_n的优先级，第一种方式rst_n的优先级要高于第二种，第一种可以保证在仿真时复位的有效性</strong>，这两种方式在实际硬件中，都是可以正常复位的。因此，在仿真过程中，使用编译指令，告知综合工具，让复位信号rst_n尽可能靠近触发器，提高复位信号的优先级。</p><p><strong>优点：</strong></p><pre><code>1. 可以使用基于周期仿真的模拟器，比如verilator。2. 确保了所有的电路都是同步的。3. 由于是时钟有效时，才可以复位，所以可以过滤一些reset的毛刺。</code></pre><p><strong>缺点：</strong></p><ol><li>同步复位可能需要脉冲展宽器来保证复位脉冲足够宽</li><li>对于时钟门控的寄存器，同步复位无效。</li></ol><ul><li><strong>三态总线的复位</strong></li></ul><p>为了防止芯片上电时，内部三态总线上的总线竞争，就迫切需要时钟产生复位；</p><p>因此，芯片需要具有异步复位的功能。</p><img src="/2023/122543491/image-20231225235555437.png" alt style="zoom: 33%;"><p>也可以使用同步复位的方式实现，但是也必须使用复位信号直接撤销三态门的使能，寄存器的输出必须与rst_n做与；</p><img src="/2023/122543491/image-20231225235658088.png" alt style="zoom: 33%;"><h4 id="异步复位"><a href="#异步复位" class="headerlink" title="异步复位"></a>异步复位</h4><p>​异步复位可以保证 数据路径上没有复位信号的参与，在复位时，数据路径是干净的。</p><p>​异步复位最大的问题是 复位信号的释放。</p><p>​在DC阶段，对于clock和reset信号，通过设置输入驱动为0，表示驱动能力最强，<code>set_drive 0</code>。并设置<code>set_dont_touch_network</code>保护clk和reset信号不被修改。这样做的目的是 因为综合时，没有布局布线信息，在dc时即使插入buffer对clk和reset信号优化，也是没有意义的，到ICC阶段也会重新插buffer。反而，可能会对物理实现带来负面影响。所以最好的办法是不处理，在CTS时才真正的解决clk和reset。</p><p><strong>优点：</strong></p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token list punctuation">1.</span> 保证复位信号不会参与到数据路径中，保证数据路径是干净的。<span class="token list punctuation">2.</span> 不需要时钟，就可以进行电路的复位。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>缺点：</strong></p><ol><li>不能使用基于周期的仿真器</li><li>异步复位时，不会有亚稳态的影响，但是在释放时，很有可能clk是上升沿会采到rstn在变化，造成亚稳态。导致复位后的稳定状态丢失。</li><li>会受到毛刺的影响</li><li>异步复位 带来时序分析的困难</li></ol><ul><li><p>异步复位和异步置位寄存器</p><p>尽可能避免出现该类型的寄存器，否则，可能会造成综合前后结果不一致的问题。</p></li></ul><p>异步复位需要考虑recovery time和removal time的违例。</p><p>recovery time类似于setup time，在有效时钟沿上升之前，rst发生变化的最短时间。</p><p>removal time类似hold time，在有效时钟沿上升之后，rst发生变化所需要的最短时间。</p><ul><li><p>key points</p><p><strong>每个使用异步复位的ASIC电路，都应该包括复位同步器电路</strong>，也就是异步复位，同步释放。</p><p>异步复位同步器综合了两者的优点，</p></li></ul><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span><span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>nrst1 <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>nrst2 <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token keyword">begin</span>nrst1 <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>nrst2 <span class="token operator">&lt;=</span> nrst1<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token keyword">end</span>第二级的nrst2是为了消除，第一级异步复位信号释放带来的任何亚稳态。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="/2023/122543491/image-20231226100118399.png" alt style="zoom:50%;"><ul><li><p><strong>异步复位毛刺过滤器</strong></p><p>通过延迟电路，将延迟前后的信号做”与”，即可得到真正的复位信号。</p><img src="/2023/122543491/image-20240220172053034.png" alt style="zoom: 50%;"></li></ul><h5 id="容易出现的问题"><a href="#容易出现的问题" class="headerlink" title="容易出现的问题"></a>容易出现的问题</h5><ul><li>异步复位容易产生毛刺，导致整个电路发生复位；<br>解决办法：使用毛刺过滤电路；<br>对于时序逻辑的复位信号，当有连续周期的reset时才进行复位；<br>对于组合逻辑的复位信号，使用reset_delay &amp; reset_delay10ns判断复位；</li><li>复位信号的扇出很大，需要特殊考虑<br>解决办法：和cts一样处理；</li></ul><p>FPGA通常使用 “<strong>同步复位</strong>“处理，原因：异步复位占用更多的布线资源，导致难以满足时序性能要求。</p><p>异步复位信号的remove和recovery时间检查是在 <strong>同步释放</strong> 时检查的，异步信号对电路进行复位时，不需要进行removal和recovery时间检查。</p><img src="/2023/122543491/bf9a1b154285b85c2cec134685452f4d.png" alt="img" style="zoom:50%;"><p>因此，电路复位使用同步复位，异步释放的方式设计。</p><p>复位树和时钟树的区别，复位树不需要严格的减小skew，一般将skew约束在一个时钟周期内，保证复位有效时在一个周期内使电路进入初始状态。</p><h3 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h3><blockquote><p>《 硬件架构的艺术 数字电路的设计方法与技术》</p><p><a href="https://zhuanlan.zhihu.com/p/104550266">https://zhuanlan.zhihu.com/p/104550266</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 数字前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Makefile</title>
      <link href="/2023/11277120.html"/>
      <url>/2023/11277120.html</url>
      
        <content type="html"><![CDATA[<h2 id="Makefile"><a href="#Makefile" class="headerlink" title="Makefile"></a>Makefile</h2><h3 id="Makefile的运行"><a href="#Makefile的运行" class="headerlink" title="Makefile的运行"></a>Makefile的运行</h3><p>make -f 文件名，执行特定的Makefile文件<br>Make 的默认行为是执行Makefile的第一个target，该目标一般会带起多个目标的执行。目标中有&#x3D;，或者-打头的不能指定为终极目标，因为这些字符的目标会被解析成命令行参数或者变量。</p><pre class="line-numbers language-makefile" data-language="makefile"><code class="language-makefile"><span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> all <span class="token target symbol">all</span><span class="token punctuation">:</span> prog1 prog2 prog3 prog4<span class="token comment"># 通过make all执行所有的target</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>检查规则(常用)</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-n</span> 打印命令，不执行<span class="token parameter variable">-s</span> ：全面禁止命令的显示<span class="token parameter variable">-q</span> 寻找目标，找到什么都不输出，找不到打印错误error<span class="token parameter variable">-B</span> 认为所有目标都需要重编译<span class="token parameter variable">-C</span> <span class="token operator">&lt;</span>dir<span class="token operator">></span> 指定读取Makefile的目录，如果有多个“-C”参数，make 的解释是后面的路径以前面的作为相对路径，并以最后的目录作为被指定目录。比如“make <span class="token parameter variable">-C</span> ~hchen/test <span class="token parameter variable">-C</span> prog”等价于“make <span class="token parameter variable">-C</span> ~hchen/test/prog”。<span class="token parameter variable">-I</span> <span class="token operator">&lt;</span>dir<span class="token operator">></span> 指定一个被包含Makefile的搜索目标。可以使用多个“-I”参数来指定多个目录<span class="token parameter variable">-t</span> 更新target的时间，组织生成目标的命令运行<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>命令执行顺序</li></ul><p>命令顺序执行，如果想要当前的命令在下一行使用，需要将下行命令放在当前行，并加上“；”<br>默认使用&#x2F;bin&#x2F;sh标准执行命令</p><ul><li>命令执行出错</li></ul><p>有可能会终止整个make的执行；但是有时候命令出错是允许的，所以要在命令前加上“-”，表示忽略命令的出错。<br>或者通过命令行参数的方式，<br>-i make会忽略所有出错的命令<br>-k 表示命令出错时，终止该命令执行，但是继续执行其他规则</p><ul><li>嵌套执行make</li></ul><pre class="line-numbers language-makefile" data-language="makefile"><code class="language-makefile"><span class="token target symbol">subsystem</span><span class="token punctuation">:</span><span class="token variable">$</span><span class="token punctuation">(</span>MAKE<span class="token punctuation">)</span> -C subdir//进入子目录，执行make选项var <span class="token operator">=</span> 123<span class="token keyword">export</span> var <span class="token comment"># 声明该变量传递给子make文件</span>make -w 进入或者退出目录时会有提示<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Makefile中的变量"><a href="#Makefile中的变量" class="headerlink" title="Makefile中的变量"></a>Makefile中的变量</h3><pre class="line-numbers language-makefile" data-language="makefile"><code class="language-makefile">Var <span class="token operator">=</span> value类似C的<span class="token keyword">define</span>，强烈建议变量的引用使用括号，比如 <span class="token variable">$</span><span class="token punctuation">(</span>var<span class="token punctuation">)</span>等号右侧的变量可以是Makefile文件后面的内容，就有可能导致递归，所以要使用 <span class="token operator">:=</span>，表示只能使用前面的变量。Var <span class="token operator">:=</span> value<span class="token operator">:=</span> 在脚本编译过程中，就会对变量的进行替换，而不是在执行时替换。<span class="token operator">=</span>  在执行时才进行替换，如果该变量在后面发生了变化，会影响前面的赋值<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-makefile" data-language="makefile"><code class="language-makefile"><span class="token comment">#定义一个变量，值是一个空格</span>Nullstring <span class="token operator">:=</span>space <span class="token operator">:=</span> <span class="token variable">$Nullstring</span> <span class="token comment">#end of the line</span>dir <span class="token operator">:=</span> /foo/bar    <span class="token comment">#end</span>加了<span class="token comment">#后，表示这个dir变量最后会有4个空格导致错误。</span>Foo <span class="token operator">?=</span> valueFoo如果没有定义过，就在此处定义<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>高级用法</li></ul><pre class="line-numbers language-makefile" data-language="makefile"><code class="language-makefile">1. 变量值的替换  Foo <span class="token operator">:=</span> a.o b.o c.o  Bar <span class="token operator">:=</span> <span class="token variable">$</span><span class="token punctuation">(</span>Foo<span class="token punctuation">:</span>.o<span class="token operator">=</span>.c<span class="token punctuation">)</span>2. 变量的值当成变量  Foo <span class="token operator">:=</span> \<span class="token variable">$</span><span class="token punctuation">(</span><span class="token variable">$</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>3. 追加变量值 <span class="token operator">+=</span>  Object <span class="token operator">:=</span> main.o foo.o  Object <span class="token operator">+=</span> another.o如果前一次的是 <span class="token operator">:=</span> ，那么 <span class="token operator">+=</span> 会以 <span class="token operator">:=</span> 作为其赋值符4. 多行变量使用<span class="token keyword">define</span>   <span class="token keyword">endef</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>环境变量</li></ul><pre class="line-numbers language-makefile" data-language="makefile"><code class="language-makefile">如果在命令行参数中代入该变量，环境变量的值会被覆盖。如果make时指定了-e，环境变量会覆盖Makefile中定义的变量。Makefile中定义的变量都是全局变量，<span class="token variable">$@</span> <span class="token variable">$^…</span> 都属于规则型变量也可以为某个目标target设置局部变量，该变量会作用到有这个目标所引发的所有规则区域。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-makefile" data-language="makefile"><code class="language-makefile"><span class="token target symbol">prog</span> <span class="token punctuation">:</span> CFLAGS <span class="token operator">=</span> -g<span class="token target symbol">prog</span> <span class="token punctuation">:</span> prog.o foo.o bar.o<span class="token variable">$</span><span class="token punctuation">(</span>GCC<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>CFLAGS<span class="token punctuation">)</span> prog.o foo.o bar.o<span class="token variable">$</span><span class="token punctuation">(</span>addprefix src/,foo bar<span class="token punctuation">)</span> 为每个文件名添加前缀src/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Makefile中的函数"><a href="#Makefile中的函数" class="headerlink" title="Makefile中的函数"></a>Makefile中的函数</h3><h4 id="patsubst"><a href="#patsubst" class="headerlink" title="patsubst"></a>patsubst</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable"><span class="token variable">$(</span>patsubst <span class="token operator">&lt;</span>pattern<span class="token operator">></span>,<span class="token operator">&lt;</span>replacement<span class="token operator">></span>,<span class="token operator">&lt;</span>text<span class="token operator">></span><span class="token variable">)</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>查找&lt;text&gt; 中的单词（单词以“空格”、“Tab”或“回车”“换行”分隔）是否符合模式 &lt;pattern&gt;<br>返回被替换后的字符串</p><p>pattern：可以包含通配符%，表示任意长度的字符串。也可以是subst的&lt;from&gt;</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable"><span class="token variable">$(</span>objects:.o<span class="token operator">=</span>.c<span class="token variable">)</span></span> 和 <span class="token variable"><span class="token variable">$(</span>patsubst %.o,%.c,<span class="token punctuation">$(</span>objects<span class="token punctuation">)</span><span class="token variable">)</span></span> 是一样的<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="strip"><a href="#strip" class="headerlink" title="strip"></a>strip</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable"><span class="token variable">$(</span>strip <span class="token operator">&lt;</span>string<span class="token operator">></span><span class="token variable">)</span></span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>去掉string开头和结尾的空字符</p><h4 id="findstring"><a href="#findstring" class="headerlink" title="findstring"></a>findstring</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable"><span class="token variable">$(</span>findstring <span class="token operator">&lt;</span>find<span class="token operator">></span>,<span class="token operator">&lt;</span>in<span class="token operator">></span><span class="token variable">)</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如果找到，那么返回 &lt;find&gt; ，否则返回空字符串<br>在字串 &lt;in&gt; 中查找&lt;find&gt; 字串</p><h4 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable"><span class="token variable">$(</span>filter <span class="token operator">&lt;</span>pattern<span class="token punctuation">..</span>.<span class="token operator">></span>,<span class="token operator">&lt;</span>text<span class="token operator">></span><span class="token variable">)</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>以 &lt;pattern&gt; 模式过滤 &lt;text&gt; 字符串中的单词，保留符合模式 &lt;pattern&gt; 的单词。可以 有多个模式。 返回符合模式 &lt;pattern&gt; 的字串。<br>filter-out 功能与filter相反</p><h4 id="sort"><a href="#sort" class="headerlink" title="sort"></a>sort</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable"><span class="token variable">$(</span><span class="token function">sort</span> <span class="token operator">&lt;</span>list<span class="token operator">></span><span class="token variable">)</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>给字符串 &lt;list&gt; 中的单词排序（升序）。<br>返回排序后的字符串，sort 函数会去掉 &lt;list&gt; 中相同的单词。</p><h4 id="word"><a href="#word" class="headerlink" title="word"></a>word</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable"><span class="token variable">$(</span>word <span class="token operator">&lt;</span>n<span class="token operator">></span>,<span class="token operator">&lt;</span>text<span class="token operator">></span><span class="token variable">)</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>取字符串 &lt;text&gt; 中第 &lt;n&gt; 个单词。（从一开始）<br>返回字符串 &lt;text&gt; 中第 &lt;n&gt; 个单词。如果 &lt;n&gt; 比 &lt;text&gt; 中的单词数要大，那么返回空字符串。</p><h4 id="wordlist"><a href="#wordlist" class="headerlink" title="wordlist"></a>wordlist</h4><p>$(wordlist <ss>,<e>,<text>)<br>从字符串 &lt;text&gt; 中取从 &lt;ss&gt; 开始到 &lt;e&gt; 的单词串。&lt;ss&gt; 和 &lt;e&gt; 是一个数字</text></e></ss></p><h4 id="words"><a href="#words" class="headerlink" title="words"></a>words</h4><p>$(words <text>)<br>统计 &lt;text&gt; 中字符串中的单词个数。 如果我们要取 &lt;text&gt; 中最后的一个单词，我们可以这样：</text></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable"><span class="token variable">$(</span>word <span class="token punctuation">$(</span>words <span class="token operator">&lt;</span>text<span class="token operator">></span><span class="token punctuation">)</span>,<span class="token operator">&lt;</span>text<span class="token operator">></span><span class="token variable">)</span></span> 。<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="firstword"><a href="#firstword" class="headerlink" title="firstword"></a>firstword</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable"><span class="token variable">$(</span>firstword <span class="token operator">&lt;</span>text<span class="token operator">></span><span class="token variable">)</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>取字符串 &lt;text&gt; 中的第一个单词。 </p><h4 id="dir-文件名操作函数"><a href="#dir-文件名操作函数" class="headerlink" title="dir 文件名操作函数"></a>dir 文件名操作函数</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable"><span class="token variable">$(</span><span class="token function">dir</span> <span class="token operator">&lt;</span>names<span class="token punctuation">..</span>.<span class="token operator">></span><span class="token variable">)</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>从文件名序列 &lt;names&gt; 中取出目录部分。目录部分是指最后一个反斜杠（&#x2F; ）之前的部分。 如果没有反斜杠，那么返回 .&#x2F;</p><h4 id="notdir"><a href="#notdir" class="headerlink" title="notdir"></a>notdir</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable"><span class="token variable">$(</span>notdir <span class="token operator">&lt;</span>names<span class="token punctuation">..</span>.<span class="token operator">></span><span class="token variable">)</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>从文件名序列 &lt;names&gt; 中取出非目录部分。非目录部分是指最后一个反斜杠（&#x2F; ）之后的部分。</p><h4 id="Suffix"><a href="#Suffix" class="headerlink" title="Suffix"></a>Suffix</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable"><span class="token variable">$(</span>suffix <span class="token operator">&lt;</span>names<span class="token punctuation">..</span>.<span class="token operator">></span><span class="token variable">)</span></span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>从文件名序列 &lt;names&gt; 中取出各个文件名的后缀</p><h4 id="basename"><a href="#basename" class="headerlink" title="basename"></a>basename</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable"><span class="token variable">$(</span><span class="token function">basename</span> <span class="token operator">&lt;</span>names<span class="token punctuation">..</span>.<span class="token operator">></span><span class="token variable">)</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>从文件名序列 &lt;names&gt; 中取出各个文件名的前缀部分。</p><h4 id="addsuffix"><a href="#addsuffix" class="headerlink" title="addsuffix"></a>addsuffix</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable"><span class="token variable">$(</span>addsuffix <span class="token operator">&lt;</span>suffix<span class="token operator">></span>,<span class="token operator">&lt;</span>names<span class="token punctuation">..</span>.<span class="token operator">></span><span class="token variable">)</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>加后缀，把后缀 &lt;suffix&gt; 加到 <names> 中的每个单词后面。</names></p><h4 id="addprefix"><a href="#addprefix" class="headerlink" title="addprefix"></a>addprefix</h4><p>$(addprefix <prefix>,&lt;names…&gt;)<br>把前缀 &lt;prefix&gt; 加到 &lt;names&gt; 中的每个单词前面。 </prefix></p><h4 id="join"><a href="#join" class="headerlink" title="join"></a>join</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable"><span class="token variable">$(</span><span class="token function">join</span> <span class="token operator">&lt;</span>list<span class="token operator"><span class="token file-descriptor important">1</span>></span>,<span class="token operator">&lt;</span>list<span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token variable">)</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>连接list1 和list2</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable"><span class="token variable">$(</span><span class="token function">join</span> aaa bbb , <span class="token number">111</span> <span class="token number">222</span> <span class="token number">333</span><span class="token variable">)</span></span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>返回值是 aaa111 bbb222 333</p><h4 id="foreach-函数"><a href="#foreach-函数" class="headerlink" title="foreach 函数"></a>foreach 函数</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable"><span class="token variable">$(</span>foreach <span class="token operator">&lt;</span>var<span class="token operator">></span>,<span class="token operator">&lt;</span>list<span class="token operator">></span>,<span class="token operator">&lt;</span>text<span class="token operator">></span><span class="token variable">)</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>把参数 &lt;list&gt; 中的单词逐一取出放到参数 &lt;var&gt; 所指定的变量中，然后再执行 &lt;text&gt; 所包含的表达式。每一次 &lt;text&gt; 会返回一个字符串，循环过程中，&lt;text&gt; 的所返回的每个字符串会以空格分隔，最后当整个循环结束时，&lt;text&gt; 所返回的每个字符串所组成的整个字符串（以空格分隔）将会是 foreach 函数的返回值.   var是一个临时变量，作用域只在 foreach 函数</p><p>&lt;var&gt; 最好是一个变量名,&lt;list&gt; 可以是一个表达式，而 &lt;text&gt; 中一般会使用 &lt;var&gt; 这个 参数来依次枚举 &lt;list&gt; 中的单词</p><h4 id="if-函数"><a href="#if-函数" class="headerlink" title="if 函数"></a>if 函数</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable"><span class="token variable">$(</span><span class="token keyword">if</span> <span class="token operator">&lt;</span>condition<span class="token operator">></span>,<span class="token operator">&lt;</span>then-part<span class="token operator">></span><span class="token variable">)</span></span><span class="token variable"><span class="token variable">$(</span><span class="token keyword">if</span> <span class="token operator">&lt;</span>condition<span class="token operator">></span>,<span class="token operator">&lt;</span>then-part<span class="token operator">></span>,<span class="token operator">&lt;</span>else-part<span class="token operator">></span><span class="token variable">)</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>即 if 函数的参数可以是两个，也可以是三个。&lt;condition&gt; 参数是 if 的表达式，如果其返回的为非空字符串，那么这个表达式就相当于返回真，于是，&lt;then-part&gt; 会被计算，否则 &lt;else-part&gt; 会被计算。</p><h4 id="shell-函数"><a href="#shell-函数" class="headerlink" title="shell 函数"></a>shell 函数</h4><p>操作系统 Shell 的命令<br>shell 函数把执行操作系统命令后的输出作为函数返回</p><h4 id="控制-make-的函数"><a href="#控制-make-的函数" class="headerlink" title="控制 make 的函数"></a>控制 make 的函数</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable"><span class="token variable">$(</span>error <span class="token operator">&lt;</span>text <span class="token punctuation">..</span>.<span class="token operator">></span><span class="token variable">)</span></span> <span class="token variable"><span class="token variable">$(</span>warning <span class="token operator">&lt;</span>text <span class="token punctuation">..</span>.<span class="token operator">></span><span class="token variable">)</span></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>很像 error 函数，只是它并不会让 make 退出，只是输出一段警告信息，而 make 继续执行。</p><h4 id="wildcard"><a href="#wildcard" class="headerlink" title="wildcard"></a><strong>wildcard</strong></h4><pre class="line-numbers language-makefile" data-language="makefile"><code class="language-makefile"><span class="token comment">#显示扩展名</span><span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">wildcard</span> *.v<span class="token punctuation">)</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="readlink"><a href="#readlink" class="headerlink" title="readlink"></a>readlink</h4><pre class="line-numbers language-makefile" data-language="makefile"><code class="language-makefile">打印解析符号链接或符号链接的规范文件名-f 通过递归给出指定名称的符号链接当前脚本的绝对路径：readlink -m <span class="token variable">$0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="abspath"><a href="#abspath" class="headerlink" title="abspath"></a>abspath</h4><pre class="line-numbers language-makefile" data-language="makefile"><code class="language-makefile"><span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">abspath</span> ./src<span class="token punctuation">)</span> <span class="token comment"># 返回目录或者文件的绝对路径</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="用法"><a href="#用法" class="headerlink" title="$$ 用法"></a>$$ 用法</h4><pre class="line-numbers language-makefile" data-language="makefile"><code class="language-makefile">SRC <span class="token operator">:=</span> A.c B.c<span class="token target symbol">process</span><span class="token punctuation">:</span>for i in <span class="token variable">$</span><span class="token punctuation">(</span>SRC<span class="token punctuation">)</span><span class="token punctuation">;</span> do \readlink -f <span class="token variable">$$i</span> >> <span class="token variable">$file</span> \done使用两个<span class="token variable">$$，是因为i在shell的for循环中展开，属于shell的变量，相当于两层变量的嵌套。make读到$$i时候，会进行转义，展开成$i，然后交给shell解释程序。施加了$$的变量，需要两次展开，才能得到变量的值。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Makefile中C编译、链接选项"><a href="#Makefile中C编译、链接选项" class="headerlink" title="Makefile中C编译、链接选项"></a>Makefile中C编译、链接选项</h3><pre class="line-numbers language-makefile" data-language="makefile"><code class="language-makefile">CFLAGS参数<span class="token operator">|</span><span class="token operator">|</span>编译<span class="token operator">|</span><span class="token operator">|</span>-c<span class="token comment"># 将C编译成.o目标文件，不链接</span>-o<span class="token comment"># 重命名</span>-Idir<span class="token comment"># 将新路径添加到include路径中，-I. -I/opt/usr...</span>-Wall   <span class="token comment"># 生成所有warning，并停止编译</span>-w<span class="token comment"># 关闭所有warning</span>-O<span class="token comment"># 优化编译选项</span>LDFLAGS参数<span class="token operator">|</span><span class="token operator">|</span>链接<span class="token operator">|</span><span class="token operator">|</span>-lxxx<span class="token comment"># 添加动态链接库，在搜索目录中找xxx.a，xxx.so的库文件</span>-static<span class="token comment"># 使用静态链接库生成目标文件，避免使用共享库</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux基础知识 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Makefile </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vim/vscode配置和操作</title>
      <link href="/2023/112521332.html"/>
      <url>/2023/112521332.html</url>
      
        <content type="html"><![CDATA[<h2 id="Vim"><a href="#Vim" class="headerlink" title="Vim"></a>Vim</h2><h3 id="实现一列序号递增"><a href="#实现一列序号递增" class="headerlink" title="实现一列序号递增"></a>实现一列序号递增</h3><p>ctrl-v 选中列，然后 g + ctrl-a</p><pre class="line-numbers language-vim" data-language="vim"><code class="language-vim">my_array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>   my_array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>my_array<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> my_array<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>my_array<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>my_array<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>my_array<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>my_array<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>my_array<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>my_array<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>my_array<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>my_array<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>my_array<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="比较文件"><a href="#比较文件" class="headerlink" title="比较文件"></a>比较文件</h3><ul><li>bash下使用vim</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> <span class="token parameter variable">-d</span> file1 file2vimdiff file1 file2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>已经打开一个文件，打开另外一个文件对比</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">vert diffsplit file2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>打开两个文件</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">在两个文件中分别执行  diffthis<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>vim filename +50   打开filename，并跳转到第50行</p><pre class="line-numbers language-none"><code class="language-none">:w new_file<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="生成递增递减序列（10进制，16进制）-vimincr插件"><a href="#生成递增递减序列（10进制，16进制）-vimincr插件" class="headerlink" title="生成递增递减序列（10进制，16进制）  vimincr插件"></a>生成递增递减序列（10进制，16进制）  vimincr插件</h3><p>按10进制递增：Ctrl+v选中，shift+；，输入命令II 或者 I</p><p>按10进制递减：Ctrl+v选中，shift+；，输入命令II-1或者 I-1   </p><p>按16进制递增：Ctrl+v选中，shift+；，输入命令IIX 或者 IX</p><p>按16进制递减：Ctrl+v选中，shift+；，输入命令IIX-1或者 IX-1 </p><h4 id="只查看文件"><a href="#只查看文件" class="headerlink" title="只查看文件"></a>只查看文件</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">less</span> filename<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux基础知识 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vim Vscode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpyGalss</title>
      <link href="/2023/112431792.html"/>
      <url>/2023/112431792.html</url>
      
        <content type="html"><![CDATA[<h3 id="SPYGLASS"><a href="#SPYGLASS" class="headerlink" title="SPYGLASS"></a>SPYGLASS</h3><p>主要用于检查设计中的跨时钟域CDC问题，包含五大模块：lint，CDC（跨时钟域检查），LP（低功耗），Constraint（约束），DFT（可测性）。类似pt，属于静态验证工具，不需要编写testbench。</p><p>Rule：spyglass进行RTL分析的最小单位.<br>Goal：是一系列相关rule的集合，组合起来完成RTL的某个特定任务，user可以用guidewave定义好的goal，也可以自定义，可以指定规则的顺序。<br>Sub-Methodology：一系列Goal的集合，用以达成某方面特定目标。</p><p>SGDC：Constraints文件，包含clock和reset等约束信息</p><pre class="line-numbers language-sdc" data-language="sdc"><code class="language-sdc">current_design &quot;key_top&quot;clock -name clk -period 10 -edge 0 5reset -name rstn -value 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>Waiver：用以过滤一些结果的文件</p><p>CDC：检查异步信号有没有同步处理就使用，组合逻辑是否有毛刺。</p><p>parameter：可以在进行RTL分析之前设定某些参数，对检查过程进行一些约束。</p><ul><li>Lint 中各个goal主要检查什么？</li></ul><p><img src="/2023/112431792/image-20231128002240109.png"></p><ul><li>Lint 检查时设置方法学，检查目标集合</li></ul><p><img src="/2023/112431792/image-20231128002527247.png"></p><p>具体操作：</p><ul><li><p>按 ‘e’ 修改代码。</p></li><li><p>对于有问题的地方，比如锁存器，可以查看原理图。</p></li></ul><p>spyglass会生成较多报告，其中常用的是<strong>moresimple.rpt</strong>，显示源文件中的错误。</p><p>使用<strong>ifdef</strong>构造来启用固定代码，添加以下内容来启用宏，从而启用<strong>Fix_W415</strong>宏：</p><blockquote><p><strong>set_option define { Fix_W415 }</strong></p><p>可以替换掉文件开头定义的&#96;define</p></blockquote><ul><li><p>读入的文件</p><ol><li>设计文件：.v或者.sv</li><li>约束文件：.sgdc</li><li>HDL libraries：之前编译过的verilog库</li></ol></li></ul><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl"><span class="token comment"># tcl 命令</span>read_file <span class="token operator">-</span>type verilog  xx.vread_file <span class="token operator">-</span>type sourcelist filelist.fread_file <span class="token operator">-</span>type sgdc xxx.sgdc<span class="token comment"># common settings</span>set_option top xxxset_option enableSV yes<span class="token comment"># SDC文件可以直接被spyglass读取，自动转换成SGDC，需要进行以下设置</span>set_option sdc2sgdc yescurrent_design xxxsdc_data <span class="token operator">-</span>file ssss_src.sdc<span class="token comment">#设置异步复位的值</span>reset <span class="token operator">-</span>name <span class="token string">"xxx.xx.Z"</span> <span class="token operator">-</span>async <span class="token operator">-</span>value 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>约束文件 .sgdc</li></ul><p>​包括clock，reset，set_case_analysis( -name -value)<br>  <pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl"><span class="token operator">/</span><span class="token operator">/</span>指定模块顶层current_design training <span class="token operator">/</span><span class="token operator">/</span>约束时钟, 模块顶层所有的时钟都要约束<span class="token keyword">clock</span> <span class="token operator">-</span>name CLKA <span class="token operator">-</span>period 10 <span class="token operator">-</span>edge <span class="token punctuation">&#123;</span>0 5<span class="token punctuation">&#125;</span><span class="token keyword">clock</span> <span class="token operator">-</span>name CLKB <span class="token operator">-</span>period 100 <span class="token operator">-</span>edge <span class="token punctuation">&#123;</span>0 50<span class="token punctuation">&#125;</span><span class="token operator">/</span><span class="token operator">/</span>约束复位reset <span class="token operator">-</span>name reset_a <span class="token operator">-</span>value 0reset <span class="token operator">-</span>name reset_b <span class="token operator">-</span>value 0<span class="token operator">/</span><span class="token operator">/</span>约束输入端口input <span class="token operator">-</span>name <span class="token punctuation">&#123;</span>in_a in_b reset_a<span class="token punctuation">&#125;</span> <span class="token operator">-</span>clock CLKAinput <span class="token operator">-</span>name <span class="token punctuation">&#123;</span>resetn_b<span class="token punctuation">&#125;</span> <span class="token operator">-</span>clock CLKB<span class="token operator">/</span><span class="token operator">/</span>约束输出端口output <span class="token operator">-</span>name <span class="token punctuation">&#123;</span>dout<span class="token punctuation">&#125;</span> <span class="token operator">-</span>clock CLKB<span class="token operator">/</span><span class="token operator">/</span>如果有SDC约束文件sdc_data <span class="token operator">-</span>file ..<span class="token operator">/</span>my_file.sdc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><ul><li>文件不同颜色标识<ul><li>绿色代表该模块可分析，但是不可综合</li><li>黑色表示作为黑盒子存在</li><li>白色代表可分析，可综合</li></ul></li></ul><p>手动添加waiver放弃对一些电路的检查。</p><h6 id="生成报告"><a href="#生成报告" class="headerlink" title="生成报告"></a>生成报告</h6><pre class="line-numbers language-none"><code class="language-none">write_aggregate_report datasheet write_aggregate_report dashboard<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><a href="https://blog.csdn.net/qq_21842097/article/details/122538986?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~Rate-1-122538986-blog-122534341.235%5Ev38%5Epc_relevant_sort_base3&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~Rate-1-122538986-blog-122534341.235%5Ev38%5Epc_relevant_sort_base3&utm_relevant_index=1">https://blog.csdn.net/qq_21842097/article/details/122538986?spm=1001.2101.3001.6661.1&amp;utm_medium=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-122538986-blog-122534341.235%5Ev38%5Epc_relevant_sort_base3&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-122538986-blog-122534341.235%5Ev38%5Epc_relevant_sort_base3&amp;utm_relevant_index=1</a></p><ul><li><p>时钟和复位</p><p><strong>cdc_setup中的rules</strong>：<strong>clock_info1, reset_info1, setup_clock01</strong></p><ul><li><p>clock_info1</p><p>Primary Clocks: 普通输入时钟<br>Black box clocks：黑盒或工艺库单元输出的时钟<br>Derived：寄存器或工艺库单元输出的时钟<br>Undrived Clocks：悬空的线或者门控锁存器输出的时钟<br>Gated clocks：组合逻辑输出的时钟</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">top</span><span class="token punctuation">(</span><span class="token keyword">input</span>  clk1<span class="token punctuation">,</span><span class="token keyword">input</span>  rstn<span class="token punctuation">,</span><span class="token keyword">input</span>  <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> d<span class="token punctuation">,</span>    <span class="token keyword">output</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> q<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">wire</span> clk3<span class="token punctuation">,</span> clk4<span class="token punctuation">;</span><span class="token keyword">reg</span> clk2<span class="token punctuation">;</span><span class="token function">BB</span><span class="token punctuation">(</span>clk1<span class="token punctuation">,</span> clk3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk1 <span class="token keyword">or</span> <span class="token keyword">negedge</span> rstn<span class="token punctuation">)</span><span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rstn<span class="token punctuation">)</span> clk2 <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">else</span> clk2 <span class="token operator">&lt;=</span> <span class="token operator">~</span>clk2<span class="token punctuation">;</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk4 <span class="token keyword">or</span> <span class="token keyword">negedge</span> rstn<span class="token punctuation">)</span> <span class="token keyword">begin</span><span class="token keyword">end</span><span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>clk1是primary clock，clk2是Derived clock，clk3是Black box clocks，clk4是Undrived Clocks</p></li><li><p>Reset_info1</p><table><thead><tr><th>普通复位</th><th>Primary Presets&#x2F;Clears</th></tr></thead><tbody><tr><td>黑盒（blackbox）或工艺库单元产生的复位</td><td>Black box Presets&#x2F;Clears</td></tr><tr><td>寄存器产生的复位</td><td>Derived Presets&#x2F;Clears</td></tr><tr><td>悬空的线产生的复位</td><td>Undrived Presets&#x2F;Clears</td></tr><tr><td>锁存器，三态器件产生的复位</td><td>Gated Presets&#x2F;Clears</td></tr></tbody></table></li><li><p>Setup_clock01</p><p>报告时钟源，时钟使能信号和clock cone<br>设计中多个输入时钟通过选择器后只输出一个时钟，输出的时钟称为clock cone。</p><img src="/2023/112431792/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3pob25nX2V0aGFu,size_16,color_FFFFFF,t_70.png" alt style="zoom:50%;"></li></ul></li><li><p>CDC_setup_check</p><p><strong>clock_info03a，clock_info05a&#x2F;b， clock_info18</strong></p><ul><li><p>clock_info03a  报告设计中未被约束的时钟引脚。</p><ol><li>时钟经过组合逻辑被disabled，门控时钟 <img src="/2023/112431792/290753-20220707153610355-1659264831.png" alt style="zoom:67%;"></li><li>约束文件中没有约束时钟引脚，且use_inferred_clocks参数被设置为No<img src="/2023/112431792/290753-20220707153634456-628658853.png" alt style="zoom: 67%;"></li><li>时钟路径上有Blackbox，且Blackbox输出的时钟没有约束<img src="/2023/112431792/290753-20220707153647566-2088386241.png" alt style="zoom:67%;"></li><li>时钟在设计中没有传输，断头时钟。<img src="/2023/112431792/290753-20220707153659862-637731003.png" alt styl="zoom:67%;"></li></ol></li><li><p>clock_info05a&#x2F;b</p><p>在设计如果有clock的mux选择输出，需要指定set_case_analysis命令来约束。</p><pre class="line-numbers language-none"><code class="language-none">input ports: clk1, clk2  output port: clkout  enable port: in1  assign clkout &#x3D; in1 ? clk1 : clk2;  在sgdc文件中：  current_design test  clock -name clk1   clock -name clk2  这样报违例。需要进行下面的配置  set_case_analysis -name in1 -value 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>clock_info18</p><p>报告设计中未约束的引脚<br>sgdc中一定要约束所有的输入、输出引脚，时钟引脚以及BLACKBOX的引脚。</p><p>包括：input，output，clock，reset，set_case_analysis，abstract_port</p></li></ul></li><li><p>CDC_verify_struct</p><p>​主要检查设计中是否有 未同步的信号，是否有毛刺。</p><ul><li><p><strong>AC_unsync01&#x2F;02</strong></p><p>如果源寄存器是控制信号，检查信号是否通过一个有效同步器。<br>如果源寄存器是数据信号，检查是否使用异步fifo或握手信号。</p></li><li><p><strong>AC_SYNC01&#x2F;02</strong></p><p>报告设计中已经同步的信号，这项规则只会报告信息，不会报告违例。</p></li><li><p><strong>AC_conv01&#x2F;02&#x2F;03</strong></p><p>报告设计中的聚合问题，可能引起数据不一致性，即同步前后数据不一致。</p><p>AC_conv01报告信号经过同步器+寄存器后的聚合违例。</p></li></ul></li></ul><img src="/2023/112431792/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3pob25nX2V0aGFu,size_16,color_FFFFFF,t_70-1706510260564-11.png" alt style="zoom:67%;"><p>​多bit信号，在同步后经过不同数量的寄存器，最终在一个逻辑门聚合。在源寄存器端发送的是00-&gt;11，在目的寄存器聚合的输入端的结果是00-&gt;10-&gt;11，导致和源寄存器端发送的结果不一致（数据一致性问题）。但是如果是单bit的数据变化，就不会有这种问题。<br>​<img src="/2023/112431792/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3pob25nX2V0aGFu,size_16,color_FFFFFF,t_70-1706524314470-14.png" alt style="zoom: 67%;"></p><p>​上图所描述的问题也是一样的。</p><p>​<img src="/2023/112431792/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3pob25nX2V0aGFu,size_16,color_FFFFFF,t_70-1706524438604-17.png" alt style="zoom:67%;"><br>​这种情况下没有违例，两个信号由同一个控制信号控制。如果报出违例，检查设置确实没有问题，可以设置cdc_false_path命令约束。</p><p>​AC_conv02规则报告信号经过同步器后违例，且聚合后又通过了寄存器。</p><p>​<img src="/2023/112431792/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3pob25nX2V0aGFu,size_16,color_FFFFFF,t_70-1706525364578-20.png" alt style="zoom:67%;"><br>​这种方式和上面的conv01不同，上面的聚合发生在寄存器后，而这种方式聚合发生在同步后，同样会出现数据一致性问题。（多bit数据同步，不能采用单bit打两拍的方式）。<strong>解决办法：如果是计数器，可以将多bit数据转成格雷码，在发送端打一拍，然后再传递出去。</strong></p><p>​报告同一个信号经过多条同步路径后，又聚合的问题。类似于多比特数据的同步问题。</p><img src="/2023/112431792/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3pob25nX2V0aGFu,size_16,color_FFFFFF,t_70-1706525889668-23.png" alt style="zoom:67%;"><p>​AC_conv03规则检查不同时钟域信号，经过同一个时钟域同步后的聚合问题。</p><p><img src="/2023/112431792/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3pob25nX2V0aGFu,size_16,color_FFFFFF,t_70-1706526000058-26.png"></p><p>​AC_glitch03 报告设计中的毛刺。</p><ul><li><strong>Clock_sync05&#x2F;06</strong></li></ul><p>​Clock_sync05报告输入信号被多个不同的时钟域寄存器采样。</p><p>​<img src="/2023/112431792/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3pob25nX2V0aGFu,size_16,color_FFFFFF,t_70-1706527099731-29.png" alt style="zoom: 80%;"></p><p>​Clock_syn06报告输出信号由多个时钟域信号组合而成。<br><img src="/2023/112431792/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3pob25nX2V0aGFu,size_16,color_FFFFFF,t_70-1706527140384-32.png"></p><p>​<strong>如果确保设计没有问题，可以使用set_case_analysis命令加强对输入信号的约束</strong></p><p><strong>AC_cdc01a AC_cdcdatahold1a AC_conv02&#x2F;04&#x2F;05 AC_fifo01 AC_handshake01&#x2F;02</strong></p><p>检查CDC_verify(functional cdc checks)：数据完整性、格雷码编码、FIFO上溢或下溢和握手协议。</p><p>AC_cdc01a<br>    检查快时钟到慢时钟同步数据传输是否丢失。</p><img src="/2023/112431792/290753-20220707155308615-135013952.png" alt style="zoom:80%;"><p>​如果快时钟域的信号只维持一个周期，慢时钟域很容易采不到。快时钟域的信号变化至少维持慢时钟域的1.5个周期不变。</p><p><img src="/2023/112431792/290753-20220707155318653-96027376.png"></p><p>AC_datahold01a 检查多bit数据被另一个时钟域采样时是否稳定，与上面的cdc_01a检查单bit类似.FIFO、握手、门控同步模块都不会被检查。</p><p>AC_conv02&#x2F;04&#x2F;05 检查跨时钟传输过程中没有聚合，也没有格雷码编码的多比特控制信号。<br>检查是否使用格雷码编码</p><p><img src="/2023/112431792/290753-20220707155437109-1964738978.png"></p><p>检查不同bit信号是否使用不同的同步方式，src_bus[0]采用多级同步器方式同步，src_bus[1]采用同步控制信号方式</p><p><img src="/2023/112431792/290753-20220707155449430-751485405.png"></p><p>检查不同bit信号是否使用同一个同步控制信号，src_bus[0]与src_bus[1]采用不同的同步控制信号</p><p><img src="/2023/112431792/290753-20220707155459981-1844018659.png"></p><p>AC_fifo01：检查fifo是否上溢或者下溢</p><p>AC_handshake01&#x2F;02: </p><p>01检查req-&gt;ack信号是否满足四相握手协议。REQ拉高-&gt;ACK拉高-&gt;REQ拉低-&gt;ACK拉低。valid&#x3D;》REQ，ready&#x3D;》ACK</p><p><img src="/2023/112431792/290753-20220707155544879-178987688.png"></p><p>02检查是否会有数据丢失 </p><h3 id="项目中出现的问题"><a href="#项目中出现的问题" class="headerlink" title="项目中出现的问题"></a>项目中出现的问题</h3><h4 id="LINT检查误报生成锁存器"><a href="#LINT检查误报生成锁存器" class="headerlink" title="LINT检查误报生成锁存器"></a>LINT检查误报生成锁存器</h4><p>code如下</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>        <span class="token function">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>W_LORA_MEM<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>            Avg_Mem_c_sum<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>     <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>save_avg_data_en<span class="token punctuation">)</span> <span class="token keyword">begin</span>         <span class="token function">if</span><span class="token punctuation">(</span>up_endpoint_en<span class="token punctuation">)</span>            Avg_Mem_c_sum<span class="token punctuation">[</span>save_data_counter<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> c_sum <span class="token operator">+</span> Mem<span class="token punctuation">[</span>acc_cnt<span class="token punctuation">]</span><span class="token punctuation">;</span>         <span class="token keyword">else</span>             Avg_Mem_c_sum<span class="token punctuation">[</span>save_data_counter<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> c_sum<span class="token punctuation">;</span>     <span class="token keyword">end</span><span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2023/112431792/image-20240325162129005.png" alt="image-20240325162129005"></p><p>通过代码看出，Avg_Mem_c_sum[0]不会生成锁存器，但是报出来会生成。因此写出完整的代码如下，就可以解决这个问题。</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>        <span class="token function">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>W_LORA_MEM<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>            Avg_Mem_c_sum<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>     <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>save_avg_data_en<span class="token punctuation">)</span> <span class="token keyword">begin</span>         <span class="token function">if</span><span class="token punctuation">(</span>up_endpoint_en<span class="token punctuation">)</span>            Avg_Mem_c_sum<span class="token punctuation">[</span>save_data_counter<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> c_sum <span class="token operator">+</span> Mem<span class="token punctuation">[</span>acc_cnt<span class="token punctuation">]</span><span class="token punctuation">;</span>         <span class="token keyword">else</span>             Avg_Mem_c_sum<span class="token punctuation">[</span>save_data_counter<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> c_sum<span class="token punctuation">;</span>     <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token keyword">begin</span>        <span class="token function">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>W_LORA_MEM<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>            Avg_Mem_c_sum<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> Avg_Mem_c_sum<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token keyword">end</span><span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="违例：异步复位信号作为其他寄存器的同步处理"><a href="#违例：异步复位信号作为其他寄存器的同步处理" class="headerlink" title="违例：异步复位信号作为其他寄存器的同步处理"></a>违例：异步复位信号作为其他寄存器的同步处理</h4><p>nrst一般只作为异步复位信号，如果nrst作为其他寄存器的同步信号，就会报违例。</p><p>当异步复位&#x2F;置位信号作为非复位或者同步复位时，报告违例。</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span><span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>out1 <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">else</span> out1 <span class="token operator">&lt;=</span> in<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>out2 <span class="token operator">&lt;=</span> nrst<span class="token punctuation">;</span><span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其中，nrst本身是异步复位信号，但nrst作为了out2寄存器的输入信号，相当于跨时钟域的信号，直接接入到同步电路中，并没有经过降低亚稳态的处理，所以静态时序分析很困难。</p><p>如果同步复位和异步复位混用，同样会报该违例。</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token important">always @</span><span class="token punctuation">(</span>posedeg clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span><span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span>out <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">else</span>out <span class="token operator">&lt;=</span> in<span class="token punctuation">;</span><span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>生成的类似电路图如下，异步复位参与了同步信号运算作为输入给到寄存器。nrst需要满足setup和recovery时间</p><img src="/2023/112431792/image-20240325235809883.png" alt="image-20240325235809883" style="zoom: 33%;"><p>在带有使能功能的RTL设计中，如果在敏感列表中引入了negedge nrst，在always里面没有进行复位，此时，nrst会作为参与同步使能信号（做与运算）进行综合电路。</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token important">always @</span><span class="token punctuation">(</span>posedeg clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span><span class="token function">if</span><span class="token punctuation">(</span>load_en<span class="token punctuation">)</span>out <span class="token operator">&lt;=</span> in<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token comment">// 报错，无法推断哪个是时钟信号。有两个时钟信号控制输出。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token keyword">begin</span>out1 <span class="token operator">&lt;=</span> in1<span class="token punctuation">;</span>    <span class="token keyword">end</span><span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果nrst信号忘记写，nrst会被当做同步使能信号。该代码综合出来的结果如下图所示。</p><p><img src="/2023/112431792/image-20240326003348858.png" alt="image-20240326003348858"></p><p>tips：在设计中，一般只使用一种复位方案，同步或者异步复位。混合使用这两种方案可能会导致系统部分复位，并且可能不符合 SoC 的设计意图。此外，可能会对 STA 产生影响，对于异步重置，需要满足恢复时间（取消断言）。对于同步复位，需要满足setup建立时间。</p><p>敏感列表中的信号，在always块中必须有作用才行，否则不知道时序电路的时钟信号是哪个。</p><h4 id="违例：同步FIFO中有组合逻辑环"><a href="#违例：同步FIFO中有组合逻辑环" class="headerlink" title="违例：同步FIFO中有组合逻辑环"></a>违例：同步FIFO中有组合逻辑环</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token comment">// comb logic</span>  <span class="token function">if</span><span class="token punctuation">(</span>rd_en <span class="token operator">&amp;</span> <span class="token operator">!</span>fifo_empty<span class="token punctuation">)</span>    rd_data <span class="token operator">=</span> ram<span class="token punctuation">[</span>rd_ptr<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">else</span>    rd_data <span class="token operator">=</span> <span class="token number">'h0</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token comment">// 在FIFO输出rdata时，需要组合逻辑输出。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>按照上面的逻辑，rdata输出和rd_en有关，rd_en是输入的控制信号，如果rdata影响rd_en，rd_en也会影响rdata，两者形成了组合逻辑环。在spyglass中会报错。（取决于rden和rdata是否有组合逻辑的关联，在AXI4交叉矩阵设计的项目中确实存在组合逻辑的关联）</p><p>在spyglass检查组合逻辑环是静态检查，如果是下面的代码</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token comment">// comb logic</span>  <span class="token function">if</span><span class="token punctuation">(</span>rd_en <span class="token operator">&amp;</span> <span class="token operator">!</span>fifo_empty<span class="token punctuation">)</span>    rd_data <span class="token operator">=</span> ram<span class="token punctuation">[</span>rd_ptr<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">else</span>    rd_data <span class="token operator">=</span> ram<span class="token punctuation">[</span>rd_ptr<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>无论rd_en为1还是0，rdata输出都是一样的，rd_ptr也是时序逻辑输出，所以并不存在组合逻辑环的情况。但是spyglass会报出组合逻辑环的违例。这是因为rdata影响了rd_en，rd_en会影响rdata。rdata的输出是取决于rd_en的，但是rdata无论是1还是0，输出一样，spyglass并不会检查输出值是否一样，而是检测是否存在分支，只要有分支，就存在组合逻辑环的潜在危险。</p><p>正确逻辑的代码如下</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token important">always @</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>  <span class="token comment">// comb logic</span>  <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>fifo_empty<span class="token punctuation">)</span>    rd_data <span class="token operator">=</span> ram<span class="token punctuation">[</span>rd_ptr<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">else</span>    rd_data <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>将rdata输出与rd_en解耦，不让他存在回环的可能性。且rdata的输出只与时序逻辑有关，fifo_empty是取决于时序逻辑cnt和rd_ptr的。</p><p><strong>总结：spyglass报出组合逻辑环违例，并不会真正的发生组合逻辑回环。但是代码一定有问题，需要自己斟酌。</strong></p><h5 id="组合逻辑环verilog-bug"><a href="#组合逻辑环verilog-bug" class="headerlink" title="组合逻辑环verilog bug"></a>组合逻辑环verilog bug</h5><p>参考网上博客 <a href="https://blog.csdn.net/kuan__/article/details/138872121">https://blog.csdn.net/kuan__/article/details/138872121</a></p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">module</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token keyword">input</span> b<span class="token punctuation">;</span><span class="token keyword">output</span> a0<span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">assign</span> a  <span class="token operator">=</span> <span class="token operator">!</span>b <span class="token operator">?</span> a0 <span class="token punctuation">:</span> <span class="token number">1'b1</span><span class="token punctuation">;</span><span class="token keyword">assign</span> a0 <span class="token operator">=</span> <span class="token operator">!</span>b <span class="token operator">?</span> <span class="token number">1'b0</span> <span class="token punctuation">:</span> a<span class="token punctuation">;</span><span class="token keyword">endmodule</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>按照逻辑来说，b无论是0还是1，a0都是确定的，且没有组合逻辑环。但是如果b给到a和a0的mux有延迟。就可能存在组合逻辑环。</p><img src="/2023/112431792/59b0aca63ec84c72ad065f91f39a7e89.png" alt="请添加图片描述" style="zoom: 50%;"><p>从上面的代码也可以看出，a0和a之间存在组合逻辑环的潜在危险。a0和a有关，a和a0有关。</p>]]></content>
      
      
      <categories>
          
          <category> 数字中端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpyGalss </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>add delay to verilog models</title>
      <link href="/2023/112317390.html"/>
      <url>/2023/112317390.html</url>
      
        <content type="html"><![CDATA[<h2 id="verilog中的延迟模型"><a href="#verilog中的延迟模型" class="headerlink" title="verilog中的延迟模型"></a>verilog中的延迟模型</h2><h4 id="block-assignment（always）-“-”-阻塞赋值"><a href="#block-assignment（always）-“-”-阻塞赋值" class="headerlink" title="block assignment（always） “&#x3D;” 阻塞赋值"></a>block assignment（always） “&#x3D;” 阻塞赋值</h4><p>分为两种方式：LHS、RHS</p><ul><li>LHS</li></ul><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token important">always @</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token comment">//LHS always @(a) // RHS</span>  <span class="token number">#5</span> y <span class="token operator">=</span> <span class="token operator">~</span>a<span class="token punctuation">;</span>  y <span class="token operator">=</span> <span class="token number">#5</span> <span class="token operator">~</span>a<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><img src="/2023/112317390/image-20231123170149369.png" alt="LHS in always" style="zoom: 67%;"><img src="/2023/112317390/image-20231123170340908.png" alt="always 阻塞 LHS" style="zoom: 67%;"><p>​总结：LHS是在第一次变量发生变化后，延迟12ns才进行真正的计算，如上图所示15ns后其他变量发生了变化，输出在统一在27ns时会使用最新的输入数据。<strong>相当于先延迟再计算。</strong>这里，b，ci的输入到输出，并没有经过12ns的延迟。</p><ul><li>RHS</li></ul><img src="/2023/112317390/image-20231123193908804.png" alt="always RHS 阻塞" style="zoom: 67%;"><p>​如果延迟12ns的期间，a，b，ci发生了变化，则输出不会体现出来。<strong>相当于先计算，再延迟。</strong></p><p>​在任何阻塞赋值的语句上，尽可能不使用这种形式。</p><h4 id="noblocking-assignment-（always）“"><a href="#noblocking-assignment-（always）“" class="headerlink" title="noblocking assignment （always）“&lt;&#x3D;” 非阻塞赋值"></a>noblocking assignment （always）“&lt;&#x3D;” 非阻塞赋值</h4><img src="/2023/112317390/image-20231123204725158.png" alt="Nonblocking Assignments with Delays" style="zoom:67%;"><ul><li>LHS</li></ul><p>​这种情况和阻塞赋值的”LHS”具有一样的问题。 </p><ul><li>RHS</li></ul><p>​<strong>这种是延迟组合逻辑的正确方式</strong></p><p>​<img src="/2023/112317390/image-20231123212135502.png" alt="always 非阻塞" style="zoom:67%;"></p><p>​<img src="/2023/112317390/image-20231123212223383.png" alt="always 非阻塞" style="zoom: 50%;"></p><p>​15ns时，a发生变化，在此后的12ns如果a，ci，b发生变化，则在27ns不会使用最新的数据，而是每个变化点后的12ns才发生改变。符合预期效果。</p><h4 id="Continuous-assignment"><a href="#Continuous-assignment" class="headerlink" title="Continuous assignment"></a>Continuous assignment</h4><img src="/2023/112317390/image-20231123213602068.png" alt="continous assignments" style="zoom:50%;"><p>​RHS delay，存在和always同样的问题，间隔小于12ns的任何输入变化都不会被检测到。</p><img src="/2023/112317390/image-20231123213721809.png" alt="assign '=' delay " style="zoom:50%;"><img src="/2023/112317390/image-20231123213918097.png" alt="assign delay wave" style="zoom: 50%;"><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p><strong>只有always块的非阻塞赋值RHS才可以准确描述组合逻辑的延迟。</strong></p><h4 id="Bug"><a href="#Bug" class="headerlink" title="Bug"></a>Bug</h4><p>在tb测试时，如果输入信号是通过@(posedge clk)给出的，一定要 <strong>使用&lt;&#x3D;非阻塞赋值</strong>。否则，会导致，在上升沿时阻塞和非阻塞赋值冲突。</p><p>建模中，对于延迟的信号，需要 <strong>赋初始值</strong>。</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">assign #10 c &#x3D; a &amp; b;  &#x2F;&#x2F; 是允许的assign #10 c &lt;&#x3D; a &amp; b; &#x2F;&#x2F; 是不允许的assign c &#x3D; #10 a &amp; b;  &#x2F;&#x2F; 是不允许的<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> RTL仿真 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RTL延迟建模方法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>小谈case语句</title>
      <link href="/2023/112324934.html"/>
      <url>/2023/112324934.html</url>
      
        <content type="html"><![CDATA[<h4 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h4><p>​最近一直在写code，随着学习的深入，越来越想知道verilog 语法和对应的电路实现是什么样子的。</p><p>​首先，确定一点，完备的case，所有的分支都是并行的，且互斥，所以讨论有没有优先级是没有意义的，它对应的电路是一个MUX。（没有优先级）</p><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog">完备的<span class="token keyword">case</span>分支，等价于 <span class="token keyword">if</span> <span class="token keyword">else</span><span class="token operator">-</span><span class="token keyword">if</span> <span class="token keyword">else</span><span class="token operator">-</span><span class="token keyword">if</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>缺省case</li></ul><p>​case的分支中，如果缺省，不进行其他操作，dc综合的时候<strong>会生成锁存器latch</strong></p><p>​这个时候如果添加原语 <strong>&#x2F;&#x2F;synopsys full_case</strong> ，目的是让综合器DC知道所有情况都已经列全了，不会生成latch。</p><ul><li><p>full case</p><p>每个可能的case expression的取值，都有与之相对应的分支。都列全了，即使没有default，也是full case synopsys的dc_shell把full_case解释为：如果case不是full，对于没有出现的分支条件，输出就当成“不关心”处理，在综合的时候，对于没有出现的分支，会根据逻辑优化赋个常数。<strong>这样会导致前仿和后仿的结果不一致，所以需要注意这个地方</strong>，如果case中有default，case_full会被忽略。</p></li><li><p>parallel case</p><p>parallel case是指case expression只能匹配一个分支，不能出现一对多的情况。</p><p>告诉DC，所有条件都是互斥的，且都是并行，不存在优先级。</p><p>优先级只会存在于多对一的情况下。</p><p><strong>在仿真的时候出现了多对一的情况，会导致仿真执行有一定的优先级，这样就不是parallel case。如果针对这种情况dc时，加上parallel case，会综合出没有优先级的编码器。</strong></p><p>通过<strong>遍历条件</strong>在case中是否<strong>只会被执行一次</strong>，我们可以判断case的综合结果为串行还是并行</p></li></ul><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>​当case 是full且是parallel的时候，综合出来的电路是没有优先级的MUX，多选一数据选择器；</p><p>​如果case不是full，又没有default，会综合出latch。</p><h4 id="综合"><a href="#综合" class="headerlink" title="综合"></a>综合</h4><p>if elseif 和case</p><p><img src="/2023/112324934/image-20240507185616364.png" alt="image-20240507185616364"></p><p><img src="/2023/112324934/image-20240507185631196.png" alt="image-20240507185631196"></p><p>使用case语句去除优先级，可以大大优化电路的逻辑</p><h3 id="unique和priority-case"><a href="#unique和priority-case" class="headerlink" title="unique和priority case"></a>unique和priority case</h3><p>属于SV的语法，unique case等效为full_case+parallel_case，而priority case则等效为full_case。值得注意的是，unique case和priority case是<strong>SV语法</strong>，而full_case和parallel_case是<strong>编译选项</strong>。</p><h5 id="unique-case"><a href="#unique-case" class="headerlink" title="unique case"></a>unique case</h5><p>相当于full_case+parallel_case，case_expression同时只能匹配一个case_selection_items；一个case_selection_items必须存在与之对应的case_expression。unique修饰该case语句是完整的且并行的，各case分支之间彼此互斥，没有交叠。</p><h5 id="priority-case"><a href="#priority-case" class="headerlink" title="priority case"></a>priority case</h5><p>相当于full_case，有优先级的时候才使用。case分支的位置很重要，决定了优先级。</p><pre class="line-numbers language-systemverilog" data-language="systemverilog"><code class="language-systemverilog">always_combpriority case (1’b1)irq0: irq &#x3D; 4’b0001;irq1: irq &#x3D; 4’b0010;irq2: irq &#x3D; 4’b0100;irq3: irq &#x3D; 4’b1000;endcase<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果case不满足unique case和priority case，编译时会直接报错。</p>]]></content>
      
      
      <categories>
          
          <category> 数字前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础知识 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>提高RTL仿真速度</title>
      <link href="/2023/11224275.html"/>
      <url>/2023/11224275.html</url>
      
        <content type="html"><![CDATA[<h2 id="如何提高仿真器的效率"><a href="#如何提高仿真器的效率" class="headerlink" title="如何提高仿真器的效率"></a>如何提高仿真器的效率</h2><p>了解仿真器的底层原理，合适的code style会节省仿真时间。</p><h4 id="仿真算法："><a href="#仿真算法：" class="headerlink" title="仿真算法："></a><strong>仿真算法：</strong></h4><ol><li><p>基于时间的（spice仿真器）</p><p>每个时间节点对所有元件都进行计算，效率低。</p></li><li><p>基于事件的（Verilog XL，NC verilog）</p><p>只有电路发生变化时，才进行处理。效率高。</p></li><li><p>基于周期的（Verilator ）</p><p>只在时钟边沿计算，不管时序，使用两值逻辑。仅适用于同步电路，效率高。比如CPU的仿真。</p></li></ol><p>​以下的测试都是基于Verilog-XL</p><ul><li><h4 id="case语句和多if-else-if语句"><a href="#case语句和多if-else-if语句" class="headerlink" title="case语句和多if else if语句"></a>case语句和多if else if语句</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token comment">// case                         // if else-if                    </span><span class="token important">always @</span>（<span class="token operator">*</span>）<span class="token keyword">begin</span>                <span class="token important">always @</span>（<span class="token operator">*</span>）<span class="token keyword">begin</span>                    <span class="token function">case</span><span class="token punctuation">(</span>sel<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                  <span class="token function">if</span><span class="token punctuation">(</span>sel <span class="token operator">==</span> <span class="token number">2'b00</span><span class="token punctuation">)</span>                     <span class="token number">2'b00</span><span class="token punctuation">:</span> out <span class="token operator">=</span> a<span class="token punctuation">;</span>                 out <span class="token operator">=</span> a<span class="token punctuation">;</span>                        <span class="token number">2'b01</span><span class="token punctuation">:</span> out <span class="token operator">=</span> b<span class="token punctuation">;</span>             <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>sel <span class="token operator">==</span> <span class="token number">2'b01</span><span class="token punctuation">)</span>                     <span class="token number">2'b10</span><span class="token punctuation">:</span> out <span class="token operator">=</span> c<span class="token punctuation">;</span>                 out <span class="token operator">=</span> b<span class="token punctuation">;</span>                        <span class="token number">2'b11</span><span class="token punctuation">:</span> out <span class="token operator">=</span> d<span class="token punctuation">;</span>             <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>sel <span class="token operator">==</span> <span class="token number">2'b10</span><span class="token punctuation">)</span>                     <span class="token keyword">default</span> <span class="token punctuation">:</span> out <span class="token operator">=</span> a<span class="token punctuation">;</span>              out <span class="token operator">=</span> c<span class="token punctuation">;</span>                    <span class="token keyword">endcase</span>                         <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>sel <span class="token operator">==</span> <span class="token number">2'b11</span><span class="token punctuation">)</span>             <span class="token keyword">end</span>                                     out <span class="token operator">=</span> d<span class="token punctuation">;</span>                                                   <span class="token keyword">end</span>      <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>测试案例：8选1数据选择器，</p><p>仿真发现：基于case的多路选择器，CPU仿真时间更短。</p></li><li><h4 id="带有begin-end和不带begin-end"><a href="#带有begin-end和不带begin-end" class="headerlink" title="带有begin end和不带begin end"></a>带有begin end和不带begin end</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span><span class="token keyword">begin</span><span class="token function">if</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> c <span class="token operator">&lt;=</span> b<span class="token punctuation">;</span><span class="token keyword">else</span>  c <span class="token operator">&lt;=</span> d<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span><span class="token function">if</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> c <span class="token operator">&lt;=</span> b<span class="token punctuation">;</span><span class="token keyword">else</span>  c <span class="token operator">&lt;=</span> d<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p>​测试结果：nobegin表述的内存利用率和仿真时间要优一些。</p><ul><li><h4 id="define-和-parameters"><a href="#define-和-parameters" class="headerlink" title="&#96;define 和 parameters"></a>&#96;define 和 parameters</h4><img src="/2023/11224275/define1.jpg" alt="define&amp;parameters"></li></ul><p>​parameters要更好一些。</p><ul><li><h4 id="always-group和nogroup"><a href="#always-group和nogroup" class="headerlink" title="always group和nogroup"></a>always group和nogroup</h4><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span>en<span class="token punctuation">)</span> <span class="token keyword">begin</span>        out1 <span class="token operator">&lt;=</span> a<span class="token punctuation">;</span>        out2 <span class="token operator">&lt;=</span> b<span class="token punctuation">;</span>        out3 <span class="token operator">&lt;=</span> c<span class="token punctuation">;</span>        out4 <span class="token operator">&lt;=</span> d<span class="token punctuation">;</span>    <span class="token keyword">end</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span>en<span class="token punctuation">)</span> out1 <span class="token operator">&lt;=</span> a<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span>en<span class="token punctuation">)</span> out2 <span class="token operator">&lt;=</span> b<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span>en<span class="token punctuation">)</span> out3 <span class="token operator">&lt;=</span> c<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span>en<span class="token punctuation">)</span> out4 <span class="token operator">&lt;=</span> d<span class="token punctuation">;</span><span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/2023/11224275/image-20231122100101428.png" alt="group&amp;nogroup"></p><p>group的仿真时间明显缩短了。</p></li><li><p>verilog可综合</p></li></ul><p>​左移，右移逻辑的操作数，可以是常数，也可以是变量，都是可以综合的，综合结果不一样。 常数的操作数，综合 出来是一个定值，变量的操作数综合出来是一个mux。</p><ul><li>DC时综合的原语</li></ul><pre class="line-numbers language-tcl" data-language="tcl"><code class="language-tcl"><span class="token operator">/</span><span class="token operator">/</span> synopsys translate_off忽略该部分的代码，DC时不会进行转义。<span class="token operator">/</span><span class="token operator">/</span> synopsys translate_on忽略的部分在前仿时是可以发挥作用的，如果错误使用translate_off on语句，会导致前仿和后仿的结果不一致。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token comment">// 小心使用translate off on</span>ex<span class="token punctuation">.</span>带两个异步复位信号的D触发器一般的实现方式如下：<span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst <span class="token keyword">or</span> <span class="token keyword">negedge</span> nset<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span> <span class="token comment">// asyn</span>        q <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nset<span class="token punctuation">)</span> <span class="token comment">// asyn</span>        q <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>         q <span class="token operator">&lt;=</span> d<span class="token punctuation">;</span><span class="token keyword">end</span>这种方式会导致前仿和后仿出现细微的区别。极端测试向量如下：如果nrst和nset同时拉低，则结果输出为<span class="token number">0</span><span class="token punctuation">.</span>经过半个周期后，nrst拉高了，输出结果依然为<span class="token number">0</span><span class="token punctuation">.</span>因为<span class="token important">always</span>块是边沿敏感触发的，但是nset和nrst都是异步的，nset此时为<span class="token number">0</span>，q输出结果应该为<span class="token number">1</span>；计算结果与实际电路不符。解决办法：    加入translate on off语句。配合<span class="token keyword">force</span> 和 relase正确code如下：<span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> nrst <span class="token keyword">or</span> <span class="token keyword">negedge</span> nset<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nrst<span class="token punctuation">)</span> <span class="token comment">// asyn</span>        q <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>nset<span class="token punctuation">)</span> <span class="token comment">// asyn</span>        q <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>         q <span class="token operator">&lt;=</span> d<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token comment">// synopsys translate_off</span><span class="token important">always @</span><span class="token punctuation">(</span>nrst <span class="token keyword">or</span> nset<span class="token punctuation">)</span> <span class="token keyword">begin</span>    <span class="token function">if</span><span class="token punctuation">(</span>nrst <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>nset<span class="token punctuation">)</span>   <span class="token keyword">force</span> q <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>                <span class="token keyword">release</span> q<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token comment">// synopsys translate_on</span>该代码可以保证，在nrst撤离时，nset如果为<span class="token number">0</span>，q输出结果为<span class="token number">1</span>；这是在前仿时需要加入的特殊语句，并加上原语。在实际综合过程中，不会被综合。保证了前仿和实际流片的结果完全一致。在工艺库中，有时钟，异步复位和异步置数的端口，也就是说<span class="token important">always</span>块中的敏感列表，最多可以有三个。但是不能是同时<span class="token keyword">posedge</span> clk <span class="token keyword">or</span> <span class="token keyword">negedge</span> clk。一个信号不能依赖两个边沿。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>verilog调试</p><p>bg：verilog中的参数可以用 &#96;define和parameter指定，这种方式必须要求我们在编译前修改好，编译后就不能再修改了。但是为了节省编译时间，可以使用 $test$plusargs和$value$plusargs来指定。</p></li></ul><pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token constant">`timescale</span> <span class="token number">1</span>ns<span class="token operator">/</span><span class="token number">1</span>ps<span class="token keyword">module</span> tb<span class="token punctuation">;</span><span class="token keyword">reg</span><span class="token punctuation">[</span><span class="token number">255</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> testname<span class="token punctuation">;</span><span class="token keyword">initial</span> <span class="token keyword">begin</span><span class="token kernel-function property">$display</span><span class="token punctuation">(</span><span class="token string">"**********************RESULT IS BELOW*********************"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">if</span><span class="token punctuation">(</span><span class="token kernel-function property">$test</span><span class="token kernel-function property">$plusargs</span><span class="token punctuation">(</span><span class="token string">"TAISHAN"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token kernel-function property">$display</span><span class="token punctuation">(</span><span class="token string">"****************TAISHAN is selected******************"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">else</span><span class="token kernel-function property">$display</span><span class="token punctuation">(</span><span class="token string">"**********************$test$plusargs FAIL**************"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token kernel-function property">$value</span><span class="token kernel-function property">$plusargs</span><span class="token punctuation">(</span><span class="token string">"TESTNAME=%s"</span><span class="token punctuation">,</span> testname<span class="token punctuation">[</span><span class="token number">255</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token keyword">begin</span>  <span class="token kernel-function property">$display</span><span class="token punctuation">(</span><span class="token string">"*****************Running test %0s.********************"</span><span class="token punctuation">,</span> testname<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">end</span> <span class="token keyword">else</span> <span class="token kernel-function property">$display</span><span class="token punctuation">(</span><span class="token string">"**********************$value$plusargs FAIL**************"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token kernel-function property">$finish</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token keyword">endmodule</span>使用方式：<span class="token number">1</span><span class="token punctuation">.</span>simv<span class="token number">2</span><span class="token punctuation">.</span>simv<span class="token operator">+</span>TATSHAN<span class="token number">3</span><span class="token punctuation">.</span>simv<span class="token operator">+</span>TAISHAN<span class="token operator">+</span>TESTNAME<span class="token operator">=</span>HUASHAN<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在仿真时，0时刻会执行一些系统函数，有些数据没有准备好，导致发生系统仿真错误，因此，可以在代码中初始化变量的值。</p><p><img src="/2023/11224275/image-20240203213035815.png"></p><p><img src="/2023/11224275/image-20240203213107944.png"></p>]]></content>
      
      
      <categories>
          
          <category> RTL仿真 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 仿真器底层原理 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
